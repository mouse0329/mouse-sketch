const _0x165a85=_0x3c84;(function(_0x17bd37,_0x217efc){const _0x4601de=_0x3c84,_0x41bd5e=_0x17bd37();while(!![]){try{const _0x2f35b3=parseInt(_0x4601de(0x11e))/0x1*(-parseInt(_0x4601de(0xf1))/0x2)+parseInt(_0x4601de(0x110))/0x3*(-parseInt(_0x4601de(0x141))/0x4)+-parseInt(_0x4601de(0xdb))/0x5*(-parseInt(_0x4601de(0xe6))/0x6)+parseInt(_0x4601de(0x11a))/0x7+parseInt(_0x4601de(0x103))/0x8+parseInt(_0x4601de(0xe3))/0x9+-parseInt(_0x4601de(0xf6))/0xa*(parseInt(_0x4601de(0xc5))/0xb);if(_0x2f35b3===_0x217efc)break;else _0x41bd5e['push'](_0x41bd5e['shift']());}catch(_0x2ae8a9){_0x41bd5e['push'](_0x41bd5e['shift']());}}}(_0x3640,0xb277d));const _0x358f49=(function(){let _0x3d0749=!![];return function(_0x3097a7,_0x24a568){const _0x313e30=_0x3d0749?function(){const _0x37865c=_0x3c84;if(_0x24a568){const _0x309918=_0x24a568[_0x37865c(0x10b)](_0x3097a7,arguments);return _0x24a568=null,_0x309918;}}:function(){};return _0x3d0749=![],_0x313e30;};}()),_0x584ced=_0x358f49(this,function(){const _0x18146c=_0x3c84;return _0x584ced['toString']()[_0x18146c(0x116)](_0x18146c(0x130))[_0x18146c(0x142)]()[_0x18146c(0x105)](_0x584ced)[_0x18146c(0x116)]('(((.+)+)+)+$');});_0x584ced();function createProject(_0x15f120=0x10,_0xe5f623=0x10,_0x2c5051=''){const _0x4741e6=_0x3c84;let _0x5bbc42=0x14,_0x44d315=[],_0xe3b2ef=[],_0x207749=[],_0x162963=document[_0x4741e6(0x133)](_0x4741e6(0xce));_0x162963[_0x4741e6(0xbb)]=_0x15f120*_0x5bbc42,_0x162963['height']=_0xe5f623*_0x5bbc42,_0x44d315[_0x4741e6(0x10f)]({'canvas':_0x162963,'visible':!![]}),_0xe3b2ef[_0x4741e6(0x10f)]([]),_0x207749['push']([]);let _0x46a5b0={'layers':_0x44d315,'activeLayer':0x0,'layerHistories':_0xe3b2ef,'layerRedoStacks':_0x207749};return{'frames':[_0x46a5b0],'activeFrame':0x0,'width':_0x15f120,'height':_0xe5f623,'name':_0x2c5051||'画像'+(projects[_0x4741e6(0x138)]+0x1)};}function _0x3c84(_0x44ebde,_0xc4c73a){_0x44ebde=_0x44ebde-0xb9;const _0x7c6ad2=_0x3640();let _0x584ced=_0x7c6ad2[_0x44ebde];return _0x584ced;}function editProjectName(_0x5634a2,_0x181547){const _0xc1670d=_0x3c84,_0x110d5e=document[_0xc1670d(0x133)](_0xc1670d(0xee));_0x110d5e['type']=_0xc1670d(0x112),_0x110d5e[_0xc1670d(0x129)]=projects[_0x5634a2]['name']||'画像'+(_0x5634a2+0x1),_0x110d5e[_0xc1670d(0xc4)]=_0xc1670d(0xc1),_0x110d5e[_0xc1670d(0x12f)]['width']=_0xc1670d(0xf7),_0x110d5e[_0xc1670d(0x135)]=()=>{const _0x355c60=_0xc1670d;projects[_0x5634a2]['name']=_0x110d5e['value'][_0x355c60(0xf5)]()||'画像'+(_0x5634a2+0x1),updateProjectUI();},_0x110d5e[_0xc1670d(0xf9)]=_0x4f8f5b=>{const _0x5433b3=_0xc1670d;if(_0x4f8f5b[_0x5433b3(0x104)]==='Enter')_0x110d5e[_0x5433b3(0x124)]();},_0x181547[_0xc1670d(0xfb)](_0x110d5e),_0x110d5e['focus'](),_0x110d5e[_0xc1670d(0x10a)]();}function addProject(){showNewProjectDialog((_0x35a38b,_0x5c265e,_0x2ecacd)=>{const _0x4ade50=_0x3c84;if(!Number[_0x4ade50(0x126)](_0x35a38b)||_0x35a38b<0x1)_0x35a38b=0x10;if(!Number[_0x4ade50(0x126)](_0x5c265e)||_0x5c265e<0x1)_0x5c265e=0x10;projects[_0x4ade50(0x10f)](createProject(_0x35a38b,_0x5c265e,_0x2ecacd)),activeProject=projects[_0x4ade50(0x138)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();});}function removeProjectAt(_0x3aff1d){const _0x13ea8a=_0x3c84;if(projects[_0x13ea8a(0x138)]<=0x1)return;const _0x14d1d4=projects[_0x3aff1d]&&projects[_0x3aff1d][_0x13ea8a(0xd2)]?projects[_0x3aff1d][_0x13ea8a(0xd2)]:'画像'+(_0x3aff1d+0x1);if(!confirm('「'+_0x14d1d4+_0x13ea8a(0xe1)))return;projects[_0x13ea8a(0x119)](_0x3aff1d,0x1);if(activeProject>=projects[_0x13ea8a(0x138)])activeProject=projects[_0x13ea8a(0x138)]-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentProject(){return projects[activeProject];}function addFrame(){const _0x862cdf=_0x3c84,_0x3b8716=getCurrentProject(),_0x4393e1=_0x3b8716['frames'][_0x3b8716[_0x862cdf(0xc2)]],_0x806874=_0x4f5f82=>{const _0x4a4187=_0x862cdf,_0x5192d2=document['createElement']('canvas');_0x5192d2['width']=_0x4f5f82[_0x4a4187(0xbb)],_0x5192d2[_0x4a4187(0xd1)]=_0x4f5f82[_0x4a4187(0xd1)];const _0xd23fd0=_0x5192d2['getContext']('2d');if(_0x4f5f82 instanceof HTMLCanvasElement)_0xd23fd0['drawImage'](_0x4f5f82,0x0,0x0);else _0x4f5f82[_0x4a4187(0xce)]&&_0x4f5f82['canvas']instanceof HTMLCanvasElement?_0xd23fd0['drawImage'](_0x4f5f82[_0x4a4187(0xce)],0x0,0x0):console[_0x4a4187(0xfd)](_0x4a4187(0xe0),_0x4f5f82);return _0x5192d2;},_0x2f512d=_0x4393e1[_0x862cdf(0xcd)]['map'](_0x806874),_0x2b7862=_0x2f512d[_0x862cdf(0xdc)](()=>[]),_0x5d9a54=_0x2f512d[_0x862cdf(0xdc)](()=>[]),_0x2e8e55={'layers':_0x2f512d,'activeLayer':0x0,'layerHistories':_0x2b7862,'layerRedoStacks':_0x5d9a54};_0x3b8716[_0x862cdf(0xeb)][_0x862cdf(0x119)](_0x3b8716[_0x862cdf(0xc2)]+0x1,0x0,_0x2e8e55),_0x3b8716[_0x862cdf(0xc2)]++,updateFrameUI(),updateLayerUI(),redrawAll();}function _0x3640(){const _0x563c62=['width','charCodeAt','startAutoSaveInterval','getElementById','auto-save:\x20saved','stringify','project-name-edit','activeFrame','folder','className','27324hNLkiF','createObjectURL','hidden','application/json','log','startAutoSaveInterval:\x20starting\x20interval\x20','auto-save\x20failed','getImageData','layers','canvas','target','number','height','name','textContent','requestAutoSave:\x20timer\x20fired','split','requestAutoSave','保存に失敗したチュー:','getItem','startCell','ZIP作成中...','137270sjucNF','map','ファイルを読み込み中...','ファイルの読み込みに失敗しました。','error','複製できないレイヤーがありますチュー','」を削除しますか？','onload','10746459bGWqnS','parse','active','162oDgJvz','loadProjectFromIDB:\x20localStorage\x20quick\x20load\x20failed','loadProjectFromIDB:\x20DB\x20に保存が見つかりませんでした。localStorage\x20のクイック保存を確認します。','loadProjectFromIDB:\x20localStorage\x20のクイック保存を復元します','offsetCells','frames','drawImage','readAsText','input','onerror','getContext','6542LzTZZm','all','clearRect','pen','trim','4130boRlgb','80px','layerRedoStacks','onkeydown','data','replaceWith','startsWith','warn','setItem','layer-','src','.gif','projects','10616768iBYGOb','key','constructor','addEventListener','appendChild','nezumi-sketch.msketch','catch','select','apply','files','visibilitychange','debug','push','536172uEABeS','body','text','.apng','ファイルにプロジェクトメタデータが見つかりませんでした。読み込みできません。','image/png','search','nezumi-sketch-save-quick','max','splice','7400617rlVYHp','nezumi-animation','layerExportStatus','some','401IpwjZP','nudgeActiveLayer:\x20対象レイヤーのキャンバスが見つかりません','flushQuickSaveToLocalStorage:\x20saved\x20quick\x20snapshot','activeLayer','requestAutoSave:\x20scheduling\x20save\x20in\x20','frame-','blur','layerHistories','isFinite','flushQuickSaveToLocalStorage\x20failed','floor','value','then','処理中...','beforeunload','プロジェクトをIndexedDBに保存したチュー！','activeProject','style','(((.+)+)+)+$','info','href','createElement','type','onblur','スタンドアロン形式のプロジェクトを読み込みました:\x20','replace','length','IndexedDBからの読み込みに失敗したチュー…','disabled','pasteLayerBtn','toDataURL','image','auto-save\x20(interval):\x20saved','IndexedDBからプロジェクトを読み込んだチュー！','generateAsync','28OafUaU','toString','loadProjectFromIDB:\x20データ確認','click','function','isArray','download'];_0x3640=function(){return _0x563c62;};return _0x3640();}const cloneLayer=_0x193e52=>{const _0x42a2a4=_0x3c84,_0x5c1e01=document[_0x42a2a4(0x133)](_0x42a2a4(0xce));_0x5c1e01[_0x42a2a4(0xbb)]=_0x193e52[_0x42a2a4(0xbb)],_0x5c1e01[_0x42a2a4(0xd1)]=_0x193e52['height'];const _0x177e17=_0x5c1e01[_0x42a2a4(0xf0)]('2d');if(_0x193e52 instanceof HTMLCanvasElement)_0x177e17[_0x42a2a4(0xec)](_0x193e52,0x0,0x0);else _0x193e52[_0x42a2a4(0xce)]&&_0x193e52['canvas']instanceof HTMLCanvasElement?_0x177e17[_0x42a2a4(0xec)](_0x193e52[_0x42a2a4(0xce)],0x0,0x0):console[_0x42a2a4(0xfd)](_0x42a2a4(0xe0),_0x193e52);return _0x5c1e01;};function removeFrameAt(_0x5908ec){const _0x473e73=_0x3c84;let _0x309661=getCurrentProject();if(_0x309661[_0x473e73(0xeb)]['length']<=0x1)return;_0x309661['frames']['splice'](_0x5908ec,0x1);if(_0x309661[_0x473e73(0xc2)]>=_0x309661[_0x473e73(0xeb)][_0x473e73(0x138)])_0x309661['activeFrame']=_0x309661[_0x473e73(0xeb)][_0x473e73(0x138)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0x2d5503=_0x3c84,_0x3c4dd1=getCurrentProject();if(!_0x3c4dd1||!_0x3c4dd1['frames']||typeof _0x3c4dd1['activeFrame']!==_0x2d5503(0xd0)||!_0x3c4dd1[_0x2d5503(0xeb)][_0x3c4dd1['activeFrame']])return null;return _0x3c4dd1[_0x2d5503(0xeb)][_0x3c4dd1[_0x2d5503(0xc2)]];}function swapLayer(_0x5f2cab,_0x1977ea){const _0x698a93=_0x3c84;let _0x537f78=getCurrentFrame();[_0x537f78['layers'][_0x5f2cab],_0x537f78['layers'][_0x1977ea]]=[_0x537f78[_0x698a93(0xcd)][_0x1977ea],_0x537f78['layers'][_0x5f2cab]],[_0x537f78['layerHistories'][_0x5f2cab],_0x537f78['layerHistories'][_0x1977ea]]=[_0x537f78[_0x698a93(0x125)][_0x1977ea],_0x537f78[_0x698a93(0x125)][_0x5f2cab]],[_0x537f78[_0x698a93(0xf8)][_0x5f2cab],_0x537f78[_0x698a93(0xf8)][_0x1977ea]]=[_0x537f78[_0x698a93(0xf8)][_0x1977ea],_0x537f78[_0x698a93(0xf8)][_0x5f2cab]];if(_0x537f78[_0x698a93(0x121)]===_0x5f2cab)_0x537f78[_0x698a93(0x121)]=_0x1977ea;else{if(_0x537f78[_0x698a93(0x121)]===_0x1977ea)_0x537f78['activeLayer']=_0x5f2cab;}updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x698a93(0x145))requestAutoSave();}function removeLayerAt(_0x4a6c47){const _0xa01bd=_0x3c84;let _0x433633=getCurrentFrame();if(_0x433633[_0xa01bd(0xcd)][_0xa01bd(0x138)]<=0x1)return;_0x433633['layers'][_0xa01bd(0x119)](_0x4a6c47,0x1),_0x433633['layerHistories'][_0xa01bd(0x119)](_0x4a6c47,0x1),_0x433633[_0xa01bd(0xf8)][_0xa01bd(0x119)](_0x4a6c47,0x1);if(_0x433633[_0xa01bd(0x121)]>=_0x433633[_0xa01bd(0xcd)][_0xa01bd(0x138)])_0x433633[_0xa01bd(0x121)]=_0x433633[_0xa01bd(0xcd)][_0xa01bd(0x138)]-0x1;updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0xa01bd(0x145))requestAutoSave();}function addLayer(){const _0x8d622a=_0x3c84;let _0x3feca9=getCurrentProject(),_0x53ef2b=getCurrentFrame(),_0x954212=document[_0x8d622a(0x133)](_0x8d622a(0xce));_0x954212[_0x8d622a(0xbb)]=_0x3feca9['width']*cellSize,_0x954212[_0x8d622a(0xd1)]=_0x3feca9[_0x8d622a(0xd1)]*cellSize,_0x53ef2b[_0x8d622a(0xcd)][_0x8d622a(0x10f)]({'canvas':_0x954212,'visible':!![]}),_0x53ef2b[_0x8d622a(0x125)][_0x8d622a(0x10f)]([]),_0x53ef2b[_0x8d622a(0xf8)][_0x8d622a(0x10f)]([]),_0x53ef2b['activeLayer']=_0x53ef2b[_0x8d622a(0xcd)]['length']-0x1,saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0x1c946d=_0x3c84;let _0x350bc2=getCurrentFrame();if(_0x350bc2[_0x1c946d(0xcd)]['length']<=0x1)return;_0x350bc2[_0x1c946d(0xcd)][_0x1c946d(0x119)](_0x350bc2['activeLayer'],0x1),_0x350bc2[_0x1c946d(0x125)][_0x1c946d(0x119)](_0x350bc2['activeLayer'],0x1),_0x350bc2[_0x1c946d(0xf8)][_0x1c946d(0x119)](_0x350bc2[_0x1c946d(0x121)],0x1),_0x350bc2[_0x1c946d(0x121)]=Math[_0x1c946d(0x118)](0x0,_0x350bc2[_0x1c946d(0x121)]-0x1),updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x1c946d(0x145))requestAutoSave();}function selectLayer(_0x376036){getCurrentFrame()['activeLayer']=parseInt(_0x376036),updateLayerUI();}function copyLayer(){const _0x4faeb7=_0x3c84,_0x2db929=getCurrentFrame();if(!_0x2db929)return;const _0x29b196=_0x2db929['activeLayer'];if(typeof _0x29b196!==_0x4faeb7(0xd0)||!_0x2db929[_0x4faeb7(0xcd)][_0x29b196])return;const _0x332874=_0x2db929[_0x4faeb7(0xcd)][_0x29b196],_0x4276bf=_0x332874&&_0x332874[_0x4faeb7(0xce)]?_0x332874['canvas']:_0x332874;if(!_0x4276bf||typeof _0x4276bf['toDataURL']!=='function')return;copiedLayerDataUrl=_0x4276bf[_0x4faeb7(0x13c)]();const _0x47b623=document[_0x4faeb7(0xbe)](_0x4faeb7(0x13b));if(_0x47b623)_0x47b623[_0x4faeb7(0x13a)]=![];}function pasteLayer(){const _0x396dcd=_0x3c84;if(!copiedLayerDataUrl)return;const _0x24732f=getCurrentProject(),_0x3b72e4=getCurrentFrame();if(!_0x24732f||!_0x3b72e4)return;const _0x4de8df=document[_0x396dcd(0x133)](_0x396dcd(0xce));_0x4de8df[_0x396dcd(0xbb)]=_0x24732f['width']*cellSize,_0x4de8df[_0x396dcd(0xd1)]=_0x24732f[_0x396dcd(0xd1)]*cellSize;const _0x4bb08e=_0x4de8df['getContext']('2d'),_0x1aa1a6=new Image();_0x1aa1a6['onload']=()=>{const _0x24193e=_0x396dcd;_0x4bb08e[_0x24193e(0xf3)](0x0,0x0,_0x4de8df[_0x24193e(0xbb)],_0x4de8df[_0x24193e(0xd1)]),_0x4bb08e[_0x24193e(0xec)](_0x1aa1a6,0x0,0x0),_0x3b72e4[_0x24193e(0xcd)]['push']({'canvas':_0x4de8df,'visible':!![]}),_0x3b72e4['layerHistories'][_0x24193e(0x10f)]([]),_0x3b72e4['layerRedoStacks'][_0x24193e(0x10f)]([]),_0x3b72e4[_0x24193e(0x121)]=_0x3b72e4[_0x24193e(0xcd)][_0x24193e(0x138)]-0x1,saveHistory(),updateLayerUI(),redrawAll();},_0x1aa1a6[_0x396dcd(0x100)]=copiedLayerDataUrl;}async function exportLayersAsGif(){const _0x42d9a6=_0x3c84,_0x13edb8=document[_0x42d9a6(0xbe)](_0x42d9a6(0x11c));if(_0x13edb8)_0x13edb8[_0x42d9a6(0xd3)]=_0x42d9a6(0x12b);const _0x57ecef=getCurrentProject();if(!_0x57ecef){if(_0x13edb8)_0x13edb8[_0x42d9a6(0xd3)]='';return;}const _0x42e127=_0x57ecef[_0x42d9a6(0xeb)],_0x8689aa=_0x57ecef[_0x42d9a6(0xbb)]*cellSize,_0x345210=_0x57ecef['height']*cellSize;let _0x1d4109=0x0;_0x42e127['forEach'](_0x5aa393=>{const _0x5e6914=_0x42d9a6;_0x1d4109=Math[_0x5e6914(0x118)](_0x1d4109,_0x5aa393[_0x5e6914(0xcd)][_0x5e6914(0x138)]);});for(let _0xf6c860=0x0;_0xf6c860<_0x1d4109;_0xf6c860++){const _0x316559=await Promise['all'](_0x42e127[_0x42d9a6(0xdc)](_0x370aa5=>{return new Promise(_0x52a1e4=>{const _0x6eded9=_0x3c84,_0x4e4b15=document[_0x6eded9(0x133)](_0x6eded9(0xce));_0x4e4b15[_0x6eded9(0xbb)]=_0x8689aa,_0x4e4b15['height']=_0x345210;const _0x2a7be0=_0x4e4b15[_0x6eded9(0xf0)]('2d'),_0x2d76db=_0x370aa5[_0x6eded9(0xcd)][_0xf6c860]&&_0x370aa5['layers'][_0xf6c860]['canvas']?_0x370aa5[_0x6eded9(0xcd)][_0xf6c860][_0x6eded9(0xce)]:_0x370aa5[_0x6eded9(0xcd)][_0xf6c860];if(_0x2d76db)_0x2a7be0[_0x6eded9(0xec)](_0x2d76db,0x0,0x0);const _0x107033=new Image();_0x107033[_0x6eded9(0xe2)]=()=>_0x52a1e4(_0x107033),_0x107033[_0x6eded9(0x100)]=_0x4e4b15[_0x6eded9(0x13c)](_0x6eded9(0x115));});})),_0x3f47d8=_0x316559[_0x42d9a6(0x11d)](_0x17b063=>{const _0x3c930b=_0x42d9a6,_0x3f5032=document[_0x3c930b(0x133)]('canvas');_0x3f5032[_0x3c930b(0xbb)]=_0x8689aa,_0x3f5032[_0x3c930b(0xd1)]=_0x345210;const _0x39d154=_0x3f5032[_0x3c930b(0xf0)]('2d');_0x39d154[_0x3c930b(0xec)](_0x17b063,0x0,0x0);const _0xc162f0=_0x39d154[_0x3c930b(0xcc)](0x0,0x0,_0x8689aa,_0x345210)['data'];for(let _0x47795d=0x3;_0x47795d<_0xc162f0['length'];_0x47795d+=0x4)if(_0xc162f0[_0x47795d]!==0x0)return!![];return![];});if(!_0x3f47d8)continue;const _0x4181f1=(_0x57ecef[_0x42d9a6(0xd2)]||_0x42d9a6(0x11b))[_0x42d9a6(0x137)](/[\\/:*?"<>|]/g,'_')+('-layer'+(_0xf6c860+0x1)+_0x42d9a6(0x101));convertToGIF(_0x316559,animationDelay,_0x4181f1),await new Promise(_0x1f7275=>setTimeout(_0x1f7275,0x78));}if(_0x13edb8)_0x13edb8[_0x42d9a6(0xd3)]='';}async function exportLayersAsApng(){const _0x375f70=_0x3c84,_0x299b60=document['getElementById'](_0x375f70(0x11c));if(_0x299b60)_0x299b60['textContent']='処理中...';const _0x1a8f2f=getCurrentProject();if(!_0x1a8f2f){if(_0x299b60)_0x299b60['textContent']='';return;}const _0x5911ce=_0x1a8f2f[_0x375f70(0xeb)],_0x422a9f=_0x1a8f2f[_0x375f70(0xbb)]*cellSize,_0x5cfc20=_0x1a8f2f[_0x375f70(0xd1)]*cellSize;let _0x18a0d6=0x0;_0x5911ce['forEach'](_0x5c6424=>{const _0x4eb9bb=_0x375f70;_0x18a0d6=Math[_0x4eb9bb(0x118)](_0x18a0d6,_0x5c6424['layers'][_0x4eb9bb(0x138)]);});for(let _0x26b376=0x0;_0x26b376<_0x18a0d6;_0x26b376++){const _0x571b38=await Promise[_0x375f70(0xf2)](_0x5911ce['map'](_0x46b68c=>{return new Promise(_0x1d3aab=>{const _0x540869=_0x3c84,_0x4bd1c5=document['createElement'](_0x540869(0xce));_0x4bd1c5['width']=_0x422a9f,_0x4bd1c5[_0x540869(0xd1)]=_0x5cfc20;const _0x4d4065=_0x4bd1c5[_0x540869(0xf0)]('2d'),_0x533385=_0x46b68c[_0x540869(0xcd)][_0x26b376]&&_0x46b68c[_0x540869(0xcd)][_0x26b376][_0x540869(0xce)]?_0x46b68c[_0x540869(0xcd)][_0x26b376]['canvas']:_0x46b68c[_0x540869(0xcd)][_0x26b376];if(_0x533385)_0x4d4065[_0x540869(0xec)](_0x533385,0x0,0x0);const _0x3a3252=new Image();_0x3a3252[_0x540869(0xe2)]=()=>_0x1d3aab(_0x3a3252),_0x3a3252[_0x540869(0x100)]=_0x4bd1c5[_0x540869(0x13c)]('image/png');});})),_0x35397d=_0x571b38[_0x375f70(0x11d)](_0x22a863=>{const _0x45e24c=_0x375f70,_0x3c731a=document[_0x45e24c(0x133)](_0x45e24c(0xce));_0x3c731a[_0x45e24c(0xbb)]=_0x422a9f,_0x3c731a[_0x45e24c(0xd1)]=_0x5cfc20;const _0x5ec161=_0x3c731a[_0x45e24c(0xf0)]('2d');_0x5ec161['drawImage'](_0x22a863,0x0,0x0);const _0x286998=_0x5ec161[_0x45e24c(0xcc)](0x0,0x0,_0x422a9f,_0x5cfc20)[_0x45e24c(0xfa)];for(let _0x442949=0x3;_0x442949<_0x286998['length'];_0x442949+=0x4)if(_0x286998[_0x442949]!==0x0)return!![];return![];});if(!_0x35397d)continue;const _0x58b435=(_0x1a8f2f[_0x375f70(0xd2)]||'nezumi-animation')['replace'](/[\\/:*?"<>|]/g,'_')+('-layer'+(_0x26b376+0x1)+_0x375f70(0x113));convertToAPNG(_0x571b38,_0x422a9f,_0x5cfc20,animationDelay,_0x58b435),await new Promise(_0x39b0ae=>setTimeout(_0x39b0ae,0x78));}if(_0x299b60)_0x299b60['textContent']='';}async function exportFramesLayersZip(){const _0xc9fddd=_0x3c84,_0x4fb55e=document['getElementById'](_0xc9fddd(0x11c));if(_0x4fb55e)_0x4fb55e['textContent']=_0xc9fddd(0xda);const _0x3c272e=getCurrentProject();if(!_0x3c272e){if(_0x4fb55e)_0x4fb55e[_0xc9fddd(0xd3)]='';return;}const _0x5d125b=_0x3c272e['frames'],_0x2030d0=_0x3c272e[_0xc9fddd(0xbb)]*cellSize,_0x45ab76=_0x3c272e[_0xc9fddd(0xd1)]*cellSize,_0x40f561=new JSZip();for(let _0x3f871c=0x0;_0x3f871c<_0x5d125b[_0xc9fddd(0x138)];_0x3f871c++){const _0x12c8bb=_0x5d125b[_0x3f871c],_0x5a50e2=_0x40f561[_0xc9fddd(0xc3)](_0xc9fddd(0x123)+(_0x3f871c+0x1));for(let _0x3c350b=0x0;_0x3c350b<_0x12c8bb[_0xc9fddd(0xcd)][_0xc9fddd(0x138)];_0x3c350b++){const _0x2bc653=document[_0xc9fddd(0x133)](_0xc9fddd(0xce));_0x2bc653['width']=_0x2030d0,_0x2bc653[_0xc9fddd(0xd1)]=_0x45ab76;const _0x1ff0e1=_0x2bc653[_0xc9fddd(0xf0)]('2d');_0x1ff0e1[_0xc9fddd(0xf3)](0x0,0x0,_0x2030d0,_0x45ab76);const _0x3e4ea3=_0x12c8bb[_0xc9fddd(0xcd)][_0x3c350b];if(_0x3e4ea3){const _0xe33850=_0x3e4ea3['canvas']?_0x3e4ea3[_0xc9fddd(0xce)]:_0x3e4ea3;if(_0xe33850)_0x1ff0e1[_0xc9fddd(0xec)](_0xe33850,0x0,0x0);}const _0xcc1e86=_0x2bc653[_0xc9fddd(0x13c)](_0xc9fddd(0x115)),_0x5a7986=_0xcc1e86[_0xc9fddd(0xd5)](',')[0x1],_0x591e02=atob(_0x5a7986),_0x6eb6af=new Uint8Array(_0x591e02['length']);for(let _0x59bbbc=0x0;_0x59bbbc<_0x591e02[_0xc9fddd(0x138)];_0x59bbbc++)_0x6eb6af[_0x59bbbc]=_0x591e02[_0xc9fddd(0xbc)](_0x59bbbc);_0x5a50e2['file'](_0xc9fddd(0xff)+(_0x3c350b+0x1)+'.png',_0x6eb6af);}}const _0x5a2300=await _0x40f561[_0xc9fddd(0x140)]({'type':'blob'}),_0x59652a=(_0x3c272e['name']||'nezumi-export')['replace'](/[\\/:*?"<>|]/g,'_'),_0x33593e=document['createElement']('a');_0x33593e['href']=URL[_0xc9fddd(0xc6)](_0x5a2300),_0x33593e[_0xc9fddd(0xba)]=_0x59652a+'-frames-layers.zip',document[_0xc9fddd(0x111)][_0xc9fddd(0x107)](_0x33593e),_0x33593e[_0xc9fddd(0x144)](),setTimeout(()=>{const _0x5ce52e=_0xc9fddd;URL['revokeObjectURL'](_0x33593e[_0x5ce52e(0x132)]),document['body']['removeChild'](_0x33593e);if(_0x4fb55e)_0x4fb55e[_0x5ce52e(0xd3)]='';},0x4b0);}function saveProjectFile(){const _0x53face=_0x3c84,_0x51d8ed=typeof getSavePayload===_0x53face(0x145)?getSavePayload():{'projects':projects[_0x53face(0xdc)](_0x5db539=>({'width':_0x5db539[_0x53face(0xbb)],'height':_0x5db539[_0x53face(0xd1)],'name':_0x5db539[_0x53face(0xd2)]||'','activeFrame':_0x5db539[_0x53face(0xc2)],'frames':_0x5db539['frames'][_0x53face(0xdc)](_0x5688a0=>({'activeLayer':_0x5688a0[_0x53face(0x121)],'layers':_0x5688a0[_0x53face(0xcd)]['map'](_0x2517e9=>_0x2517e9&&_0x2517e9[_0x53face(0xce)]?_0x2517e9['canvas'][_0x53face(0x13c)]():_0x2517e9&&_0x2517e9[_0x53face(0x13c)]?_0x2517e9['toDataURL']():null)}))})),'activeProject':activeProject},_0xfd7791=new Blob([JSON['stringify'](_0x51d8ed)],{'type':_0x53face(0xc8)}),_0x108809=document[_0x53face(0x133)]('a');_0x108809[_0x53face(0xba)]=_0x53face(0x108),_0x108809[_0x53face(0x132)]=URL[_0x53face(0xc6)](_0xfd7791),_0x108809[_0x53face(0x144)]();}function getSavePayload(){const _0x1e7862=_0x3c84;return{'projects':projects['map'](_0x3b87c6=>({'width':_0x3b87c6['width'],'height':_0x3b87c6[_0x1e7862(0xd1)],'name':_0x3b87c6[_0x1e7862(0xd2)]||'','activeFrame':_0x3b87c6[_0x1e7862(0xc2)],'frames':_0x3b87c6['frames']['map'](_0x22d20e=>({'activeLayer':_0x22d20e[_0x1e7862(0x121)],'layers':_0x22d20e[_0x1e7862(0xcd)][_0x1e7862(0xdc)](_0x17b747=>_0x17b747&&_0x17b747[_0x1e7862(0xce)]?_0x17b747['canvas'][_0x1e7862(0x13c)]():_0x17b747&&_0x17b747[_0x1e7862(0x13c)]?_0x17b747[_0x1e7862(0x13c)]():null)}))})),'activeProject':activeProject};}async function saveProjectToIDB(){const _0x3c2936=_0x3c84,_0x18e83c=getSavePayload();try{await idbSet('nezumi-sketch-save',_0x18e83c),console['log'](_0x3c2936(0x12d));}catch(_0x1bae67){console['error'](_0x3c2936(0xd7),_0x1bae67);}}function flushQuickSaveToLocalStorage(){const _0x4f234c=_0x3c84;try{const _0x4926ba=getSavePayload();localStorage[_0x4f234c(0xfe)](_0x4f234c(0x117),JSON[_0x4f234c(0xc0)](_0x4926ba)),console['debug'](_0x4f234c(0x120));}catch(_0x1cd861){console['error'](_0x4f234c(0x127),_0x1cd861);}}window['addEventListener'](_0x165a85(0x10d),()=>{const _0x13f285=_0x165a85;if(document[_0x13f285(0xc7)]&&autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB==='function')saveProjectToIDB();}}),window[_0x165a85(0x106)](_0x165a85(0x12c),()=>{const _0x497f07=_0x165a85;if(autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x497f07(0x145))saveProjectToIDB();}});let autosaveDirty=![],autosaveTimer=null;const AUTOSAVE_DELAY=0x1388,AUTOSAVE_INTERVAL=0xea60;function requestAutoSave(){const _0x17e770=_0x165a85;autosaveDirty=!![];if(autosaveTimer)clearTimeout(autosaveTimer);console[_0x17e770(0x10e)](_0x17e770(0x122)+AUTOSAVE_DELAY+'ms'),autosaveTimer=setTimeout(async()=>{const _0x5f5aa3=_0x17e770;console[_0x5f5aa3(0x10e)](_0x5f5aa3(0xd4));if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console['log'](_0x5f5aa3(0xbf));}catch(_0x3f561a){console[_0x5f5aa3(0xdf)](_0x5f5aa3(0xcb),_0x3f561a);}},AUTOSAVE_DELAY);}function startAutoSaveInterval(){const _0x550043=_0x165a85;console[_0x550043(0x10e)](_0x550043(0xca)+AUTOSAVE_INTERVAL+'ms'),setInterval(async()=>{const _0x146025=_0x550043;if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x146025(0xc9)](_0x146025(0x13e));}catch(_0x3f0d8e){console[_0x146025(0xdf)]('auto-save\x20(interval)\x20failed',_0x3f0d8e);}},AUTOSAVE_INTERVAL);}window[_0x165a85(0xd6)]=requestAutoSave,window[_0x165a85(0xbd)]=startAutoSaveInterval;function loadProjectFile(_0x23fe12){const _0x48f841=_0x165a85,_0x373bf7=_0x23fe12[_0x48f841(0xcf)][_0x48f841(0x10c)][0x0];if(!_0x373bf7)return;if(_0x373bf7[_0x48f841(0x134)]&&_0x373bf7[_0x48f841(0x134)][_0x48f841(0xfc)](_0x48f841(0x13d))){loadStandaloneFromFile(_0x373bf7)[_0x48f841(0x12a)](_0x1a9770=>{const _0x5b5b42=_0x48f841;alert(_0x5b5b42(0x136)+(_0x1a9770[_0x5b5b42(0xd2)]||'画像'));})[_0x48f841(0x109)](_0x1091c5=>{const _0x2f8261=_0x48f841;console[_0x2f8261(0xfd)](_0x1091c5),alert(_0x2f8261(0x114));});return;}const _0x36f839=new FileReader();try{showLoading(_0x48f841(0xdd));}catch(_0x4fa912){}_0x36f839['onload']=function(_0x3e8c86){const _0x18481e=_0x48f841;try{const _0x4d8fae=JSON[_0x18481e(0xe4)](_0x3e8c86['target']['result']);projects=_0x4d8fae['projects']['map']((_0x2dc33c,_0x16d34b)=>{const _0x2c92c0=_0x18481e;let _0xe1b346=createProject(_0x2dc33c[_0x2c92c0(0xbb)],_0x2dc33c[_0x2c92c0(0xd1)],_0x2dc33c[_0x2c92c0(0xd2)]||'画像'+(_0x16d34b+0x1));return _0xe1b346[_0x2c92c0(0xeb)]=_0x2dc33c['frames'][_0x2c92c0(0xdc)](_0x3c04c7=>{const _0x38e3a0=_0x2c92c0;let _0x28ed55={'layers':[],'activeLayer':_0x3c04c7['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x37cc27=0x0;_0x37cc27<_0x3c04c7[_0x38e3a0(0xcd)][_0x38e3a0(0x138)];_0x37cc27++){let _0xf6187a=new Image();_0xf6187a[_0x38e3a0(0x100)]=_0x3c04c7['layers'][_0x37cc27];let _0x2621ae=document[_0x38e3a0(0x133)](_0x38e3a0(0xce));_0x2621ae[_0x38e3a0(0xbb)]=_0x2dc33c[_0x38e3a0(0xbb)]*cellSize,_0x2621ae[_0x38e3a0(0xd1)]=_0x2dc33c[_0x38e3a0(0xd1)]*cellSize,_0xf6187a['onload']=()=>{const _0x370b40=_0x38e3a0;let _0x37fc54=_0x2621ae[_0x370b40(0xf0)]('2d');_0x37fc54[_0x370b40(0xf3)](0x0,0x0,_0x2621ae[_0x370b40(0xbb)],_0x2621ae[_0x370b40(0xd1)]),_0x37fc54[_0x370b40(0xec)](_0xf6187a,0x0,0x0);try{redrawAll();}catch(_0x258443){}},_0x28ed55[_0x38e3a0(0xcd)][_0x38e3a0(0x10f)](_0x2621ae),_0x28ed55['layerHistories']['push']([]),_0x28ed55[_0x38e3a0(0xf8)]['push']([]);}return _0x28ed55;}),_0xe1b346['activeFrame']=_0x2dc33c[_0x2c92c0(0xc2)],_0xe1b346[_0x2c92c0(0xd2)]=_0x2dc33c[_0x2c92c0(0xd2)]||'画像'+(_0x16d34b+0x1),_0xe1b346;}),activeProject=_0x4d8fae[_0x18481e(0x12e)]||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}catch(_0x27e8b7){alert(_0x18481e(0xde));}finally{try{hideLoading();}catch(_0x27cff7){}}},_0x36f839[_0x48f841(0xef)]=function(){try{hideLoading();}catch(_0x149a3d){}},_0x36f839[_0x48f841(0xed)](_0x373bf7);}async function loadProjectFromIDB(){const _0x349d10=_0x165a85;try{let _0x59e3ea=await idbGet('nezumi-sketch-save');if(!_0x59e3ea){console[_0x349d10(0x131)](_0x349d10(0xe8));try{const _0x15be31=localStorage[_0x349d10(0xd8)](_0x349d10(0x117));if(_0x15be31){const _0x5087ce=JSON[_0x349d10(0xe4)](_0x15be31);_0x5087ce&&_0x5087ce[_0x349d10(0x102)]&&(console['info'](_0x349d10(0xe9)),_0x59e3ea=_0x5087ce);}}catch(_0x457d95){console[_0x349d10(0xfd)](_0x349d10(0xe7),_0x457d95);}if(!_0x59e3ea){if(typeof requestAutoSave===_0x349d10(0x145))requestAutoSave();return;}}console['log'](_0x349d10(0x143),{'projects':Array[_0x349d10(0xb9)](_0x59e3ea[_0x349d10(0x102)])?_0x59e3ea[_0x349d10(0x102)][_0x349d10(0x138)]:0x0,'activeProject':_0x59e3ea['activeProject']}),projects=_0x59e3ea[_0x349d10(0x102)][_0x349d10(0xdc)]((_0x4f68a1,_0x33b475)=>{const _0x3e58c6=_0x349d10;let _0x1a5133=createProject(_0x4f68a1[_0x3e58c6(0xbb)],_0x4f68a1['height'],_0x4f68a1[_0x3e58c6(0xd2)]||'画像'+(_0x33b475+0x1));return _0x1a5133[_0x3e58c6(0xeb)]=_0x4f68a1[_0x3e58c6(0xeb)][_0x3e58c6(0xdc)](_0x3315b8=>{const _0x5448e8=_0x3e58c6;let _0x77165b={'layers':[],'activeLayer':_0x3315b8['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x501371=0x0;_0x501371<_0x3315b8['layers'][_0x5448e8(0x138)];_0x501371++){let _0x3b7bfc=new Image();_0x3b7bfc[_0x5448e8(0x100)]=_0x3315b8['layers'][_0x501371];let _0xfa0d7f=document[_0x5448e8(0x133)](_0x5448e8(0xce));_0xfa0d7f[_0x5448e8(0xbb)]=_0x4f68a1[_0x5448e8(0xbb)]*cellSize,_0xfa0d7f['height']=_0x4f68a1[_0x5448e8(0xd1)]*cellSize,_0x3b7bfc[_0x5448e8(0xe2)]=()=>{const _0x7146b5=_0x5448e8;let _0x41fb92=_0xfa0d7f[_0x7146b5(0xf0)]('2d');_0x41fb92['clearRect'](0x0,0x0,_0xfa0d7f[_0x7146b5(0xbb)],_0xfa0d7f[_0x7146b5(0xd1)]),_0x41fb92[_0x7146b5(0xec)](_0x3b7bfc,0x0,0x0);},_0x77165b[_0x5448e8(0xcd)]['push']({'canvas':_0xfa0d7f,'visible':!![]}),_0x77165b[_0x5448e8(0x125)]['push']([]),_0x77165b['layerRedoStacks']['push']([]);}return _0x77165b;}),_0x1a5133['activeFrame']=_0x4f68a1[_0x3e58c6(0xc2)],_0x1a5133[_0x3e58c6(0xd2)]=_0x4f68a1[_0x3e58c6(0xd2)]||'画像'+(_0x33b475+0x1),_0x1a5133;}),activeProject=_0x59e3ea[_0x349d10(0x12e)]||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{if(typeof updateUndoRedoButtons==='function')updateUndoRedoButtons();}catch(_0x1dc8f0){}setTool(_0x349d10(0xf4)),console[_0x349d10(0xc9)](_0x349d10(0x13f));}catch(_0x1ecc46){alert(_0x349d10(0x139)),console['error'](_0x1ecc46);}}function shiftLayerCanvas(_0x13cd65,_0x4b8d3c,_0x2cc250){const _0x3128cc=_0x165a85;if(!_0x13cd65)return;const _0x523d81=_0x13cd65[_0x3128cc(0xbb)],_0x4c0075=_0x13cd65[_0x3128cc(0xd1)],_0x2a2552=document[_0x3128cc(0x133)](_0x3128cc(0xce));_0x2a2552[_0x3128cc(0xbb)]=_0x523d81,_0x2a2552['height']=_0x4c0075;const _0x31edb5=_0x2a2552[_0x3128cc(0xf0)]('2d');_0x31edb5[_0x3128cc(0xf3)](0x0,0x0,_0x523d81,_0x4c0075),_0x31edb5['drawImage'](_0x13cd65,0x0,0x0);const _0x429c80=_0x13cd65['getContext']('2d');_0x429c80[_0x3128cc(0xf3)](0x0,0x0,_0x523d81,_0x4c0075),_0x429c80[_0x3128cc(0xec)](_0x2a2552,_0x4b8d3c,_0x2cc250);}function nudgeActiveLayer(_0x32d2af,_0x29011a){const _0x15e67d=_0x165a85,_0x4240c2=getCurrentProject();if(!_0x4240c2)return;const _0x1b54f7=getCurrentFrame();if(!_0x1b54f7)return;const _0x38e857=_0x1b54f7['activeLayer'];if(_0x38e857==null)return;const _0x169c23=(_0x32d2af||0x0)*cellSize,_0x47edf1=(_0x29011a||0x0)*cellSize;if(_0x169c23===0x0&&_0x47edf1===0x0)return;saveHistory();const _0x4bcdda=_0x1b54f7[_0x15e67d(0xcd)][_0x38e857],_0xacc78b=_0x4bcdda&&_0x4bcdda[_0x15e67d(0xce)]?_0x4bcdda[_0x15e67d(0xce)]:_0x4bcdda;_0xacc78b?(shiftLayerCanvas(_0xacc78b,_0x169c23,_0x47edf1),redrawAll()):console[_0x15e67d(0xfd)](_0x15e67d(0x11f),_0x4bcdda);}function startLayerMove(_0x3b518e){const _0x77c152=_0x165a85;layerMoveState[_0x77c152(0xe5)]=!![];const _0x272cad=getCanvasCoords(_0x3b518e);layerMoveState[_0x77c152(0xd9)]={'x':Math[_0x77c152(0x128)](_0x272cad['x']/cellSize),'y':Math[_0x77c152(0x128)](_0x272cad['y']/cellSize)},layerMoveState[_0x77c152(0xea)]={'x':0x0,'y':0x0};}function endLayerMove(_0x39d6b7){const _0x4da59c=_0x165a85;if(!layerMoveState[_0x4da59c(0xe5)])return;const _0x14731b=layerMoveState[_0x4da59c(0xea)]['x']*cellSize,_0x284551=layerMoveState['offsetCells']['y']*cellSize;if(_0x14731b!==0x0||_0x284551!==0x0){saveHistory();const _0x15a481=getCurrentFrame();if(_0x15a481&&typeof _0x15a481[_0x4da59c(0x121)]===_0x4da59c(0xd0)){const _0x56d146=_0x15a481[_0x4da59c(0xcd)][_0x15a481['activeLayer']],_0x3ce058=_0x56d146&&_0x56d146[_0x4da59c(0xce)]?_0x56d146[_0x4da59c(0xce)]:_0x56d146;if(_0x3ce058)shiftLayerCanvas(_0x3ce058,_0x14731b,_0x284551);}}layerMoveState[_0x4da59c(0xe5)]=![],layerMoveState[_0x4da59c(0xd9)]=null,layerMoveState[_0x4da59c(0xea)]={'x':0x0,'y':0x0},redrawAll();}