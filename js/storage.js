function _0x789f(){const _0x5d8feb=['720610BpPJxw','clear','saveHistory\x20error','2485056BbOPYw','height','shift','8544RxaeWY','map','transaction','drawImage','nezumi-palette','toString','layerRedoStacks','put','保存エラー','8EXlVbw','objectStore','number','readAsArrayBuffer','getContext','includes','length','(((.+)+)+)+$','delete','error','readonly','activeLayer','18zljbBm','frames','forEach','width','isArray','20946508xhEHjK','layerHistories','project','メタデータが見つかりませんでした','slice','11857454rqyhfo','2865WPnwQS','result','canvas','crossOrigin','constructor','clearRect','push','layers','6807LGjovF','readwrite','読込エラー','onload','onsuccess','116036WytCBI','name','onerror','oncomplete','anonymous','function','toDataURL','search','requestAutoSave','818jIBXMu','createElement'];_0x789f=function(){return _0x5d8feb;};return _0x789f();}(function(_0x41a89a,_0x434166){const _0x16c5be=_0x5215,_0x3f2b1e=_0x41a89a();while(!![]){try{const _0x57f52d=parseInt(_0x16c5be(0x66))/0x1+-parseInt(_0x16c5be(0x6f))/0x2*(-parseInt(_0x16c5be(0x9f))/0x3)+parseInt(_0x16c5be(0x74))/0x4+-parseInt(_0x16c5be(0x97))/0x5*(parseInt(_0x16c5be(0x77))/0x6)+parseInt(_0x16c5be(0x96))/0x7*(-parseInt(_0x16c5be(0x80))/0x8)+parseInt(_0x16c5be(0x8c))/0x9*(-parseInt(_0x16c5be(0x71))/0xa)+parseInt(_0x16c5be(0x91))/0xb;if(_0x57f52d===_0x434166)break;else _0x3f2b1e['push'](_0x3f2b1e['shift']());}catch(_0x348500){_0x3f2b1e['push'](_0x3f2b1e['shift']());}}}(_0x789f,0xdf861));const _0xe9fe26=(function(){let _0x3750e8=!![];return function(_0x249183,_0x4db162){const _0x25eb42=_0x3750e8?function(){if(_0x4db162){const _0xa232a1=_0x4db162['apply'](_0x249183,arguments);return _0x4db162=null,_0xa232a1;}}:function(){};return _0x3750e8=![],_0x25eb42;};}()),_0x29e33e=_0xe9fe26(this,function(){const _0x4849f6=_0x5215;return _0x29e33e[_0x4849f6(0x7c)]()[_0x4849f6(0x6d)](_0x4849f6(0x87))[_0x4849f6(0x7c)]()[_0x4849f6(0x9b)](_0x29e33e)[_0x4849f6(0x6d)](_0x4849f6(0x87));});_0x29e33e();function saveHistory(){const _0x8ed28=_0x5215;let _0x38be21=getCurrentFrame();if(!_0x38be21)return;if(!Array[_0x8ed28(0x90)](_0x38be21[_0x8ed28(0x92)]))_0x38be21[_0x8ed28(0x92)]=[];if(!Array[_0x8ed28(0x90)](_0x38be21[_0x8ed28(0x7d)]))_0x38be21['layerRedoStacks']=[];const _0x40f5b1=typeof _0x38be21[_0x8ed28(0x8b)]===_0x8ed28(0x82)?_0x38be21[_0x8ed28(0x8b)]:-0x1;if(_0x40f5b1<0x0)return;if(!_0x38be21['layerHistories'][_0x40f5b1])_0x38be21['layerHistories'][_0x40f5b1]=[];if(!_0x38be21['layerRedoStacks'][_0x40f5b1])_0x38be21[_0x8ed28(0x7d)][_0x40f5b1]=[];const _0x1083a0=_0x38be21[_0x8ed28(0x9e)]&&_0x38be21['layers'][_0x40f5b1]?_0x38be21[_0x8ed28(0x9e)][_0x40f5b1]:null,_0x4a12bb=_0x1083a0&&_0x1083a0[_0x8ed28(0x99)]?_0x1083a0[_0x8ed28(0x99)]:_0x1083a0;if(!_0x4a12bb||typeof _0x4a12bb[_0x8ed28(0x6c)]!==_0x8ed28(0x6b))return;try{_0x38be21[_0x8ed28(0x92)][_0x40f5b1][_0x8ed28(0x9d)](_0x4a12bb[_0x8ed28(0x6c)]());if(_0x38be21[_0x8ed28(0x92)][_0x40f5b1][_0x8ed28(0x86)]>0x32)_0x38be21[_0x8ed28(0x92)][_0x40f5b1][_0x8ed28(0x76)]();_0x38be21[_0x8ed28(0x7d)][_0x40f5b1]=[];try{if(typeof updateUndoRedoButtons===_0x8ed28(0x6b))updateUndoRedoButtons();}catch(_0x5a2759){}if(typeof window[_0x8ed28(0x6e)]===_0x8ed28(0x6b))window['requestAutoSave']();}catch(_0xc4293a){console['error'](_0x8ed28(0x73),_0xc4293a);}}async function idbSet(_0x452f15,_0x26c379){const _0x34ec85=await openDB();return new Promise((_0x29d63c,_0x75e97a)=>{const _0x43b96f=_0x5215,_0x3845a9=_0x34ec85[_0x43b96f(0x79)](storeName,_0x43b96f(0xa0));_0x3845a9[_0x43b96f(0x81)](storeName)[_0x43b96f(0x7e)](_0x26c379,_0x452f15),_0x3845a9[_0x43b96f(0x69)]=()=>_0x29d63c(),_0x3845a9[_0x43b96f(0x68)]=()=>_0x75e97a(_0x3845a9[_0x43b96f(0x89)]);});}async function idbGet(_0x3a5c7d){const _0x4e6b2b=await openDB();return new Promise((_0x2167ff,_0x3062df)=>{const _0x12d67c=_0x5215,_0x3c88d1=_0x4e6b2b[_0x12d67c(0x79)](storeName,_0x12d67c(0x8a)),_0x5c21eb=_0x3c88d1[_0x12d67c(0x81)](storeName)['get'](_0x3a5c7d);_0x5c21eb[_0x12d67c(0x65)]=()=>_0x2167ff(_0x5c21eb['result']),_0x5c21eb['onerror']=()=>_0x3062df(_0x5c21eb['error']);});}function _0x5215(_0x1dec1b,_0x249248){_0x1dec1b=_0x1dec1b-0x64;const _0x3d3928=_0x789f();let _0x29e33e=_0x3d3928[_0x1dec1b];return _0x29e33e;}async function idbDelete(_0x3e9dbf){const _0x537017=await openDB();return new Promise((_0x174423,_0x2b6151)=>{const _0x4ea929=_0x5215,_0x55f68a=_0x537017[_0x4ea929(0x79)](storeName,_0x4ea929(0xa0));_0x55f68a['objectStore'](storeName)[_0x4ea929(0x88)](_0x3e9dbf),_0x55f68a[_0x4ea929(0x69)]=()=>_0x174423(),_0x55f68a['onerror']=()=>_0x2b6151(_0x55f68a[_0x4ea929(0x89)]);});}async function idbClear(){const _0x240960=await openDB();return new Promise((_0x1ed350,_0x4b66c0)=>{const _0x249527=_0x5215,_0xdda42c=_0x240960[_0x249527(0x79)](storeName,_0x249527(0xa0));_0xdda42c[_0x249527(0x81)](storeName)[_0x249527(0x72)](),_0xdda42c[_0x249527(0x69)]=()=>_0x1ed350(),_0xdda42c[_0x249527(0x68)]=()=>_0x4b66c0(_0xdda42c[_0x249527(0x89)]);});}async function savePaletteToDB(){const _0x7fa46=_0x5215;try{await idbSet('nezumi-palette',PALETTE_COLORS);}catch(_0x33c9e9){console['error'](_0x7fa46(0x7f),_0x33c9e9);}}async function loadPaletteFromDB(){const _0x7cc495=_0x5215;try{const _0x523890=await idbGet(_0x7cc495(0x7b));if(Array[_0x7cc495(0x90)](_0x523890)&&_0x523890['length']){const _0xf407d=[];_0x523890[_0x7cc495(0x8e)](_0x42c2a6=>{const _0x3dfe55=_0x7cc495;if(typeof _0x42c2a6==='string'&&!_0xf407d[_0x3dfe55(0x85)](_0x42c2a6))_0xf407d[_0x3dfe55(0x9d)](_0x42c2a6);});for(const _0x4cbdd0 of typeof DEFAULT_PALETTE!=='undefined'?DEFAULT_PALETTE:[]){if(!_0xf407d[_0x7cc495(0x85)](_0x4cbdd0))_0xf407d[_0x7cc495(0x9d)](_0x4cbdd0);}PALETTE_COLORS=_0xf407d[_0x7cc495(0x95)](0x0,0x18);}}catch(_0x314fc2){console[_0x7cc495(0x89)](_0x7cc495(0xa1),_0x314fc2);}}async function loadImages(_0x13223b){const _0x3193a4=_0x5215,_0x352b62=await Promise['all'](_0x13223b[_0x3193a4(0x78)](_0x4bbbce=>{return new Promise(_0x3fbec8=>{const _0x1ee808=_0x5215,_0x52d395=new Image();_0x52d395[_0x1ee808(0x9a)]=_0x1ee808(0x6a),_0x52d395['src']=_0x4bbbce,_0x52d395[_0x1ee808(0x64)]=()=>_0x3fbec8(_0x52d395);});}));return _0x352b62;}function loadStandaloneFromFile(_0x236754){return new Promise((_0x18efca,_0x15aaa5)=>{const _0x3bfa12=_0x5215;try{showLoading('画像ファイルを読み込み中...');}catch(_0x1e0466){}const _0x4173a9=new FileReader();_0x4173a9[_0x3bfa12(0x64)]=_0x59dc15=>{const _0x169434=_0x3bfa12,_0x2269b6=_0x59dc15['target'][_0x169434(0x98)],_0x24e499=extractMetadataFromArrayBuffer(_0x2269b6);if(!_0x24e499||!_0x24e499[_0x169434(0x93)]){try{hideLoading();}catch(_0x246759){}_0x15aaa5(new Error(_0x169434(0x94)));return;}const _0x48edc2=_0x24e499[_0x169434(0x93)];try{const _0x1e9565=createProject(_0x48edc2[_0x169434(0x8f)],_0x48edc2[_0x169434(0x75)],_0x48edc2[_0x169434(0x67)]||'画像');_0x1e9565[_0x169434(0x8d)]=_0x48edc2[_0x169434(0x8d)][_0x169434(0x78)](_0x5741d8=>{const _0xa9540e=_0x169434;let _0x5350a2={'layers':[],'activeLayer':_0x5741d8['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x24eb06=0x0;_0x24eb06<_0x5741d8['layers'][_0xa9540e(0x86)];_0x24eb06++){let _0x2d25b5=new Image();_0x2d25b5['src']=_0x5741d8[_0xa9540e(0x9e)][_0x24eb06];let _0x3e7971=document[_0xa9540e(0x70)](_0xa9540e(0x99));_0x3e7971['width']=_0x48edc2[_0xa9540e(0x8f)]*cellSize,_0x3e7971[_0xa9540e(0x75)]=_0x48edc2[_0xa9540e(0x75)]*cellSize,_0x2d25b5[_0xa9540e(0x64)]=()=>{const _0x440a87=_0xa9540e;let _0x16cea1=_0x3e7971[_0x440a87(0x84)]('2d');_0x16cea1[_0x440a87(0x9c)](0x0,0x0,_0x3e7971[_0x440a87(0x8f)],_0x3e7971[_0x440a87(0x75)]),_0x16cea1[_0x440a87(0x7a)](_0x2d25b5,0x0,0x0);},_0x5350a2['layers'][_0xa9540e(0x9d)](_0x3e7971);}return _0x5350a2;}),projects[_0x169434(0x9d)](_0x1e9565),activeProject=projects[_0x169434(0x86)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0x3a5a05){}_0x18efca(_0x1e9565);}catch(_0x42d15e){try{hideLoading();}catch(_0x4fda2a){}_0x15aaa5(_0x42d15e);}},_0x4173a9[_0x3bfa12(0x68)]=_0x392004=>{try{hideLoading();}catch(_0x48327e){};_0x15aaa5(_0x392004);},_0x4173a9[_0x3bfa12(0x83)](_0x236754);});}