const _0x74af53=_0x289e;(function(_0x58f677,_0x4104b2){const _0x294e85=_0x289e,_0xa1ebf1=_0x58f677();while(!![]){try{const _0x2a815a=-parseInt(_0x294e85(0xf4))/0x1+-parseInt(_0x294e85(0x114))/0x2+parseInt(_0x294e85(0x14e))/0x3*(parseInt(_0x294e85(0x131))/0x4)+parseInt(_0x294e85(0x13a))/0x5+parseInt(_0x294e85(0x12e))/0x6*(-parseInt(_0x294e85(0xfe))/0x7)+-parseInt(_0x294e85(0x141))/0x8*(-parseInt(_0x294e85(0x130))/0x9)+-parseInt(_0x294e85(0x13c))/0xa;if(_0x2a815a===_0x4104b2)break;else _0xa1ebf1['push'](_0xa1ebf1['shift']());}catch(_0x2542e6){_0xa1ebf1['push'](_0xa1ebf1['shift']());}}}(_0x4ae9,0x92694));const _0x12b095=(function(){let _0x6bf989=!![];return function(_0x2fe039,_0x1641fc){const _0x191f06=_0x6bf989?function(){if(_0x1641fc){const _0x837bb=_0x1641fc['apply'](_0x2fe039,arguments);return _0x1641fc=null,_0x837bb;}}:function(){};return _0x6bf989=![],_0x191f06;};}()),_0x4d911b=_0x12b095(this,function(){const _0x4584c3=_0x289e;return _0x4d911b[_0x4584c3(0xe2)]()['search'](_0x4584c3(0xf6))['toString']()[_0x4584c3(0x135)](_0x4d911b)[_0x4584c3(0x139)]('(((.+)+)+)+$');});_0x4d911b();function createProject(_0x17881f=0x10,_0xbf3992=0x10,_0x53c942=''){const _0x30695a=_0x289e;let _0x508bfa=0x14,_0x20fe72=[],_0x5ed70d=[],_0x165744=[],_0x249064=document[_0x30695a(0xee)](_0x30695a(0x10c));_0x249064[_0x30695a(0x120)]=_0x17881f*_0x508bfa,_0x249064['height']=_0xbf3992*_0x508bfa,_0x20fe72[_0x30695a(0x12f)]({'canvas':_0x249064,'visible':!![]}),_0x5ed70d[_0x30695a(0x12f)]([]),_0x165744[_0x30695a(0x12f)]([]);let _0x34ba50={'layers':_0x20fe72,'activeLayer':0x0,'layerHistories':_0x5ed70d,'layerRedoStacks':_0x165744};return{'frames':[_0x34ba50],'activeFrame':0x0,'width':_0x17881f,'height':_0xbf3992,'name':_0x53c942||'画像'+(projects['length']+0x1)};}function editProjectName(_0x237e1a,_0x1f7987){const _0x22032a=_0x289e,_0x828dec=document[_0x22032a(0xee)](_0x22032a(0x150));_0x828dec[_0x22032a(0x108)]='text',_0x828dec[_0x22032a(0x106)]=projects[_0x237e1a][_0x22032a(0xf9)]||'画像'+(_0x237e1a+0x1),_0x828dec[_0x22032a(0xfd)]=_0x22032a(0x109),_0x828dec[_0x22032a(0x14c)]['width']=_0x22032a(0x134),_0x828dec[_0x22032a(0x132)]=()=>{const _0x4bf33f=_0x22032a;projects[_0x237e1a][_0x4bf33f(0xf9)]=_0x828dec['value'][_0x4bf33f(0x129)]()||'画像'+(_0x237e1a+0x1),updateProjectUI();},_0x828dec[_0x22032a(0x14a)]=_0x564fb2=>{const _0x3e5437=_0x22032a;if(_0x564fb2[_0x3e5437(0xf3)]===_0x3e5437(0xf1))_0x828dec[_0x3e5437(0x14f)]();},_0x1f7987['replaceWith'](_0x828dec),_0x828dec[_0x22032a(0xf7)](),_0x828dec[_0x22032a(0xd4)]();}function addProject(){showNewProjectDialog((_0x42b206,_0x2f6d46,_0x3694d8)=>{const _0xb33be7=_0x289e;if(!Number[_0xb33be7(0x142)](_0x42b206)||_0x42b206<0x1)_0x42b206=0x10;if(!Number[_0xb33be7(0x142)](_0x2f6d46)||_0x2f6d46<0x1)_0x2f6d46=0x10;projects[_0xb33be7(0x12f)](createProject(_0x42b206,_0x2f6d46,_0x3694d8)),activeProject=projects['length']-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();});}function removeProjectAt(_0x4841d1){const _0x5cf049=_0x289e;if(projects[_0x5cf049(0x115)]<=0x1)return;const _0x4de041=projects[_0x4841d1]&&projects[_0x4841d1][_0x5cf049(0xf9)]?projects[_0x4841d1][_0x5cf049(0xf9)]:'画像'+(_0x4841d1+0x1);if(!confirm('「'+_0x4de041+'」を削除しますか？'))return;projects['splice'](_0x4841d1,0x1);if(activeProject>=projects['length'])activeProject=projects[_0x5cf049(0x115)]-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentProject(){return projects[activeProject];}function addFrame(){const _0x13e84b=_0x289e,_0x57f5fd=getCurrentProject(),_0x3f0148=_0x57f5fd[_0x13e84b(0x110)][_0x57f5fd[_0x13e84b(0xdc)]],_0x39f4ff=_0x49b393=>{const _0x1f5d14=_0x13e84b,_0x239723=document[_0x1f5d14(0xee)](_0x1f5d14(0x10c));_0x239723[_0x1f5d14(0x120)]=_0x49b393[_0x1f5d14(0x120)],_0x239723[_0x1f5d14(0x137)]=_0x49b393[_0x1f5d14(0x137)];const _0x36e001=_0x239723[_0x1f5d14(0xd8)]('2d');if(_0x49b393 instanceof HTMLCanvasElement)_0x36e001['drawImage'](_0x49b393,0x0,0x0);else _0x49b393[_0x1f5d14(0x10c)]&&_0x49b393['canvas']instanceof HTMLCanvasElement?_0x36e001['drawImage'](_0x49b393[_0x1f5d14(0x10c)],0x0,0x0):console[_0x1f5d14(0x12a)]('複製できないレイヤーがありますチュー',_0x49b393);return _0x239723;},_0x41c491=_0x3f0148[_0x13e84b(0xe0)][_0x13e84b(0xed)](_0x39f4ff),_0x5a95c1=_0x41c491['map'](()=>[]),_0x49c413=_0x41c491[_0x13e84b(0xed)](()=>[]),_0x2dfdde={'layers':_0x41c491,'activeLayer':0x0,'layerHistories':_0x5a95c1,'layerRedoStacks':_0x49c413};_0x57f5fd[_0x13e84b(0x110)]['splice'](_0x57f5fd[_0x13e84b(0xdc)]+0x1,0x0,_0x2dfdde),_0x57f5fd[_0x13e84b(0xdc)]++,updateFrameUI(),updateLayerUI(),redrawAll();}const cloneLayer=_0x4cf11a=>{const _0x2e7cdd=_0x289e,_0x26df9e=document[_0x2e7cdd(0xee)](_0x2e7cdd(0x10c));_0x26df9e[_0x2e7cdd(0x120)]=_0x4cf11a[_0x2e7cdd(0x120)],_0x26df9e['height']=_0x4cf11a['height'];const _0x528159=_0x26df9e[_0x2e7cdd(0xd8)]('2d');if(_0x4cf11a instanceof HTMLCanvasElement)_0x528159[_0x2e7cdd(0x111)](_0x4cf11a,0x0,0x0);else _0x4cf11a[_0x2e7cdd(0x10c)]&&_0x4cf11a[_0x2e7cdd(0x10c)]instanceof HTMLCanvasElement?_0x528159['drawImage'](_0x4cf11a[_0x2e7cdd(0x10c)],0x0,0x0):console['warn'](_0x2e7cdd(0x12c),_0x4cf11a);return _0x26df9e;};function removeFrameAt(_0x45101a){const _0x2fcc6e=_0x289e;let _0x5dc95f=getCurrentProject();if(_0x5dc95f[_0x2fcc6e(0x110)][_0x2fcc6e(0x115)]<=0x1)return;_0x5dc95f[_0x2fcc6e(0x110)][_0x2fcc6e(0x125)](_0x45101a,0x1);if(_0x5dc95f[_0x2fcc6e(0xdc)]>=_0x5dc95f[_0x2fcc6e(0x110)][_0x2fcc6e(0x115)])_0x5dc95f[_0x2fcc6e(0xdc)]=_0x5dc95f[_0x2fcc6e(0x110)][_0x2fcc6e(0x115)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0xbe716d=_0x289e,_0x3d2439=getCurrentProject();if(!_0x3d2439||!_0x3d2439['frames']||typeof _0x3d2439[_0xbe716d(0xdc)]!==_0xbe716d(0x113)||!_0x3d2439[_0xbe716d(0x110)][_0x3d2439['activeFrame']])return null;return _0x3d2439['frames'][_0x3d2439['activeFrame']];}function swapLayer(_0x495c11,_0x33d3b2){const _0xaf64aa=_0x289e;let _0x27c30a=getCurrentFrame();[_0x27c30a[_0xaf64aa(0xe0)][_0x495c11],_0x27c30a[_0xaf64aa(0xe0)][_0x33d3b2]]=[_0x27c30a['layers'][_0x33d3b2],_0x27c30a[_0xaf64aa(0xe0)][_0x495c11]],[_0x27c30a['layerHistories'][_0x495c11],_0x27c30a[_0xaf64aa(0x147)][_0x33d3b2]]=[_0x27c30a['layerHistories'][_0x33d3b2],_0x27c30a['layerHistories'][_0x495c11]],[_0x27c30a[_0xaf64aa(0x10f)][_0x495c11],_0x27c30a[_0xaf64aa(0x10f)][_0x33d3b2]]=[_0x27c30a[_0xaf64aa(0x10f)][_0x33d3b2],_0x27c30a[_0xaf64aa(0x10f)][_0x495c11]];if(_0x27c30a['activeLayer']===_0x495c11)_0x27c30a['activeLayer']=_0x33d3b2;else{if(_0x27c30a[_0xaf64aa(0xeb)]===_0x33d3b2)_0x27c30a['activeLayer']=_0x495c11;}updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0xaf64aa(0xe4))requestAutoSave();}function removeLayerAt(_0x4e5da8){const _0x413a70=_0x289e;let _0x1e3b64=getCurrentFrame();if(_0x1e3b64[_0x413a70(0xe0)][_0x413a70(0x115)]<=0x1)return;_0x1e3b64[_0x413a70(0xe0)]['splice'](_0x4e5da8,0x1),_0x1e3b64['layerHistories'][_0x413a70(0x125)](_0x4e5da8,0x1),_0x1e3b64[_0x413a70(0x10f)][_0x413a70(0x125)](_0x4e5da8,0x1);if(_0x1e3b64[_0x413a70(0xeb)]>=_0x1e3b64[_0x413a70(0xe0)]['length'])_0x1e3b64[_0x413a70(0xeb)]=_0x1e3b64[_0x413a70(0xe0)][_0x413a70(0x115)]-0x1;updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x413a70(0xe4))requestAutoSave();}function addLayer(){const _0x5ebc81=_0x289e;let _0x1b0953=getCurrentProject(),_0x545a55=getCurrentFrame(),_0x4e714e=document[_0x5ebc81(0xee)](_0x5ebc81(0x10c));_0x4e714e[_0x5ebc81(0x120)]=_0x1b0953[_0x5ebc81(0x120)]*cellSize,_0x4e714e['height']=_0x1b0953[_0x5ebc81(0x137)]*cellSize,_0x545a55['layers']['push']({'canvas':_0x4e714e,'visible':!![]}),_0x545a55[_0x5ebc81(0x147)]['push']([]),_0x545a55[_0x5ebc81(0x10f)][_0x5ebc81(0x12f)]([]),_0x545a55['activeLayer']=_0x545a55['layers'][_0x5ebc81(0x115)]-0x1,saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0xab8edd=_0x289e;let _0x464b77=getCurrentFrame();if(_0x464b77[_0xab8edd(0xe0)]['length']<=0x1)return;_0x464b77[_0xab8edd(0xe0)][_0xab8edd(0x125)](_0x464b77[_0xab8edd(0xeb)],0x1),_0x464b77[_0xab8edd(0x147)][_0xab8edd(0x125)](_0x464b77['activeLayer'],0x1),_0x464b77[_0xab8edd(0x10f)][_0xab8edd(0x125)](_0x464b77[_0xab8edd(0xeb)],0x1),_0x464b77['activeLayer']=Math[_0xab8edd(0xf0)](0x0,_0x464b77[_0xab8edd(0xeb)]-0x1),updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0xab8edd(0xe4))requestAutoSave();}function _0x289e(_0x2db46f,_0x34a442){_0x2db46f=_0x2db46f-0xcf;const _0x545546=_0x4ae9();let _0x4d911b=_0x545546[_0x2db46f];return _0x4d911b;}function selectLayer(_0x50a572){const _0x4a09a1=_0x289e;getCurrentFrame()[_0x4a09a1(0xeb)]=parseInt(_0x50a572),updateLayerUI();}function copyLayer(){const _0x73aa2e=_0x289e,_0x45d9dc=getCurrentFrame();if(!_0x45d9dc)return;const _0x1c326f=_0x45d9dc['activeLayer'];if(typeof _0x1c326f!=='number'||!_0x45d9dc[_0x73aa2e(0xe0)][_0x1c326f])return;const _0x4444d8=_0x45d9dc[_0x73aa2e(0xe0)][_0x1c326f],_0x811a8f=_0x4444d8&&_0x4444d8[_0x73aa2e(0x10c)]?_0x4444d8['canvas']:_0x4444d8;if(!_0x811a8f||typeof _0x811a8f[_0x73aa2e(0x143)]!==_0x73aa2e(0xe4))return;copiedLayerDataUrl=_0x811a8f['toDataURL']();const _0x375793=document[_0x73aa2e(0xe9)](_0x73aa2e(0xd5));if(_0x375793)_0x375793['disabled']=![];}function pasteLayer(){const _0x2dce1e=_0x289e;if(!copiedLayerDataUrl)return;const _0x2f383b=getCurrentProject(),_0x30adeb=getCurrentFrame();if(!_0x2f383b||!_0x30adeb)return;const _0x10cacf=document[_0x2dce1e(0xee)](_0x2dce1e(0x10c));_0x10cacf[_0x2dce1e(0x120)]=_0x2f383b[_0x2dce1e(0x120)]*cellSize,_0x10cacf['height']=_0x2f383b[_0x2dce1e(0x137)]*cellSize;const _0x1ea732=_0x10cacf[_0x2dce1e(0xd8)]('2d'),_0x1a53c5=new Image();_0x1a53c5['onload']=()=>{const _0x55825d=_0x2dce1e;_0x1ea732['clearRect'](0x0,0x0,_0x10cacf[_0x55825d(0x120)],_0x10cacf[_0x55825d(0x137)]),_0x1ea732[_0x55825d(0x111)](_0x1a53c5,0x0,0x0),_0x30adeb[_0x55825d(0xe0)][_0x55825d(0x12f)]({'canvas':_0x10cacf,'visible':!![]}),_0x30adeb[_0x55825d(0x147)][_0x55825d(0x12f)]([]),_0x30adeb[_0x55825d(0x10f)][_0x55825d(0x12f)]([]),_0x30adeb[_0x55825d(0xeb)]=_0x30adeb[_0x55825d(0xe0)][_0x55825d(0x115)]-0x1,saveHistory(),updateLayerUI(),redrawAll();},_0x1a53c5[_0x2dce1e(0x153)]=copiedLayerDataUrl;}async function exportLayersAsGif(){const _0x3abad4=_0x289e,_0x466aaf=document[_0x3abad4(0xe9)]('layerExportStatus');if(_0x466aaf)_0x466aaf['textContent']=_0x3abad4(0xdb);const _0x224e8e=getCurrentProject();if(!_0x224e8e){if(_0x466aaf)_0x466aaf[_0x3abad4(0x116)]='';return;}const _0x215965=_0x224e8e[_0x3abad4(0x110)],_0x14042a=_0x224e8e['width']*cellSize,_0x3b5b35=_0x224e8e[_0x3abad4(0x137)]*cellSize;let _0x55d0f5=0x0;_0x215965[_0x3abad4(0x146)](_0x458832=>{const _0x3f1b94=_0x3abad4;_0x55d0f5=Math[_0x3f1b94(0xf0)](_0x55d0f5,_0x458832[_0x3f1b94(0xe0)]['length']);});for(let _0x4a2e5c=0x0;_0x4a2e5c<_0x55d0f5;_0x4a2e5c++){const _0x3aad69=await Promise[_0x3abad4(0x101)](_0x215965[_0x3abad4(0xed)](_0x72d148=>{return new Promise(_0x59a298=>{const _0xa4464a=_0x289e,_0x397ba8=document[_0xa4464a(0xee)](_0xa4464a(0x10c));_0x397ba8[_0xa4464a(0x120)]=_0x14042a,_0x397ba8[_0xa4464a(0x137)]=_0x3b5b35;const _0x4ffaeb=_0x397ba8[_0xa4464a(0xd8)]('2d'),_0xb46b65=_0x72d148['layers'][_0x4a2e5c]&&_0x72d148[_0xa4464a(0xe0)][_0x4a2e5c][_0xa4464a(0x10c)]?_0x72d148[_0xa4464a(0xe0)][_0x4a2e5c][_0xa4464a(0x10c)]:_0x72d148[_0xa4464a(0xe0)][_0x4a2e5c];if(_0xb46b65)_0x4ffaeb[_0xa4464a(0x111)](_0xb46b65,0x0,0x0);const _0x289822=new Image();_0x289822[_0xa4464a(0x151)]=()=>_0x59a298(_0x289822),_0x289822[_0xa4464a(0x153)]=_0x397ba8[_0xa4464a(0x143)]('image/png');});})),_0x59e713=_0x3aad69[_0x3abad4(0xef)](_0x163e49=>{const _0x2bc911=_0x3abad4,_0x21e2fb=document['createElement']('canvas');_0x21e2fb[_0x2bc911(0x120)]=_0x14042a,_0x21e2fb[_0x2bc911(0x137)]=_0x3b5b35;const _0x4baebd=_0x21e2fb[_0x2bc911(0xd8)]('2d');_0x4baebd[_0x2bc911(0x111)](_0x163e49,0x0,0x0);const _0x1d678f=_0x4baebd[_0x2bc911(0x11b)](0x0,0x0,_0x14042a,_0x3b5b35)[_0x2bc911(0xe6)];for(let _0x43bc7f=0x3;_0x43bc7f<_0x1d678f[_0x2bc911(0x115)];_0x43bc7f+=0x4)if(_0x1d678f[_0x43bc7f]!==0x0)return!![];return![];});if(!_0x59e713)continue;const _0x1816d6=(_0x224e8e[_0x3abad4(0xf9)]||_0x3abad4(0x122))[_0x3abad4(0x12d)](/[\\/:*?"<>|]/g,'_')+('-layer'+(_0x4a2e5c+0x1)+_0x3abad4(0xfb));convertToGIF(_0x3aad69,animationDelay,_0x1816d6),await new Promise(_0x2d654c=>setTimeout(_0x2d654c,0x78));}if(_0x466aaf)_0x466aaf['textContent']='';}async function exportLayersAsApng(){const _0x10a9be=_0x289e,_0x310646=document[_0x10a9be(0xe9)](_0x10a9be(0x152));if(_0x310646)_0x310646['textContent']=_0x10a9be(0xdb);const _0x5c09f5=getCurrentProject();if(!_0x5c09f5){if(_0x310646)_0x310646[_0x10a9be(0x116)]='';return;}const _0x53cc57=_0x5c09f5[_0x10a9be(0x110)],_0x33f5ba=_0x5c09f5[_0x10a9be(0x120)]*cellSize,_0x3b7dfe=_0x5c09f5[_0x10a9be(0x137)]*cellSize;let _0x3eac49=0x0;_0x53cc57[_0x10a9be(0x146)](_0x561e57=>{const _0x59bed5=_0x10a9be;_0x3eac49=Math[_0x59bed5(0xf0)](_0x3eac49,_0x561e57[_0x59bed5(0xe0)]['length']);});for(let _0x525892=0x0;_0x525892<_0x3eac49;_0x525892++){const _0x525b5a=await Promise[_0x10a9be(0x101)](_0x53cc57['map'](_0x2f4246=>{return new Promise(_0x13ee93=>{const _0xac9a6a=_0x289e,_0x57090b=document[_0xac9a6a(0xee)](_0xac9a6a(0x10c));_0x57090b[_0xac9a6a(0x120)]=_0x33f5ba,_0x57090b['height']=_0x3b7dfe;const _0x3cbc91=_0x57090b[_0xac9a6a(0xd8)]('2d'),_0x502994=_0x2f4246[_0xac9a6a(0xe0)][_0x525892]&&_0x2f4246[_0xac9a6a(0xe0)][_0x525892][_0xac9a6a(0x10c)]?_0x2f4246[_0xac9a6a(0xe0)][_0x525892][_0xac9a6a(0x10c)]:_0x2f4246['layers'][_0x525892];if(_0x502994)_0x3cbc91[_0xac9a6a(0x111)](_0x502994,0x0,0x0);const _0x2ce8bf=new Image();_0x2ce8bf[_0xac9a6a(0x151)]=()=>_0x13ee93(_0x2ce8bf),_0x2ce8bf[_0xac9a6a(0x153)]=_0x57090b[_0xac9a6a(0x143)](_0xac9a6a(0x128));});})),_0xfe9c50=_0x525b5a[_0x10a9be(0xef)](_0x3c99d9=>{const _0x3f7db4=_0x10a9be,_0x1170a6=document[_0x3f7db4(0xee)](_0x3f7db4(0x10c));_0x1170a6[_0x3f7db4(0x120)]=_0x33f5ba,_0x1170a6[_0x3f7db4(0x137)]=_0x3b7dfe;const _0x519ae4=_0x1170a6[_0x3f7db4(0xd8)]('2d');_0x519ae4[_0x3f7db4(0x111)](_0x3c99d9,0x0,0x0);const _0x2f8f74=_0x519ae4[_0x3f7db4(0x11b)](0x0,0x0,_0x33f5ba,_0x3b7dfe)[_0x3f7db4(0xe6)];for(let _0x5dd4da=0x3;_0x5dd4da<_0x2f8f74[_0x3f7db4(0x115)];_0x5dd4da+=0x4)if(_0x2f8f74[_0x5dd4da]!==0x0)return!![];return![];});if(!_0xfe9c50)continue;const _0x20b321=(_0x5c09f5[_0x10a9be(0xf9)]||_0x10a9be(0x122))[_0x10a9be(0x12d)](/[\\/:*?"<>|]/g,'_')+(_0x10a9be(0xfa)+(_0x525892+0x1)+'.apng');convertToAPNG(_0x525b5a,_0x33f5ba,_0x3b7dfe,animationDelay,_0x20b321),await new Promise(_0x229cc7=>setTimeout(_0x229cc7,0x78));}if(_0x310646)_0x310646[_0x10a9be(0x116)]='';}async function exportFramesLayersZip(){const _0x4492bb=_0x289e,_0x185946=document[_0x4492bb(0xe9)](_0x4492bb(0x152));if(_0x185946)_0x185946[_0x4492bb(0x116)]='ZIP作成中...';const _0x23c825=getCurrentProject();if(!_0x23c825){if(_0x185946)_0x185946[_0x4492bb(0x116)]='';return;}const _0x40b15b=_0x23c825[_0x4492bb(0x110)],_0x143c1e=_0x23c825[_0x4492bb(0x120)]*cellSize,_0x4c8ed2=_0x23c825[_0x4492bb(0x137)]*cellSize,_0x16361d=new JSZip();for(let _0x7b55ce=0x0;_0x7b55ce<_0x40b15b[_0x4492bb(0x115)];_0x7b55ce++){const _0x3b87eb=_0x40b15b[_0x7b55ce],_0xb1965e=_0x16361d[_0x4492bb(0x104)]('frame-'+(_0x7b55ce+0x1));for(let _0x179f0d=0x0;_0x179f0d<_0x3b87eb[_0x4492bb(0xe0)][_0x4492bb(0x115)];_0x179f0d++){const _0xbc9aca=document[_0x4492bb(0xee)](_0x4492bb(0x10c));_0xbc9aca[_0x4492bb(0x120)]=_0x143c1e,_0xbc9aca[_0x4492bb(0x137)]=_0x4c8ed2;const _0x1c08f6=_0xbc9aca[_0x4492bb(0xd8)]('2d');_0x1c08f6[_0x4492bb(0x11d)](0x0,0x0,_0x143c1e,_0x4c8ed2);const _0x50ab31=_0x3b87eb[_0x4492bb(0xe0)][_0x179f0d];if(_0x50ab31){const _0x11c371=_0x50ab31[_0x4492bb(0x10c)]?_0x50ab31[_0x4492bb(0x10c)]:_0x50ab31;if(_0x11c371)_0x1c08f6[_0x4492bb(0x111)](_0x11c371,0x0,0x0);}const _0x9f2dad=_0xbc9aca['toDataURL'](_0x4492bb(0x128)),_0x59109a=_0x9f2dad[_0x4492bb(0x124)](',')[0x1],_0x1f37be=atob(_0x59109a),_0x48fbdb=new Uint8Array(_0x1f37be[_0x4492bb(0x115)]);for(let _0x1b1dc3=0x0;_0x1b1dc3<_0x1f37be[_0x4492bb(0x115)];_0x1b1dc3++)_0x48fbdb[_0x1b1dc3]=_0x1f37be[_0x4492bb(0x11a)](_0x1b1dc3);_0xb1965e[_0x4492bb(0xd6)](_0x4492bb(0x102)+(_0x179f0d+0x1)+_0x4492bb(0xf5),_0x48fbdb);}}const _0x4e8913=await _0x16361d[_0x4492bb(0x103)]({'type':'blob'}),_0x165688=(_0x23c825[_0x4492bb(0xf9)]||_0x4492bb(0x11c))[_0x4492bb(0x12d)](/[\\/:*?"<>|]/g,'_'),_0x4b782c=document[_0x4492bb(0xee)]('a');_0x4b782c[_0x4492bb(0x148)]=URL[_0x4492bb(0x13e)](_0x4e8913),_0x4b782c[_0x4492bb(0x13d)]=_0x165688+_0x4492bb(0x138),document[_0x4492bb(0xde)][_0x4492bb(0xff)](_0x4b782c),_0x4b782c[_0x4492bb(0xd0)](),setTimeout(()=>{const _0x42950c=_0x4492bb;URL[_0x42950c(0x107)](_0x4b782c[_0x42950c(0x148)]),document['body'][_0x42950c(0xcf)](_0x4b782c);if(_0x185946)_0x185946[_0x42950c(0x116)]='';},0x4b0);}function saveProjectFile(){const _0xb64a4e=_0x289e,_0x4a40e9=typeof getSavePayload===_0xb64a4e(0xe4)?getSavePayload():{'projects':projects[_0xb64a4e(0xed)](_0x24cc31=>({'width':_0x24cc31[_0xb64a4e(0x120)],'height':_0x24cc31[_0xb64a4e(0x137)],'name':_0x24cc31[_0xb64a4e(0xf9)]||'','activeFrame':_0x24cc31[_0xb64a4e(0xdc)],'frames':_0x24cc31['frames'][_0xb64a4e(0xed)](_0x28fa6e=>({'activeLayer':_0x28fa6e[_0xb64a4e(0xeb)],'layers':_0x28fa6e[_0xb64a4e(0xe0)][_0xb64a4e(0xed)](_0x50c467=>_0x50c467&&_0x50c467[_0xb64a4e(0x10c)]?_0x50c467[_0xb64a4e(0x10c)][_0xb64a4e(0x143)]():_0x50c467&&_0x50c467[_0xb64a4e(0x143)]?_0x50c467[_0xb64a4e(0x143)]():null)}))})),'activeProject':activeProject},_0x5f586a=new Blob([JSON['stringify'](_0x4a40e9)],{'type':_0xb64a4e(0xf2)}),_0x57796e=document[_0xb64a4e(0xee)]('a');_0x57796e[_0xb64a4e(0x13d)]='nezumi-sketch.msketch',_0x57796e[_0xb64a4e(0x148)]=URL['createObjectURL'](_0x5f586a),_0x57796e[_0xb64a4e(0xd0)]();}function getSavePayload(){const _0x34b421=_0x289e;return{'projects':projects[_0x34b421(0xed)](_0x10c2f3=>({'width':_0x10c2f3[_0x34b421(0x120)],'height':_0x10c2f3[_0x34b421(0x137)],'name':_0x10c2f3[_0x34b421(0xf9)]||'','activeFrame':_0x10c2f3[_0x34b421(0xdc)],'frames':_0x10c2f3[_0x34b421(0x110)][_0x34b421(0xed)](_0x9c4789=>({'activeLayer':_0x9c4789['activeLayer'],'layers':_0x9c4789[_0x34b421(0xe0)][_0x34b421(0xed)](_0xfee9e5=>_0xfee9e5&&_0xfee9e5[_0x34b421(0x10c)]?_0xfee9e5[_0x34b421(0x10c)]['toDataURL']():_0xfee9e5&&_0xfee9e5[_0x34b421(0x143)]?_0xfee9e5['toDataURL']():null)}))})),'activeProject':activeProject};}function _0x4ae9(){const _0x1bdd5f=['-frames-layers.zip','search','3566830jQKAie','auto-save\x20(interval):\x20saved','5131730NoAdXa','download','createObjectURL','startAutoSaveInterval:\x20starting\x20interval\x20','readAsText','16ooXIqc','isFinite','toDataURL','startAutoSaveInterval','loadProjectFromIDB:\x20localStorage\x20quick\x20load\x20failed','forEach','layerHistories','href','IndexedDBからの読み込みに失敗したチュー…','onkeydown','setItem','style','nezumi-sketch-save','181413EVABDk','blur','input','onload','layerExportStatus','src','getItem','removeChild','click','active','debug','offsetCells','select','pasteLayerBtn','file','image','getContext','log','then','処理中...','activeFrame','flushQuickSaveToLocalStorage\x20failed','body','requestAutoSave:\x20scheduling\x20save\x20in\x20','layers','nudgeActiveLayer:\x20対象レイヤーのキャンバスが見つかりません','toString','error','function','ファイルにプロジェクトメタデータが見つかりませんでした。読み込みできません。','data','loadProjectFromIDB:\x20DB\x20に保存が見つかりませんでした。localStorage\x20のクイック保存を確認します。','nezumi-sketch-save-quick','getElementById','プロジェクトをIndexedDBに保存したチュー！','activeLayer','info','map','createElement','some','max','Enter','application/json','key','623865QABgEj','.png','(((.+)+)+)+$','focus','スタンドアロン形式のプロジェクトを読み込みました:\x20','name','-layer','.gif','loadProjectFromIDB:\x20localStorage\x20のクイック保存を復元します','className','1708931nQMkUp','appendChild','auto-save\x20(interval)\x20failed','all','layer-','generateAsync','folder','IndexedDBからプロジェクトを読み込んだチュー！','value','revokeObjectURL','type','project-name-edit','startsWith','activeProject','canvas','flushQuickSaveToLocalStorage:\x20saved\x20quick\x20snapshot','isArray','layerRedoStacks','frames','drawImage','loadProjectFromIDB:\x20データ確認','number','145974tZeazK','length','textContent','parse','保存に失敗したチュー:','stringify','charCodeAt','getImageData','nezumi-export','clearRect','requestAutoSave:\x20timer\x20fired','floor','width','files','nezumi-animation','onerror','split','splice','projects','auto-save:\x20saved','image/png','trim','warn','addEventListener','複製できないレイヤーがありますチュー','replace','6nxscrH','push','3311019uUwWqa','40XLmpMd','onblur','pen','80px','constructor','startCell','height'];_0x4ae9=function(){return _0x1bdd5f;};return _0x4ae9();}async function saveProjectToIDB(){const _0x377a2b=_0x289e,_0xbe942a=getSavePayload();try{await idbSet(_0x377a2b(0x14d),_0xbe942a),console[_0x377a2b(0xd9)](_0x377a2b(0xea));}catch(_0x13c64d){console[_0x377a2b(0xe3)](_0x377a2b(0x118),_0x13c64d);}}function flushQuickSaveToLocalStorage(){const _0x50f62f=_0x289e;try{const _0x165fc6=getSavePayload();localStorage[_0x50f62f(0x14b)](_0x50f62f(0xe8),JSON[_0x50f62f(0x119)](_0x165fc6)),console[_0x50f62f(0xd2)](_0x50f62f(0x10d));}catch(_0x43a14b){console[_0x50f62f(0xe3)](_0x50f62f(0xdd),_0x43a14b);}}window[_0x74af53(0x12b)]('visibilitychange',()=>{const _0x4e5106=_0x74af53;if(document['hidden']&&autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x4e5106(0xe4))saveProjectToIDB();}}),window['addEventListener']('beforeunload',()=>{const _0xaa6596=_0x74af53;if(autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0xaa6596(0xe4))saveProjectToIDB();}});let autosaveDirty=![],autosaveTimer=null;const AUTOSAVE_DELAY=0x1388,AUTOSAVE_INTERVAL=0xea60;function requestAutoSave(){const _0x4443a0=_0x74af53;autosaveDirty=!![];if(autosaveTimer)clearTimeout(autosaveTimer);console[_0x4443a0(0xd2)](_0x4443a0(0xdf)+AUTOSAVE_DELAY+'ms'),autosaveTimer=setTimeout(async()=>{const _0x158c9a=_0x4443a0;console[_0x158c9a(0xd2)](_0x158c9a(0x11e));if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x158c9a(0xd9)](_0x158c9a(0x127));}catch(_0x592ecb){console[_0x158c9a(0xe3)]('auto-save\x20failed',_0x592ecb);}},AUTOSAVE_DELAY);}function startAutoSaveInterval(){const _0x2382a9=_0x74af53;console[_0x2382a9(0xd2)](_0x2382a9(0x13f)+AUTOSAVE_INTERVAL+'ms'),setInterval(async()=>{const _0xc472f3=_0x2382a9;if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0xc472f3(0xd9)](_0xc472f3(0x13b));}catch(_0x42978c){console[_0xc472f3(0xe3)](_0xc472f3(0x100),_0x42978c);}},AUTOSAVE_INTERVAL);}window['requestAutoSave']=requestAutoSave,window[_0x74af53(0x144)]=startAutoSaveInterval;function loadProjectFile(_0x2a2ef9){const _0x517179=_0x74af53,_0x32ad12=_0x2a2ef9['target'][_0x517179(0x121)][0x0];if(!_0x32ad12)return;if(_0x32ad12['type']&&_0x32ad12[_0x517179(0x108)][_0x517179(0x10a)](_0x517179(0xd7))){loadStandaloneFromFile(_0x32ad12)[_0x517179(0xda)](_0x45e9d2=>{const _0x1718a9=_0x517179;alert(_0x1718a9(0xf8)+(_0x45e9d2[_0x1718a9(0xf9)]||'画像'));})['catch'](_0x4a18dc=>{const _0x2ff8cd=_0x517179;console['warn'](_0x4a18dc),alert(_0x2ff8cd(0xe5));});return;}const _0x4cf725=new FileReader();try{showLoading('ファイルを読み込み中...');}catch(_0x41748a){}_0x4cf725[_0x517179(0x151)]=function(_0xdf560e){const _0x5a4b35=_0x517179;try{const _0x287312=JSON[_0x5a4b35(0x117)](_0xdf560e['target']['result']);projects=_0x287312[_0x5a4b35(0x126)][_0x5a4b35(0xed)]((_0x92be17,_0x11ccfe)=>{const _0x28fadd=_0x5a4b35;let _0x53804b=createProject(_0x92be17[_0x28fadd(0x120)],_0x92be17[_0x28fadd(0x137)],_0x92be17[_0x28fadd(0xf9)]||'画像'+(_0x11ccfe+0x1));return _0x53804b[_0x28fadd(0x110)]=_0x92be17[_0x28fadd(0x110)][_0x28fadd(0xed)](_0x32dc76=>{const _0x506d61=_0x28fadd;let _0x25ff01={'layers':[],'activeLayer':_0x32dc76[_0x506d61(0xeb)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x2fb3f5=0x0;_0x2fb3f5<_0x32dc76[_0x506d61(0xe0)][_0x506d61(0x115)];_0x2fb3f5++){let _0x59c8e9=new Image();_0x59c8e9[_0x506d61(0x153)]=_0x32dc76[_0x506d61(0xe0)][_0x2fb3f5];let _0x49c301=document[_0x506d61(0xee)](_0x506d61(0x10c));_0x49c301['width']=_0x92be17[_0x506d61(0x120)]*cellSize,_0x49c301['height']=_0x92be17['height']*cellSize,_0x59c8e9['onload']=()=>{const _0x128182=_0x506d61;let _0x3a3d37=_0x49c301['getContext']('2d');_0x3a3d37[_0x128182(0x11d)](0x0,0x0,_0x49c301[_0x128182(0x120)],_0x49c301['height']),_0x3a3d37[_0x128182(0x111)](_0x59c8e9,0x0,0x0);try{redrawAll();}catch(_0x1968b7){}},_0x25ff01[_0x506d61(0xe0)]['push'](_0x49c301),_0x25ff01[_0x506d61(0x147)][_0x506d61(0x12f)]([]),_0x25ff01['layerRedoStacks']['push']([]);}return _0x25ff01;}),_0x53804b[_0x28fadd(0xdc)]=_0x92be17[_0x28fadd(0xdc)],_0x53804b[_0x28fadd(0xf9)]=_0x92be17[_0x28fadd(0xf9)]||'画像'+(_0x11ccfe+0x1),_0x53804b;}),activeProject=_0x287312[_0x5a4b35(0x10b)]||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}catch(_0x25e225){alert('ファイルの読み込みに失敗しました。');}finally{try{hideLoading();}catch(_0x4d7317){}}},_0x4cf725[_0x517179(0x123)]=function(){try{hideLoading();}catch(_0x3a90e0){}},_0x4cf725[_0x517179(0x140)](_0x32ad12);}async function loadProjectFromIDB(){const _0x39a198=_0x74af53;try{let _0x38a053=await idbGet('nezumi-sketch-save');if(!_0x38a053){console[_0x39a198(0xec)](_0x39a198(0xe7));try{const _0x1077b4=localStorage[_0x39a198(0x154)](_0x39a198(0xe8));if(_0x1077b4){const _0x59a336=JSON[_0x39a198(0x117)](_0x1077b4);_0x59a336&&_0x59a336[_0x39a198(0x126)]&&(console[_0x39a198(0xec)](_0x39a198(0xfc)),_0x38a053=_0x59a336);}}catch(_0x20bc4c){console[_0x39a198(0x12a)](_0x39a198(0x145),_0x20bc4c);}if(!_0x38a053){if(typeof requestAutoSave===_0x39a198(0xe4))requestAutoSave();return;}}console['log'](_0x39a198(0x112),{'projects':Array[_0x39a198(0x10e)](_0x38a053[_0x39a198(0x126)])?_0x38a053['projects'][_0x39a198(0x115)]:0x0,'activeProject':_0x38a053[_0x39a198(0x10b)]}),projects=_0x38a053[_0x39a198(0x126)][_0x39a198(0xed)]((_0x249acd,_0x2e2048)=>{const _0x3c024c=_0x39a198;let _0x2b9e2c=createProject(_0x249acd[_0x3c024c(0x120)],_0x249acd[_0x3c024c(0x137)],_0x249acd[_0x3c024c(0xf9)]||'画像'+(_0x2e2048+0x1));return _0x2b9e2c[_0x3c024c(0x110)]=_0x249acd[_0x3c024c(0x110)]['map'](_0x4a9e57=>{const _0x573d80=_0x3c024c;let _0x52b296={'layers':[],'activeLayer':_0x4a9e57[_0x573d80(0xeb)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x295683=0x0;_0x295683<_0x4a9e57['layers'][_0x573d80(0x115)];_0x295683++){let _0x28ea8e=new Image();_0x28ea8e[_0x573d80(0x153)]=_0x4a9e57[_0x573d80(0xe0)][_0x295683];let _0x14073c=document['createElement'](_0x573d80(0x10c));_0x14073c[_0x573d80(0x120)]=_0x249acd[_0x573d80(0x120)]*cellSize,_0x14073c[_0x573d80(0x137)]=_0x249acd['height']*cellSize,_0x28ea8e['onload']=()=>{const _0x4af82d=_0x573d80;let _0x3343cb=_0x14073c['getContext']('2d');_0x3343cb[_0x4af82d(0x11d)](0x0,0x0,_0x14073c[_0x4af82d(0x120)],_0x14073c[_0x4af82d(0x137)]),_0x3343cb[_0x4af82d(0x111)](_0x28ea8e,0x0,0x0);},_0x52b296[_0x573d80(0xe0)][_0x573d80(0x12f)]({'canvas':_0x14073c,'visible':!![]}),_0x52b296[_0x573d80(0x147)][_0x573d80(0x12f)]([]),_0x52b296[_0x573d80(0x10f)][_0x573d80(0x12f)]([]);}return _0x52b296;}),_0x2b9e2c[_0x3c024c(0xdc)]=_0x249acd[_0x3c024c(0xdc)],_0x2b9e2c[_0x3c024c(0xf9)]=_0x249acd['name']||'画像'+(_0x2e2048+0x1),_0x2b9e2c;}),activeProject=_0x38a053[_0x39a198(0x10b)]||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{if(typeof updateUndoRedoButtons===_0x39a198(0xe4))updateUndoRedoButtons();}catch(_0x32f6b7){}setTool(_0x39a198(0x133)),console[_0x39a198(0xd9)](_0x39a198(0x105));}catch(_0x14ea7e){alert(_0x39a198(0x149)),console[_0x39a198(0xe3)](_0x14ea7e);}}function shiftLayerCanvas(_0x12073d,_0x5a97ab,_0x33c477){const _0x3a0c78=_0x74af53;if(!_0x12073d)return;const _0x2b6a15=_0x12073d[_0x3a0c78(0x120)],_0x5b4648=_0x12073d['height'],_0x19de04=document['createElement'](_0x3a0c78(0x10c));_0x19de04[_0x3a0c78(0x120)]=_0x2b6a15,_0x19de04[_0x3a0c78(0x137)]=_0x5b4648;const _0x306185=_0x19de04['getContext']('2d');_0x306185[_0x3a0c78(0x11d)](0x0,0x0,_0x2b6a15,_0x5b4648),_0x306185[_0x3a0c78(0x111)](_0x12073d,0x0,0x0);const _0x2d94e3=_0x12073d['getContext']('2d');_0x2d94e3[_0x3a0c78(0x11d)](0x0,0x0,_0x2b6a15,_0x5b4648),_0x2d94e3[_0x3a0c78(0x111)](_0x19de04,_0x5a97ab,_0x33c477);}function nudgeActiveLayer(_0x4b09a8,_0x52d470){const _0x1fe37b=_0x74af53,_0x4e7e6f=getCurrentProject();if(!_0x4e7e6f)return;const _0x1e2f9d=getCurrentFrame();if(!_0x1e2f9d)return;const _0x2c6f7d=_0x1e2f9d[_0x1fe37b(0xeb)];if(_0x2c6f7d==null)return;const _0x46567f=(_0x4b09a8||0x0)*cellSize,_0x4922de=(_0x52d470||0x0)*cellSize;if(_0x46567f===0x0&&_0x4922de===0x0)return;saveHistory();const _0x10909b=_0x1e2f9d['layers'][_0x2c6f7d],_0x584fdc=_0x10909b&&_0x10909b['canvas']?_0x10909b[_0x1fe37b(0x10c)]:_0x10909b;_0x584fdc?(shiftLayerCanvas(_0x584fdc,_0x46567f,_0x4922de),redrawAll()):console['warn'](_0x1fe37b(0xe1),_0x10909b);}function startLayerMove(_0x14d9bf){const _0x4a3e89=_0x74af53;layerMoveState[_0x4a3e89(0xd1)]=!![];const _0x22c5c6=getCanvasCoords(_0x14d9bf);layerMoveState['startCell']={'x':Math[_0x4a3e89(0x11f)](_0x22c5c6['x']/cellSize),'y':Math[_0x4a3e89(0x11f)](_0x22c5c6['y']/cellSize)},layerMoveState[_0x4a3e89(0xd3)]={'x':0x0,'y':0x0};}function endLayerMove(_0x4c288e){const _0x34c91e=_0x74af53;if(!layerMoveState[_0x34c91e(0xd1)])return;const _0x62a011=layerMoveState[_0x34c91e(0xd3)]['x']*cellSize,_0x507c12=layerMoveState[_0x34c91e(0xd3)]['y']*cellSize;if(_0x62a011!==0x0||_0x507c12!==0x0){saveHistory();const _0x4b8212=getCurrentFrame();if(_0x4b8212&&typeof _0x4b8212[_0x34c91e(0xeb)]===_0x34c91e(0x113)){const _0x70e7af=_0x4b8212[_0x34c91e(0xe0)][_0x4b8212[_0x34c91e(0xeb)]],_0xe49eb4=_0x70e7af&&_0x70e7af[_0x34c91e(0x10c)]?_0x70e7af[_0x34c91e(0x10c)]:_0x70e7af;if(_0xe49eb4)shiftLayerCanvas(_0xe49eb4,_0x62a011,_0x507c12);}}layerMoveState['active']=![],layerMoveState[_0x34c91e(0x136)]=null,layerMoveState[_0x34c91e(0xd3)]={'x':0x0,'y':0x0},redrawAll();}