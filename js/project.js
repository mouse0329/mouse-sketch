const _0x3c5963=_0x4f55;(function(_0xa4a1b1,_0x3a5614){const _0x2adbfd=_0x4f55,_0x394a92=_0xa4a1b1();while(!![]){try{const _0x51da5a=-parseInt(_0x2adbfd(0x103))/0x1+-parseInt(_0x2adbfd(0xe5))/0x2*(parseInt(_0x2adbfd(0x12b))/0x3)+-parseInt(_0x2adbfd(0x122))/0x4*(parseInt(_0x2adbfd(0xdd))/0x5)+parseInt(_0x2adbfd(0xe4))/0x6*(parseInt(_0x2adbfd(0x10e))/0x7)+parseInt(_0x2adbfd(0x123))/0x8+-parseInt(_0x2adbfd(0xff))/0x9*(parseInt(_0x2adbfd(0x155))/0xa)+-parseInt(_0x2adbfd(0x14d))/0xb*(-parseInt(_0x2adbfd(0x153))/0xc);if(_0x51da5a===_0x3a5614)break;else _0x394a92['push'](_0x394a92['shift']());}catch(_0x3cc8ad){_0x394a92['push'](_0x394a92['shift']());}}}(_0x2f39,0xa688e));const _0x498872=(function(){let _0x10e662=!![];return function(_0x217787,_0x4712e8){const _0x3a47ce=_0x10e662?function(){if(_0x4712e8){const _0x317a4f=_0x4712e8['apply'](_0x217787,arguments);return _0x4712e8=null,_0x317a4f;}}:function(){};return _0x10e662=![],_0x3a47ce;};}()),_0x26f08b=_0x498872(this,function(){const _0xb842bf=_0x4f55;return _0x26f08b[_0xb842bf(0x15d)]()[_0xb842bf(0x143)](_0xb842bf(0x149))['toString']()[_0xb842bf(0x128)](_0x26f08b)[_0xb842bf(0x143)](_0xb842bf(0x149));});_0x26f08b();function createProject(_0x1cc384=0x10,_0x335e47=0x10,_0x38f828=''){const _0x5d8f88=_0x4f55;let _0x4f2a11=0x14,_0x28b4bb=[],_0x42a9c7=[],_0x257116=[],_0x340e68=document[_0x5d8f88(0x129)]('canvas');_0x340e68[_0x5d8f88(0xda)]=_0x1cc384*_0x4f2a11,_0x340e68[_0x5d8f88(0xed)]=_0x335e47*_0x4f2a11,_0x28b4bb[_0x5d8f88(0xf1)]({'canvas':_0x340e68,'visible':!![]}),_0x42a9c7[_0x5d8f88(0xf1)]([]),_0x257116[_0x5d8f88(0xf1)]([]);let _0x1f939e={'layers':_0x28b4bb,'activeLayer':0x0,'layerHistories':_0x42a9c7,'layerRedoStacks':_0x257116};return{'frames':[_0x1f939e],'activeFrame':0x0,'width':_0x1cc384,'height':_0x335e47,'name':_0x38f828||'画像'+(projects['length']+0x1)};}function editProjectName(_0x4cc3b0,_0x1bb05c){const _0x2fcf12=_0x4f55,_0x23f337=document[_0x2fcf12(0x129)](_0x2fcf12(0xe0));_0x23f337['type']='text',_0x23f337['value']=projects[_0x4cc3b0][_0x2fcf12(0xde)]||'画像'+(_0x4cc3b0+0x1),_0x23f337[_0x2fcf12(0x146)]=_0x2fcf12(0xf8),_0x23f337[_0x2fcf12(0x107)][_0x2fcf12(0xda)]=_0x2fcf12(0xf0),_0x23f337['onblur']=()=>{const _0x41027a=_0x2fcf12;projects[_0x4cc3b0][_0x41027a(0xde)]=_0x23f337['value'][_0x41027a(0xfe)]()||'画像'+(_0x4cc3b0+0x1),updateProjectUI();},_0x23f337[_0x2fcf12(0xf5)]=_0x107f56=>{const _0x514163=_0x2fcf12;if(_0x107f56[_0x514163(0x13f)]==='Enter')_0x23f337[_0x514163(0x121)]();},_0x1bb05c['replaceWith'](_0x23f337),_0x23f337['focus'](),_0x23f337[_0x2fcf12(0x104)]();}function addProject(){showNewProjectDialog((_0x1c85a7,_0x2b616d,_0x45d399)=>{const _0x57357c=_0x4f55;if(!Number[_0x57357c(0x13a)](_0x1c85a7)||_0x1c85a7<0x1)_0x1c85a7=0x10;if(!Number[_0x57357c(0x13a)](_0x2b616d)||_0x2b616d<0x1)_0x2b616d=0x10;projects['push'](createProject(_0x1c85a7,_0x2b616d,_0x45d399)),activeProject=projects[_0x57357c(0x110)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();});}function removeProjectAt(_0xae7f5){const _0x3fd539=_0x4f55;if(projects[_0x3fd539(0x110)]<=0x1)return;const _0x379bab=projects[_0xae7f5]&&projects[_0xae7f5][_0x3fd539(0xde)]?projects[_0xae7f5]['name']:'画像'+(_0xae7f5+0x1);if(!confirm('「'+_0x379bab+_0x3fd539(0x157)))return;projects[_0x3fd539(0x15c)](_0xae7f5,0x1);if(activeProject>=projects[_0x3fd539(0x110)])activeProject=projects['length']-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentProject(){return projects[activeProject];}function addFrame(){const _0x4d422f=_0x4f55,_0x52c846=getCurrentProject(),_0x1a596a=_0x52c846[_0x4d422f(0x145)][_0x52c846[_0x4d422f(0x15a)]],_0x2d0afa=_0x140894=>{const _0x8f8d02=_0x4d422f,_0x4ff580=document[_0x8f8d02(0x129)]('canvas');_0x4ff580[_0x8f8d02(0xda)]=_0x140894[_0x8f8d02(0xda)],_0x4ff580['height']=_0x140894[_0x8f8d02(0xed)];const _0x56aa91=_0x4ff580[_0x8f8d02(0x132)]('2d');if(_0x140894 instanceof HTMLCanvasElement)_0x56aa91['drawImage'](_0x140894,0x0,0x0);else _0x140894[_0x8f8d02(0xdb)]&&_0x140894['canvas']instanceof HTMLCanvasElement?_0x56aa91[_0x8f8d02(0x14a)](_0x140894[_0x8f8d02(0xdb)],0x0,0x0):console[_0x8f8d02(0xd9)]('複製できないレイヤーがありますチュー',_0x140894);return _0x4ff580;},_0x4ecb6d=_0x1a596a[_0x4d422f(0x136)][_0x4d422f(0x10a)](_0x2d0afa),_0x2d4293=_0x4ecb6d[_0x4d422f(0x10a)](()=>[]),_0xd79a7f=_0x4ecb6d[_0x4d422f(0x10a)](()=>[]),_0x255035={'layers':_0x4ecb6d,'activeLayer':0x0,'layerHistories':_0x2d4293,'layerRedoStacks':_0xd79a7f};_0x52c846[_0x4d422f(0x145)][_0x4d422f(0x15c)](_0x52c846['activeFrame']+0x1,0x0,_0x255035),_0x52c846[_0x4d422f(0x15a)]++,updateFrameUI(),updateLayerUI(),redrawAll();}const cloneLayer=_0x3bfc78=>{const _0x108295=_0x4f55,_0x4b3692=document['createElement'](_0x108295(0xdb));_0x4b3692[_0x108295(0xda)]=_0x3bfc78[_0x108295(0xda)],_0x4b3692[_0x108295(0xed)]=_0x3bfc78[_0x108295(0xed)];const _0x39b297=_0x4b3692[_0x108295(0x132)]('2d');if(_0x3bfc78 instanceof HTMLCanvasElement)_0x39b297[_0x108295(0x14a)](_0x3bfc78,0x0,0x0);else _0x3bfc78[_0x108295(0xdb)]&&_0x3bfc78[_0x108295(0xdb)]instanceof HTMLCanvasElement?_0x39b297['drawImage'](_0x3bfc78[_0x108295(0xdb)],0x0,0x0):console[_0x108295(0xd9)](_0x108295(0x130),_0x3bfc78);return _0x4b3692;};function removeFrameAt(_0x1fafce){const _0xae22bd=_0x4f55;let _0x4aeaa5=getCurrentProject();if(_0x4aeaa5[_0xae22bd(0x145)][_0xae22bd(0x110)]<=0x1)return;_0x4aeaa5[_0xae22bd(0x145)][_0xae22bd(0x15c)](_0x1fafce,0x1);if(_0x4aeaa5[_0xae22bd(0x15a)]>=_0x4aeaa5[_0xae22bd(0x145)]['length'])_0x4aeaa5['activeFrame']=_0x4aeaa5[_0xae22bd(0x145)][_0xae22bd(0x110)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0x1e7f83=_0x4f55,_0x424d31=getCurrentProject();if(!_0x424d31||!_0x424d31[_0x1e7f83(0x145)]||typeof _0x424d31[_0x1e7f83(0x15a)]!==_0x1e7f83(0x108)||!_0x424d31[_0x1e7f83(0x145)][_0x424d31[_0x1e7f83(0x15a)]])return null;return _0x424d31[_0x1e7f83(0x145)][_0x424d31['activeFrame']];}function swapLayer(_0x3e2697,_0x39feba){const _0x18f35d=_0x4f55;let _0x587e45=getCurrentFrame();[_0x587e45[_0x18f35d(0x136)][_0x3e2697],_0x587e45[_0x18f35d(0x136)][_0x39feba]]=[_0x587e45[_0x18f35d(0x136)][_0x39feba],_0x587e45[_0x18f35d(0x136)][_0x3e2697]],[_0x587e45[_0x18f35d(0x120)][_0x3e2697],_0x587e45[_0x18f35d(0x120)][_0x39feba]]=[_0x587e45['layerHistories'][_0x39feba],_0x587e45[_0x18f35d(0x120)][_0x3e2697]],[_0x587e45['layerRedoStacks'][_0x3e2697],_0x587e45[_0x18f35d(0x12c)][_0x39feba]]=[_0x587e45[_0x18f35d(0x12c)][_0x39feba],_0x587e45[_0x18f35d(0x12c)][_0x3e2697]];if(_0x587e45[_0x18f35d(0x106)]===_0x3e2697)_0x587e45['activeLayer']=_0x39feba;else{if(_0x587e45['activeLayer']===_0x39feba)_0x587e45[_0x18f35d(0x106)]=_0x3e2697;}updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x18f35d(0x12a))requestAutoSave();}function removeLayerAt(_0x2682bb){const _0x1824c8=_0x4f55;let _0x5e0ef6=getCurrentFrame();if(_0x5e0ef6[_0x1824c8(0x136)][_0x1824c8(0x110)]<=0x1)return;_0x5e0ef6[_0x1824c8(0x136)][_0x1824c8(0x15c)](_0x2682bb,0x1),_0x5e0ef6[_0x1824c8(0x120)]['splice'](_0x2682bb,0x1),_0x5e0ef6[_0x1824c8(0x12c)][_0x1824c8(0x15c)](_0x2682bb,0x1);if(_0x5e0ef6[_0x1824c8(0x106)]>=_0x5e0ef6['layers'][_0x1824c8(0x110)])_0x5e0ef6[_0x1824c8(0x106)]=_0x5e0ef6[_0x1824c8(0x136)][_0x1824c8(0x110)]-0x1;updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x1824c8(0x12a))requestAutoSave();}function addLayer(){const _0x4a572e=_0x4f55;let _0x5228e5=getCurrentProject(),_0x1292c2=getCurrentFrame(),_0x9bec40=document[_0x4a572e(0x129)]('canvas');_0x9bec40[_0x4a572e(0xda)]=_0x5228e5['width']*cellSize,_0x9bec40[_0x4a572e(0xed)]=_0x5228e5[_0x4a572e(0xed)]*cellSize,_0x1292c2[_0x4a572e(0x136)][_0x4a572e(0xf1)]({'canvas':_0x9bec40,'visible':!![]}),_0x1292c2[_0x4a572e(0x120)][_0x4a572e(0xf1)]([]),_0x1292c2[_0x4a572e(0x12c)][_0x4a572e(0xf1)]([]),_0x1292c2[_0x4a572e(0x106)]=_0x1292c2[_0x4a572e(0x136)]['length']-0x1,saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0x13690f=_0x4f55;let _0x15c8cd=getCurrentFrame();if(_0x15c8cd[_0x13690f(0x136)][_0x13690f(0x110)]<=0x1)return;_0x15c8cd[_0x13690f(0x136)][_0x13690f(0x15c)](_0x15c8cd[_0x13690f(0x106)],0x1),_0x15c8cd[_0x13690f(0x120)]['splice'](_0x15c8cd[_0x13690f(0x106)],0x1),_0x15c8cd[_0x13690f(0x12c)][_0x13690f(0x15c)](_0x15c8cd[_0x13690f(0x106)],0x1),_0x15c8cd['activeLayer']=Math[_0x13690f(0xec)](0x0,_0x15c8cd[_0x13690f(0x106)]-0x1),updateLayerUI(),redrawAll();if(typeof requestAutoSave==='function')requestAutoSave();}function selectLayer(_0x2005b7){getCurrentFrame()['activeLayer']=parseInt(_0x2005b7),updateLayerUI();}function copyLayer(){const _0x1f28e4=_0x4f55,_0xd2b47b=getCurrentFrame();if(!_0xd2b47b)return;const _0x387ad1=_0xd2b47b['activeLayer'];if(typeof _0x387ad1!==_0x1f28e4(0x108)||!_0xd2b47b[_0x1f28e4(0x136)][_0x387ad1])return;const _0x54ff6b=_0xd2b47b[_0x1f28e4(0x136)][_0x387ad1],_0x6fa615=_0x54ff6b&&_0x54ff6b[_0x1f28e4(0xdb)]?_0x54ff6b['canvas']:_0x54ff6b;if(!_0x6fa615||typeof _0x6fa615['toDataURL']!=='function')return;copiedLayerDataUrl=_0x6fa615[_0x1f28e4(0xe3)]();const _0x39026d=document['getElementById'](_0x1f28e4(0x13d));if(_0x39026d)_0x39026d['disabled']=![];}function pasteLayer(){const _0x2e929c=_0x4f55;if(!copiedLayerDataUrl)return;const _0x31236b=getCurrentProject(),_0x384fe1=getCurrentFrame();if(!_0x31236b||!_0x384fe1)return;const _0x43c742=document[_0x2e929c(0x129)](_0x2e929c(0xdb));_0x43c742[_0x2e929c(0xda)]=_0x31236b[_0x2e929c(0xda)]*cellSize,_0x43c742[_0x2e929c(0xed)]=_0x31236b['height']*cellSize;const _0x2d4048=_0x43c742['getContext']('2d'),_0xac12dd=new Image();_0xac12dd[_0x2e929c(0x14b)]=()=>{const _0x1764f8=_0x2e929c;_0x2d4048[_0x1764f8(0x101)](0x0,0x0,_0x43c742[_0x1764f8(0xda)],_0x43c742[_0x1764f8(0xed)]),_0x2d4048[_0x1764f8(0x14a)](_0xac12dd,0x0,0x0),_0x384fe1[_0x1764f8(0x136)]['push']({'canvas':_0x43c742,'visible':!![]}),_0x384fe1[_0x1764f8(0x120)][_0x1764f8(0xf1)]([]),_0x384fe1[_0x1764f8(0x12c)][_0x1764f8(0xf1)]([]),_0x384fe1[_0x1764f8(0x106)]=_0x384fe1['layers'][_0x1764f8(0x110)]-0x1,saveHistory(),updateLayerUI(),redrawAll();},_0xac12dd[_0x2e929c(0x159)]=copiedLayerDataUrl;}async function exportLayersAsGif(){const _0x278e3a=_0x4f55,_0x48c972=document[_0x278e3a(0x140)](_0x278e3a(0x134));if(_0x48c972)_0x48c972[_0x278e3a(0xf9)]='処理中...';const _0x1d44ed=getCurrentProject();if(!_0x1d44ed){if(_0x48c972)_0x48c972[_0x278e3a(0xf9)]='';return;}const _0x23900e=_0x1d44ed[_0x278e3a(0x145)],_0x416a14=_0x1d44ed['width']*cellSize,_0x328ae3=_0x1d44ed['height']*cellSize;let _0x4310c1=0x0;_0x23900e[_0x278e3a(0x156)](_0x43185e=>{const _0x242738=_0x278e3a;_0x4310c1=Math['max'](_0x4310c1,_0x43185e[_0x242738(0x136)][_0x242738(0x110)]);});for(let _0x25aced=0x0;_0x25aced<_0x4310c1;_0x25aced++){const _0x5a9fec=await Promise['all'](_0x23900e[_0x278e3a(0x10a)](_0x17cfd9=>{return new Promise(_0x4dbe4e=>{const _0x5dc7e0=_0x4f55,_0x41f24a=document[_0x5dc7e0(0x129)](_0x5dc7e0(0xdb));_0x41f24a[_0x5dc7e0(0xda)]=_0x416a14,_0x41f24a[_0x5dc7e0(0xed)]=_0x328ae3;const _0x2b0242=_0x41f24a[_0x5dc7e0(0x132)]('2d'),_0x57c27a=_0x17cfd9[_0x5dc7e0(0x136)][_0x25aced]&&_0x17cfd9[_0x5dc7e0(0x136)][_0x25aced]['canvas']?_0x17cfd9[_0x5dc7e0(0x136)][_0x25aced][_0x5dc7e0(0xdb)]:_0x17cfd9[_0x5dc7e0(0x136)][_0x25aced];if(_0x57c27a)_0x2b0242[_0x5dc7e0(0x14a)](_0x57c27a,0x0,0x0);const _0x2c8edd=new Image();_0x2c8edd[_0x5dc7e0(0x14b)]=()=>_0x4dbe4e(_0x2c8edd),_0x2c8edd['src']=_0x41f24a[_0x5dc7e0(0xe3)](_0x5dc7e0(0x11e));});})),_0xf6f571=_0x5a9fec[_0x278e3a(0x154)](_0x5b0dab=>{const _0x2a6b55=_0x278e3a,_0x250f42=document[_0x2a6b55(0x129)](_0x2a6b55(0xdb));_0x250f42[_0x2a6b55(0xda)]=_0x416a14,_0x250f42['height']=_0x328ae3;const _0x4be3f6=_0x250f42[_0x2a6b55(0x132)]('2d');_0x4be3f6['drawImage'](_0x5b0dab,0x0,0x0);const _0x836fc4=_0x4be3f6[_0x2a6b55(0xeb)](0x0,0x0,_0x416a14,_0x328ae3)[_0x2a6b55(0xee)];for(let _0x70eb6=0x3;_0x70eb6<_0x836fc4[_0x2a6b55(0x110)];_0x70eb6+=0x4)if(_0x836fc4[_0x70eb6]!==0x0)return!![];return![];});if(!_0xf6f571)continue;const _0x47809e=(_0x1d44ed[_0x278e3a(0xde)]||_0x278e3a(0x13b))[_0x278e3a(0xe6)](/[\\/:*?"<>|]/g,'_')+(_0x278e3a(0x137)+(_0x25aced+0x1)+_0x278e3a(0x151));convertToGIF(_0x5a9fec,animationDelay,_0x47809e),await new Promise(_0x5e8f2c=>setTimeout(_0x5e8f2c,0x78));}if(_0x48c972)_0x48c972[_0x278e3a(0xf9)]='';}async function exportLayersAsApng(){const _0x3cbb74=_0x4f55,_0x544ef2=document['getElementById'](_0x3cbb74(0x134));if(_0x544ef2)_0x544ef2[_0x3cbb74(0xf9)]=_0x3cbb74(0xe1);const _0x142c85=getCurrentProject();if(!_0x142c85){if(_0x544ef2)_0x544ef2[_0x3cbb74(0xf9)]='';return;}const _0x1b7c0d=_0x142c85[_0x3cbb74(0x145)],_0x2b001b=_0x142c85[_0x3cbb74(0xda)]*cellSize,_0x18ca96=_0x142c85[_0x3cbb74(0xed)]*cellSize;let _0x592546=0x0;_0x1b7c0d[_0x3cbb74(0x156)](_0x4dc201=>{const _0x418acf=_0x3cbb74;_0x592546=Math[_0x418acf(0xec)](_0x592546,_0x4dc201[_0x418acf(0x136)]['length']);});for(let _0x42e6c1=0x0;_0x42e6c1<_0x592546;_0x42e6c1++){const _0x35b7b4=await Promise[_0x3cbb74(0x11d)](_0x1b7c0d['map'](_0x7adce1=>{return new Promise(_0x4c3c72=>{const _0x13eee3=_0x4f55,_0x4afc52=document[_0x13eee3(0x129)](_0x13eee3(0xdb));_0x4afc52[_0x13eee3(0xda)]=_0x2b001b,_0x4afc52[_0x13eee3(0xed)]=_0x18ca96;const _0x11bbe8=_0x4afc52[_0x13eee3(0x132)]('2d'),_0x516111=_0x7adce1['layers'][_0x42e6c1]&&_0x7adce1[_0x13eee3(0x136)][_0x42e6c1][_0x13eee3(0xdb)]?_0x7adce1[_0x13eee3(0x136)][_0x42e6c1][_0x13eee3(0xdb)]:_0x7adce1[_0x13eee3(0x136)][_0x42e6c1];if(_0x516111)_0x11bbe8[_0x13eee3(0x14a)](_0x516111,0x0,0x0);const _0x5873df=new Image();_0x5873df['onload']=()=>_0x4c3c72(_0x5873df),_0x5873df[_0x13eee3(0x159)]=_0x4afc52[_0x13eee3(0xe3)](_0x13eee3(0x11e));});})),_0xeb0df=_0x35b7b4[_0x3cbb74(0x154)](_0x543407=>{const _0x2206df=_0x3cbb74,_0x5553de=document[_0x2206df(0x129)]('canvas');_0x5553de['width']=_0x2b001b,_0x5553de[_0x2206df(0xed)]=_0x18ca96;const _0x49832a=_0x5553de[_0x2206df(0x132)]('2d');_0x49832a[_0x2206df(0x14a)](_0x543407,0x0,0x0);const _0x2fe7e3=_0x49832a[_0x2206df(0xeb)](0x0,0x0,_0x2b001b,_0x18ca96)[_0x2206df(0xee)];for(let _0x67a593=0x3;_0x67a593<_0x2fe7e3[_0x2206df(0x110)];_0x67a593+=0x4)if(_0x2fe7e3[_0x67a593]!==0x0)return!![];return![];});if(!_0xeb0df)continue;const _0x5fb153=(_0x142c85[_0x3cbb74(0xde)]||_0x3cbb74(0x13b))['replace'](/[\\/:*?"<>|]/g,'_')+(_0x3cbb74(0x137)+(_0x42e6c1+0x1)+_0x3cbb74(0x109));convertToAPNG(_0x35b7b4,_0x2b001b,_0x18ca96,animationDelay,_0x5fb153),await new Promise(_0xaefc66=>setTimeout(_0xaefc66,0x78));}if(_0x544ef2)_0x544ef2['textContent']='';}async function exportFramesLayersZip(){const _0x2201e1=_0x4f55,_0x4d5e19=document[_0x2201e1(0x140)]('layerExportStatus');if(_0x4d5e19)_0x4d5e19[_0x2201e1(0xf9)]='ZIP作成中...';const _0x4bc152=getCurrentProject();if(!_0x4bc152){if(_0x4d5e19)_0x4d5e19[_0x2201e1(0xf9)]='';return;}const _0x2ea12d=_0x4bc152['frames'],_0x2fc7b5=_0x4bc152[_0x2201e1(0xda)]*cellSize,_0x3059f7=_0x4bc152[_0x2201e1(0xed)]*cellSize,_0xbcbe2c=new JSZip();for(let _0x29da30=0x0;_0x29da30<_0x2ea12d[_0x2201e1(0x110)];_0x29da30++){const _0x45a1e7=_0x2ea12d[_0x29da30],_0x10eb4d=_0xbcbe2c[_0x2201e1(0x14e)](_0x2201e1(0x158)+(_0x29da30+0x1));for(let _0x534fe6=0x0;_0x534fe6<_0x45a1e7[_0x2201e1(0x136)][_0x2201e1(0x110)];_0x534fe6++){const _0x39282e=document['createElement'](_0x2201e1(0xdb));_0x39282e[_0x2201e1(0xda)]=_0x2fc7b5,_0x39282e[_0x2201e1(0xed)]=_0x3059f7;const _0x10bcac=_0x39282e[_0x2201e1(0x132)]('2d');_0x10bcac[_0x2201e1(0x101)](0x0,0x0,_0x2fc7b5,_0x3059f7);const _0x5fd451=_0x45a1e7['layers'][_0x534fe6];if(_0x5fd451){const _0x59f981=_0x5fd451[_0x2201e1(0xdb)]?_0x5fd451['canvas']:_0x5fd451;if(_0x59f981)_0x10bcac[_0x2201e1(0x14a)](_0x59f981,0x0,0x0);}const _0x4c26d7=_0x39282e['toDataURL'](_0x2201e1(0x11e)),_0x32b03f=_0x4c26d7[_0x2201e1(0x13c)](',')[0x1],_0x7c50c0=atob(_0x32b03f),_0xf7fdc=new Uint8Array(_0x7c50c0['length']);for(let _0x30a1b7=0x0;_0x30a1b7<_0x7c50c0[_0x2201e1(0x110)];_0x30a1b7++)_0xf7fdc[_0x30a1b7]=_0x7c50c0[_0x2201e1(0x11f)](_0x30a1b7);_0x10eb4d[_0x2201e1(0xdc)](_0x2201e1(0xe9)+(_0x534fe6+0x1)+_0x2201e1(0x100),_0xf7fdc);}}const _0x126810=await _0xbcbe2c[_0x2201e1(0xe8)]({'type':_0x2201e1(0xfb)}),_0x26ff1b=(_0x4bc152[_0x2201e1(0xde)]||_0x2201e1(0x118))[_0x2201e1(0xe6)](/[\\/:*?"<>|]/g,'_'),_0xbd22a=document[_0x2201e1(0x129)]('a');_0xbd22a[_0x2201e1(0x15b)]=URL[_0x2201e1(0xfa)](_0x126810),_0xbd22a['download']=_0x26ff1b+_0x2201e1(0xea),document['body']['appendChild'](_0xbd22a),_0xbd22a['click'](),setTimeout(()=>{const _0x12c691=_0x2201e1;URL['revokeObjectURL'](_0xbd22a[_0x12c691(0x15b)]),document[_0x12c691(0xe7)][_0x12c691(0x124)](_0xbd22a);if(_0x4d5e19)_0x4d5e19[_0x12c691(0xf9)]='';},0x4b0);}function saveProjectFile(){const _0x3a99e1=_0x4f55,_0x37e057=typeof getSavePayload===_0x3a99e1(0x12a)?getSavePayload():{'projects':projects[_0x3a99e1(0x10a)](_0x3b7412=>({'width':_0x3b7412[_0x3a99e1(0xda)],'height':_0x3b7412[_0x3a99e1(0xed)],'name':_0x3b7412[_0x3a99e1(0xde)]||'','activeFrame':_0x3b7412[_0x3a99e1(0x15a)],'frames':_0x3b7412[_0x3a99e1(0x145)]['map'](_0xb15a94=>({'activeLayer':_0xb15a94['activeLayer'],'layers':_0xb15a94[_0x3a99e1(0x136)][_0x3a99e1(0x10a)](_0x4b21d3=>_0x4b21d3&&_0x4b21d3[_0x3a99e1(0xdb)]?_0x4b21d3[_0x3a99e1(0xdb)][_0x3a99e1(0xe3)]():_0x4b21d3&&_0x4b21d3['toDataURL']?_0x4b21d3[_0x3a99e1(0xe3)]():null)}))})),'activeProject':activeProject},_0x31881f=new Blob([JSON[_0x3a99e1(0xf7)](_0x37e057)],{'type':_0x3a99e1(0x11c)}),_0xf5abe0=document[_0x3a99e1(0x129)]('a');_0xf5abe0['download']=_0x3a99e1(0x126),_0xf5abe0[_0x3a99e1(0x15b)]=URL['createObjectURL'](_0x31881f),_0xf5abe0[_0x3a99e1(0x147)]();}function getSavePayload(){const _0x19d51f=_0x4f55;return{'projects':projects[_0x19d51f(0x10a)](_0xf0010e=>({'width':_0xf0010e[_0x19d51f(0xda)],'height':_0xf0010e['height'],'name':_0xf0010e['name']||'','activeFrame':_0xf0010e['activeFrame'],'frames':_0xf0010e['frames'][_0x19d51f(0x10a)](_0x1d2cba=>({'activeLayer':_0x1d2cba[_0x19d51f(0x106)],'layers':_0x1d2cba[_0x19d51f(0x136)][_0x19d51f(0x10a)](_0x2646e2=>_0x2646e2&&_0x2646e2[_0x19d51f(0xdb)]?_0x2646e2[_0x19d51f(0xdb)][_0x19d51f(0xe3)]():_0x2646e2&&_0x2646e2[_0x19d51f(0xe3)]?_0x2646e2['toDataURL']():null)}))})),'activeProject':activeProject};}async function saveProjectToIDB(){const _0x66e77e=_0x4f55,_0xd4e3b9=getSavePayload();try{await idbSet('nezumi-sketch-save',_0xd4e3b9),console['log'](_0x66e77e(0xfc));}catch(_0x163a23){console[_0x66e77e(0x10d)]('保存に失敗したチュー:',_0x163a23);}}function _0x4f55(_0x1e4da0,_0x1c115a){_0x1e4da0=_0x1e4da0-0xd8;const _0xd18979=_0x2f39();let _0x26f08b=_0xd18979[_0x1e4da0];return _0x26f08b;}function flushQuickSaveToLocalStorage(){const _0x952fce=_0x4f55;try{const _0x43fbf3=getSavePayload();localStorage[_0x952fce(0x12d)](_0x952fce(0x12e),JSON[_0x952fce(0xf7)](_0x43fbf3)),console[_0x952fce(0x148)](_0x952fce(0xd8));}catch(_0xf35098){console[_0x952fce(0x10d)](_0x952fce(0x114),_0xf35098);}}window[_0x3c5963(0x150)](_0x3c5963(0x127),()=>{const _0x166296=_0x3c5963;if(document[_0x166296(0xf3)]&&autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x166296(0x12a))saveProjectToIDB();}}),window[_0x3c5963(0x150)](_0x3c5963(0x105),()=>{const _0x4dc03e=_0x3c5963;if(autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x4dc03e(0x12a))saveProjectToIDB();}});let autosaveDirty=![],autosaveTimer=null;const AUTOSAVE_DELAY=0x1388,AUTOSAVE_INTERVAL=0xea60;function _0x2f39(){const _0xeb3a02=['charCodeAt','layerHistories','blur','33404NtpsqF','6524352ZqKeKu','removeChild','auto-save:\x20saved','nezumi-sketch.msketch','visibilitychange','constructor','createElement','function','845730SEvXDA','layerRedoStacks','setItem','nezumi-sketch-save-quick','ファイルにプロジェクトメタデータが見つかりませんでした。読み込みできません。','複製できないレイヤーがありますチュー','auto-save\x20(interval):\x20saved','getContext','IndexedDBからプロジェクトを読み込んだチュー！','layerExportStatus','onerror','layers','-layer','readAsText','offsetCells','isFinite','nezumi-animation','split','pasteLayerBtn','startsWith','key','getElementById','ファイルの読み込みに失敗しました。','startAutoSaveInterval','search','pen','frames','className','click','debug','(((.+)+)+)+$','drawImage','onload','loadProjectFromIDB:\x20DB\x20に保存が見つかりませんでした。localStorage\x20のクイック保存を確認します。','776853HRapMW','folder','requestAutoSave:\x20scheduling\x20save\x20in\x20','addEventListener','.gif','then','540WkGDMG','some','9650590netKqx','forEach','」を削除しますか？','frame-','src','activeFrame','href','splice','toString','flushQuickSaveToLocalStorage:\x20saved\x20quick\x20snapshot','warn','width','canvas','file','755jvvDnP','name','log','input','処理中...','target','toDataURL','3963714SzNfRQ','8mumeuB','replace','body','generateAsync','layer-','-frames-layers.zip','getImageData','max','height','data','catch','80px','push','projects','hidden','startCell','onkeydown','parse','stringify','project-name-edit','textContent','createObjectURL','blob','プロジェクトをIndexedDBに保存したチュー！','loadProjectFromIDB:\x20localStorage\x20quick\x20load\x20failed','trim','9kWucwj','.png','clearRect','requestAutoSave:\x20timer\x20fired','1278991hoHVHb','select','beforeunload','activeLayer','style','number','.apng','map','info','files','error','14xLseAN','floor','length','auto-save\x20(interval)\x20failed','nezumi-sketch-save','activeProject','flushQuickSaveToLocalStorage\x20failed','type','nudgeActiveLayer:\x20対象レイヤーのキャンバスが見つかりません','getItem','nezumi-export','requestAutoSave','result','active','application/json','all','image/png'];_0x2f39=function(){return _0xeb3a02;};return _0x2f39();}function requestAutoSave(){const _0x468a82=_0x3c5963;autosaveDirty=!![];if(autosaveTimer)clearTimeout(autosaveTimer);console[_0x468a82(0x148)](_0x468a82(0x14f)+AUTOSAVE_DELAY+'ms'),autosaveTimer=setTimeout(async()=>{const _0x1e05e6=_0x468a82;console[_0x1e05e6(0x148)](_0x1e05e6(0x102));if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x1e05e6(0xdf)](_0x1e05e6(0x125));}catch(_0x131367){console[_0x1e05e6(0x10d)]('auto-save\x20failed',_0x131367);}},AUTOSAVE_DELAY);}function startAutoSaveInterval(){const _0x17d448=_0x3c5963;console[_0x17d448(0x148)]('startAutoSaveInterval:\x20starting\x20interval\x20'+AUTOSAVE_INTERVAL+'ms'),setInterval(async()=>{const _0x6e7f10=_0x17d448;if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x6e7f10(0xdf)](_0x6e7f10(0x131));}catch(_0x5edd7a){console[_0x6e7f10(0x10d)](_0x6e7f10(0x111),_0x5edd7a);}},AUTOSAVE_INTERVAL);}window[_0x3c5963(0x119)]=requestAutoSave,window[_0x3c5963(0x142)]=startAutoSaveInterval;function loadProjectFile(_0x13dece){const _0x2f0226=_0x3c5963,_0x2bb60e=_0x13dece[_0x2f0226(0xe2)][_0x2f0226(0x10c)][0x0];if(!_0x2bb60e)return;if(_0x2bb60e[_0x2f0226(0x115)]&&_0x2bb60e[_0x2f0226(0x115)][_0x2f0226(0x13e)]('image')){loadStandaloneFromFile(_0x2bb60e)[_0x2f0226(0x152)](_0x1bbef2=>{const _0x3982d2=_0x2f0226;alert('スタンドアロン形式のプロジェクトを読み込みました:\x20'+(_0x1bbef2[_0x3982d2(0xde)]||'画像'));})[_0x2f0226(0xef)](_0x194c78=>{const _0x23e9a4=_0x2f0226;console[_0x23e9a4(0xd9)](_0x194c78),alert(_0x23e9a4(0x12f));});return;}const _0x1fc78a=new FileReader();try{showLoading('ファイルを読み込み中...');}catch(_0x40bc48){}_0x1fc78a[_0x2f0226(0x14b)]=function(_0x1e7ef6){const _0x5df283=_0x2f0226;try{const _0x59b751=JSON[_0x5df283(0xf6)](_0x1e7ef6[_0x5df283(0xe2)][_0x5df283(0x11a)]);projects=_0x59b751['projects'][_0x5df283(0x10a)]((_0x1c8a52,_0x32b9cd)=>{const _0x258d4b=_0x5df283;let _0x16e9e0=createProject(_0x1c8a52[_0x258d4b(0xda)],_0x1c8a52[_0x258d4b(0xed)],_0x1c8a52[_0x258d4b(0xde)]||'画像'+(_0x32b9cd+0x1));return _0x16e9e0[_0x258d4b(0x145)]=_0x1c8a52[_0x258d4b(0x145)][_0x258d4b(0x10a)](_0xac093a=>{const _0x11a70a=_0x258d4b;let _0x26d563={'layers':[],'activeLayer':_0xac093a[_0x11a70a(0x106)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x5929bd=0x0;_0x5929bd<_0xac093a[_0x11a70a(0x136)][_0x11a70a(0x110)];_0x5929bd++){let _0x4110a3=new Image();_0x4110a3['src']=_0xac093a['layers'][_0x5929bd];let _0x5929a2=document[_0x11a70a(0x129)](_0x11a70a(0xdb));_0x5929a2[_0x11a70a(0xda)]=_0x1c8a52[_0x11a70a(0xda)]*cellSize,_0x5929a2['height']=_0x1c8a52[_0x11a70a(0xed)]*cellSize,_0x4110a3['onload']=()=>{const _0x4a8ddf=_0x11a70a;let _0x5b7fcb=_0x5929a2[_0x4a8ddf(0x132)]('2d');_0x5b7fcb[_0x4a8ddf(0x101)](0x0,0x0,_0x5929a2[_0x4a8ddf(0xda)],_0x5929a2[_0x4a8ddf(0xed)]),_0x5b7fcb[_0x4a8ddf(0x14a)](_0x4110a3,0x0,0x0);try{redrawAll();}catch(_0x484326){}},_0x26d563[_0x11a70a(0x136)][_0x11a70a(0xf1)](_0x5929a2),_0x26d563[_0x11a70a(0x120)][_0x11a70a(0xf1)]([]),_0x26d563[_0x11a70a(0x12c)][_0x11a70a(0xf1)]([]);}return _0x26d563;}),_0x16e9e0[_0x258d4b(0x15a)]=_0x1c8a52[_0x258d4b(0x15a)],_0x16e9e0[_0x258d4b(0xde)]=_0x1c8a52[_0x258d4b(0xde)]||'画像'+(_0x32b9cd+0x1),_0x16e9e0;}),activeProject=_0x59b751[_0x5df283(0x113)]||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}catch(_0x1c3836){alert(_0x5df283(0x141));}finally{try{hideLoading();}catch(_0x467517){}}},_0x1fc78a[_0x2f0226(0x135)]=function(){try{hideLoading();}catch(_0x917b2d){}},_0x1fc78a[_0x2f0226(0x138)](_0x2bb60e);}async function loadProjectFromIDB(){const _0x771096=_0x3c5963;try{let _0xac47cc=await idbGet(_0x771096(0x112));if(!_0xac47cc){console['info'](_0x771096(0x14c));try{const _0x23bf86=localStorage[_0x771096(0x117)](_0x771096(0x12e));if(_0x23bf86){const _0x530837=JSON[_0x771096(0xf6)](_0x23bf86);_0x530837&&_0x530837[_0x771096(0xf2)]&&(console[_0x771096(0x10b)]('loadProjectFromIDB:\x20localStorage\x20のクイック保存を復元します'),_0xac47cc=_0x530837);}}catch(_0x3b1e1d){console[_0x771096(0xd9)](_0x771096(0xfd),_0x3b1e1d);}if(!_0xac47cc){if(typeof requestAutoSave==='function')requestAutoSave();return;}}console[_0x771096(0xdf)]('loadProjectFromIDB:\x20データ確認',{'projects':Array['isArray'](_0xac47cc[_0x771096(0xf2)])?_0xac47cc[_0x771096(0xf2)][_0x771096(0x110)]:0x0,'activeProject':_0xac47cc[_0x771096(0x113)]}),projects=_0xac47cc[_0x771096(0xf2)][_0x771096(0x10a)]((_0x17d266,_0x5e7a4f)=>{const _0x51b304=_0x771096;let _0x1abc03=createProject(_0x17d266[_0x51b304(0xda)],_0x17d266['height'],_0x17d266[_0x51b304(0xde)]||'画像'+(_0x5e7a4f+0x1));return _0x1abc03['frames']=_0x17d266[_0x51b304(0x145)][_0x51b304(0x10a)](_0x28c956=>{const _0x2121d2=_0x51b304;let _0x1a89e0={'layers':[],'activeLayer':_0x28c956[_0x2121d2(0x106)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x3340ab=0x0;_0x3340ab<_0x28c956[_0x2121d2(0x136)]['length'];_0x3340ab++){let _0xe8ef2=new Image();_0xe8ef2[_0x2121d2(0x159)]=_0x28c956[_0x2121d2(0x136)][_0x3340ab];let _0x102a26=document[_0x2121d2(0x129)](_0x2121d2(0xdb));_0x102a26[_0x2121d2(0xda)]=_0x17d266['width']*cellSize,_0x102a26[_0x2121d2(0xed)]=_0x17d266[_0x2121d2(0xed)]*cellSize,_0xe8ef2['onload']=()=>{const _0x5c90ed=_0x2121d2;let _0x1a8597=_0x102a26['getContext']('2d');_0x1a8597[_0x5c90ed(0x101)](0x0,0x0,_0x102a26['width'],_0x102a26[_0x5c90ed(0xed)]),_0x1a8597[_0x5c90ed(0x14a)](_0xe8ef2,0x0,0x0);},_0x1a89e0[_0x2121d2(0x136)][_0x2121d2(0xf1)]({'canvas':_0x102a26,'visible':!![]}),_0x1a89e0['layerHistories'][_0x2121d2(0xf1)]([]),_0x1a89e0[_0x2121d2(0x12c)]['push']([]);}return _0x1a89e0;}),_0x1abc03[_0x51b304(0x15a)]=_0x17d266['activeFrame'],_0x1abc03[_0x51b304(0xde)]=_0x17d266[_0x51b304(0xde)]||'画像'+(_0x5e7a4f+0x1),_0x1abc03;}),activeProject=_0xac47cc[_0x771096(0x113)]||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{if(typeof updateUndoRedoButtons===_0x771096(0x12a))updateUndoRedoButtons();}catch(_0x5db033){}setTool(_0x771096(0x144)),console[_0x771096(0xdf)](_0x771096(0x133));}catch(_0x31d58d){alert('IndexedDBからの読み込みに失敗したチュー…'),console[_0x771096(0x10d)](_0x31d58d);}}function shiftLayerCanvas(_0x19bac6,_0x4ed29b,_0x441f4e){const _0xbcba0a=_0x3c5963;if(!_0x19bac6)return;const _0x311857=_0x19bac6['width'],_0x1e7307=_0x19bac6[_0xbcba0a(0xed)],_0x4cc190=document['createElement']('canvas');_0x4cc190[_0xbcba0a(0xda)]=_0x311857,_0x4cc190[_0xbcba0a(0xed)]=_0x1e7307;const _0x380c05=_0x4cc190[_0xbcba0a(0x132)]('2d');_0x380c05['clearRect'](0x0,0x0,_0x311857,_0x1e7307),_0x380c05[_0xbcba0a(0x14a)](_0x19bac6,0x0,0x0);const _0x1b02d7=_0x19bac6[_0xbcba0a(0x132)]('2d');_0x1b02d7['clearRect'](0x0,0x0,_0x311857,_0x1e7307),_0x1b02d7['drawImage'](_0x4cc190,_0x4ed29b,_0x441f4e);}function nudgeActiveLayer(_0x46e6aa,_0x280b99){const _0x1134cf=_0x3c5963,_0x361551=getCurrentProject();if(!_0x361551)return;const _0x259b75=getCurrentFrame();if(!_0x259b75)return;const _0x6aa01a=_0x259b75[_0x1134cf(0x106)];if(_0x6aa01a==null)return;const _0x46a8fe=(_0x46e6aa||0x0)*cellSize,_0x517146=(_0x280b99||0x0)*cellSize;if(_0x46a8fe===0x0&&_0x517146===0x0)return;saveHistory();const _0x3831f2=_0x259b75[_0x1134cf(0x136)][_0x6aa01a],_0x180044=_0x3831f2&&_0x3831f2[_0x1134cf(0xdb)]?_0x3831f2[_0x1134cf(0xdb)]:_0x3831f2;_0x180044?(shiftLayerCanvas(_0x180044,_0x46a8fe,_0x517146),redrawAll()):console[_0x1134cf(0xd9)](_0x1134cf(0x116),_0x3831f2);}function startLayerMove(_0xba069){const _0x334fd3=_0x3c5963;layerMoveState[_0x334fd3(0x11b)]=!![];const _0x39a772=getCanvasCoords(_0xba069);layerMoveState[_0x334fd3(0xf4)]={'x':Math[_0x334fd3(0x10f)](_0x39a772['x']/cellSize),'y':Math[_0x334fd3(0x10f)](_0x39a772['y']/cellSize)},layerMoveState[_0x334fd3(0x139)]={'x':0x0,'y':0x0};}function endLayerMove(_0x8e3825){const _0x212721=_0x3c5963;if(!layerMoveState['active'])return;const _0x54716e=layerMoveState[_0x212721(0x139)]['x']*cellSize,_0xe9f0e9=layerMoveState['offsetCells']['y']*cellSize;if(_0x54716e!==0x0||_0xe9f0e9!==0x0){saveHistory();const _0x323d42=getCurrentFrame();if(_0x323d42&&typeof _0x323d42[_0x212721(0x106)]===_0x212721(0x108)){const _0x28b7be=_0x323d42[_0x212721(0x136)][_0x323d42['activeLayer']],_0x5ae619=_0x28b7be&&_0x28b7be['canvas']?_0x28b7be[_0x212721(0xdb)]:_0x28b7be;if(_0x5ae619)shiftLayerCanvas(_0x5ae619,_0x54716e,_0xe9f0e9);}}layerMoveState[_0x212721(0x11b)]=![],layerMoveState[_0x212721(0xf4)]=null,layerMoveState[_0x212721(0x139)]={'x':0x0,'y':0x0},redrawAll();}