const _0x3a47bd=_0x349e;(function(_0x5269b4,_0x2be9de){const _0x83734e=_0x349e,_0x466449=_0x5269b4();while(!![]){try{const _0x4f8137=parseInt(_0x83734e(0x139))/0x1+parseInt(_0x83734e(0x18d))/0x2*(-parseInt(_0x83734e(0x155))/0x3)+parseInt(_0x83734e(0x114))/0x4*(parseInt(_0x83734e(0x11c))/0x5)+-parseInt(_0x83734e(0x16b))/0x6*(-parseInt(_0x83734e(0x191))/0x7)+-parseInt(_0x83734e(0x142))/0x8*(parseInt(_0x83734e(0x141))/0x9)+parseInt(_0x83734e(0x186))/0xa+parseInt(_0x83734e(0x18b))/0xb*(-parseInt(_0x83734e(0x11f))/0xc);if(_0x4f8137===_0x2be9de)break;else _0x466449['push'](_0x466449['shift']());}catch(_0x427965){_0x466449['push'](_0x466449['shift']());}}}(_0x4f80,0xeb2b9));const _0xf1169f=(function(){let _0x5f3460=!![];return function(_0x336ff7,_0x263048){const _0x32ac29=_0x5f3460?function(){const _0x179412=_0x349e;if(_0x263048){const _0x3bbedf=_0x263048[_0x179412(0x16a)](_0x336ff7,arguments);return _0x263048=null,_0x3bbedf;}}:function(){};return _0x5f3460=![],_0x32ac29;};}()),_0x1d624b=_0xf1169f(this,function(){const _0x5a9821=_0x349e;return _0x1d624b[_0x5a9821(0x123)]()[_0x5a9821(0x172)](_0x5a9821(0x14f))['toString']()[_0x5a9821(0x12d)](_0x1d624b)['search']('(((.+)+)+)+$');});_0x1d624b();function createProject(_0x46ecdd=0x10,_0x14a304=0x10,_0x20923e=''){const _0x34bf0a=_0x349e;let _0x4e7335=0x14,_0x3997cd=[],_0x653f05=[],_0x33b8de=[],_0x59e81f=document[_0x34bf0a(0x165)](_0x34bf0a(0x11d));_0x59e81f['width']=_0x46ecdd*_0x4e7335,_0x59e81f[_0x34bf0a(0x15c)]=_0x14a304*_0x4e7335,_0x3997cd[_0x34bf0a(0x16d)]({'canvas':_0x59e81f,'visible':!![]}),_0x653f05['push']([]),_0x33b8de[_0x34bf0a(0x16d)]([]);let _0x1c3294={'layers':_0x3997cd,'activeLayer':0x0,'layerHistories':_0x653f05,'layerRedoStacks':_0x33b8de};return{'frames':[_0x1c3294],'activeFrame':0x0,'width':_0x46ecdd,'height':_0x14a304,'name':_0x20923e||'画像'+(projects[_0x34bf0a(0x111)]+0x1)};}function _0x4f80(){const _0x487657=['loadProjectFromIDB:\x20localStorage\x20quick\x20load\x20failed','isArray','IndexedDBからプロジェクトを読み込んだチュー！','target','undefined','activeFrame','files','value','auto-save:\x20saved','処理中...','offsetCells','getImageData','getContext','src','3568120AuHMxF','layerHistories','data','key','download','319hudNrd','visibilitychange','38nxCBHF','drawImage','requestAutoSave:\x20timer\x20fired','charCodeAt','182686BBwMVM','getElementById','onkeydown','splice','.apng','error','length','onblur','body','76gVnxcB','nezumi-sketch-save-quick','onload','textContent','Enter','split','clearRect','number','313865NNFYVU','canvas','max','588948eclRpi','result','input','application/json','toString','activeLayer','auto-save\x20(interval)\x20failed','nudgeActiveLayer:\x20対象レイヤーのキャンバスが見つかりません','image/png','pen','activeProject','revokeObjectURL','appendChild','trim','constructor','click','nezumi-animation','file','replaceWith','startAutoSaveInterval:\x20starting\x20interval\x20','style','catch','frames','setItem','.png','replace','1216479FqIhqd','warn','nezumi-sketch-save','auto-save\x20(interval):\x20saved','active','getItem','parse','disabled','6263271dPKeVT','8iORdkZ','blob','folder','removeChild','requestAutoSave:\x20scheduling\x20save\x20in\x20','.gif','addEventListener','ファイルを読み込み中...','stringify','projects','loadProjectFromIDB:\x20データ確認','保存に失敗したチュー:','width','(((.+)+)+)+$','some','layers','startAutoSaveInterval','startsWith','複製できないレイヤーがありますチュー','44805ucFFjg','toDataURL','forEach','map','beforeunload','layer-','layerExportStatus','height','pasteLayerBtn','duplicateLayerAt\x20draw\x20error','generateAsync','info','then','type','focus','layerRedoStacks','createElement','name','cloneLayer\x20draw\x20error','nezumi-export','debug','apply','138lIqMRv','all','push','startCell','-layer','href','function','search','log','」を削除しますか？','loadProjectFromIDB:\x20localStorage\x20のクイック保存を復元します','floor','スタンドアロン形式のプロジェクトを読み込みました:\x20'];_0x4f80=function(){return _0x487657;};return _0x4f80();}function editProjectName(_0x23ea36,_0x12638a){const _0x3e6e25=_0x349e,_0x3e9407=document[_0x3e6e25(0x165)](_0x3e6e25(0x121));_0x3e9407[_0x3e6e25(0x162)]='text',_0x3e9407[_0x3e6e25(0x17f)]=projects[_0x23ea36][_0x3e6e25(0x166)]||'画像'+(_0x23ea36+0x1),_0x3e9407['className']='project-name-edit',_0x3e9407[_0x3e6e25(0x133)]['width']='80px',_0x3e9407[_0x3e6e25(0x112)]=()=>{const _0x1fc5d6=_0x3e6e25;projects[_0x23ea36]['name']=_0x3e9407['value'][_0x1fc5d6(0x12c)]()||'画像'+(_0x23ea36+0x1),updateProjectUI();},_0x3e9407[_0x3e6e25(0x193)]=_0x4adc06=>{const _0x53ab36=_0x3e6e25;if(_0x4adc06[_0x53ab36(0x189)]===_0x53ab36(0x118))_0x3e9407['blur']();},_0x12638a[_0x3e6e25(0x131)](_0x3e9407),_0x3e9407[_0x3e6e25(0x163)](),_0x3e9407['select']();}function addProject(){showNewProjectDialog((_0x39d5e3,_0x2293dd,_0x7e534a)=>{const _0x401eaf=_0x349e;if(!Number['isFinite'](_0x39d5e3)||_0x39d5e3<0x1)_0x39d5e3=0x10;if(!Number['isFinite'](_0x2293dd)||_0x2293dd<0x1)_0x2293dd=0x10;projects[_0x401eaf(0x16d)](createProject(_0x39d5e3,_0x2293dd,_0x7e534a)),activeProject=projects[_0x401eaf(0x111)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();});}function removeProjectAt(_0x30f2e5){const _0xa8b3be=_0x349e;if(projects[_0xa8b3be(0x111)]<=0x1)return;const _0x412440=projects[_0x30f2e5]&&projects[_0x30f2e5]['name']?projects[_0x30f2e5][_0xa8b3be(0x166)]:'画像'+(_0x30f2e5+0x1);if(!confirm('「'+_0x412440+_0xa8b3be(0x174)))return;projects[_0xa8b3be(0x194)](_0x30f2e5,0x1);if(activeProject>=projects['length'])activeProject=projects[_0xa8b3be(0x111)]-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentProject(){return projects[activeProject];}function addFrame(){const _0x62f34d=_0x349e,_0x34e107=getCurrentProject(),_0x42e32c=_0x34e107[_0x62f34d(0x135)][_0x34e107['activeFrame']],_0x4dd3eb=_0x26dfba=>{const _0x370434=_0x62f34d,_0x485778=_0x26dfba&&_0x26dfba[_0x370434(0x11d)]?_0x26dfba[_0x370434(0x11d)]:_0x26dfba;if(!_0x485778)return console[_0x370434(0x13a)](_0x370434(0x154),_0x26dfba),null;const _0xc11e3c=document[_0x370434(0x165)](_0x370434(0x11d));_0xc11e3c[_0x370434(0x14e)]=_0x485778[_0x370434(0x14e)]||_0x34e107['width']*cellSize,_0xc11e3c[_0x370434(0x15c)]=_0x485778['height']||_0x34e107[_0x370434(0x15c)]*cellSize;const _0x498c4d=_0xc11e3c[_0x370434(0x184)]('2d');try{_0x498c4d[_0x370434(0x18e)](_0x485778,0x0,0x0);}catch(_0x53f7be){console['warn']('cloneLayer\x20draw\x20error',_0x53f7be);}return{'canvas':_0xc11e3c,'visible':_0x26dfba&&typeof _0x26dfba['visible']!==_0x370434(0x17c)?_0x26dfba['visible']:!![]};},_0x232756=_0x42e32c['layers'][_0x62f34d(0x158)](_0x4dd3eb),_0x1e7390=_0x232756[_0x62f34d(0x158)](()=>[]),_0x523b8f=_0x232756['map'](()=>[]),_0x532a42={'layers':_0x232756,'activeLayer':0x0,'layerHistories':_0x1e7390,'layerRedoStacks':_0x523b8f};_0x34e107[_0x62f34d(0x135)][_0x62f34d(0x194)](_0x34e107[_0x62f34d(0x17d)]+0x1,0x0,_0x532a42),_0x34e107[_0x62f34d(0x17d)]++,updateFrameUI(),updateLayerUI(),redrawAll();}const cloneLayer=_0x45b354=>{const _0x46455a=_0x349e,_0x405079=_0x45b354&&_0x45b354[_0x46455a(0x11d)]?_0x45b354['canvas']:_0x45b354;if(!_0x405079)return console['warn']('複製できないレイヤーがありますチュー',_0x45b354),null;const _0x4bf039=document[_0x46455a(0x165)](_0x46455a(0x11d));_0x4bf039['width']=_0x405079['width'],_0x4bf039[_0x46455a(0x15c)]=_0x405079[_0x46455a(0x15c)];const _0x3d011b=_0x4bf039[_0x46455a(0x184)]('2d');try{_0x3d011b['drawImage'](_0x405079,0x0,0x0);}catch(_0x4a17a4){console['warn'](_0x46455a(0x167),_0x4a17a4);}return{'canvas':_0x4bf039,'visible':_0x45b354&&typeof _0x45b354['visible']!==_0x46455a(0x17c)?_0x45b354['visible']:!![]};};function removeFrameAt(_0x109cdd){const _0x542ddf=_0x349e;let _0x3f8ace=getCurrentProject();if(_0x3f8ace[_0x542ddf(0x135)][_0x542ddf(0x111)]<=0x1)return;_0x3f8ace[_0x542ddf(0x135)]['splice'](_0x109cdd,0x1);if(_0x3f8ace['activeFrame']>=_0x3f8ace[_0x542ddf(0x135)][_0x542ddf(0x111)])_0x3f8ace[_0x542ddf(0x17d)]=_0x3f8ace[_0x542ddf(0x135)][_0x542ddf(0x111)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0x5bc598=_0x349e,_0x208145=getCurrentProject();if(!_0x208145||!_0x208145['frames']||typeof _0x208145[_0x5bc598(0x17d)]!==_0x5bc598(0x11b)||!_0x208145['frames'][_0x208145['activeFrame']])return null;return _0x208145[_0x5bc598(0x135)][_0x208145['activeFrame']];}function swapLayer(_0x1ca37c,_0x55ffd3){const _0x3860c8=_0x349e;let _0x222efd=getCurrentFrame();[_0x222efd[_0x3860c8(0x151)][_0x1ca37c],_0x222efd[_0x3860c8(0x151)][_0x55ffd3]]=[_0x222efd['layers'][_0x55ffd3],_0x222efd['layers'][_0x1ca37c]],[_0x222efd[_0x3860c8(0x187)][_0x1ca37c],_0x222efd[_0x3860c8(0x187)][_0x55ffd3]]=[_0x222efd[_0x3860c8(0x187)][_0x55ffd3],_0x222efd[_0x3860c8(0x187)][_0x1ca37c]],[_0x222efd[_0x3860c8(0x164)][_0x1ca37c],_0x222efd[_0x3860c8(0x164)][_0x55ffd3]]=[_0x222efd[_0x3860c8(0x164)][_0x55ffd3],_0x222efd['layerRedoStacks'][_0x1ca37c]];if(_0x222efd[_0x3860c8(0x124)]===_0x1ca37c)_0x222efd[_0x3860c8(0x124)]=_0x55ffd3;else{if(_0x222efd[_0x3860c8(0x124)]===_0x55ffd3)_0x222efd[_0x3860c8(0x124)]=_0x1ca37c;}updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x3860c8(0x171))requestAutoSave();}function removeLayerAt(_0x4c532e){const _0x2f03c9=_0x349e;let _0x2f2ab3=getCurrentFrame();if(_0x2f2ab3[_0x2f03c9(0x151)][_0x2f03c9(0x111)]<=0x1)return;_0x2f2ab3['layers']['splice'](_0x4c532e,0x1),_0x2f2ab3[_0x2f03c9(0x187)]['splice'](_0x4c532e,0x1),_0x2f2ab3[_0x2f03c9(0x164)]['splice'](_0x4c532e,0x1);if(_0x2f2ab3[_0x2f03c9(0x124)]>=_0x2f2ab3[_0x2f03c9(0x151)][_0x2f03c9(0x111)])_0x2f2ab3[_0x2f03c9(0x124)]=_0x2f2ab3[_0x2f03c9(0x151)]['length']-0x1;updateLayerUI(),redrawAll();if(typeof requestAutoSave==='function')requestAutoSave();}function addLayer(){const _0x53a58c=_0x349e;let _0x307533=getCurrentProject(),_0x1ac773=getCurrentFrame(),_0x283edc=document['createElement'](_0x53a58c(0x11d));_0x283edc[_0x53a58c(0x14e)]=_0x307533[_0x53a58c(0x14e)]*cellSize,_0x283edc['height']=_0x307533['height']*cellSize,_0x1ac773[_0x53a58c(0x151)][_0x53a58c(0x16d)]({'canvas':_0x283edc,'visible':!![]}),_0x1ac773[_0x53a58c(0x187)][_0x53a58c(0x16d)]([]),_0x1ac773[_0x53a58c(0x164)][_0x53a58c(0x16d)]([]),_0x1ac773[_0x53a58c(0x124)]=_0x1ac773[_0x53a58c(0x151)][_0x53a58c(0x111)]-0x1,saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0xa79d89=_0x349e;let _0x2eb236=getCurrentFrame();if(_0x2eb236[_0xa79d89(0x151)][_0xa79d89(0x111)]<=0x1)return;_0x2eb236[_0xa79d89(0x151)][_0xa79d89(0x194)](_0x2eb236[_0xa79d89(0x124)],0x1),_0x2eb236[_0xa79d89(0x187)]['splice'](_0x2eb236[_0xa79d89(0x124)],0x1),_0x2eb236['layerRedoStacks']['splice'](_0x2eb236[_0xa79d89(0x124)],0x1),_0x2eb236['activeLayer']=Math[_0xa79d89(0x11e)](0x0,_0x2eb236[_0xa79d89(0x124)]-0x1),updateLayerUI(),redrawAll();if(typeof requestAutoSave==='function')requestAutoSave();}function duplicateLayerAt(_0x4dc5c5){const _0x486763=_0x349e,_0xe4cc92=getCurrentProject(),_0x3b5642=getCurrentFrame();if(!_0xe4cc92||!_0x3b5642||typeof _0x4dc5c5!==_0x486763(0x11b)||!_0x3b5642[_0x486763(0x151)][_0x4dc5c5])return;const _0x2862cd=_0x3b5642['layers'][_0x4dc5c5],_0x2b008a=_0x2862cd&&_0x2862cd['canvas']?_0x2862cd[_0x486763(0x11d)]:_0x2862cd;if(!_0x2b008a)return;const _0x4c90e9=document[_0x486763(0x165)]('canvas');_0x4c90e9[_0x486763(0x14e)]=_0xe4cc92['width']*cellSize,_0x4c90e9[_0x486763(0x15c)]=_0xe4cc92[_0x486763(0x15c)]*cellSize;const _0x1119ec=_0x4c90e9[_0x486763(0x184)]('2d');_0x1119ec['clearRect'](0x0,0x0,_0x4c90e9['width'],_0x4c90e9[_0x486763(0x15c)]);try{_0x1119ec[_0x486763(0x18e)](_0x2b008a,0x0,0x0);}catch(_0x243c8e){console['warn'](_0x486763(0x15e),_0x243c8e);}const _0x37cf7d=_0x4dc5c5+0x1;_0x3b5642['layers'][_0x486763(0x194)](_0x37cf7d,0x0,{'canvas':_0x4c90e9,'visible':!![]});if(Array[_0x486763(0x179)](_0x3b5642[_0x486763(0x187)]))_0x3b5642['layerHistories'][_0x486763(0x194)](_0x37cf7d,0x0,[]);if(Array[_0x486763(0x179)](_0x3b5642[_0x486763(0x164)]))_0x3b5642['layerRedoStacks'][_0x486763(0x194)](_0x37cf7d,0x0,[]);_0x3b5642[_0x486763(0x124)]=_0x37cf7d,saveHistory(),updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x486763(0x171))requestAutoSave();}function selectLayer(_0x167e9a){const _0x4d3010=_0x349e;getCurrentFrame()[_0x4d3010(0x124)]=parseInt(_0x167e9a),updateLayerUI();}function copyLayer(){const _0x84a673=_0x349e,_0x126bdf=getCurrentFrame();if(!_0x126bdf)return;const _0x10d17e=_0x126bdf[_0x84a673(0x124)];if(typeof _0x10d17e!==_0x84a673(0x11b)||!_0x126bdf[_0x84a673(0x151)][_0x10d17e])return;const _0x5d4986=_0x126bdf['layers'][_0x10d17e],_0x3ab23a=_0x5d4986&&_0x5d4986[_0x84a673(0x11d)]?_0x5d4986[_0x84a673(0x11d)]:_0x5d4986;if(!_0x3ab23a||typeof _0x3ab23a[_0x84a673(0x156)]!==_0x84a673(0x171))return;copiedLayerDataUrl=_0x3ab23a[_0x84a673(0x156)]();const _0x21c014=document[_0x84a673(0x192)](_0x84a673(0x15d));if(_0x21c014)_0x21c014[_0x84a673(0x140)]=![];}function pasteLayer(){const _0x15a761=_0x349e;if(!copiedLayerDataUrl)return;const _0x4bebfa=getCurrentProject(),_0x3af90e=getCurrentFrame();if(!_0x4bebfa||!_0x3af90e)return;const _0x145fa7=document['createElement'](_0x15a761(0x11d));_0x145fa7[_0x15a761(0x14e)]=_0x4bebfa['width']*cellSize,_0x145fa7[_0x15a761(0x15c)]=_0x4bebfa[_0x15a761(0x15c)]*cellSize;const _0x1e9e1c=_0x145fa7['getContext']('2d'),_0x368afd=new Image();_0x368afd[_0x15a761(0x116)]=()=>{const _0x5582bb=_0x15a761;_0x1e9e1c[_0x5582bb(0x11a)](0x0,0x0,_0x145fa7[_0x5582bb(0x14e)],_0x145fa7[_0x5582bb(0x15c)]),_0x1e9e1c[_0x5582bb(0x18e)](_0x368afd,0x0,0x0),_0x3af90e[_0x5582bb(0x151)][_0x5582bb(0x16d)]({'canvas':_0x145fa7,'visible':!![]}),_0x3af90e[_0x5582bb(0x187)][_0x5582bb(0x16d)]([]),_0x3af90e['layerRedoStacks'][_0x5582bb(0x16d)]([]),_0x3af90e[_0x5582bb(0x124)]=_0x3af90e[_0x5582bb(0x151)]['length']-0x1,saveHistory(),updateLayerUI(),redrawAll();},_0x368afd[_0x15a761(0x185)]=copiedLayerDataUrl;}async function exportLayersAsGif(){const _0x28616e=_0x349e,_0x19989d=document['getElementById'](_0x28616e(0x15b));if(_0x19989d)_0x19989d['textContent']=_0x28616e(0x181);const _0x50ca44=getCurrentProject();if(!_0x50ca44){if(_0x19989d)_0x19989d[_0x28616e(0x117)]='';return;}const _0x8b9df=_0x50ca44[_0x28616e(0x135)],_0x503b7a=_0x50ca44[_0x28616e(0x14e)]*cellSize,_0x473826=_0x50ca44[_0x28616e(0x15c)]*cellSize;let _0x452794=0x0;_0x8b9df[_0x28616e(0x157)](_0x33e647=>{const _0x47b7fe=_0x28616e;_0x452794=Math[_0x47b7fe(0x11e)](_0x452794,_0x33e647[_0x47b7fe(0x151)]['length']);});for(let _0x5f0504=0x0;_0x5f0504<_0x452794;_0x5f0504++){const _0x188f00=await Promise[_0x28616e(0x16c)](_0x8b9df[_0x28616e(0x158)](_0xd29e7d=>{return new Promise(_0x124b8d=>{const _0x340eda=_0x349e,_0xed9a0b=document[_0x340eda(0x165)](_0x340eda(0x11d));_0xed9a0b[_0x340eda(0x14e)]=_0x503b7a,_0xed9a0b[_0x340eda(0x15c)]=_0x473826;const _0x185e80=_0xed9a0b[_0x340eda(0x184)]('2d'),_0x305521=_0xd29e7d[_0x340eda(0x151)][_0x5f0504]&&_0xd29e7d[_0x340eda(0x151)][_0x5f0504][_0x340eda(0x11d)]?_0xd29e7d[_0x340eda(0x151)][_0x5f0504][_0x340eda(0x11d)]:_0xd29e7d['layers'][_0x5f0504];if(_0x305521)_0x185e80['drawImage'](_0x305521,0x0,0x0);const _0x853ce8=new Image();_0x853ce8[_0x340eda(0x116)]=()=>_0x124b8d(_0x853ce8),_0x853ce8[_0x340eda(0x185)]=_0xed9a0b[_0x340eda(0x156)]('image/png');});})),_0x393bdc=_0x188f00['some'](_0x4a7754=>{const _0x1f7902=_0x28616e,_0x452fbc=document[_0x1f7902(0x165)](_0x1f7902(0x11d));_0x452fbc['width']=_0x503b7a,_0x452fbc[_0x1f7902(0x15c)]=_0x473826;const _0x4cd13b=_0x452fbc['getContext']('2d');_0x4cd13b[_0x1f7902(0x18e)](_0x4a7754,0x0,0x0);const _0x14abe0=_0x4cd13b[_0x1f7902(0x183)](0x0,0x0,_0x503b7a,_0x473826)[_0x1f7902(0x188)];for(let _0x436532=0x3;_0x436532<_0x14abe0[_0x1f7902(0x111)];_0x436532+=0x4)if(_0x14abe0[_0x436532]!==0x0)return!![];return![];});if(!_0x393bdc)continue;const _0x1a5caa=(_0x50ca44[_0x28616e(0x166)]||_0x28616e(0x12f))[_0x28616e(0x138)](/[\\/:*?"<>|]/g,'_')+(_0x28616e(0x16f)+(_0x5f0504+0x1)+_0x28616e(0x147));convertToGIF(_0x188f00,animationDelay,_0x1a5caa),await new Promise(_0x3a6e84=>setTimeout(_0x3a6e84,0x78));}if(_0x19989d)_0x19989d[_0x28616e(0x117)]='';}function _0x349e(_0x3ba754,_0x5c8c6b){_0x3ba754=_0x3ba754-0x111;const _0x31f790=_0x4f80();let _0x1d624b=_0x31f790[_0x3ba754];return _0x1d624b;}async function exportLayersAsApng(){const _0x4e07ef=_0x349e,_0x2bbea5=document[_0x4e07ef(0x192)](_0x4e07ef(0x15b));if(_0x2bbea5)_0x2bbea5[_0x4e07ef(0x117)]=_0x4e07ef(0x181);const _0x18ab15=getCurrentProject();if(!_0x18ab15){if(_0x2bbea5)_0x2bbea5[_0x4e07ef(0x117)]='';return;}const _0x2f0d72=_0x18ab15[_0x4e07ef(0x135)],_0xfae225=_0x18ab15['width']*cellSize,_0x4c23d5=_0x18ab15[_0x4e07ef(0x15c)]*cellSize;let _0x483282=0x0;_0x2f0d72[_0x4e07ef(0x157)](_0x9ad932=>{const _0x4fba0c=_0x4e07ef;_0x483282=Math[_0x4fba0c(0x11e)](_0x483282,_0x9ad932[_0x4fba0c(0x151)][_0x4fba0c(0x111)]);});for(let _0x10a5dc=0x0;_0x10a5dc<_0x483282;_0x10a5dc++){const _0x3ed21a=await Promise[_0x4e07ef(0x16c)](_0x2f0d72[_0x4e07ef(0x158)](_0x5c0d12=>{return new Promise(_0x4ce084=>{const _0x3c11e1=_0x349e,_0xbd5ca4=document[_0x3c11e1(0x165)]('canvas');_0xbd5ca4[_0x3c11e1(0x14e)]=_0xfae225,_0xbd5ca4[_0x3c11e1(0x15c)]=_0x4c23d5;const _0x52cc5b=_0xbd5ca4[_0x3c11e1(0x184)]('2d'),_0x1f0778=_0x5c0d12['layers'][_0x10a5dc]&&_0x5c0d12[_0x3c11e1(0x151)][_0x10a5dc][_0x3c11e1(0x11d)]?_0x5c0d12['layers'][_0x10a5dc]['canvas']:_0x5c0d12[_0x3c11e1(0x151)][_0x10a5dc];if(_0x1f0778)_0x52cc5b[_0x3c11e1(0x18e)](_0x1f0778,0x0,0x0);const _0x1d4f15=new Image();_0x1d4f15['onload']=()=>_0x4ce084(_0x1d4f15),_0x1d4f15[_0x3c11e1(0x185)]=_0xbd5ca4[_0x3c11e1(0x156)](_0x3c11e1(0x127));});})),_0x4f72ad=_0x3ed21a[_0x4e07ef(0x150)](_0x2f2014=>{const _0x3aa4c8=_0x4e07ef,_0x41bdaf=document[_0x3aa4c8(0x165)]('canvas');_0x41bdaf[_0x3aa4c8(0x14e)]=_0xfae225,_0x41bdaf[_0x3aa4c8(0x15c)]=_0x4c23d5;const _0x5d86be=_0x41bdaf[_0x3aa4c8(0x184)]('2d');_0x5d86be[_0x3aa4c8(0x18e)](_0x2f2014,0x0,0x0);const _0x4f711c=_0x5d86be[_0x3aa4c8(0x183)](0x0,0x0,_0xfae225,_0x4c23d5)['data'];for(let _0x161481=0x3;_0x161481<_0x4f711c[_0x3aa4c8(0x111)];_0x161481+=0x4)if(_0x4f711c[_0x161481]!==0x0)return!![];return![];});if(!_0x4f72ad)continue;const _0x5c345a=(_0x18ab15[_0x4e07ef(0x166)]||'nezumi-animation')[_0x4e07ef(0x138)](/[\\/:*?"<>|]/g,'_')+(_0x4e07ef(0x16f)+(_0x10a5dc+0x1)+_0x4e07ef(0x195));convertToAPNG(_0x3ed21a,_0xfae225,_0x4c23d5,animationDelay,_0x5c345a),await new Promise(_0xa98558=>setTimeout(_0xa98558,0x78));}if(_0x2bbea5)_0x2bbea5[_0x4e07ef(0x117)]='';}async function exportFramesLayersZip(){const _0x48cfb0=_0x349e,_0x5b6d6b=document['getElementById'](_0x48cfb0(0x15b));if(_0x5b6d6b)_0x5b6d6b['textContent']='ZIP作成中...';const _0x19ff22=getCurrentProject();if(!_0x19ff22){if(_0x5b6d6b)_0x5b6d6b[_0x48cfb0(0x117)]='';return;}const _0x28b659=_0x19ff22['frames'],_0x5535c0=_0x19ff22[_0x48cfb0(0x14e)]*cellSize,_0x5e95ce=_0x19ff22[_0x48cfb0(0x15c)]*cellSize,_0x5963ea=new JSZip();for(let _0xbf4989=0x0;_0xbf4989<_0x28b659['length'];_0xbf4989++){const _0x565709=_0x28b659[_0xbf4989],_0x349fc1=_0x5963ea[_0x48cfb0(0x144)]('frame-'+(_0xbf4989+0x1));for(let _0x3efc43=0x0;_0x3efc43<_0x565709['layers'][_0x48cfb0(0x111)];_0x3efc43++){const _0x19d10a=document[_0x48cfb0(0x165)](_0x48cfb0(0x11d));_0x19d10a['width']=_0x5535c0,_0x19d10a[_0x48cfb0(0x15c)]=_0x5e95ce;const _0x5e4afd=_0x19d10a[_0x48cfb0(0x184)]('2d');_0x5e4afd[_0x48cfb0(0x11a)](0x0,0x0,_0x5535c0,_0x5e95ce);const _0x2b7c2d=_0x565709[_0x48cfb0(0x151)][_0x3efc43];if(_0x2b7c2d){const _0x16636c=_0x2b7c2d['canvas']?_0x2b7c2d['canvas']:_0x2b7c2d;if(_0x16636c)_0x5e4afd[_0x48cfb0(0x18e)](_0x16636c,0x0,0x0);}const _0x526075=_0x19d10a['toDataURL'](_0x48cfb0(0x127)),_0x3aa9aa=_0x526075[_0x48cfb0(0x119)](',')[0x1],_0x22e909=atob(_0x3aa9aa),_0x4f5525=new Uint8Array(_0x22e909[_0x48cfb0(0x111)]);for(let _0x5bdaee=0x0;_0x5bdaee<_0x22e909[_0x48cfb0(0x111)];_0x5bdaee++)_0x4f5525[_0x5bdaee]=_0x22e909[_0x48cfb0(0x190)](_0x5bdaee);_0x349fc1[_0x48cfb0(0x130)](_0x48cfb0(0x15a)+(_0x3efc43+0x1)+_0x48cfb0(0x137),_0x4f5525);}}const _0x5542b1=await _0x5963ea[_0x48cfb0(0x15f)]({'type':_0x48cfb0(0x143)}),_0x45733b=(_0x19ff22['name']||_0x48cfb0(0x168))[_0x48cfb0(0x138)](/[\\/:*?"<>|]/g,'_'),_0x46bbee=document[_0x48cfb0(0x165)]('a');_0x46bbee[_0x48cfb0(0x170)]=URL['createObjectURL'](_0x5542b1),_0x46bbee[_0x48cfb0(0x18a)]=_0x45733b+'-frames-layers.zip',document[_0x48cfb0(0x113)][_0x48cfb0(0x12b)](_0x46bbee),_0x46bbee[_0x48cfb0(0x12e)](),setTimeout(()=>{const _0x1b8a49=_0x48cfb0;URL[_0x1b8a49(0x12a)](_0x46bbee[_0x1b8a49(0x170)]),document['body'][_0x1b8a49(0x145)](_0x46bbee);if(_0x5b6d6b)_0x5b6d6b[_0x1b8a49(0x117)]='';},0x4b0);}function saveProjectFile(){const _0x154344=_0x349e,_0x14fed2=typeof getSavePayload==='function'?getSavePayload():{'projects':projects['map'](_0x543a73=>({'width':_0x543a73['width'],'height':_0x543a73['height'],'name':_0x543a73[_0x154344(0x166)]||'','activeFrame':_0x543a73['activeFrame'],'frames':_0x543a73['frames'][_0x154344(0x158)](_0x37a3db=>({'activeLayer':_0x37a3db[_0x154344(0x124)],'layers':_0x37a3db[_0x154344(0x151)][_0x154344(0x158)](_0x3459b8=>_0x3459b8&&_0x3459b8['canvas']?_0x3459b8[_0x154344(0x11d)][_0x154344(0x156)]():_0x3459b8&&_0x3459b8[_0x154344(0x156)]?_0x3459b8[_0x154344(0x156)]():null)}))})),'activeProject':activeProject},_0x5306f9=new Blob([JSON[_0x154344(0x14a)](_0x14fed2)],{'type':_0x154344(0x122)}),_0x1dd8b2=document[_0x154344(0x165)]('a');_0x1dd8b2[_0x154344(0x18a)]='nezumi-sketch.msketch',_0x1dd8b2[_0x154344(0x170)]=URL['createObjectURL'](_0x5306f9),_0x1dd8b2[_0x154344(0x12e)]();}function getSavePayload(){const _0x2f719c=_0x349e;return{'projects':projects[_0x2f719c(0x158)](_0x1221ea=>({'width':_0x1221ea['width'],'height':_0x1221ea[_0x2f719c(0x15c)],'name':_0x1221ea[_0x2f719c(0x166)]||'','activeFrame':_0x1221ea[_0x2f719c(0x17d)],'frames':_0x1221ea[_0x2f719c(0x135)][_0x2f719c(0x158)](_0x4c104c=>({'activeLayer':_0x4c104c['activeLayer'],'layers':_0x4c104c[_0x2f719c(0x151)]['map'](_0x368ba5=>_0x368ba5&&_0x368ba5[_0x2f719c(0x11d)]?_0x368ba5[_0x2f719c(0x11d)][_0x2f719c(0x156)]():_0x368ba5&&_0x368ba5[_0x2f719c(0x156)]?_0x368ba5[_0x2f719c(0x156)]():null)}))})),'activeProject':activeProject};}async function saveProjectToIDB(){const _0x1419d=_0x349e,_0x355282=getSavePayload();try{await idbSet(_0x1419d(0x13b),_0x355282),console[_0x1419d(0x173)]('プロジェクトをIndexedDBに保存したチュー！');}catch(_0xdbc275){console[_0x1419d(0x196)](_0x1419d(0x14d),_0xdbc275);}}function flushQuickSaveToLocalStorage(){const _0x5cc222=_0x349e;try{const _0x1ac8c1=getSavePayload();localStorage[_0x5cc222(0x136)](_0x5cc222(0x115),JSON[_0x5cc222(0x14a)](_0x1ac8c1)),console[_0x5cc222(0x169)]('flushQuickSaveToLocalStorage:\x20saved\x20quick\x20snapshot');}catch(_0x4c304d){console[_0x5cc222(0x196)]('flushQuickSaveToLocalStorage\x20failed',_0x4c304d);}}window['addEventListener'](_0x3a47bd(0x18c),()=>{if(document['hidden']&&autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB==='function')saveProjectToIDB();}}),window[_0x3a47bd(0x148)](_0x3a47bd(0x159),()=>{const _0x34bb35=_0x3a47bd;if(autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x34bb35(0x171))saveProjectToIDB();}});let autosaveDirty=![],autosaveTimer=null;const AUTOSAVE_DELAY=0x1388,AUTOSAVE_INTERVAL=0xea60;function requestAutoSave(){const _0x586345=_0x3a47bd;autosaveDirty=!![];if(autosaveTimer)clearTimeout(autosaveTimer);console[_0x586345(0x169)](_0x586345(0x146)+AUTOSAVE_DELAY+'ms'),autosaveTimer=setTimeout(async()=>{const _0x593382=_0x586345;console[_0x593382(0x169)](_0x593382(0x18f));if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console['log'](_0x593382(0x180));}catch(_0x515241){console[_0x593382(0x196)]('auto-save\x20failed',_0x515241);}},AUTOSAVE_DELAY);}function startAutoSaveInterval(){const _0x100b48=_0x3a47bd;console[_0x100b48(0x169)](_0x100b48(0x132)+AUTOSAVE_INTERVAL+'ms'),setInterval(async()=>{const _0x2714fb=_0x100b48;if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x2714fb(0x173)](_0x2714fb(0x13c));}catch(_0x10cc03){console['error'](_0x2714fb(0x125),_0x10cc03);}},AUTOSAVE_INTERVAL);}window['requestAutoSave']=requestAutoSave,window[_0x3a47bd(0x152)]=startAutoSaveInterval;function loadProjectFile(_0x4ee9d5){const _0x3a5464=_0x3a47bd,_0x3e2392=_0x4ee9d5[_0x3a5464(0x17b)][_0x3a5464(0x17e)][0x0];if(!_0x3e2392)return;if(_0x3e2392[_0x3a5464(0x162)]&&_0x3e2392['type'][_0x3a5464(0x153)]('image')){loadStandaloneFromFile(_0x3e2392)[_0x3a5464(0x161)](_0x2b06dd=>{const _0x4c5402=_0x3a5464;alert(_0x4c5402(0x177)+(_0x2b06dd[_0x4c5402(0x166)]||'画像'));})[_0x3a5464(0x134)](_0x2c1a52=>{const _0x165297=_0x3a5464;console[_0x165297(0x13a)](_0x2c1a52),alert('ファイルにプロジェクトメタデータが見つかりませんでした。読み込みできません。');});return;}const _0x3889cc=new FileReader();try{showLoading(_0x3a5464(0x149));}catch(_0x41bfa7){}_0x3889cc[_0x3a5464(0x116)]=function(_0x777bb2){const _0x4d27f4=_0x3a5464;try{const _0x4a9f9a=JSON[_0x4d27f4(0x13f)](_0x777bb2['target'][_0x4d27f4(0x120)]);projects=_0x4a9f9a['projects'][_0x4d27f4(0x158)]((_0x2b53b8,_0x14b89c)=>{const _0x5eda5d=_0x4d27f4;let _0x5f95e0=createProject(_0x2b53b8['width'],_0x2b53b8[_0x5eda5d(0x15c)],_0x2b53b8[_0x5eda5d(0x166)]||'画像'+(_0x14b89c+0x1));return _0x5f95e0[_0x5eda5d(0x135)]=_0x2b53b8[_0x5eda5d(0x135)]['map'](_0x3f6e55=>{const _0x29be23=_0x5eda5d;let _0x4a693c={'layers':[],'activeLayer':_0x3f6e55[_0x29be23(0x124)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x469473=0x0;_0x469473<_0x3f6e55[_0x29be23(0x151)][_0x29be23(0x111)];_0x469473++){let _0x18aa5a=new Image();_0x18aa5a[_0x29be23(0x185)]=_0x3f6e55[_0x29be23(0x151)][_0x469473];let _0x2305e8=document[_0x29be23(0x165)](_0x29be23(0x11d));_0x2305e8[_0x29be23(0x14e)]=_0x2b53b8[_0x29be23(0x14e)]*cellSize,_0x2305e8['height']=_0x2b53b8['height']*cellSize,_0x18aa5a[_0x29be23(0x116)]=()=>{const _0x4ab7f8=_0x29be23;let _0x2efaa7=_0x2305e8[_0x4ab7f8(0x184)]('2d');_0x2efaa7[_0x4ab7f8(0x11a)](0x0,0x0,_0x2305e8[_0x4ab7f8(0x14e)],_0x2305e8[_0x4ab7f8(0x15c)]),_0x2efaa7[_0x4ab7f8(0x18e)](_0x18aa5a,0x0,0x0);try{redrawAll();}catch(_0x37ad31){}},_0x4a693c['layers'][_0x29be23(0x16d)](_0x2305e8),_0x4a693c[_0x29be23(0x187)][_0x29be23(0x16d)]([]),_0x4a693c['layerRedoStacks'][_0x29be23(0x16d)]([]);}return _0x4a693c;}),_0x5f95e0[_0x5eda5d(0x17d)]=_0x2b53b8[_0x5eda5d(0x17d)],_0x5f95e0[_0x5eda5d(0x166)]=_0x2b53b8[_0x5eda5d(0x166)]||'画像'+(_0x14b89c+0x1),_0x5f95e0;}),activeProject=_0x4a9f9a[_0x4d27f4(0x129)]||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}catch(_0x11f37a){alert('ファイルの読み込みに失敗しました。');}finally{try{hideLoading();}catch(_0x406ca9){}}},_0x3889cc['onerror']=function(){try{hideLoading();}catch(_0x595a68){}},_0x3889cc['readAsText'](_0x3e2392);}async function loadProjectFromIDB(){const _0x4fbbdf=_0x3a47bd;try{let _0x2c452a=await idbGet(_0x4fbbdf(0x13b));if(!_0x2c452a){console['info']('loadProjectFromIDB:\x20DB\x20に保存が見つかりませんでした。localStorage\x20のクイック保存を確認します。');try{const _0x4c9616=localStorage[_0x4fbbdf(0x13e)]('nezumi-sketch-save-quick');if(_0x4c9616){const _0x43b3d7=JSON[_0x4fbbdf(0x13f)](_0x4c9616);_0x43b3d7&&_0x43b3d7[_0x4fbbdf(0x14b)]&&(console[_0x4fbbdf(0x160)](_0x4fbbdf(0x175)),_0x2c452a=_0x43b3d7);}}catch(_0x5cad1e){console[_0x4fbbdf(0x13a)](_0x4fbbdf(0x178),_0x5cad1e);}if(!_0x2c452a){if(typeof requestAutoSave===_0x4fbbdf(0x171))requestAutoSave();return;}}console[_0x4fbbdf(0x173)](_0x4fbbdf(0x14c),{'projects':Array[_0x4fbbdf(0x179)](_0x2c452a[_0x4fbbdf(0x14b)])?_0x2c452a[_0x4fbbdf(0x14b)][_0x4fbbdf(0x111)]:0x0,'activeProject':_0x2c452a['activeProject']}),projects=_0x2c452a[_0x4fbbdf(0x14b)][_0x4fbbdf(0x158)]((_0xc54192,_0x423137)=>{const _0x8f083d=_0x4fbbdf;let _0x5ac01d=createProject(_0xc54192[_0x8f083d(0x14e)],_0xc54192[_0x8f083d(0x15c)],_0xc54192['name']||'画像'+(_0x423137+0x1));return _0x5ac01d[_0x8f083d(0x135)]=_0xc54192[_0x8f083d(0x135)][_0x8f083d(0x158)](_0x41f625=>{const _0x495eb6=_0x8f083d;let _0x31de7a={'layers':[],'activeLayer':_0x41f625['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x1875f4=0x0;_0x1875f4<_0x41f625[_0x495eb6(0x151)][_0x495eb6(0x111)];_0x1875f4++){let _0x43b260=new Image();_0x43b260[_0x495eb6(0x185)]=_0x41f625['layers'][_0x1875f4];let _0x3e4ffa=document['createElement']('canvas');_0x3e4ffa[_0x495eb6(0x14e)]=_0xc54192[_0x495eb6(0x14e)]*cellSize,_0x3e4ffa[_0x495eb6(0x15c)]=_0xc54192[_0x495eb6(0x15c)]*cellSize,_0x43b260[_0x495eb6(0x116)]=()=>{const _0x1362f5=_0x495eb6;let _0x3738fa=_0x3e4ffa[_0x1362f5(0x184)]('2d');_0x3738fa[_0x1362f5(0x11a)](0x0,0x0,_0x3e4ffa[_0x1362f5(0x14e)],_0x3e4ffa[_0x1362f5(0x15c)]),_0x3738fa[_0x1362f5(0x18e)](_0x43b260,0x0,0x0);try{redrawAll();}catch(_0x2c39e){}},_0x31de7a[_0x495eb6(0x151)][_0x495eb6(0x16d)]({'canvas':_0x3e4ffa,'visible':!![]}),_0x31de7a[_0x495eb6(0x187)][_0x495eb6(0x16d)]([]),_0x31de7a['layerRedoStacks'][_0x495eb6(0x16d)]([]);}return _0x31de7a;}),_0x5ac01d[_0x8f083d(0x17d)]=_0xc54192[_0x8f083d(0x17d)],_0x5ac01d['name']=_0xc54192['name']||'画像'+(_0x423137+0x1),_0x5ac01d;}),activeProject=_0x2c452a['activeProject']||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{if(typeof updateUndoRedoButtons===_0x4fbbdf(0x171))updateUndoRedoButtons();}catch(_0x809957){}setTool(_0x4fbbdf(0x128)),console[_0x4fbbdf(0x173)](_0x4fbbdf(0x17a));}catch(_0x4c828f){alert('IndexedDBからの読み込みに失敗したチュー…'),console[_0x4fbbdf(0x196)](_0x4c828f);}}function shiftLayerCanvas(_0x5b15f6,_0x583f85,_0x3b7715){const _0x4a382e=_0x3a47bd;if(!_0x5b15f6)return;const _0x2eda5b=_0x5b15f6['width'],_0x2852d9=_0x5b15f6[_0x4a382e(0x15c)],_0x163c70=document[_0x4a382e(0x165)]('canvas');_0x163c70[_0x4a382e(0x14e)]=_0x2eda5b,_0x163c70[_0x4a382e(0x15c)]=_0x2852d9;const _0x5aad9d=_0x163c70['getContext']('2d');_0x5aad9d[_0x4a382e(0x11a)](0x0,0x0,_0x2eda5b,_0x2852d9),_0x5aad9d[_0x4a382e(0x18e)](_0x5b15f6,0x0,0x0);const _0x40bbcf=_0x5b15f6['getContext']('2d');_0x40bbcf[_0x4a382e(0x11a)](0x0,0x0,_0x2eda5b,_0x2852d9),_0x40bbcf['drawImage'](_0x163c70,_0x583f85,_0x3b7715);}function nudgeActiveLayer(_0x4df919,_0x376f60){const _0x3fc385=_0x3a47bd,_0x365409=getCurrentProject();if(!_0x365409)return;const _0x3f7e4e=getCurrentFrame();if(!_0x3f7e4e)return;const _0x3a6f28=_0x3f7e4e[_0x3fc385(0x124)];if(_0x3a6f28==null)return;const _0x159039=(_0x4df919||0x0)*cellSize,_0x4a6520=(_0x376f60||0x0)*cellSize;if(_0x159039===0x0&&_0x4a6520===0x0)return;saveHistory();const _0x373525=_0x3f7e4e[_0x3fc385(0x151)][_0x3a6f28],_0x54610e=_0x373525&&_0x373525['canvas']?_0x373525['canvas']:_0x373525;_0x54610e?(shiftLayerCanvas(_0x54610e,_0x159039,_0x4a6520),redrawAll()):console[_0x3fc385(0x13a)](_0x3fc385(0x126),_0x373525);}function startLayerMove(_0x3abc0a){const _0x351af3=_0x3a47bd;layerMoveState[_0x351af3(0x13d)]=!![];const _0x577634=getCanvasCoords(_0x3abc0a);layerMoveState['startCell']={'x':Math['floor'](_0x577634['x']/cellSize),'y':Math[_0x351af3(0x176)](_0x577634['y']/cellSize)},layerMoveState[_0x351af3(0x182)]={'x':0x0,'y':0x0};}function endLayerMove(_0x33fb1d){const _0x53d90f=_0x3a47bd;if(!layerMoveState[_0x53d90f(0x13d)])return;const _0x21bb97=layerMoveState['offsetCells']['x']*cellSize,_0x193cb3=layerMoveState['offsetCells']['y']*cellSize;if(_0x21bb97!==0x0||_0x193cb3!==0x0){saveHistory();const _0x1d53e3=getCurrentFrame();if(_0x1d53e3&&typeof _0x1d53e3[_0x53d90f(0x124)]===_0x53d90f(0x11b)){const _0x445c11=_0x1d53e3['layers'][_0x1d53e3[_0x53d90f(0x124)]],_0x18537b=_0x445c11&&_0x445c11[_0x53d90f(0x11d)]?_0x445c11[_0x53d90f(0x11d)]:_0x445c11;if(_0x18537b)shiftLayerCanvas(_0x18537b,_0x21bb97,_0x193cb3);}}layerMoveState[_0x53d90f(0x13d)]=![],layerMoveState[_0x53d90f(0x16e)]=null,layerMoveState[_0x53d90f(0x182)]={'x':0x0,'y':0x0},redrawAll();}