(function(_0x5c7fc6,_0xf67039){const _0x4deb77=_0x3d35,_0x24851d=_0x5c7fc6();while(!![]){try{const _0x431968=-parseInt(_0x4deb77(0xf0))/0x1+-parseInt(_0x4deb77(0x113))/0x2*(parseInt(_0x4deb77(0x10a))/0x3)+-parseInt(_0x4deb77(0x106))/0x4*(-parseInt(_0x4deb77(0x10c))/0x5)+-parseInt(_0x4deb77(0xf4))/0x6*(parseInt(_0x4deb77(0x116))/0x7)+parseInt(_0x4deb77(0x110))/0x8*(-parseInt(_0x4deb77(0x125))/0x9)+parseInt(_0x4deb77(0x100))/0xa+parseInt(_0x4deb77(0x102))/0xb;if(_0x431968===_0xf67039)break;else _0x24851d['push'](_0x24851d['shift']());}catch(_0x23d5ac){_0x24851d['push'](_0x24851d['shift']());}}}(_0xe3c5,0x3a044));const _0x1860b0=(function(){let _0x1dd61c=!![];return function(_0x37250d,_0x1f0be8){const _0x3f86c2=_0x1dd61c?function(){const _0x106b34=_0x3d35;if(_0x1f0be8){const _0x7f3751=_0x1f0be8[_0x106b34(0x121)](_0x37250d,arguments);return _0x1f0be8=null,_0x7f3751;}}:function(){};return _0x1dd61c=![],_0x3f86c2;};}()),_0x4151fd=_0x1860b0(this,function(){const _0x48a89c=_0x3d35;return _0x4151fd[_0x48a89c(0x11f)]()['search']('(((.+)+)+)+$')[_0x48a89c(0x11f)]()[_0x48a89c(0xff)](_0x4151fd)[_0x48a89c(0x10d)](_0x48a89c(0x109));});_0x4151fd();function saveHistory(){const _0x2c0353=_0x3d35;let _0x5783f3=getCurrentFrame();if(!_0x5783f3)return;if(!Array[_0x2c0353(0x115)](_0x5783f3[_0x2c0353(0x112)]))_0x5783f3['layerHistories']=[];if(!Array[_0x2c0353(0x115)](_0x5783f3[_0x2c0353(0x101)]))_0x5783f3[_0x2c0353(0x101)]=[];const _0xd352bc=typeof _0x5783f3['activeLayer']===_0x2c0353(0x11a)?_0x5783f3[_0x2c0353(0x124)]:-0x1;if(_0xd352bc<0x0)return;if(!_0x5783f3[_0x2c0353(0x112)][_0xd352bc])_0x5783f3[_0x2c0353(0x112)][_0xd352bc]=[];if(!_0x5783f3['layerRedoStacks'][_0xd352bc])_0x5783f3[_0x2c0353(0x101)][_0xd352bc]=[];const _0x2b7b33=_0x5783f3[_0x2c0353(0x104)]&&_0x5783f3[_0x2c0353(0x104)][_0xd352bc]?_0x5783f3[_0x2c0353(0x104)][_0xd352bc]:null,_0xc3a19a=_0x2b7b33&&_0x2b7b33[_0x2c0353(0x10b)]?_0x2b7b33[_0x2c0353(0x10b)]:_0x2b7b33;if(!_0xc3a19a||typeof _0xc3a19a['toDataURL']!==_0x2c0353(0x12a))return;try{_0x5783f3['layerHistories'][_0xd352bc][_0x2c0353(0xfa)](_0xc3a19a[_0x2c0353(0xf7)]());if(_0x5783f3[_0x2c0353(0x112)][_0xd352bc][_0x2c0353(0x111)]>0x32)_0x5783f3[_0x2c0353(0x112)][_0xd352bc][_0x2c0353(0x108)]();_0x5783f3[_0x2c0353(0x101)][_0xd352bc]=[];try{if(typeof updateUndoRedoButtons===_0x2c0353(0x12a))updateUndoRedoButtons();}catch(_0x8892fa){}if(typeof window[_0x2c0353(0x122)]===_0x2c0353(0x12a))window[_0x2c0353(0x122)]();}catch(_0x4f6c7f){console[_0x2c0353(0x118)]('saveHistory\x20error',_0x4f6c7f);}}async function idbSet(_0x3271f7,_0x19cfaf){const _0x3e75b0=await openDB();return new Promise((_0x4a7222,_0xe3917d)=>{const _0x5bfb80=_0x3d35,_0x332802=_0x3e75b0['transaction'](storeName,_0x5bfb80(0x103));_0x332802['objectStore'](storeName)[_0x5bfb80(0xfe)](_0x19cfaf,_0x3271f7),_0x332802[_0x5bfb80(0x105)]=()=>_0x4a7222(),_0x332802[_0x5bfb80(0x128)]=()=>_0xe3917d(_0x332802[_0x5bfb80(0x118)]);});}async function idbGet(_0x5abdc4){const _0x508e7b=await openDB();return new Promise((_0x23fcb1,_0x3630e4)=>{const _0x3cc951=_0x3d35,_0x3f3727=_0x508e7b[_0x3cc951(0x123)](storeName,_0x3cc951(0x129)),_0x4afb33=_0x3f3727[_0x3cc951(0x127)](storeName)['get'](_0x5abdc4);_0x4afb33[_0x3cc951(0xf6)]=()=>_0x23fcb1(_0x4afb33[_0x3cc951(0xf1)]),_0x4afb33['onerror']=()=>_0x3630e4(_0x4afb33['error']);});}async function idbDelete(_0x38da68){const _0x2be520=await openDB();return new Promise((_0x451b70,_0x1ce6a5)=>{const _0x571124=_0x3d35,_0x541eb2=_0x2be520[_0x571124(0x123)](storeName,_0x571124(0x103));_0x541eb2['objectStore'](storeName)[_0x571124(0xf5)](_0x38da68),_0x541eb2[_0x571124(0x105)]=()=>_0x451b70(),_0x541eb2['onerror']=()=>_0x1ce6a5(_0x541eb2['error']);});}async function idbClear(){const _0xd5a8a9=await openDB();return new Promise((_0x5badff,_0x232f5e)=>{const _0x6e02ef=_0x3d35,_0xf54c32=_0xd5a8a9[_0x6e02ef(0x123)](storeName,_0x6e02ef(0x103));_0xf54c32[_0x6e02ef(0x127)](storeName)['clear'](),_0xf54c32[_0x6e02ef(0x105)]=()=>_0x5badff(),_0xf54c32[_0x6e02ef(0x128)]=()=>_0x232f5e(_0xf54c32[_0x6e02ef(0x118)]);});}async function savePaletteToDB(){const _0x28e8d9=_0x3d35;try{await idbSet(_0x28e8d9(0x11b),PALETTE_COLORS);}catch(_0x3ddb2e){console[_0x28e8d9(0x118)]('保存エラー',_0x3ddb2e);}}function _0xe3c5(){const _0x475fa1=['nezumi-palette','slice','width','target','toString','メタデータが見つかりませんでした','apply','requestAutoSave','transaction','activeLayer','36iJtzfO','map','objectStore','onerror','readonly','function','27822xRUAcs','result','anonymous','clearRect','1518oyLpTF','delete','onsuccess','toDataURL','createElement','src','push','getContext','project','includes','put','constructor','4066610BsITWd','layerRedoStacks','3698167EBmdDU','readwrite','layers','oncomplete','692tkmivU','forEach','shift','(((.+)+)+)+$','2217eeiqHf','canvas','5230qNaISd','search','読込エラー','height','66208OFMEyF','length','layerHistories','674feepGb','frames','isArray','10409RlXWxC','onload','error','画像ファイルを読み込み中...','number'];_0xe3c5=function(){return _0x475fa1;};return _0xe3c5();}function _0x3d35(_0x5a56c0,_0x490538){_0x5a56c0=_0x5a56c0-0xf0;const _0x2c3c5d=_0xe3c5();let _0x4151fd=_0x2c3c5d[_0x5a56c0];return _0x4151fd;}async function loadPaletteFromDB(){const _0x3db478=_0x3d35;try{const _0x9d8480=await idbGet('nezumi-palette');if(Array[_0x3db478(0x115)](_0x9d8480)&&_0x9d8480[_0x3db478(0x111)]){const _0x964109=[];_0x9d8480[_0x3db478(0x107)](_0xa4d95a=>{const _0x103e27=_0x3db478;if(typeof _0xa4d95a==='string'&&!_0x964109['includes'](_0xa4d95a))_0x964109[_0x103e27(0xfa)](_0xa4d95a);});for(const _0x99a4fe of typeof DEFAULT_PALETTE!=='undefined'?DEFAULT_PALETTE:[]){if(!_0x964109[_0x3db478(0xfd)](_0x99a4fe))_0x964109[_0x3db478(0xfa)](_0x99a4fe);}PALETTE_COLORS=_0x964109[_0x3db478(0x11c)](0x0,0x18);}}catch(_0x1f943c){console[_0x3db478(0x118)](_0x3db478(0x10e),_0x1f943c);}}async function loadImages(_0x1c5a1b){const _0x4c305b=_0x3d35,_0x5e31a1=await Promise['all'](_0x1c5a1b[_0x4c305b(0x126)](_0x475cd9=>{return new Promise(_0x5744d3=>{const _0x46e34b=_0x3d35,_0x287e45=new Image();_0x287e45['crossOrigin']=_0x46e34b(0xf2),_0x287e45[_0x46e34b(0xf9)]=_0x475cd9,_0x287e45[_0x46e34b(0x117)]=()=>_0x5744d3(_0x287e45);});}));return _0x5e31a1;}function loadStandaloneFromFile(_0x13bddc){return new Promise((_0x251ca0,_0x478e2c)=>{const _0x3131ad=_0x3d35;try{showLoading(_0x3131ad(0x119));}catch(_0x2bb938){}const _0x3c2a5d=new FileReader();_0x3c2a5d['onload']=_0x4d6b8f=>{const _0x20d465=_0x3131ad,_0x28d0a9=_0x4d6b8f[_0x20d465(0x11e)][_0x20d465(0xf1)],_0x683881=extractMetadataFromArrayBuffer(_0x28d0a9);if(!_0x683881||!_0x683881['project']){try{hideLoading();}catch(_0x415b0e){}_0x478e2c(new Error(_0x20d465(0x120)));return;}const _0xba57da=_0x683881[_0x20d465(0xfc)];try{const _0xfc460b=createProject(_0xba57da[_0x20d465(0x11d)],_0xba57da[_0x20d465(0x10f)],_0xba57da['name']||'画像');_0xfc460b[_0x20d465(0x114)]=_0xba57da['frames']['map'](_0xa38b6d=>{const _0x238ba1=_0x20d465;let _0x177cd4={'layers':[],'activeLayer':_0xa38b6d[_0x238ba1(0x124)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x4a27c9=0x0;_0x4a27c9<_0xa38b6d['layers'][_0x238ba1(0x111)];_0x4a27c9++){let _0x11700f=new Image();_0x11700f[_0x238ba1(0xf9)]=_0xa38b6d[_0x238ba1(0x104)][_0x4a27c9];let _0x2f1f28=document[_0x238ba1(0xf8)](_0x238ba1(0x10b));_0x2f1f28[_0x238ba1(0x11d)]=_0xba57da['width']*cellSize,_0x2f1f28['height']=_0xba57da[_0x238ba1(0x10f)]*cellSize,_0x11700f['onload']=()=>{const _0x410985=_0x238ba1;let _0x53c36c=_0x2f1f28[_0x410985(0xfb)]('2d');_0x53c36c[_0x410985(0xf3)](0x0,0x0,_0x2f1f28[_0x410985(0x11d)],_0x2f1f28[_0x410985(0x10f)]),_0x53c36c['drawImage'](_0x11700f,0x0,0x0);try{redrawAll();}catch(_0x5ba00b){}},_0x177cd4[_0x238ba1(0x104)][_0x238ba1(0xfa)](_0x2f1f28);}return _0x177cd4;}),projects['push'](_0xfc460b),activeProject=projects[_0x20d465(0x111)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0x8a2bc4){}_0x251ca0(_0xfc460b);}catch(_0x1a72e3){try{hideLoading();}catch(_0x301c2c){}_0x478e2c(_0x1a72e3);}},_0x3c2a5d[_0x3131ad(0x128)]=_0x4902ad=>{try{hideLoading();}catch(_0x274441){};_0x478e2c(_0x4902ad);},_0x3c2a5d['readAsArrayBuffer'](_0x13bddc);});}