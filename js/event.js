const _0x2fb706=_0x4bf1;(function(_0xbb52d4,_0x57e5ab){const _0x21092a=_0x4bf1,_0x47c13c=_0xbb52d4();while(!![]){try{const _0x3a3dc9=parseInt(_0x21092a(0x1e7))/0x1*(parseInt(_0x21092a(0x21f))/0x2)+-parseInt(_0x21092a(0x1f8))/0x3*(-parseInt(_0x21092a(0x220))/0x4)+parseInt(_0x21092a(0x26e))/0x5+parseInt(_0x21092a(0x237))/0x6+parseInt(_0x21092a(0x1e2))/0x7*(-parseInt(_0x21092a(0x20c))/0x8)+-parseInt(_0x21092a(0x257))/0x9+-parseInt(_0x21092a(0x255))/0xa;if(_0x3a3dc9===_0x57e5ab)break;else _0x47c13c['push'](_0x47c13c['shift']());}catch(_0xf8ea55){_0x47c13c['push'](_0x47c13c['shift']());}}}(_0x557e,0x97e48));const _0xb19745=(function(){let _0xe36b5b=!![];return function(_0x560836,_0xc7cd49){const _0x2fe4bf=_0xe36b5b?function(){const _0x26cfc6=_0x4bf1;if(_0xc7cd49){const _0x306141=_0xc7cd49[_0x26cfc6(0x1fc)](_0x560836,arguments);return _0xc7cd49=null,_0x306141;}}:function(){};return _0xe36b5b=![],_0x2fe4bf;};}()),_0x350cf2=_0xb19745(this,function(){const _0x3d6230=_0x4bf1;return _0x350cf2[_0x3d6230(0x270)]()[_0x3d6230(0x1f3)](_0x3d6230(0x20f))[_0x3d6230(0x270)]()[_0x3d6230(0x213)](_0x350cf2)[_0x3d6230(0x1f3)](_0x3d6230(0x20f));});function _0x4bf1(_0xe6ebb3,_0x91fdfe){_0xe6ebb3=_0xe6ebb3-0x1db;const _0x1b8b93=_0x557e();let _0x350cf2=_0x1b8b93[_0xe6ebb3];return _0x350cf2;}_0x350cf2(),window[_0x2fb706(0x228)](_0x2fb706(0x252),()=>{const _0x384b9e=_0x2fb706,_0x28e66e=document['getElementById'](_0x384b9e(0x211));_0x28e66e&&(_0x28e66e['value']=penAlphaMode,_0x28e66e[_0x384b9e(0x258)]=_0x15060a=>{const _0x301077=_0x384b9e;penAlphaMode=_0x15060a[_0x301077(0x26a)][_0x301077(0x212)];});const _0x27d1a2=document[_0x384b9e(0x24f)](_0x384b9e(0x1e4));if(_0x27d1a2){const _0x387db1=localStorage[_0x384b9e(0x263)](_0x384b9e(0x21b))||_0x384b9e(0x240);applyTheme(_0x387db1),_0x27d1a2[_0x384b9e(0x228)](_0x384b9e(0x223),()=>{toggleTheme();});}window[_0x384b9e(0x228)]('resize',updateMenuBtnDisplay),updateMenuBtnDisplay();const _0x536ae7=document[_0x384b9e(0x24f)](_0x384b9e(0x21a)),_0x573b57=document[_0x384b9e(0x24f)]('right-panel'),_0x5c200a=document[_0x384b9e(0x24f)]('right-toolbar'),_0x3d5406=document['querySelector'](_0x384b9e(0x245)),_0x32ff1f=document[_0x384b9e(0x261)](_0x384b9e(0x22d)),_0x86b36=_0x5c200a?_0x5c200a[_0x384b9e(0x222)]:null,_0x160f8e=_0x5c200a?_0x5c200a['nextSibling']:null;let _0x3e46df=null;function _0x3c38bb(){const _0x4691ac=_0x384b9e;try{if(!_0x5c200a)return;const _0x4bca7b=window[_0x4691ac(0x244)],_0x2269c6=_0x4bca7b<=0x384;if(_0x2269c6&&_0x3d5406&&_0x5c200a['parentNode']!==_0x3d5406){if(_0x3e46df===null)_0x3e46df=_0x5c200a[_0x4691ac(0x1ef)](_0x4691ac(0x22e))||'';_0x3d5406[_0x4691ac(0x266)](_0x5c200a),_0x5c200a[_0x4691ac(0x26c)][_0x4691ac(0x239)](_0x4691ac(0x25a));const _0x5059ff=_0x32ff1f?_0x32ff1f[_0x4691ac(0x217)]:0x38;_0x5c200a[_0x4691ac(0x22e)][_0x4691ac(0x1f6)]='fixed',_0x5c200a['style']['left']=_0x4691ac(0x1ee),_0x5c200a[_0x4691ac(0x22e)][_0x4691ac(0x268)]=_0x4691ac(0x1ee),_0x5c200a[_0x4691ac(0x22e)][_0x4691ac(0x249)]=_0x5059ff+0x8+'px',_0x5c200a[_0x4691ac(0x22e)][_0x4691ac(0x1e1)]=0x1770,_0x5c200a['style']['width']='auto',_0x5c200a[_0x4691ac(0x22e)][_0x4691ac(0x277)]=_0x4691ac(0x226),_0x5c200a['style']['display']=_0x4691ac(0x24e);}else{if(!_0x2269c6&&_0x86b36&&_0x5c200a['parentNode']!==_0x86b36){_0x160f8e&&_0x160f8e['parentNode']===_0x86b36?_0x86b36[_0x4691ac(0x218)](_0x5c200a,_0x160f8e):_0x86b36[_0x4691ac(0x266)](_0x5c200a);_0x5c200a[_0x4691ac(0x26c)][_0x4691ac(0x224)](_0x4691ac(0x25a));if(_0x3e46df!==null){if(_0x3e46df==='')_0x5c200a[_0x4691ac(0x232)]('style');else _0x5c200a[_0x4691ac(0x1f9)]('style',_0x3e46df);_0x3e46df=null;}}else{if(_0x2269c6&&_0x5c200a[_0x4691ac(0x222)]===_0x3d5406){const _0x16006a=_0x32ff1f?_0x32ff1f[_0x4691ac(0x217)]:0x38;_0x5c200a[_0x4691ac(0x22e)][_0x4691ac(0x249)]=_0x16006a+0x8+'px';}}}}catch(_0x5b1fea){console[_0x4691ac(0x1ff)](_0x4691ac(0x21e),_0x5b1fea);}}_0x536ae7&&(_0x536ae7['style'][_0x384b9e(0x1f1)]=_0x384b9e(0x1eb),_0x536ae7[_0x384b9e(0x228)](_0x384b9e(0x223),()=>{const _0xcadaab=_0x384b9e;if(window[_0xcadaab(0x244)]<=0x384&&_0x5c200a){const _0x46ec8c=_0x5c200a[_0xcadaab(0x22e)]['display']!==_0xcadaab(0x24e);_0x5c200a[_0xcadaab(0x22e)][_0xcadaab(0x1f1)]=_0x46ec8c?'none':_0xcadaab(0x1f5),_0x5c200a['classList'][_0xcadaab(0x275)](_0xcadaab(0x1fb),!_0x46ec8c);}else _0x573b57&&_0x573b57['classList'][_0xcadaab(0x275)](_0xcadaab(0x254));}));window['addEventListener']('resize',_0x3c38bb),_0x3c38bb();const _0x4e4c2b=document[_0x384b9e(0x24f)](_0x384b9e(0x225));_0x4e4c2b&&(_0x4e4c2b['oninput']=_0x5bec40=>setZoomValue(_0x5bec40[_0x384b9e(0x26a)]['value']));const _0x2d419f=document['getElementById']('openColorPickerBtn'),_0x1ed6b0=document[_0x384b9e(0x24f)](_0x384b9e(0x210));function _0x5cf082(){const _0x26f019=_0x384b9e;if(typeof showColorPickerDialog!==_0x26f019(0x221))return;const _0x4b75a8=currentColor===_0x26f019(0x200)||!currentColor?_0x26f019(0x233):currentColor;showColorPickerDialog({'color':_0x4b75a8,'alpha':typeof currentAlpha==='number'?currentAlpha:0x1,'onChange':({hex:_0x274b78,rgba:_0x33fa8c,a:_0x19dca4})=>{const _0xdd6a7=_0x26f019;try{_0x33fa8c&&_0x33fa8c[0x3]===0x0?(currentColor='transparent',currentAlpha=0x0):(currentColor=_0x274b78||(_0x33fa8c?rgbToHex(_0x33fa8c[0x0],_0x33fa8c[0x1],_0x33fa8c[0x2]):_0x4b75a8),currentAlpha=_0x33fa8c&&typeof _0x33fa8c[0x3]===_0xdd6a7(0x20e)?_0x33fa8c[0x3]:_0x19dca4||0x1);updateCurrentColorSwatch();const _0x5f2c60=document['getElementById']('colorPicker');if(_0x5f2c60&&currentColor!==_0xdd6a7(0x200))_0x5f2c60[_0xdd6a7(0x212)]=currentColor;}catch(_0x1e18d8){console[_0xdd6a7(0x1ff)](_0xdd6a7(0x1fd),_0x1e18d8);}},'onOk':({hex:_0x35d98d,rgba:_0x510b8b,a:_0x5d93b5})=>{const _0x37b36=_0x26f019;_0x510b8b&&_0x510b8b[0x3]===0x0?(currentColor=_0x37b36(0x200),currentAlpha=0x0):(currentColor=_0x35d98d||(_0x510b8b?rgbToHex(_0x510b8b[0x0],_0x510b8b[0x1],_0x510b8b[0x2]):_0x4b75a8),currentAlpha=_0x510b8b&&typeof _0x510b8b[0x3]===_0x37b36(0x20e)?_0x510b8b[0x3]:_0x5d93b5||0x1);updateCurrentColorSwatch();const _0x20df27=document[_0x37b36(0x24f)](_0x37b36(0x21d));if(_0x20df27&&currentColor!==_0x37b36(0x200))_0x20df27[_0x37b36(0x212)]=currentColor;}});}if(_0x2d419f)_0x2d419f[_0x384b9e(0x228)](_0x384b9e(0x223),_0x5cf082);if(_0x1ed6b0)_0x1ed6b0[_0x384b9e(0x228)]('click',_0x5cf082);const _0x426592=document['getElementById'](_0x384b9e(0x251)),_0x36b4b1=document[_0x384b9e(0x24f)]('pasteLayerBtn');if(_0x426592)_0x426592[_0x384b9e(0x228)](_0x384b9e(0x223),()=>{const _0x2b861a=_0x384b9e;try{copyLayer();}catch(_0x319ea3){console[_0x2b861a(0x1ff)](_0x2b861a(0x1e0),_0x319ea3);}});_0x36b4b1&&(_0x36b4b1[_0x384b9e(0x228)](_0x384b9e(0x223),()=>{const _0xf2ed7=_0x384b9e;try{pasteLayer();}catch(_0x36bf10){console[_0xf2ed7(0x1ff)]('pasteLayer\x20error',_0x36bf10);}}),_0x36b4b1['disabled']=!copiedLayerDataUrl);let _0x5df05f=![],_0xc433ee=null;function _0x46ccad(_0x2dd677){const _0x594a44=_0x384b9e;if(!_0x2dd677)return![];const _0x54eb1d=_0x2dd677[_0x594a44(0x271)]&&_0x2dd677['tagName'][_0x594a44(0x1ea)]();if(_0x54eb1d===_0x594a44(0x201)||_0x54eb1d==='textarea'||_0x54eb1d==='select')return!![];if(_0x2dd677[_0x594a44(0x24b)])return!![];return![];}window[_0x384b9e(0x228)](_0x384b9e(0x22c),_0x34b212=>{const _0x3ea7a1=_0x384b9e;_0x34b212[_0x3ea7a1(0x231)]===_0x3ea7a1(0x215)&&!_0x5df05f&&!_0x46ccad(document[_0x3ea7a1(0x269)])&&(_0xc433ee=currentTool,setTool('pan'),_0x5df05f=!![]);},{'passive':!![]}),window[_0x384b9e(0x228)]('keyup',_0x2401ea=>{const _0xb8f24f=_0x384b9e;if(_0x2401ea['key']===_0xb8f24f(0x215)&&_0x5df05f){if(currentTool==='pan'&&_0xc433ee)setTool(_0xc433ee);_0xc433ee=null,_0x5df05f=![];}},{'passive':!![]}),window[_0x384b9e(0x228)](_0x384b9e(0x22c),_0xc06283=>{const _0x269c65=_0x384b9e;if(_0x46ccad(document[_0x269c65(0x269)]))return;const _0xa622ab=navigator['platform']&&navigator[_0x269c65(0x1f0)][_0x269c65(0x279)]()[_0x269c65(0x1e6)](_0x269c65(0x1df))>=0x0,_0x185b8c=_0xa622ab?_0xc06283[_0x269c65(0x23c)]:_0xc06283[_0x269c65(0x27a)];if(!_0x185b8c)return;const _0x54483a=(_0xc06283[_0x269c65(0x231)]||'')['toLowerCase']();if(_0x54483a==='z'&&!_0xc06283[_0x269c65(0x246)]){_0xc06283[_0x269c65(0x1fa)]();try{undo();}catch(_0x2f700a){console[_0x269c65(0x1ff)](_0x269c65(0x25e),_0x2f700a);}}else{if(_0x54483a==='z'&&_0xc06283[_0x269c65(0x246)]||_0x54483a==='y'){_0xc06283[_0x269c65(0x1fa)]();try{redo();}catch(_0x168368){console['error'](_0x269c65(0x21c),_0x168368);}}}},{'passive':![]}),window['showAboutDialog']=function(){const _0x23ee86=_0x384b9e;if(document[_0x23ee86(0x24f)](_0x23ee86(0x234)))return;const _0x4a9776=document[_0x23ee86(0x235)](_0x23ee86(0x272));_0x4a9776['id']=_0x23ee86(0x234),_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x1f6)]=_0x23ee86(0x274),_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x247)]='0',_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x243)]='0',_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x248)]=_0x23ee86(0x276),_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x1f7)]=_0x23ee86(0x265),_0x4a9776[_0x23ee86(0x22e)]['display']='flex',_0x4a9776['style'][_0x23ee86(0x229)]='center',_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x23e)]=_0x23ee86(0x267),_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x1e1)]=0x2710,_0x4a9776[_0x23ee86(0x22e)][_0x23ee86(0x24c)]=_0x23ee86(0x24a);const _0x3e3c95=window[_0x23ee86(0x259)]||{},_0x1ed184=_0x3e3c95['version']||'不明',_0x158d81=_0x3e3c95['id']||'不明';_0x4a9776[_0x23ee86(0x23b)]='\x0a\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:var(--surface);padding:18px\x2022px;border-radius:10px;min-width:280px;max-width:720px;text-align:left;box-shadow:0\x202px\x2024px\x20rgba(0,0,0,0.25);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x22>ネズミスケッチについて</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ネズミスケッチは、簡単にドット絵アニメーションを作成できるツールです。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>バージョン:\x20<b>'+_0x1ed184+_0x23ee86(0x203)+_0x158d81+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>©\x202025\x20nezumi-sketch\x20<a\x20href=\x22https://github.com/mouse0329\x22\x20rel=\x22noopener\x20noreferrer\x22>github\x20mouse0329</a></p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><a\x20href=\x22/terms\x22>利用規約</a>\u3000<a\x20href=\x22/license\x22>ライセンス</a>\u3000<a\x20href=\x22/about\x22>紹介ページ</a></p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:right;margin-top:10px;\x22><button\x20id=\x22aboutCloseBtn\x22>閉じる</button></div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20',document['body']['appendChild'](_0x4a9776),_0x4a9776[_0x23ee86(0x261)]('#aboutCloseBtn')[_0x23ee86(0x1dd)]=()=>_0x4a9776[_0x23ee86(0x224)](),_0x4a9776[_0x23ee86(0x228)](_0x23ee86(0x223),_0x55ca7d=>{const _0x53ee17=_0x23ee86;if(_0x55ca7d[_0x53ee17(0x26a)]===_0x4a9776)_0x4a9776[_0x53ee17(0x224)]();});};const _0x161b1b=document[_0x384b9e(0x24f)](_0x384b9e(0x205)),_0x2f2a96=document['getElementById'](_0x384b9e(0x24d)),_0x344711=document[_0x384b9e(0x24f)](_0x384b9e(0x204)),_0x159728=document[_0x384b9e(0x24f)](_0x384b9e(0x22b)),_0x5c6cb7=document[_0x384b9e(0x24f)](_0x384b9e(0x1e9));function _0x3b1229(){const _0x4eddb0=_0x384b9e;let _0x39ea11=0x1;if(_0x5c6cb7){_0x39ea11=parseInt(_0x5c6cb7[_0x4eddb0(0x212)],0xa)||0x1;if(_0x39ea11<0x1)_0x39ea11=0x1;}return _0x39ea11;}if(_0x161b1b)_0x161b1b[_0x384b9e(0x228)]('click',()=>nudgeActiveLayer(0x0,-_0x3b1229()));if(_0x2f2a96)_0x2f2a96[_0x384b9e(0x228)](_0x384b9e(0x223),()=>nudgeActiveLayer(0x0,_0x3b1229()));if(_0x344711)_0x344711[_0x384b9e(0x228)](_0x384b9e(0x223),()=>nudgeActiveLayer(-_0x3b1229(),0x0));if(_0x159728)_0x159728[_0x384b9e(0x228)](_0x384b9e(0x223),()=>nudgeActiveLayer(_0x3b1229(),0x0));}),window[_0x2fb706(0x242)]=()=>{const _0x507051=_0x2fb706;canvas=document[_0x507051(0x24f)]('canvas'),wrapper=document['getElementById'](_0x507051(0x26d))||canvas?.[_0x507051(0x25f)]||null;if(!canvas){console['error'](_0x507051(0x25c));return;}ctx=canvas['getContext']('2d'),projects=[createProject()],activeProject=0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),initCanvas(),setTool(_0x507051(0x1f4)),updateCurrentColorSwatch(),loadPaletteFromDB()[_0x507051(0x241)](()=>createPalette());const _0x4880f3=document[_0x507051(0x24f)]('penSize');if(_0x4880f3)_0x4880f3['value']=penSize;const _0x1e0d3a=document[_0x507051(0x24f)](_0x507051(0x23d));if(_0x1e0d3a)_0x1e0d3a[_0x507051(0x212)]=penMode;const _0x38bfd1=document['getElementById']('animSpeedRange'),_0x919663=document[_0x507051(0x24f)](_0x507051(0x273));_0x38bfd1&&_0x919663&&((!Number[_0x507051(0x238)](animationDelay)||animationDelay<=0x0)&&(animationDelay=0x12c),_0x38bfd1[_0x507051(0x212)]=animationDelay,_0x919663['value']=animationDelay,_0x38bfd1[_0x507051(0x209)]=_0x300402=>{const _0x4ad765=_0x507051;_0x919663[_0x4ad765(0x212)]=_0x300402[_0x4ad765(0x26a)][_0x4ad765(0x212)],setAnimationDelay(_0x300402['target']['value']);},_0x919663[_0x507051(0x258)]=_0x3b4cfc=>{const _0x22cc7c=_0x507051;let _0x52b75f=Math[_0x22cc7c(0x26b)](0xa,Math['min'](0x1388,parseInt(_0x3b4cfc[_0x22cc7c(0x26a)][_0x22cc7c(0x212)],0xa)||animationDelay));_0x38bfd1[_0x22cc7c(0x212)]=_0x52b75f,_0x919663[_0x22cc7c(0x212)]=_0x52b75f,setAnimationDelay(_0x52b75f);});canvas[_0x507051(0x230)]=handleMouseDown,canvas['onmousemove']=handleMouseMove,canvas[_0x507051(0x25b)]=handleMouseUp,canvas[_0x507051(0x1ed)]=handleMouseUp,canvas[_0x507051(0x25d)]=handleTouchStart,canvas[_0x507051(0x22f)]=handleTouchMove,canvas[_0x507051(0x216)]=handleTouchEnd,canvas[_0x507051(0x256)]=handleTouchEnd,canvas['addEventListener'](_0x507051(0x1e8),handleTouchStart,{'passive':![]}),canvas['addEventListener']('touchmove',handleTouchMove,{'passive':![]}),canvas[_0x507051(0x228)](_0x507051(0x207),handleTouchEnd,{'passive':![]}),canvas['addEventListener'](_0x507051(0x260),handleTouchEnd,{'passive':![]});try{showLoading(_0x507051(0x253));}catch(_0x4be7c7){}loadProjectFromIDB()[_0x507051(0x20b)](_0x359cae=>{const _0x42989b=_0x507051;console['warn'](_0x42989b(0x206),_0x359cae);})[_0x507051(0x1ec)](()=>{const _0x5819ff=_0x507051;try{hideLoading();}catch(_0x2ab291){}if(typeof window[_0x5819ff(0x1fe)]==='function')window['startAutoSaveInterval']();});};function handleMouseDown(_0x36f201){const _0x10b91d=_0x2fb706;if(currentTool===_0x10b91d(0x264)){isDrawing=!![],panStart={'x':_0x36f201['clientX'],'y':_0x36f201[_0x10b91d(0x1e3)],'posX':posX,'posY':posY},canvas[_0x10b91d(0x22e)][_0x10b91d(0x208)]=_0x10b91d(0x219);return;}isDrawing=!![],saveHistory();const _0x38ad09=getCanvasCoords(_0x36f201),_0x49ca15=Math['floor'](_0x38ad09['x']/cellSize),_0x1a9c43=Math[_0x10b91d(0x262)](_0x38ad09['y']/cellSize);currentTool===_0x10b91d(0x1dc)?(fillAt(_0x49ca15,_0x1a9c43),saveHistory(),isDrawing=![],lastMouse=null):(drawDotXY(_0x49ca15,_0x1a9c43),lastMouse={'x':_0x49ca15,'y':_0x1a9c43});}function handleMouseMove(_0xf90293){const _0x16c92f=_0x2fb706;if(!isDrawing)return;if(currentTool==='pan'&&panStart){const _0x4f3f7e=_0xf90293[_0x16c92f(0x22a)]-panStart['x'],_0x5180d9=_0xf90293[_0x16c92f(0x1e3)]-panStart['y'];posX=panStart[_0x16c92f(0x236)]+_0x4f3f7e,posY=panStart[_0x16c92f(0x20a)]+_0x5180d9,updateTransform();return;}const _0x33d01d=getCanvasCoords(_0xf90293),_0x22d82f=Math[_0x16c92f(0x262)](_0x33d01d['x']/cellSize),_0x1e8c36=Math['floor'](_0x33d01d['y']/cellSize);if(!lastMouse){drawDotXY(_0x22d82f,_0x1e8c36),lastMouse={'x':_0x22d82f,'y':_0x1e8c36};return;}const _0x418da3=_0x22d82f-lastMouse['x'],_0x153fa0=_0x1e8c36-lastMouse['y'],_0x1cf238=Math[_0x16c92f(0x26b)](Math[_0x16c92f(0x1e5)](_0x418da3),Math['abs'](_0x153fa0));if(_0x1cf238<=0x1)drawDotXY(_0x22d82f,_0x1e8c36);else for(let _0x57ae9b=0x1;_0x57ae9b<=_0x1cf238;_0x57ae9b++){const _0x372b14=Math[_0x16c92f(0x227)](lastMouse['x']+_0x418da3*_0x57ae9b/_0x1cf238),_0x3c4b14=Math[_0x16c92f(0x227)](lastMouse['y']+_0x153fa0*_0x57ae9b/_0x1cf238);drawDotXY(_0x372b14,_0x3c4b14);}lastMouse={'x':_0x22d82f,'y':_0x1e8c36};}function handleMouseUp(_0x4055dd){const _0x40f2b7=_0x2fb706;if(currentTool===_0x40f2b7(0x264)){isDrawing=![],panStart=null,canvas[_0x40f2b7(0x22e)]['cursor']='grab';return;}isDrawing&&saveHistory(),isDrawing=![],lastMouse=null;}function handleTouchStart(_0x3bb1e5){const _0x262c27=_0x2fb706;if(_0x3bb1e5[_0x262c27(0x23a)]['length']===0x2){_0x3bb1e5[_0x262c27(0x1fa)](),isPinching=!![],isDrawing=![],lastTouch=null;const _0x397596=_0x3bb1e5[_0x262c27(0x23a)][0x0],_0x471e34=_0x3bb1e5[_0x262c27(0x23a)][0x1];pinchStartDistance=Math['hypot'](_0x471e34['clientX']-_0x397596['clientX'],_0x471e34[_0x262c27(0x1e3)]-_0x397596[_0x262c27(0x1e3)]),pinchStartMid={'clientX':(_0x397596[_0x262c27(0x22a)]+_0x471e34[_0x262c27(0x22a)])/0x2,'clientY':(_0x397596[_0x262c27(0x1e3)]+_0x471e34[_0x262c27(0x1e3)])/0x2},pinchStartScale=scale,pinchStartPosX=posX,pinchStartPosY=posY,pinchRect=canvas[_0x262c27(0x23f)]();}else{if(_0x3bb1e5[_0x262c27(0x23a)][_0x262c27(0x1de)]===0x1){if(colorPickMode){_0x3bb1e5[_0x262c27(0x1fa)]();const _0x54c42d=_0x3bb1e5[_0x262c27(0x23a)][0x0];onCanvasColorPick({'clientX':_0x54c42d['clientX'],'clientY':_0x54c42d[_0x262c27(0x1e3)]});return;}_0x3bb1e5[_0x262c27(0x1fa)]();if(isPinching)return;const _0x533f4a=_0x3bb1e5[_0x262c27(0x23a)][0x0];if(currentTool===_0x262c27(0x264)){isDrawing=!![],panStart={'x':_0x533f4a[_0x262c27(0x22a)],'y':_0x533f4a['clientY'],'posX':posX,'posY':posY};if(canvas)canvas[_0x262c27(0x22e)]['cursor']='grabbing';return;}isDrawing=!![],saveHistory();let _0x8c053b=getTouchPos(_0x3bb1e5);lastTouch=_0x8c053b,currentTool==='fill'?(fillAt(_0x8c053b['x'],_0x8c053b['y']),saveHistory(),isDrawing=![]):drawDotTouch(_0x8c053b['x'],_0x8c053b['y']);}}}function handleTouchMove(_0x5d8bd9){const _0x53ccdc=_0x2fb706;if(!_0x5d8bd9)return;if(isPinching||_0x5d8bd9[_0x53ccdc(0x23a)]&&_0x5d8bd9[_0x53ccdc(0x23a)][_0x53ccdc(0x1de)]===0x2){_0x5d8bd9[_0x53ccdc(0x1fa)](),isDrawing=![],lastTouch=null;const _0x4514bf=_0x5d8bd9[_0x53ccdc(0x23a)][0x0],_0x3e253a=_0x5d8bd9['touches'][0x1],_0x5aa7c2=Math[_0x53ccdc(0x214)](_0x3e253a[_0x53ccdc(0x22a)]-_0x4514bf[_0x53ccdc(0x22a)],_0x3e253a[_0x53ccdc(0x1e3)]-_0x4514bf[_0x53ccdc(0x1e3)]),_0x3ca745={'clientX':(_0x4514bf[_0x53ccdc(0x22a)]+_0x3e253a['clientX'])/0x2,'clientY':(_0x4514bf[_0x53ccdc(0x1e3)]+_0x3e253a['clientY'])/0x2};if(!pinchStartDistance)pinchStartDistance=_0x5aa7c2||0x1;let _0x3491d0=_0x5aa7c2/pinchStartDistance||0x1,_0x491dc3=pinchStartScale*_0x3491d0;_0x491dc3=Math['min'](Math[_0x53ccdc(0x26b)](_0x491dc3,0.2),0x5);const _0x27c937=pinchRect||canvas[_0x53ccdc(0x23f)](),_0x2bae7d=(pinchStartMid['clientX']-_0x27c937['left']-pinchStartPosX)/pinchStartScale,_0x5c484b=(pinchStartMid['clientY']-_0x27c937[_0x53ccdc(0x243)]-pinchStartPosY)/pinchStartScale;posX=_0x3ca745[_0x53ccdc(0x22a)]-_0x27c937[_0x53ccdc(0x247)]-_0x2bae7d*_0x491dc3,posY=_0x3ca745[_0x53ccdc(0x1e3)]-_0x27c937[_0x53ccdc(0x243)]-_0x5c484b*_0x491dc3,scale=_0x491dc3,updateTransform();return;}if(currentTool===_0x53ccdc(0x264)&&panStart&&_0x5d8bd9[_0x53ccdc(0x23a)]&&_0x5d8bd9[_0x53ccdc(0x23a)][0x0]){_0x5d8bd9[_0x53ccdc(0x1fa)]();const _0x24434a=_0x5d8bd9[_0x53ccdc(0x23a)][0x0],_0x33b348=_0x24434a[_0x53ccdc(0x22a)]-panStart['x'],_0x30e939=_0x24434a[_0x53ccdc(0x1e3)]-panStart['y'];posX=panStart[_0x53ccdc(0x236)]+_0x33b348,posY=panStart[_0x53ccdc(0x20a)]+_0x30e939,updateTransform();return;}if(!isDrawing)return;if(_0x5d8bd9['touches']&&_0x5d8bd9[_0x53ccdc(0x23a)][_0x53ccdc(0x1de)]>0x1)return;_0x5d8bd9[_0x53ccdc(0x1fa)]();const _0xa4a707=getTouchPos(_0x5d8bd9);if(!_0xa4a707)return;if(lastTouch){const _0x7a2472=Math['abs']((_0xa4a707['x']-lastTouch['x'])*cellSize),_0x245eb9=Math[_0x53ccdc(0x1e5)]((_0xa4a707['y']-lastTouch['y'])*cellSize);if(_0x7a2472>=PAN_CANCEL_DISTANCE||_0x245eb9>=PAN_CANCEL_DISTANCE){if(currentTool!==_0x53ccdc(0x1f4)){isDrawing=![];return;}}}if(lastTouch){const _0x5398b8=_0xa4a707['x']-lastTouch['x'],_0x20fc2c=_0xa4a707['y']-lastTouch['y'],_0x37e438=Math[_0x53ccdc(0x26b)](Math[_0x53ccdc(0x1e5)](_0x5398b8),Math[_0x53ccdc(0x1e5)](_0x20fc2c));for(let _0x5080fa=0x1;_0x5080fa<=_0x37e438;_0x5080fa++){const _0x39a683=Math[_0x53ccdc(0x227)](lastTouch['x']+_0x5398b8*_0x5080fa/_0x37e438),_0x3cfec5=Math[_0x53ccdc(0x227)](lastTouch['y']+_0x20fc2c*_0x5080fa/_0x37e438);drawDotTouch(_0x39a683,_0x3cfec5);}}else drawDotTouch(_0xa4a707['x'],_0xa4a707['y']);lastTouch=_0xa4a707;}function handleTouchEnd(_0x240618){const _0x3c7316=_0x2fb706;isPinching&&_0x240618[_0x3c7316(0x23a)]&&_0x240618['touches'][_0x3c7316(0x1de)]<0x2&&(isPinching=![],pinchStartDistance=0x0,pinchStartMid=null,pinchRect=null);isDrawing&&(!_0x240618[_0x3c7316(0x23a)]||_0x240618[_0x3c7316(0x23a)][_0x3c7316(0x1de)]===0x0)&&saveHistory();if(_0x240618[_0x3c7316(0x23a)]&&_0x240618[_0x3c7316(0x23a)][_0x3c7316(0x1de)]===0x1){let _0xdce42a=_0x240618['touches'][0x0];lastTouch=getTouchPos({'touches':[_0xdce42a]}),isDrawing=!![];if(currentTool===_0x3c7316(0x264)){panStart={'x':_0xdce42a[_0x3c7316(0x22a)],'y':_0xdce42a[_0x3c7316(0x1e3)],'posX':posX,'posY':posY};if(canvas)canvas['style'][_0x3c7316(0x208)]=_0x3c7316(0x219);}}else{isDrawing=![],lastTouch=null;if(currentTool==='pan'){panStart=null;if(canvas)canvas[_0x3c7316(0x22e)]['cursor']=_0x3c7316(0x250);}}}function onCanvasColorPick(_0x51e143){const _0x98acd=_0x2fb706;try{const _0x32fe00=getCanvasCoords(_0x51e143),_0x50281f=Math[_0x98acd(0x262)](_0x32fe00['x']),_0x1f6b09=Math['floor'](_0x32fe00['y']),_0x51daf3=ctx[_0x98acd(0x1f2)](_0x50281f,_0x1f6b09,0x1,0x1)[_0x98acd(0x20d)],_0x34ca17=_0x51daf3[0x0],_0x87a754=_0x51daf3[0x1],_0x4d049b=_0x51daf3[0x2],_0x3ea178=_0x51daf3[0x3];if(_0x3ea178===0x0){currentColor=_0x98acd(0x200);const _0x1e3079=document[_0x98acd(0x24f)](_0x98acd(0x21d));if(_0x1e3079)_0x1e3079[_0x98acd(0x212)]=_0x98acd(0x233);console[_0x98acd(0x1db)]('Picked\x20transparent');}else{const _0x1ef8ce='#'+[_0x34ca17,_0x87a754,_0x4d049b][_0x98acd(0x278)](_0x15bc27=>_0x15bc27[_0x98acd(0x270)](0x10)[_0x98acd(0x26f)](0x2,'0'))[_0x98acd(0x202)]('');currentColor=_0x1ef8ce;const _0x3bf097=document[_0x98acd(0x24f)](_0x98acd(0x21d));if(_0x3bf097)_0x3bf097[_0x98acd(0x212)]=_0x1ef8ce;console[_0x98acd(0x1db)]('Picked\x20color',_0x1ef8ce);}}catch(_0x423c79){console[_0x98acd(0x1ff)]('onCanvasColorPick\x20error',_0x423c79);}colorPickMode=![];if(canvas)canvas[_0x98acd(0x22e)]['cursor']='default';}function _0x557e(){const _0x274c0e=['IndexedDB\x20からの読み込みに失敗したチュー','touchend','cursor','oninput','posY','catch','1010936hxPiaN','data','number','(((.+)+)+)+$','currentColorSwatch','penAlphaMode','value','constructor','hypot','Shift','ontouchend','offsetHeight','insertBefore','grabbing','toolsToggleBtn','nezumi-theme','redo\x20shortcut\x20error','colorPicker','relocateRightToolbar\x20error','6wxGuxC','763340dkYthm','function','parentNode','click','remove','zoomSlider','0\x202px\x2010px\x20rgba(0,0,0,0.15)','round','addEventListener','alignItems','clientX','nudgeRightBtn','keydown','footer','style','ontouchmove','onmousedown','key','removeAttribute','#000000','about-dialog','createElement','posX','7411782reDkKJ','isFinite','add','touches','innerHTML','metaKey','penMode','justifyContent','getBoundingClientRect','light','then','onload','top','innerWidth','.tool-btn-container','shiftKey','left','width','bottom','rgba(0,0,0,0.35)','isContentEditable','background','nudgeDownBtn','none','getElementById','grab','copyLayerBtn','DOMContentLoaded','自動復元中...','open','28384780kdclTL','ontouchcancel','3582909EbQuVG','onchange','NEZUMI_BUILD_META','toolbar-mobile','onmouseup','canvas\x20要素が見つからないチュー','ontouchstart','undo\x20shortcut\x20error','parentElement','touchcancel','querySelector','floor','getItem','pan','100vh','appendChild','center','right','activeElement','target','max','classList','canvas-container','5760020WtqoTS','padStart','toString','tagName','div','animSpeedValue','fixed','toggle','100vw','boxShadow','map','toUpperCase','ctrlKey','info','fill','onclick','length','MAC','copyLayer\x20error','zIndex','7GsklCC','clientY','themeToggleBtn','abs','indexOf','150929SUTWFQ','touchstart','nudgeStep','toLowerCase','inline-block','finally','onmouseleave','8px','getAttribute','platform','display','getImageData','search','pen','block','position','height','18cxZNZb','setAttribute','preventDefault','mobile-open','apply','color\x20picker\x20onChange\x20error','startAutoSaveInterval','error','transparent','input','join','</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20バージョンID:\x20','nudgeLeftBtn','nudgeUpBtn'];_0x557e=function(){return _0x274c0e;};return _0x557e();}