(function(_0x4c3dc9,_0x26ce01){const _0x30055c=_0x6e7b,_0x16361d=_0x4c3dc9();while(!![]){try{const _0x4fb49e=parseInt(_0x30055c(0xc1))/0x1*(-parseInt(_0x30055c(0xcf))/0x2)+-parseInt(_0x30055c(0xbe))/0x3+-parseInt(_0x30055c(0xb6))/0x4*(parseInt(_0x30055c(0x99))/0x5)+-parseInt(_0x30055c(0xa6))/0x6+-parseInt(_0x30055c(0xca))/0x7+-parseInt(_0x30055c(0xb9))/0x8+-parseInt(_0x30055c(0xae))/0x9*(-parseInt(_0x30055c(0xa4))/0xa);if(_0x4fb49e===_0x26ce01)break;else _0x16361d['push'](_0x16361d['shift']());}catch(_0x351342){_0x16361d['push'](_0x16361d['shift']());}}}(_0x58b3,0xd34f3));const _0x33b024=(function(){let _0x4d766a=!![];return function(_0x23f560,_0x415c49){const _0x1ffda9=_0x4d766a?function(){const _0x2a7828=_0x6e7b;if(_0x415c49){const _0x70577a=_0x415c49[_0x2a7828(0xa8)](_0x23f560,arguments);return _0x415c49=null,_0x70577a;}}:function(){};return _0x4d766a=![],_0x1ffda9;};}()),_0x58b37a=_0x33b024(this,function(){const _0xf037b1=_0x6e7b;return _0x58b37a[_0xf037b1(0xaa)]()[_0xf037b1(0xc7)](_0xf037b1(0xbc))[_0xf037b1(0xaa)]()[_0xf037b1(0xc3)](_0x58b37a)[_0xf037b1(0xc7)](_0xf037b1(0xbc));});function _0x58b3(){const _0x4c560f=['27ifkSoE','読込エラー','メタデータが見つかりませんでした','shift','project','nezumi-palette','layerHistories','canvas','388NNmqae','readonly','src','10873896bSORQQ','anonymous','name','(((.+)+)+)+$','requestAutoSave','2192904zDlBPZ','push','undefined','1804AeJFEQ','all','constructor','delete','crossOrigin','slice','search','onerror','target','4301416GkDXEd','drawImage','frames','activeLayer','layers','466RlebBQ','onsuccess','result','includes','onload','clearRect','layerRedoStacks','error','30815qmrRWh','function','map','toDataURL','width','length','createElement','isArray','transaction','readwrite','readAsArrayBuffer','16660390OqHhwu','get','2458548OeQuBt','保存エラー','apply','oncomplete','toString','put','height','objectStore'];_0x58b3=function(){return _0x4c560f;};return _0x58b3();}_0x58b37a();function _0x6e7b(_0x51aadf,_0x299673){_0x51aadf=_0x51aadf-0x97;const _0x5f359f=_0x58b3();let _0x58b37a=_0x5f359f[_0x51aadf];return _0x58b37a;}function saveHistory(){const _0x59caca=_0x6e7b;let _0x17ad7a=getCurrentFrame();if(!_0x17ad7a)return;if(!Array[_0x59caca(0xa0)](_0x17ad7a[_0x59caca(0xb4)]))_0x17ad7a[_0x59caca(0xb4)]=[];if(!Array[_0x59caca(0xa0)](_0x17ad7a[_0x59caca(0x97)]))_0x17ad7a[_0x59caca(0x97)]=[];const _0x1ad0c6=typeof _0x17ad7a[_0x59caca(0xcd)]==='number'?_0x17ad7a[_0x59caca(0xcd)]:-0x1;if(_0x1ad0c6<0x0)return;if(!_0x17ad7a[_0x59caca(0xb4)][_0x1ad0c6])_0x17ad7a[_0x59caca(0xb4)][_0x1ad0c6]=[];if(!_0x17ad7a[_0x59caca(0x97)][_0x1ad0c6])_0x17ad7a[_0x59caca(0x97)][_0x1ad0c6]=[];const _0x592e9a=_0x17ad7a[_0x59caca(0xce)]&&_0x17ad7a['layers'][_0x1ad0c6]?_0x17ad7a['layers'][_0x1ad0c6]:null,_0x26c933=_0x592e9a&&_0x592e9a['canvas']?_0x592e9a[_0x59caca(0xb5)]:_0x592e9a;if(!_0x26c933||typeof _0x26c933[_0x59caca(0x9c)]!==_0x59caca(0x9a))return;try{_0x17ad7a['layerHistories'][_0x1ad0c6][_0x59caca(0xbf)](_0x26c933[_0x59caca(0x9c)]());if(_0x17ad7a[_0x59caca(0xb4)][_0x1ad0c6][_0x59caca(0x9e)]>0x32)_0x17ad7a['layerHistories'][_0x1ad0c6][_0x59caca(0xb1)]();_0x17ad7a[_0x59caca(0x97)][_0x1ad0c6]=[];try{if(typeof updateUndoRedoButtons===_0x59caca(0x9a))updateUndoRedoButtons();}catch(_0x54f260){}if(typeof window[_0x59caca(0xbd)]===_0x59caca(0x9a))window['requestAutoSave']();}catch(_0xf46fbb){console['error']('saveHistory\x20error',_0xf46fbb);}}async function idbSet(_0x543298,_0x2aeda4){const _0x567e74=await openDB();return new Promise((_0x593d28,_0x280f01)=>{const _0xc83fde=_0x6e7b,_0x4d916e=_0x567e74[_0xc83fde(0xa1)](storeName,'readwrite');_0x4d916e[_0xc83fde(0xad)](storeName)[_0xc83fde(0xab)](_0x2aeda4,_0x543298),_0x4d916e[_0xc83fde(0xa9)]=()=>_0x593d28(),_0x4d916e[_0xc83fde(0xc8)]=()=>_0x280f01(_0x4d916e[_0xc83fde(0x98)]);});}async function idbGet(_0x39d6a9){const _0x59db51=await openDB();return new Promise((_0x55e1b9,_0x271f6a)=>{const _0x62f3eb=_0x6e7b,_0x8953d0=_0x59db51['transaction'](storeName,_0x62f3eb(0xb7)),_0x4ac9bf=_0x8953d0[_0x62f3eb(0xad)](storeName)[_0x62f3eb(0xa5)](_0x39d6a9);_0x4ac9bf[_0x62f3eb(0xd0)]=()=>_0x55e1b9(_0x4ac9bf['result']),_0x4ac9bf[_0x62f3eb(0xc8)]=()=>_0x271f6a(_0x4ac9bf[_0x62f3eb(0x98)]);});}async function idbDelete(_0x2b9cf1){const _0x2b7846=await openDB();return new Promise((_0x745bf4,_0x4b4ca5)=>{const _0x1b8666=_0x6e7b,_0x43eb02=_0x2b7846[_0x1b8666(0xa1)](storeName,_0x1b8666(0xa2));_0x43eb02[_0x1b8666(0xad)](storeName)[_0x1b8666(0xc4)](_0x2b9cf1),_0x43eb02[_0x1b8666(0xa9)]=()=>_0x745bf4(),_0x43eb02[_0x1b8666(0xc8)]=()=>_0x4b4ca5(_0x43eb02[_0x1b8666(0x98)]);});}async function idbClear(){const _0x5a59ad=await openDB();return new Promise((_0x518eff,_0x473fbc)=>{const _0x550cfb=_0x6e7b,_0x5215b0=_0x5a59ad[_0x550cfb(0xa1)](storeName,'readwrite');_0x5215b0[_0x550cfb(0xad)](storeName)['clear'](),_0x5215b0[_0x550cfb(0xa9)]=()=>_0x518eff(),_0x5215b0[_0x550cfb(0xc8)]=()=>_0x473fbc(_0x5215b0['error']);});}async function savePaletteToDB(){const _0x3fcbda=_0x6e7b;try{await idbSet(_0x3fcbda(0xb3),PALETTE_COLORS);}catch(_0x5a24f9){console['error'](_0x3fcbda(0xa7),_0x5a24f9);}}async function loadPaletteFromDB(){const _0x1831c2=_0x6e7b;try{const _0x5c86a5=await idbGet('nezumi-palette');if(Array[_0x1831c2(0xa0)](_0x5c86a5)&&_0x5c86a5[_0x1831c2(0x9e)]){const _0x25eaff=[];_0x5c86a5['forEach'](_0x159230=>{const _0x58a949=_0x1831c2;if(typeof _0x159230==='string'&&!_0x25eaff['includes'](_0x159230))_0x25eaff[_0x58a949(0xbf)](_0x159230);});for(const _0xe92662 of typeof DEFAULT_PALETTE!==_0x1831c2(0xc0)?DEFAULT_PALETTE:[]){if(!_0x25eaff[_0x1831c2(0xd2)](_0xe92662))_0x25eaff['push'](_0xe92662);}PALETTE_COLORS=_0x25eaff[_0x1831c2(0xc6)](0x0,0x18);}}catch(_0x572922){console[_0x1831c2(0x98)](_0x1831c2(0xaf),_0x572922);}}async function loadImages(_0x44ccb4){const _0x28e9f6=_0x6e7b,_0x2cb859=await Promise[_0x28e9f6(0xc2)](_0x44ccb4[_0x28e9f6(0x9b)](_0x4df11d=>{return new Promise(_0x2ff47c=>{const _0x4d64d9=_0x6e7b,_0x507048=new Image();_0x507048[_0x4d64d9(0xc5)]=_0x4d64d9(0xba),_0x507048[_0x4d64d9(0xb8)]=_0x4df11d,_0x507048['onload']=()=>_0x2ff47c(_0x507048);});}));return _0x2cb859;}function loadStandaloneFromFile(_0x109956){return new Promise((_0x59a32f,_0x432952)=>{const _0xa71604=_0x6e7b;try{showLoading('画像ファイルを読み込み中...');}catch(_0x4b64cc){}const _0x465cfb=new FileReader();_0x465cfb[_0xa71604(0xd3)]=_0x10e29b=>{const _0x3cd9e9=_0xa71604,_0x36affc=_0x10e29b[_0x3cd9e9(0xc9)][_0x3cd9e9(0xd1)],_0x2de735=extractMetadataFromArrayBuffer(_0x36affc);if(!_0x2de735||!_0x2de735[_0x3cd9e9(0xb2)]){try{hideLoading();}catch(_0x188ea1){}_0x432952(new Error(_0x3cd9e9(0xb0)));return;}const _0x4ba274=_0x2de735[_0x3cd9e9(0xb2)];try{const _0x31bada=createProject(_0x4ba274[_0x3cd9e9(0x9d)],_0x4ba274[_0x3cd9e9(0xac)],_0x4ba274[_0x3cd9e9(0xbb)]||'画像');_0x31bada['frames']=_0x4ba274[_0x3cd9e9(0xcc)][_0x3cd9e9(0x9b)](_0x1997e4=>{const _0x1c8c84=_0x3cd9e9;let _0x121238={'layers':[],'activeLayer':_0x1997e4[_0x1c8c84(0xcd)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x5024d2=0x0;_0x5024d2<_0x1997e4[_0x1c8c84(0xce)][_0x1c8c84(0x9e)];_0x5024d2++){let _0xb3a53a=new Image();_0xb3a53a['src']=_0x1997e4['layers'][_0x5024d2];let _0x52b9af=document[_0x1c8c84(0x9f)](_0x1c8c84(0xb5));_0x52b9af[_0x1c8c84(0x9d)]=_0x4ba274[_0x1c8c84(0x9d)]*cellSize,_0x52b9af['height']=_0x4ba274['height']*cellSize,_0xb3a53a[_0x1c8c84(0xd3)]=()=>{const _0x43c813=_0x1c8c84;let _0x46d5bf=_0x52b9af['getContext']('2d');_0x46d5bf[_0x43c813(0xd4)](0x0,0x0,_0x52b9af[_0x43c813(0x9d)],_0x52b9af[_0x43c813(0xac)]),_0x46d5bf[_0x43c813(0xcb)](_0xb3a53a,0x0,0x0);try{redrawAll();}catch(_0x3e2560){}},_0x121238[_0x1c8c84(0xce)][_0x1c8c84(0xbf)](_0x52b9af);}return _0x121238;}),projects[_0x3cd9e9(0xbf)](_0x31bada),activeProject=projects['length']-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0xeed308){}_0x59a32f(_0x31bada);}catch(_0x208318){try{hideLoading();}catch(_0x29fd30){}_0x432952(_0x208318);}},_0x465cfb[_0xa71604(0xc8)]=_0x3d4e38=>{try{hideLoading();}catch(_0x4af533){};_0x432952(_0x3d4e38);},_0x465cfb[_0xa71604(0xa3)](_0x109956);});}