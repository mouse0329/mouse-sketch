(function(_0x3da1a9,_0x1eb78f){const _0x4cf151=_0x58b3,_0x1575aa=_0x3da1a9();while(!![]){try{const _0x3066ff=parseInt(_0x4cf151(0xae))/0x1*(-parseInt(_0x4cf151(0x9e))/0x2)+parseInt(_0x4cf151(0xa0))/0x3+parseInt(_0x4cf151(0xb4))/0x4+parseInt(_0x4cf151(0xb6))/0x5*(parseInt(_0x4cf151(0x97))/0x6)+-parseInt(_0x4cf151(0x95))/0x7*(-parseInt(_0x4cf151(0xb2))/0x8)+parseInt(_0x4cf151(0xba))/0x9*(-parseInt(_0x4cf151(0xbc))/0xa)+-parseInt(_0x4cf151(0xb5))/0xb;if(_0x3066ff===_0x1eb78f)break;else _0x1575aa['push'](_0x1575aa['shift']());}catch(_0x11d21e){_0x1575aa['push'](_0x1575aa['shift']());}}}(_0x37d8,0xed3e6));function _0x58b3(_0x3a7be8,_0x100476){_0x3a7be8=_0x3a7be8-0x8f;const _0xf52a4e=_0x37d8();let _0x553569=_0xf52a4e[_0x3a7be8];return _0x553569;}const _0x50d655=(function(){let _0x362adc=!![];return function(_0x556a79,_0x19a8f2){const _0x590b38=_0x362adc?function(){if(_0x19a8f2){const _0x44589a=_0x19a8f2['apply'](_0x556a79,arguments);return _0x19a8f2=null,_0x44589a;}}:function(){};return _0x362adc=![],_0x590b38;};}()),_0x553569=_0x50d655(this,function(){const _0x51f8fa=_0x58b3;return _0x553569[_0x51f8fa(0x91)]()[_0x51f8fa(0xa5)](_0x51f8fa(0xa3))[_0x51f8fa(0x91)]()['constructor'](_0x553569)['search'](_0x51f8fa(0xa3));});_0x553569();function saveHistory(){const _0x536236=_0x58b3;let _0x1e0db2=getCurrentFrame();if(!_0x1e0db2)return;if(!Array[_0x536236(0x8f)](_0x1e0db2[_0x536236(0xa1)]))_0x1e0db2[_0x536236(0xa1)]=[];if(!Array[_0x536236(0x8f)](_0x1e0db2['layerRedoStacks']))_0x1e0db2['layerRedoStacks']=[];const _0xf6bcbe=typeof _0x1e0db2[_0x536236(0xc1)]==='number'?_0x1e0db2[_0x536236(0xc1)]:-0x1;if(_0xf6bcbe<0x0)return;if(!_0x1e0db2['layerHistories'][_0xf6bcbe])_0x1e0db2[_0x536236(0xa1)][_0xf6bcbe]=[];if(!_0x1e0db2[_0x536236(0x9b)][_0xf6bcbe])_0x1e0db2[_0x536236(0x9b)][_0xf6bcbe]=[];const _0x39ba56=_0x1e0db2[_0x536236(0xbe)]&&_0x1e0db2[_0x536236(0xbe)][_0xf6bcbe]?_0x1e0db2[_0x536236(0xbe)][_0xf6bcbe]:null,_0x13c5fe=_0x39ba56&&_0x39ba56[_0x536236(0xaf)]?_0x39ba56[_0x536236(0xaf)]:_0x39ba56;if(!_0x13c5fe||typeof _0x13c5fe[_0x536236(0xc2)]!==_0x536236(0xb8))return;try{_0x1e0db2['layerHistories'][_0xf6bcbe][_0x536236(0x9c)](_0x13c5fe['toDataURL']());if(_0x1e0db2[_0x536236(0xa1)][_0xf6bcbe][_0x536236(0x9f)]>0x32)_0x1e0db2[_0x536236(0xa1)][_0xf6bcbe]['shift']();_0x1e0db2[_0x536236(0x9b)][_0xf6bcbe]=[];try{if(typeof updateUndoRedoButtons===_0x536236(0xb8))updateUndoRedoButtons();}catch(_0x5deb39){}if(typeof window[_0x536236(0xb3)]==='function')window['requestAutoSave']();}catch(_0x15da80){console[_0x536236(0x93)](_0x536236(0x92),_0x15da80);}}function _0x37d8(){const _0x41cc16=['forEach','get','clear','画像ファイルを読み込み中...','objectStore','1fsYWuD','canvas','height','nezumi-palette','16KErzKg','requestAutoSave','3933120QJEnlM','17248264mSyWZc','479095HReTCJ','width','function','読込エラー','15687315HfibYq','メタデータが見つかりませんでした','10LgmpZq','project','layers','readAsArrayBuffer','oncomplete','activeLayer','toDataURL','createElement','all','drawImage','includes','clearRect','isArray','undefined','toString','saveHistory\x20error','error','anonymous','6097980tCvUsU','readwrite','90snFuJC','transaction','onerror','onsuccess','layerRedoStacks','push','onload','447778KwFwvC','length','1031559QdzcMK','layerHistories','crossOrigin','(((.+)+)+)+$','result','search','target','getContext','slice'];_0x37d8=function(){return _0x41cc16;};return _0x37d8();}async function idbSet(_0x60d97d,_0x3130e9){const _0x60eab6=await openDB();return new Promise((_0x5cf17b,_0x4feecc)=>{const _0x140066=_0x58b3,_0x154b79=_0x60eab6[_0x140066(0x98)](storeName,'readwrite');_0x154b79[_0x140066(0xad)](storeName)['put'](_0x3130e9,_0x60d97d),_0x154b79[_0x140066(0xc0)]=()=>_0x5cf17b(),_0x154b79[_0x140066(0x99)]=()=>_0x4feecc(_0x154b79[_0x140066(0x93)]);});}async function idbGet(_0x2942d2){const _0x50872d=await openDB();return new Promise((_0x10f171,_0x4b9b57)=>{const _0xbb026c=_0x58b3,_0xfd393=_0x50872d[_0xbb026c(0x98)](storeName,'readonly'),_0x408d30=_0xfd393[_0xbb026c(0xad)](storeName)[_0xbb026c(0xaa)](_0x2942d2);_0x408d30[_0xbb026c(0x9a)]=()=>_0x10f171(_0x408d30[_0xbb026c(0xa4)]),_0x408d30[_0xbb026c(0x99)]=()=>_0x4b9b57(_0x408d30['error']);});}async function idbDelete(_0x20c9fd){const _0x4e6562=await openDB();return new Promise((_0x43683c,_0x4fe0f6)=>{const _0x98bf95=_0x58b3,_0x298776=_0x4e6562[_0x98bf95(0x98)](storeName,_0x98bf95(0x96));_0x298776[_0x98bf95(0xad)](storeName)['delete'](_0x20c9fd),_0x298776[_0x98bf95(0xc0)]=()=>_0x43683c(),_0x298776[_0x98bf95(0x99)]=()=>_0x4fe0f6(_0x298776[_0x98bf95(0x93)]);});}async function idbClear(){const _0x1fae4d=await openDB();return new Promise((_0x6af59e,_0x399e2e)=>{const _0x5490ce=_0x58b3,_0x32cf33=_0x1fae4d['transaction'](storeName,'readwrite');_0x32cf33['objectStore'](storeName)[_0x5490ce(0xab)](),_0x32cf33[_0x5490ce(0xc0)]=()=>_0x6af59e(),_0x32cf33[_0x5490ce(0x99)]=()=>_0x399e2e(_0x32cf33[_0x5490ce(0x93)]);});}async function savePaletteToDB(){try{await idbSet('nezumi-palette',PALETTE_COLORS);}catch(_0x7dab98){console['error']('保存エラー',_0x7dab98);}}async function loadPaletteFromDB(){const _0x8688e5=_0x58b3;try{const _0x1a5081=await idbGet(_0x8688e5(0xb1));if(Array[_0x8688e5(0x8f)](_0x1a5081)&&_0x1a5081['length']){const _0x4261a2=[];_0x1a5081[_0x8688e5(0xa9)](_0x379b90=>{const _0x1918e1=_0x8688e5;if(typeof _0x379b90==='string'&&!_0x4261a2[_0x1918e1(0xc6)](_0x379b90))_0x4261a2[_0x1918e1(0x9c)](_0x379b90);});for(const _0x2afa96 of typeof DEFAULT_PALETTE!==_0x8688e5(0x90)?DEFAULT_PALETTE:[]){if(!_0x4261a2[_0x8688e5(0xc6)](_0x2afa96))_0x4261a2[_0x8688e5(0x9c)](_0x2afa96);}PALETTE_COLORS=_0x4261a2[_0x8688e5(0xa8)](0x0,0x18);}}catch(_0x1d2e71){console[_0x8688e5(0x93)](_0x8688e5(0xb9),_0x1d2e71);}}async function loadImages(_0x4e729e){const _0x1f77f9=_0x58b3,_0x4e952a=await Promise[_0x1f77f9(0xc4)](_0x4e729e['map'](_0x18d7ff=>{return new Promise(_0x36bd15=>{const _0x2f0d57=_0x58b3,_0x113da1=new Image();_0x113da1[_0x2f0d57(0xa2)]=_0x2f0d57(0x94),_0x113da1['src']=_0x18d7ff,_0x113da1[_0x2f0d57(0x9d)]=()=>_0x36bd15(_0x113da1);});}));return _0x4e952a;}function loadStandaloneFromFile(_0x1e80c4){return new Promise((_0x11b1cb,_0x577e77)=>{const _0x2e7306=_0x58b3;try{showLoading(_0x2e7306(0xac));}catch(_0x592f77){}const _0xb99d8e=new FileReader();_0xb99d8e[_0x2e7306(0x9d)]=_0x479885=>{const _0x2bce02=_0x2e7306,_0x125029=_0x479885[_0x2bce02(0xa6)][_0x2bce02(0xa4)],_0x88583e=extractMetadataFromArrayBuffer(_0x125029);if(!_0x88583e||!_0x88583e[_0x2bce02(0xbd)]){try{hideLoading();}catch(_0x31ab04){}_0x577e77(new Error(_0x2bce02(0xbb)));return;}const _0x374de4=_0x88583e[_0x2bce02(0xbd)];try{const _0x31f155=createProject(_0x374de4[_0x2bce02(0xb7)],_0x374de4[_0x2bce02(0xb0)],_0x374de4['name']||'画像');_0x31f155['frames']=_0x374de4['frames']['map'](_0x4cccf1=>{const _0x1c14b9=_0x2bce02;let _0x4fb8f8={'layers':[],'activeLayer':_0x4cccf1[_0x1c14b9(0xc1)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x5aab30=0x0;_0x5aab30<_0x4cccf1['layers'][_0x1c14b9(0x9f)];_0x5aab30++){let _0x441956=new Image();_0x441956['src']=_0x4cccf1[_0x1c14b9(0xbe)][_0x5aab30];let _0x58fc44=document[_0x1c14b9(0xc3)](_0x1c14b9(0xaf));_0x58fc44[_0x1c14b9(0xb7)]=_0x374de4[_0x1c14b9(0xb7)]*cellSize,_0x58fc44['height']=_0x374de4[_0x1c14b9(0xb0)]*cellSize,_0x441956[_0x1c14b9(0x9d)]=()=>{const _0x560f56=_0x1c14b9;let _0x55de99=_0x58fc44[_0x560f56(0xa7)]('2d');_0x55de99[_0x560f56(0xc7)](0x0,0x0,_0x58fc44['width'],_0x58fc44[_0x560f56(0xb0)]),_0x55de99[_0x560f56(0xc5)](_0x441956,0x0,0x0);try{redrawAll();}catch(_0x6987b6){}},_0x4fb8f8[_0x1c14b9(0xbe)][_0x1c14b9(0x9c)](_0x58fc44);}return _0x4fb8f8;}),projects[_0x2bce02(0x9c)](_0x31f155),activeProject=projects['length']-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0xc4a245){}_0x11b1cb(_0x31f155);}catch(_0x1cb1a3){try{hideLoading();}catch(_0x3680cc){}_0x577e77(_0x1cb1a3);}},_0xb99d8e[_0x2e7306(0x99)]=_0x265513=>{try{hideLoading();}catch(_0x5dfbc1){};_0x577e77(_0x265513);},_0xb99d8e[_0x2e7306(0xbf)](_0x1e80c4);});}