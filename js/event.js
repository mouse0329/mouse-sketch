function _0x5b4c(){const _0x393eac=['body','Shift','pasteLayerBtn','copyLayer\x20error','top','exportWidthPx','finally','height','DOMContentLoaded','remove','onmouseleave','appendChild','undo\x20shortcut\x20error','platform','style','touchcancel','info','innerHTML','right-toolbar','10308744TiYgzF','activeElement','posY','(((.+)+)+)+$','length','join','isContentEditable','light','rgba(0,0,0,0.35)','onmousemove','insertBefore','constructor','position','</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20バージョンID:\x20','right','#aboutCloseBtn','grabbing','onchange','pan','toUpperCase','198450vBJuOE','0\x202px\x2010px\x20rgba(0,0,0,0.15)','toLowerCase','Picked\x20color','touchstart','ontouchend','redo\x20shortcut\x20error','zoomSlider','805240WnNXju','click','transparent','preventDefault','penAlphaMode','boxShadow','then','addEventListener','pen','min','background','resize','MAC','597320ncRYul','getBoundingClientRect','catch','openColorPickerBtn','toggle','getElementById','ontouchcancel','4610872XhCNJE','onCanvasColorPick\x20error','apply','inline-block','fixed','value','grab','div','toolbar-mobile','8px','parentNode','nudgeLeftBtn','4338220hxrYMX','penMode','width','max','block','removeAttribute','input','flex','copyLayerBtn','error','setAttribute','select','none','hypot','fill','Picked\x20transparent','offsetHeight','onmousedown','nezumi-theme','showAboutDialog','oninput','getContext','open','number','isFinite','version','key','ontouchmove','innerWidth','onmouseup','nudgeUpBtn','nudgeStep','frontDimBtn','canvas-container','clientY','8888660aXJSxM','canvas','canvas\x20要素が見つからないチュー','auto','floor','getAttribute','IndexedDB\x20からの読み込みに失敗したチュー','keydown','100vw','function','default','classList','自動復元中...','center','colorPicker','data','disabled','posX','search','display','ctrlKey','cursor','footer','100vh','createElement','animSpeedValue','target','keyup','metaKey','currentColorSwatch','zIndex','3lXdQXh','tagName','ontouchstart','relocateRightToolbar\x20error','round','nudgeRightBtn','getImageData','color\x20picker\x20onChange\x20error','abs','textarea','touches','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>©\x202025\x20nezumi-sketch\x20<a\x20href=\x22https://github.com/mouse0329\x22\x20rel=\x22noopener\x20noreferrer\x22>github\x20mouse0329</a></p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><a\x20href=\x22/terms\x22>利用規約</a>\u3000<a\x20href=\x22/license\x22>ライセンス</a>\u3000<a\x20href=\x22/about\x22>紹介ページ</a></p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:right;margin-top:10px;\x22><button\x20id=\x22aboutCloseBtn\x22>閉じる</button></div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','36BoODhI','left','bottom','\x0a\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:var(--surface);padding:18px\x2022px;border-radius:10px;min-width:280px;max-width:720px;text-align:left;box-shadow:0\x202px\x2024px\x20rgba(0,0,0,0.25);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x22>ネズミスケッチについて</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ネズミスケッチは、簡単にドット絵アニメーションを作成できるツールです。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>バージョン:\x20<b>','onload','about-dialog','nextSibling','toString','querySelector','clientX'];_0x5b4c=function(){return _0x393eac;};return _0x5b4c();}const _0x2f6fab=_0x5590;(function(_0x2520fd,_0x560a2e){const _0x304b6b=_0x5590,_0x43e619=_0x2520fd();while(!![]){try{const _0x3cc135=-parseInt(_0x304b6b(0x1ad))/0x1+parseInt(_0x304b6b(0x1a0))/0x2+parseInt(_0x304b6b(0x15b))/0x3*(-parseInt(_0x304b6b(0x119))/0x4)+-parseInt(_0x304b6b(0x13c))/0x5+parseInt(_0x304b6b(0x184))/0x6+-parseInt(_0x304b6b(0x198))/0x7+parseInt(_0x304b6b(0x1b4))/0x8*(parseInt(_0x304b6b(0x167))/0x9);if(_0x3cc135===_0x560a2e)break;else _0x43e619['push'](_0x43e619['shift']());}catch(_0x296c0c){_0x43e619['push'](_0x43e619['shift']());}}}(_0x5b4c,0xe50ef));const _0x448713=(function(){let _0x273c18=!![];return function(_0x41190d,_0x65ec17){const _0x183ed2=_0x273c18?function(){const _0x218d4e=_0x5590;if(_0x65ec17){const _0x3147a0=_0x65ec17[_0x218d4e(0x1b6)](_0x41190d,arguments);return _0x65ec17=null,_0x3147a0;}}:function(){};return _0x273c18=![],_0x183ed2;};}()),_0xb8ebaf=_0x448713(this,function(){const _0x489252=_0x5590;return _0xb8ebaf[_0x489252(0x16e)]()[_0x489252(0x14e)](_0x489252(0x187))[_0x489252(0x16e)]()[_0x489252(0x18f)](_0xb8ebaf)[_0x489252(0x14e)](_0x489252(0x187));});function _0x5590(_0x65c3fa,_0x3d48f4){_0x65c3fa=_0x65c3fa-0x118;const _0x327846=_0x5b4c();let _0xb8ebaf=_0x327846[_0x65c3fa];return _0xb8ebaf;}_0xb8ebaf(),window[_0x2f6fab(0x1a7)](_0x2f6fab(0x179),()=>{const _0x498a09=_0x2f6fab,_0x10ac31=document[_0x498a09(0x1b2)](_0x498a09(0x1a4));_0x10ac31&&(_0x10ac31[_0x498a09(0x1b9)]=penAlphaMode,_0x10ac31[_0x498a09(0x195)]=_0x435ab9=>{const _0x537061=_0x498a09;penAlphaMode=_0x435ab9[_0x537061(0x156)][_0x537061(0x1b9)];});const _0x51f0a9=document[_0x498a09(0x1b2)]('themeToggleBtn');if(_0x51f0a9){const _0x536e41=localStorage['getItem'](_0x498a09(0x12b))||_0x498a09(0x18b);applyTheme(_0x536e41),_0x51f0a9[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>{toggleTheme();});}window[_0x498a09(0x1a7)](_0x498a09(0x1ab),updateMenuBtnDisplay),updateMenuBtnDisplay();const _0x5bff86=document[_0x498a09(0x1b2)]('toolsToggleBtn'),_0xbba76e=document[_0x498a09(0x1b2)]('right-panel'),_0x28304e=document[_0x498a09(0x1b2)](_0x498a09(0x183)),_0xd4baa4=document[_0x498a09(0x16f)]('.tool-btn-container'),_0x539e48=document[_0x498a09(0x16f)](_0x498a09(0x152)),_0xdd9332=_0x28304e?_0x28304e[_0x498a09(0x1be)]:null,_0x109491=_0x28304e?_0x28304e[_0x498a09(0x16d)]:null;let _0x288e2d=null;function _0xafd572(){const _0x306b5a=_0x498a09;try{if(!_0x28304e)return;const _0x2722f2=window['innerWidth'],_0x1285ed=_0x2722f2<=0x384;if(_0x1285ed&&_0xd4baa4&&_0x28304e[_0x306b5a(0x1be)]!==_0xd4baa4){if(_0x288e2d===null)_0x288e2d=_0x28304e[_0x306b5a(0x141)]('style')||'';_0xd4baa4[_0x306b5a(0x17c)](_0x28304e),_0x28304e[_0x306b5a(0x147)]['add'](_0x306b5a(0x1bc));const _0x31b192=_0x539e48?_0x539e48[_0x306b5a(0x129)]:0x38;_0x28304e['style'][_0x306b5a(0x190)]=_0x306b5a(0x1b8),_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x168)]='8px',_0x28304e['style'][_0x306b5a(0x192)]=_0x306b5a(0x1bd),_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x169)]=_0x31b192+0x8+'px',_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x15a)]=0x1770,_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x11b)]=_0x306b5a(0x13f),_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x1a5)]=_0x306b5a(0x199),_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x14f)]=_0x306b5a(0x125);}else{if(!_0x1285ed&&_0xdd9332&&_0x28304e['parentNode']!==_0xdd9332){_0x109491&&_0x109491[_0x306b5a(0x1be)]===_0xdd9332?_0xdd9332[_0x306b5a(0x18e)](_0x28304e,_0x109491):_0xdd9332['appendChild'](_0x28304e);_0x28304e[_0x306b5a(0x147)][_0x306b5a(0x17a)]('toolbar-mobile');if(_0x288e2d!==null){if(_0x288e2d==='')_0x28304e[_0x306b5a(0x11e)](_0x306b5a(0x17f));else _0x28304e[_0x306b5a(0x123)](_0x306b5a(0x17f),_0x288e2d);_0x288e2d=null;}}else{if(_0x1285ed&&_0x28304e['parentNode']===_0xd4baa4){const _0x3771b4=_0x539e48?_0x539e48[_0x306b5a(0x129)]:0x38;_0x28304e[_0x306b5a(0x17f)][_0x306b5a(0x169)]=_0x3771b4+0x8+'px';}}}}catch(_0x1464c4){console[_0x306b5a(0x122)](_0x306b5a(0x15e),_0x1464c4);}}_0x5bff86&&(_0x5bff86[_0x498a09(0x17f)][_0x498a09(0x14f)]=_0x498a09(0x1b7),_0x5bff86['addEventListener'](_0x498a09(0x1a1),()=>{const _0x1f1a00=_0x498a09;if(window[_0x1f1a00(0x135)]<=0x384&&_0x28304e){const _0x6fbee6=_0x28304e[_0x1f1a00(0x17f)][_0x1f1a00(0x14f)]!==_0x1f1a00(0x125);_0x28304e[_0x1f1a00(0x17f)]['display']=_0x6fbee6?_0x1f1a00(0x125):_0x1f1a00(0x11d),_0x28304e['classList'][_0x1f1a00(0x1b1)]('mobile-open',!_0x6fbee6);}else _0xbba76e&&_0xbba76e[_0x1f1a00(0x147)][_0x1f1a00(0x1b1)](_0x1f1a00(0x12f));}));window[_0x498a09(0x1a7)]('resize',_0xafd572),_0xafd572();const _0x428f13=document[_0x498a09(0x1b2)](_0x498a09(0x19f));_0x428f13&&(_0x428f13['oninput']=_0x24b760=>setZoomValue(_0x24b760[_0x498a09(0x156)]['value']));const _0x9227a3=document[_0x498a09(0x1b2)](_0x498a09(0x1b0)),_0x3fff8a=document['getElementById'](_0x498a09(0x159));function _0x39b8c2(){const _0x2e8fb7=_0x498a09;if(typeof showColorPickerDialog!==_0x2e8fb7(0x145))return;const _0x417199=currentColor===_0x2e8fb7(0x1a2)||!currentColor?'#000000':currentColor;showColorPickerDialog({'color':_0x417199,'alpha':typeof currentAlpha===_0x2e8fb7(0x130)?currentAlpha:0x1,'onChange':({hex:_0x3a9c64,rgba:_0x4e6f0f,a:_0x16e088})=>{const _0x9e4e4a=_0x2e8fb7;try{_0x4e6f0f&&_0x4e6f0f[0x3]===0x0?(currentColor='transparent',currentAlpha=0x0):(currentColor=_0x3a9c64||(_0x4e6f0f?rgbToHex(_0x4e6f0f[0x0],_0x4e6f0f[0x1],_0x4e6f0f[0x2]):_0x417199),currentAlpha=_0x4e6f0f&&typeof _0x4e6f0f[0x3]===_0x9e4e4a(0x130)?_0x4e6f0f[0x3]:_0x16e088||0x1);updateCurrentColorSwatch();const _0x5f0609=document[_0x9e4e4a(0x1b2)](_0x9e4e4a(0x14a));if(_0x5f0609&&currentColor!=='transparent')_0x5f0609['value']=currentColor;}catch(_0x1a8959){console[_0x9e4e4a(0x122)](_0x9e4e4a(0x162),_0x1a8959);}},'onOk':({hex:_0x515ea6,rgba:_0x432b03,a:_0x457cfb})=>{const _0x1a6499=_0x2e8fb7;_0x432b03&&_0x432b03[0x3]===0x0?(currentColor='transparent',currentAlpha=0x0):(currentColor=_0x515ea6||(_0x432b03?rgbToHex(_0x432b03[0x0],_0x432b03[0x1],_0x432b03[0x2]):_0x417199),currentAlpha=_0x432b03&&typeof _0x432b03[0x3]===_0x1a6499(0x130)?_0x432b03[0x3]:_0x457cfb||0x1);updateCurrentColorSwatch();const _0x236ce5=document[_0x1a6499(0x1b2)](_0x1a6499(0x14a));if(_0x236ce5&&currentColor!==_0x1a6499(0x1a2))_0x236ce5[_0x1a6499(0x1b9)]=currentColor;}});}if(_0x9227a3)_0x9227a3['addEventListener'](_0x498a09(0x1a1),_0x39b8c2);if(_0x3fff8a)_0x3fff8a[_0x498a09(0x1a7)](_0x498a09(0x1a1),_0x39b8c2);const _0x5eb60d=document[_0x498a09(0x1b2)](_0x498a09(0x121)),_0x5a3f4c=document[_0x498a09(0x1b2)](_0x498a09(0x173));if(_0x5eb60d)_0x5eb60d[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>{const _0x269f8c=_0x498a09;try{copyLayer();}catch(_0xf05bc7){console[_0x269f8c(0x122)](_0x269f8c(0x174),_0xf05bc7);}});_0x5a3f4c&&(_0x5a3f4c[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>{const _0x5796b0=_0x498a09;try{pasteLayer();}catch(_0x2f761a){console[_0x5796b0(0x122)]('pasteLayer\x20error',_0x2f761a);}}),_0x5a3f4c[_0x498a09(0x14c)]=!copiedLayerDataUrl);let _0x2e0a61=![],_0x36d93c=null;function _0x2acde(_0x47ef8c){const _0x51eab8=_0x498a09;if(!_0x47ef8c)return![];const _0x37c031=_0x47ef8c[_0x51eab8(0x15c)]&&_0x47ef8c[_0x51eab8(0x15c)][_0x51eab8(0x19a)]();if(_0x37c031===_0x51eab8(0x11f)||_0x37c031===_0x51eab8(0x164)||_0x37c031===_0x51eab8(0x124))return!![];if(_0x47ef8c[_0x51eab8(0x18a)])return!![];return![];}window[_0x498a09(0x1a7)](_0x498a09(0x143),_0xed3796=>{const _0x233fe1=_0x498a09;_0xed3796[_0x233fe1(0x133)]===_0x233fe1(0x172)&&!_0x2e0a61&&!_0x2acde(document[_0x233fe1(0x185)])&&(_0x36d93c=currentTool,setTool('pan'),_0x2e0a61=!![]);},{'passive':!![]}),window['addEventListener'](_0x498a09(0x157),_0x38f929=>{const _0x329a01=_0x498a09;if(_0x38f929[_0x329a01(0x133)]===_0x329a01(0x172)&&_0x2e0a61){if(currentTool===_0x329a01(0x196)&&_0x36d93c)setTool(_0x36d93c);_0x36d93c=null,_0x2e0a61=![];}},{'passive':!![]}),window[_0x498a09(0x1a7)](_0x498a09(0x143),_0xe589ad=>{const _0x6f3adf=_0x498a09;if(_0x2acde(document['activeElement']))return;const _0x464cbd=navigator['platform']&&navigator[_0x6f3adf(0x17e)][_0x6f3adf(0x197)]()['indexOf'](_0x6f3adf(0x1ac))>=0x0,_0x428e31=_0x464cbd?_0xe589ad[_0x6f3adf(0x158)]:_0xe589ad[_0x6f3adf(0x150)];if(!_0x428e31)return;const _0x10446c=(_0xe589ad[_0x6f3adf(0x133)]||'')['toLowerCase']();if(_0x10446c==='z'&&!_0xe589ad['shiftKey']){_0xe589ad['preventDefault']();try{undo();}catch(_0x38d024){console[_0x6f3adf(0x122)](_0x6f3adf(0x17d),_0x38d024);}}else{if(_0x10446c==='z'&&_0xe589ad['shiftKey']||_0x10446c==='y'){_0xe589ad[_0x6f3adf(0x1a3)]();try{redo();}catch(_0xf87b5a){console[_0x6f3adf(0x122)](_0x6f3adf(0x19e),_0xf87b5a);}}}},{'passive':![]}),window[_0x498a09(0x12c)]=function(){const _0x355333=_0x498a09;if(document[_0x355333(0x1b2)](_0x355333(0x16c)))return;const _0x197484=document[_0x355333(0x154)](_0x355333(0x1bb));_0x197484['id']=_0x355333(0x16c),_0x197484[_0x355333(0x17f)][_0x355333(0x190)]=_0x355333(0x1b8),_0x197484['style'][_0x355333(0x168)]='0',_0x197484[_0x355333(0x17f)]['top']='0',_0x197484['style'][_0x355333(0x11b)]=_0x355333(0x144),_0x197484[_0x355333(0x17f)][_0x355333(0x178)]=_0x355333(0x153),_0x197484[_0x355333(0x17f)][_0x355333(0x14f)]=_0x355333(0x120),_0x197484[_0x355333(0x17f)]['alignItems']=_0x355333(0x149),_0x197484[_0x355333(0x17f)]['justifyContent']=_0x355333(0x149),_0x197484['style'][_0x355333(0x15a)]=0x2710,_0x197484['style'][_0x355333(0x1aa)]=_0x355333(0x18c);const _0x74d2d=window['NEZUMI_BUILD_META']||{},_0x49588c=_0x74d2d[_0x355333(0x132)]||'不明',_0x331a93=_0x74d2d['id']||'不明';_0x197484[_0x355333(0x182)]=_0x355333(0x16a)+_0x49588c+_0x355333(0x191)+_0x331a93+_0x355333(0x166),document[_0x355333(0x171)]['appendChild'](_0x197484),_0x197484[_0x355333(0x16f)](_0x355333(0x193))['onclick']=()=>_0x197484[_0x355333(0x17a)](),_0x197484[_0x355333(0x1a7)](_0x355333(0x1a1),_0x289f36=>{const _0x40f0f1=_0x355333;if(_0x289f36[_0x40f0f1(0x156)]===_0x197484)_0x197484['remove']();});};const _0x4be64c=document[_0x498a09(0x1b2)](_0x498a09(0x137)),_0x5d8d8d=document['getElementById']('nudgeDownBtn'),_0x5c47f9=document[_0x498a09(0x1b2)](_0x498a09(0x118)),_0x53253a=document[_0x498a09(0x1b2)](_0x498a09(0x160)),_0x1b4946=document[_0x498a09(0x1b2)](_0x498a09(0x138));function _0x230d3c(){const _0x170421=_0x498a09;let _0x461ff8=0x1;if(_0x1b4946){_0x461ff8=parseInt(_0x1b4946[_0x170421(0x1b9)],0xa)||0x1;if(_0x461ff8<0x1)_0x461ff8=0x1;}return _0x461ff8;}if(_0x4be64c)_0x4be64c[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>nudgeActiveLayer(0x0,-_0x230d3c()));if(_0x5d8d8d)_0x5d8d8d[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>nudgeActiveLayer(0x0,_0x230d3c()));if(_0x5c47f9)_0x5c47f9[_0x498a09(0x1a7)]('click',()=>nudgeActiveLayer(-_0x230d3c(),0x0));if(_0x53253a)_0x53253a[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>nudgeActiveLayer(_0x230d3c(),0x0));const _0x52f763=document[_0x498a09(0x1b2)](_0x498a09(0x139));_0x52f763&&_0x52f763[_0x498a09(0x1a7)](_0x498a09(0x1a1),()=>toggleFrontLayerDim());try{toggleGrid(showGrid);}catch(_0xc528e4){}try{toggleFrontLayerDim(dimFrontLayers);}catch(_0x266ab3){}try{updateAnimUi(![]);}catch(_0x487996){}}),window[_0x2f6fab(0x16b)]=()=>{const _0x1af669=_0x2f6fab;canvas=document['getElementById'](_0x1af669(0x13d)),wrapper=document[_0x1af669(0x1b2)](_0x1af669(0x13a))||canvas?.['parentElement']||null;if(!canvas){console['error'](_0x1af669(0x13e));return;}ctx=canvas[_0x1af669(0x12e)]('2d'),projects=[createProject()],activeProject=0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),initCanvas(),setTool(_0x1af669(0x1a8)),updateCurrentColorSwatch(),loadPaletteFromDB()[_0x1af669(0x1a6)](()=>createPalette());const _0x106121=document['getElementById']('penSize');if(_0x106121)_0x106121[_0x1af669(0x1b9)]=penSize;const _0x4e5b27=document[_0x1af669(0x1b2)](_0x1af669(0x11a));if(_0x4e5b27)_0x4e5b27['value']=penMode;const _0x3c233d=document[_0x1af669(0x1b2)](_0x1af669(0x176)),_0x27870e=document[_0x1af669(0x1b2)]('exportHeightPx');if(_0x3c233d)_0x3c233d['value']=canvas[_0x1af669(0x11b)];if(_0x27870e)_0x27870e[_0x1af669(0x1b9)]=canvas[_0x1af669(0x178)];const _0xc28b6c=document[_0x1af669(0x1b2)]('animSpeedRange'),_0x659bae=document[_0x1af669(0x1b2)](_0x1af669(0x155));_0xc28b6c&&_0x659bae&&((!Number[_0x1af669(0x131)](animationDelay)||animationDelay<=0x0)&&(animationDelay=0x12c),_0xc28b6c[_0x1af669(0x1b9)]=animationDelay,_0x659bae[_0x1af669(0x1b9)]=animationDelay,_0xc28b6c[_0x1af669(0x12d)]=_0x1987e9=>{const _0x2e5f7b=_0x1af669;_0x659bae[_0x2e5f7b(0x1b9)]=_0x1987e9[_0x2e5f7b(0x156)][_0x2e5f7b(0x1b9)],setAnimationDelay(_0x1987e9[_0x2e5f7b(0x156)][_0x2e5f7b(0x1b9)]);},_0x659bae[_0x1af669(0x195)]=_0x33ba40=>{const _0x28cbea=_0x1af669;let _0x3685b5=Math[_0x28cbea(0x11c)](0xa,Math[_0x28cbea(0x1a9)](0x1388,parseInt(_0x33ba40[_0x28cbea(0x156)][_0x28cbea(0x1b9)],0xa)||animationDelay));_0xc28b6c[_0x28cbea(0x1b9)]=_0x3685b5,_0x659bae[_0x28cbea(0x1b9)]=_0x3685b5,setAnimationDelay(_0x3685b5);});canvas[_0x1af669(0x12a)]=handleMouseDown,canvas[_0x1af669(0x18d)]=handleMouseMove,canvas[_0x1af669(0x136)]=handleMouseUp,canvas[_0x1af669(0x17b)]=handleMouseUp,canvas[_0x1af669(0x15d)]=handleTouchStart,canvas[_0x1af669(0x134)]=handleTouchMove,canvas[_0x1af669(0x19d)]=handleTouchEnd,canvas[_0x1af669(0x1b3)]=handleTouchEnd,canvas[_0x1af669(0x1a7)](_0x1af669(0x19c),handleTouchStart,{'passive':![]}),canvas['addEventListener']('touchmove',handleTouchMove,{'passive':![]}),canvas['addEventListener']('touchend',handleTouchEnd,{'passive':![]}),canvas[_0x1af669(0x1a7)](_0x1af669(0x180),handleTouchEnd,{'passive':![]});try{showLoading(_0x1af669(0x148));}catch(_0x4bfa9a){}loadProjectFromIDB()[_0x1af669(0x1af)](_0x2068dd=>{const _0x2c2fa4=_0x1af669;console['warn'](_0x2c2fa4(0x142),_0x2068dd);})[_0x1af669(0x177)](()=>{const _0x21f6a8=_0x1af669;try{hideLoading();}catch(_0x47e263){}if(typeof window['startAutoSaveInterval']===_0x21f6a8(0x145))window['startAutoSaveInterval']();});};function handleMouseDown(_0x246c7f){const _0x297b01=_0x2f6fab;if(currentTool===_0x297b01(0x196)){isDrawing=!![],panStart={'x':_0x246c7f[_0x297b01(0x170)],'y':_0x246c7f[_0x297b01(0x13b)],'posX':posX,'posY':posY},canvas[_0x297b01(0x17f)][_0x297b01(0x151)]=_0x297b01(0x194);return;}isDrawing=!![],saveHistory();const _0x30daf5=getCanvasCoords(_0x246c7f),_0x37d29b=Math[_0x297b01(0x140)](_0x30daf5['x']/cellSize),_0xa12ded=Math['floor'](_0x30daf5['y']/cellSize);currentTool===_0x297b01(0x127)?(fillAt(_0x37d29b,_0xa12ded),saveHistory(),isDrawing=![],lastMouse=null):(drawDotXY(_0x37d29b,_0xa12ded),lastMouse={'x':_0x37d29b,'y':_0xa12ded});}function handleMouseMove(_0x15151c){const _0x410c66=_0x2f6fab;if(!isDrawing)return;if(currentTool===_0x410c66(0x196)&&panStart){const _0x25f551=_0x15151c['clientX']-panStart['x'],_0x5cff71=_0x15151c[_0x410c66(0x13b)]-panStart['y'];posX=panStart[_0x410c66(0x14d)]+_0x25f551,posY=panStart[_0x410c66(0x186)]+_0x5cff71,updateTransform();return;}const _0x39be62=getCanvasCoords(_0x15151c),_0xed7f8b=Math[_0x410c66(0x140)](_0x39be62['x']/cellSize),_0xc07119=Math[_0x410c66(0x140)](_0x39be62['y']/cellSize);if(!lastMouse){drawDotXY(_0xed7f8b,_0xc07119),lastMouse={'x':_0xed7f8b,'y':_0xc07119};return;}const _0x19893d=_0xed7f8b-lastMouse['x'],_0x1386a5=_0xc07119-lastMouse['y'],_0x527066=Math['max'](Math['abs'](_0x19893d),Math['abs'](_0x1386a5));if(_0x527066<=0x1)drawDotXY(_0xed7f8b,_0xc07119);else for(let _0x2092c6=0x1;_0x2092c6<=_0x527066;_0x2092c6++){const _0x4c2c33=Math[_0x410c66(0x15f)](lastMouse['x']+_0x19893d*_0x2092c6/_0x527066),_0x125c01=Math['round'](lastMouse['y']+_0x1386a5*_0x2092c6/_0x527066);drawDotXY(_0x4c2c33,_0x125c01);}lastMouse={'x':_0xed7f8b,'y':_0xc07119};}function handleMouseUp(_0x1e50d4){const _0x5ce51b=_0x2f6fab;if(currentTool===_0x5ce51b(0x196)){isDrawing=![],panStart=null,canvas['style'][_0x5ce51b(0x151)]=_0x5ce51b(0x1ba);return;}isDrawing&&saveHistory(),isDrawing=![],lastMouse=null;}function handleTouchStart(_0x20b741){const _0x55f298=_0x2f6fab;if(_0x20b741[_0x55f298(0x165)]['length']===0x2){_0x20b741['preventDefault'](),isPinching=!![],isDrawing=![],lastTouch=null;const _0x21e431=_0x20b741[_0x55f298(0x165)][0x0],_0x391383=_0x20b741['touches'][0x1];pinchStartDistance=Math[_0x55f298(0x126)](_0x391383[_0x55f298(0x170)]-_0x21e431[_0x55f298(0x170)],_0x391383[_0x55f298(0x13b)]-_0x21e431[_0x55f298(0x13b)]),pinchStartMid={'clientX':(_0x21e431[_0x55f298(0x170)]+_0x391383[_0x55f298(0x170)])/0x2,'clientY':(_0x21e431[_0x55f298(0x13b)]+_0x391383[_0x55f298(0x13b)])/0x2},pinchStartScale=scale,pinchStartPosX=posX,pinchStartPosY=posY,pinchRect=canvas[_0x55f298(0x1ae)]();}else{if(_0x20b741[_0x55f298(0x165)][_0x55f298(0x188)]===0x1){if(colorPickMode){_0x20b741[_0x55f298(0x1a3)]();const _0x567e52=_0x20b741['touches'][0x0];onCanvasColorPick({'clientX':_0x567e52[_0x55f298(0x170)],'clientY':_0x567e52[_0x55f298(0x13b)]});return;}_0x20b741[_0x55f298(0x1a3)]();if(isPinching)return;const _0x389134=_0x20b741[_0x55f298(0x165)][0x0];if(currentTool==='pan'){isDrawing=!![],panStart={'x':_0x389134[_0x55f298(0x170)],'y':_0x389134[_0x55f298(0x13b)],'posX':posX,'posY':posY};if(canvas)canvas['style'][_0x55f298(0x151)]=_0x55f298(0x194);return;}isDrawing=!![],saveHistory();let _0x442103=getTouchPos(_0x20b741);lastTouch=_0x442103,currentTool===_0x55f298(0x127)?(fillAt(_0x442103['x'],_0x442103['y']),saveHistory(),isDrawing=![]):drawDotTouch(_0x442103['x'],_0x442103['y']);}}}function handleTouchMove(_0x1607fe){const _0x273d1a=_0x2f6fab;if(!_0x1607fe)return;if(isPinching||_0x1607fe[_0x273d1a(0x165)]&&_0x1607fe[_0x273d1a(0x165)][_0x273d1a(0x188)]===0x2){_0x1607fe[_0x273d1a(0x1a3)](),isDrawing=![],lastTouch=null;const _0x52f475=_0x1607fe['touches'][0x0],_0x52cec4=_0x1607fe[_0x273d1a(0x165)][0x1],_0x3b9d9e=Math[_0x273d1a(0x126)](_0x52cec4[_0x273d1a(0x170)]-_0x52f475[_0x273d1a(0x170)],_0x52cec4[_0x273d1a(0x13b)]-_0x52f475['clientY']),_0x12416b={'clientX':(_0x52f475[_0x273d1a(0x170)]+_0x52cec4[_0x273d1a(0x170)])/0x2,'clientY':(_0x52f475[_0x273d1a(0x13b)]+_0x52cec4[_0x273d1a(0x13b)])/0x2};if(!pinchStartDistance)pinchStartDistance=_0x3b9d9e||0x1;let _0x93ab4a=_0x3b9d9e/pinchStartDistance||0x1,_0x1ac309=pinchStartScale*_0x93ab4a;_0x1ac309=Math[_0x273d1a(0x1a9)](Math[_0x273d1a(0x11c)](_0x1ac309,0.2),0x5);const _0x48b522=pinchRect||canvas[_0x273d1a(0x1ae)](),_0x4b4a3e=(pinchStartMid['clientX']-_0x48b522[_0x273d1a(0x168)]-pinchStartPosX)/pinchStartScale,_0x18ac29=(pinchStartMid['clientY']-_0x48b522[_0x273d1a(0x175)]-pinchStartPosY)/pinchStartScale;posX=_0x12416b['clientX']-_0x48b522[_0x273d1a(0x168)]-_0x4b4a3e*_0x1ac309,posY=_0x12416b[_0x273d1a(0x13b)]-_0x48b522['top']-_0x18ac29*_0x1ac309,scale=_0x1ac309,updateTransform();return;}if(currentTool===_0x273d1a(0x196)&&panStart&&_0x1607fe[_0x273d1a(0x165)]&&_0x1607fe[_0x273d1a(0x165)][0x0]){_0x1607fe['preventDefault']();const _0x33cdd7=_0x1607fe[_0x273d1a(0x165)][0x0],_0x21ecb8=_0x33cdd7['clientX']-panStart['x'],_0x216f08=_0x33cdd7['clientY']-panStart['y'];posX=panStart[_0x273d1a(0x14d)]+_0x21ecb8,posY=panStart['posY']+_0x216f08,updateTransform();return;}if(!isDrawing)return;if(_0x1607fe[_0x273d1a(0x165)]&&_0x1607fe[_0x273d1a(0x165)][_0x273d1a(0x188)]>0x1)return;_0x1607fe[_0x273d1a(0x1a3)]();const _0x40f865=getTouchPos(_0x1607fe);if(!_0x40f865)return;if(lastTouch){const _0x459f1f=Math[_0x273d1a(0x163)]((_0x40f865['x']-lastTouch['x'])*cellSize),_0x782e0f=Math[_0x273d1a(0x163)]((_0x40f865['y']-lastTouch['y'])*cellSize);if(_0x459f1f>=PAN_CANCEL_DISTANCE||_0x782e0f>=PAN_CANCEL_DISTANCE){if(currentTool!==_0x273d1a(0x1a8)){isDrawing=![];return;}}}if(lastTouch){const _0x3d5cdf=_0x40f865['x']-lastTouch['x'],_0x511e5e=_0x40f865['y']-lastTouch['y'],_0x33269c=Math['max'](Math['abs'](_0x3d5cdf),Math[_0x273d1a(0x163)](_0x511e5e));for(let _0x33d888=0x1;_0x33d888<=_0x33269c;_0x33d888++){const _0x4d8159=Math[_0x273d1a(0x15f)](lastTouch['x']+_0x3d5cdf*_0x33d888/_0x33269c),_0x46d048=Math[_0x273d1a(0x15f)](lastTouch['y']+_0x511e5e*_0x33d888/_0x33269c);drawDotTouch(_0x4d8159,_0x46d048);}}else drawDotTouch(_0x40f865['x'],_0x40f865['y']);lastTouch=_0x40f865;}function handleTouchEnd(_0x5891e1){const _0x11d9a5=_0x2f6fab;isPinching&&_0x5891e1[_0x11d9a5(0x165)]&&_0x5891e1[_0x11d9a5(0x165)][_0x11d9a5(0x188)]<0x2&&(isPinching=![],pinchStartDistance=0x0,pinchStartMid=null,pinchRect=null);isDrawing&&(!_0x5891e1[_0x11d9a5(0x165)]||_0x5891e1['touches'][_0x11d9a5(0x188)]===0x0)&&saveHistory();if(_0x5891e1[_0x11d9a5(0x165)]&&_0x5891e1[_0x11d9a5(0x165)][_0x11d9a5(0x188)]===0x1){let _0x3749f6=_0x5891e1[_0x11d9a5(0x165)][0x0];lastTouch=getTouchPos({'touches':[_0x3749f6]}),isDrawing=!![];if(currentTool===_0x11d9a5(0x196)){panStart={'x':_0x3749f6['clientX'],'y':_0x3749f6[_0x11d9a5(0x13b)],'posX':posX,'posY':posY};if(canvas)canvas[_0x11d9a5(0x17f)][_0x11d9a5(0x151)]=_0x11d9a5(0x194);}}else{isDrawing=![],lastTouch=null;if(currentTool===_0x11d9a5(0x196)){panStart=null;if(canvas)canvas[_0x11d9a5(0x17f)][_0x11d9a5(0x151)]='grab';}}}function onCanvasColorPick(_0x57a790){const _0x2c360f=_0x2f6fab;try{const _0x5856c4=getCanvasCoords(_0x57a790),_0x4596f8=Math[_0x2c360f(0x140)](_0x5856c4['x']),_0x4872a6=Math[_0x2c360f(0x140)](_0x5856c4['y']),_0x7938da=ctx[_0x2c360f(0x161)](_0x4596f8,_0x4872a6,0x1,0x1)[_0x2c360f(0x14b)],_0x13213c=_0x7938da[0x0],_0x5e2d6c=_0x7938da[0x1],_0x158561=_0x7938da[0x2],_0x21b579=_0x7938da[0x3];if(_0x21b579===0x0){currentColor='transparent';const _0x27d97d=document[_0x2c360f(0x1b2)](_0x2c360f(0x14a));if(_0x27d97d)_0x27d97d[_0x2c360f(0x1b9)]='#000000';console[_0x2c360f(0x181)](_0x2c360f(0x128));}else{const _0x1794b8='#'+[_0x13213c,_0x5e2d6c,_0x158561]['map'](_0x26d353=>_0x26d353[_0x2c360f(0x16e)](0x10)['padStart'](0x2,'0'))[_0x2c360f(0x189)]('');currentColor=_0x1794b8;const _0x59faa1=document[_0x2c360f(0x1b2)](_0x2c360f(0x14a));if(_0x59faa1)_0x59faa1[_0x2c360f(0x1b9)]=_0x1794b8;console[_0x2c360f(0x181)](_0x2c360f(0x19b),_0x1794b8);}}catch(_0x2bf471){console[_0x2c360f(0x122)](_0x2c360f(0x1b5),_0x2bf471);}colorPickMode=![];if(canvas)canvas[_0x2c360f(0x17f)][_0x2c360f(0x151)]=_0x2c360f(0x146);}