(function(_0x40f639,_0x4c5576){const _0x8386dc=_0x4dd7,_0xaf3dec=_0x40f639();while(!![]){try{const _0x3fb03e=-parseInt(_0x8386dc(0x172))/0x1+parseInt(_0x8386dc(0x150))/0x2*(parseInt(_0x8386dc(0x157))/0x3)+-parseInt(_0x8386dc(0x17c))/0x4*(-parseInt(_0x8386dc(0x186))/0x5)+parseInt(_0x8386dc(0x178))/0x6*(-parseInt(_0x8386dc(0x14f))/0x7)+parseInt(_0x8386dc(0x153))/0x8+-parseInt(_0x8386dc(0x17e))/0x9+-parseInt(_0x8386dc(0x17a))/0xa;if(_0x3fb03e===_0x4c5576)break;else _0xaf3dec['push'](_0xaf3dec['shift']());}catch(_0x226a59){_0xaf3dec['push'](_0xaf3dec['shift']());}}}(_0x37f3,0xb3228));const _0x57aab3=(function(){let _0x4ee5b1=!![];return function(_0x2c925b,_0x1e2e48){const _0x227cfb=_0x4ee5b1?function(){if(_0x1e2e48){const _0x229eb6=_0x1e2e48['apply'](_0x2c925b,arguments);return _0x1e2e48=null,_0x229eb6;}}:function(){};return _0x4ee5b1=![],_0x227cfb;};}()),_0x5a1407=_0x57aab3(this,function(){const _0x499038=_0x4dd7;return _0x5a1407[_0x499038(0x160)]()[_0x499038(0x16f)]('(((.+)+)+)+$')[_0x499038(0x160)]()[_0x499038(0x15e)](_0x5a1407)['search'](_0x499038(0x162));});_0x5a1407();function saveHistory(){const _0x114e18=_0x4dd7;let _0x5bf55f=getCurrentFrame();if(!_0x5bf55f)return;if(!Array[_0x114e18(0x164)](_0x5bf55f[_0x114e18(0x169)]))_0x5bf55f[_0x114e18(0x169)]=[];if(!Array[_0x114e18(0x164)](_0x5bf55f['layerRedoStacks']))_0x5bf55f['layerRedoStacks']=[];const _0xf413a3=typeof _0x5bf55f[_0x114e18(0x181)]===_0x114e18(0x180)?_0x5bf55f['activeLayer']:-0x1;if(_0xf413a3<0x0)return;if(!_0x5bf55f[_0x114e18(0x169)][_0xf413a3])_0x5bf55f[_0x114e18(0x169)][_0xf413a3]=[];if(!_0x5bf55f[_0x114e18(0x16e)][_0xf413a3])_0x5bf55f[_0x114e18(0x16e)][_0xf413a3]=[];const _0x11478f=_0x5bf55f['layers']&&_0x5bf55f[_0x114e18(0x18a)][_0xf413a3]?_0x5bf55f[_0x114e18(0x18a)][_0xf413a3]:null,_0x559c8e=_0x11478f&&_0x11478f['canvas']?_0x11478f[_0x114e18(0x163)]:_0x11478f;if(!_0x559c8e||typeof _0x559c8e[_0x114e18(0x15f)]!==_0x114e18(0x167))return;try{_0x5bf55f[_0x114e18(0x169)][_0xf413a3][_0x114e18(0x17b)](_0x559c8e[_0x114e18(0x15f)]());if(_0x5bf55f['layerHistories'][_0xf413a3]['length']>0x32)_0x5bf55f[_0x114e18(0x169)][_0xf413a3]['shift']();_0x5bf55f[_0x114e18(0x16e)][_0xf413a3]=[];try{if(typeof updateUndoRedoButtons===_0x114e18(0x167))updateUndoRedoButtons();}catch(_0x388ed1){}if(typeof window[_0x114e18(0x171)]===_0x114e18(0x167))window['requestAutoSave']();}catch(_0x5c6a92){console['error'](_0x114e18(0x185),_0x5c6a92);}}async function idbSet(_0xa9474b,_0x3f24f5){const _0x53e91c=await openDB();return new Promise((_0x2a068f,_0x41f9ae)=>{const _0x142bc7=_0x4dd7,_0x2891f9=_0x53e91c[_0x142bc7(0x183)](storeName,_0x142bc7(0x18b));_0x2891f9[_0x142bc7(0x174)](storeName)[_0x142bc7(0x16d)](_0x3f24f5,_0xa9474b),_0x2891f9[_0x142bc7(0x17f)]=()=>_0x2a068f(),_0x2891f9[_0x142bc7(0x179)]=()=>_0x41f9ae(_0x2891f9[_0x142bc7(0x15d)]);});}async function idbGet(_0x51586c){const _0x1901d9=await openDB();return new Promise((_0x1016e1,_0x1625f5)=>{const _0x182450=_0x4dd7,_0x3b6234=_0x1901d9['transaction'](storeName,_0x182450(0x15c)),_0x5d1c77=_0x3b6234[_0x182450(0x174)](storeName)[_0x182450(0x16c)](_0x51586c);_0x5d1c77[_0x182450(0x154)]=()=>_0x1016e1(_0x5d1c77['result']),_0x5d1c77[_0x182450(0x179)]=()=>_0x1625f5(_0x5d1c77[_0x182450(0x15d)]);});}function _0x4dd7(_0x355ef9,_0x4d7d14){_0x355ef9=_0x355ef9-0x14e;const _0x271bb0=_0x37f3();let _0x5a1407=_0x271bb0[_0x355ef9];return _0x5a1407;}function _0x37f3(){const _0x298e30=['oncomplete','number','activeLayer','map','transaction','画像ファイルを読み込み中...','saveHistory\x20error','1889855OwRMQi','height','src','project','layers','readwrite','string','crossOrigin','7NvUmaX','298LZJoGO','all','保存エラー','7285776yFavIN','onsuccess','clearRect','メタデータが見つかりませんでした','19146nwKQLn','result','target','createElement','getContext','readonly','error','constructor','toDataURL','toString','length','(((.+)+)+)+$','canvas','isArray','includes','onload','function','frames','layerHistories','width','nezumi-palette','get','put','layerRedoStacks','search','clear','requestAutoSave','389860vbAtcX','delete','objectStore','読込エラー','name','slice','938082XzxOUC','onerror','10071010cIgpsD','push','8TJsaHB','forEach','2974842xlFnaG'];_0x37f3=function(){return _0x298e30;};return _0x37f3();}async function idbDelete(_0x59a362){const _0x1c9035=await openDB();return new Promise((_0x2cdaa7,_0x40034b)=>{const _0x59d32b=_0x4dd7,_0x1ff482=_0x1c9035['transaction'](storeName,_0x59d32b(0x18b));_0x1ff482[_0x59d32b(0x174)](storeName)[_0x59d32b(0x173)](_0x59a362),_0x1ff482['oncomplete']=()=>_0x2cdaa7(),_0x1ff482[_0x59d32b(0x179)]=()=>_0x40034b(_0x1ff482[_0x59d32b(0x15d)]);});}async function idbClear(){const _0x4d1e24=await openDB();return new Promise((_0x119050,_0x331995)=>{const _0x1484a9=_0x4dd7,_0x559286=_0x4d1e24[_0x1484a9(0x183)](storeName,_0x1484a9(0x18b));_0x559286[_0x1484a9(0x174)](storeName)[_0x1484a9(0x170)](),_0x559286[_0x1484a9(0x17f)]=()=>_0x119050(),_0x559286[_0x1484a9(0x179)]=()=>_0x331995(_0x559286[_0x1484a9(0x15d)]);});}async function savePaletteToDB(){const _0x504b1d=_0x4dd7;try{await idbSet(_0x504b1d(0x16b),PALETTE_COLORS);}catch(_0x1b4f44){console[_0x504b1d(0x15d)](_0x504b1d(0x152),_0x1b4f44);}}async function loadPaletteFromDB(){const _0x299048=_0x4dd7;try{const _0x4c4904=await idbGet(_0x299048(0x16b));if(Array[_0x299048(0x164)](_0x4c4904)&&_0x4c4904['length']){const _0x3dda66=[];_0x4c4904[_0x299048(0x17d)](_0x223d03=>{const _0x4cada7=_0x299048;if(typeof _0x223d03===_0x4cada7(0x18c)&&!_0x3dda66[_0x4cada7(0x165)](_0x223d03))_0x3dda66['push'](_0x223d03);});for(const _0x3b59b6 of typeof DEFAULT_PALETTE!=='undefined'?DEFAULT_PALETTE:[]){if(!_0x3dda66[_0x299048(0x165)](_0x3b59b6))_0x3dda66['push'](_0x3b59b6);}PALETTE_COLORS=_0x3dda66[_0x299048(0x177)](0x0,0x18);}}catch(_0x5d9d25){console[_0x299048(0x15d)](_0x299048(0x175),_0x5d9d25);}}async function loadImages(_0x28c1f2){const _0x3196d6=_0x4dd7,_0x524fba=await Promise[_0x3196d6(0x151)](_0x28c1f2[_0x3196d6(0x182)](_0x47a411=>{return new Promise(_0x11bab5=>{const _0x5f533a=_0x4dd7,_0x44df52=new Image();_0x44df52[_0x5f533a(0x14e)]='anonymous',_0x44df52[_0x5f533a(0x188)]=_0x47a411,_0x44df52[_0x5f533a(0x166)]=()=>_0x11bab5(_0x44df52);});}));return _0x524fba;}function loadStandaloneFromFile(_0x59371f){return new Promise((_0x10380d,_0x3e1ea1)=>{const _0x1badbf=_0x4dd7;try{showLoading(_0x1badbf(0x184));}catch(_0x329604){}const _0xe0a7d0=new FileReader();_0xe0a7d0[_0x1badbf(0x166)]=_0xb62ddd=>{const _0x28ddc1=_0x1badbf,_0x29203b=_0xb62ddd[_0x28ddc1(0x159)][_0x28ddc1(0x158)],_0x2500e9=extractMetadataFromArrayBuffer(_0x29203b);if(!_0x2500e9||!_0x2500e9['project']){try{hideLoading();}catch(_0x439fd9){}_0x3e1ea1(new Error(_0x28ddc1(0x156)));return;}const _0x25f1c5=_0x2500e9[_0x28ddc1(0x189)];try{const _0x1eae56=createProject(_0x25f1c5['width'],_0x25f1c5[_0x28ddc1(0x187)],_0x25f1c5[_0x28ddc1(0x176)]||'画像');_0x1eae56[_0x28ddc1(0x168)]=_0x25f1c5['frames'][_0x28ddc1(0x182)](_0x370b11=>{const _0x26da05=_0x28ddc1;let _0x23a8f6={'layers':[],'activeLayer':_0x370b11[_0x26da05(0x181)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x5b1153=0x0;_0x5b1153<_0x370b11[_0x26da05(0x18a)][_0x26da05(0x161)];_0x5b1153++){let _0x44b61a=new Image();_0x44b61a[_0x26da05(0x188)]=_0x370b11['layers'][_0x5b1153];let _0x56a278=document[_0x26da05(0x15a)](_0x26da05(0x163));_0x56a278['width']=_0x25f1c5['width']*cellSize,_0x56a278[_0x26da05(0x187)]=_0x25f1c5['height']*cellSize,_0x44b61a[_0x26da05(0x166)]=()=>{const _0x5cb6a6=_0x26da05;let _0x21c6e2=_0x56a278[_0x5cb6a6(0x15b)]('2d');_0x21c6e2[_0x5cb6a6(0x155)](0x0,0x0,_0x56a278[_0x5cb6a6(0x16a)],_0x56a278['height']),_0x21c6e2['drawImage'](_0x44b61a,0x0,0x0);try{redrawAll();}catch(_0x13a08f){}},_0x23a8f6[_0x26da05(0x18a)]['push'](_0x56a278);}return _0x23a8f6;}),projects['push'](_0x1eae56),activeProject=projects[_0x28ddc1(0x161)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0x350f00){}_0x10380d(_0x1eae56);}catch(_0x19af93){try{hideLoading();}catch(_0x1dad85){}_0x3e1ea1(_0x19af93);}},_0xe0a7d0[_0x1badbf(0x179)]=_0x1c5066=>{try{hideLoading();}catch(_0xc55c17){};_0x3e1ea1(_0x1c5066);},_0xe0a7d0['readAsArrayBuffer'](_0x59371f);});}