const _0x171766=_0x57eb;(function(_0x57e3ee,_0x402df7){const _0x563ffc=_0x57eb,_0x1235eb=_0x57e3ee();while(!![]){try{const _0x4c9991=-parseInt(_0x563ffc(0x181))/0x1*(parseInt(_0x563ffc(0x1a2))/0x2)+parseInt(_0x563ffc(0x1f6))/0x3+parseInt(_0x563ffc(0x19c))/0x4+parseInt(_0x563ffc(0x194))/0x5+parseInt(_0x563ffc(0x190))/0x6+parseInt(_0x563ffc(0x18d))/0x7*(parseInt(_0x563ffc(0x219))/0x8)+parseInt(_0x563ffc(0x1bb))/0x9*(-parseInt(_0x563ffc(0x19a))/0xa);if(_0x4c9991===_0x402df7)break;else _0x1235eb['push'](_0x1235eb['shift']());}catch(_0x44f898){_0x1235eb['push'](_0x1235eb['shift']());}}}(_0x3d9f,0x65bff));const _0x2c514e=(function(){let _0x25f4b4=!![];return function(_0x38b33d,_0x4e471e){const _0x4f494d=_0x25f4b4?function(){const _0x2683ec=_0x57eb;if(_0x4e471e){const _0x35c73f=_0x4e471e[_0x2683ec(0x1c9)](_0x38b33d,arguments);return _0x4e471e=null,_0x35c73f;}}:function(){};return _0x25f4b4=![],_0x4f494d;};}()),_0x274b5d=_0x2c514e(this,function(){const _0x100aea=_0x57eb;return _0x274b5d[_0x100aea(0x21e)]()['search'](_0x100aea(0x1c2))['toString']()['constructor'](_0x274b5d)[_0x100aea(0x1fa)](_0x100aea(0x1c2));});_0x274b5d();function createProject(_0x37594d=0x10,_0x3c7bf0=0x10,_0x29861f=''){const _0x358d14=_0x57eb;let _0x5f0d7b=0x14,_0x3c07ee=[],_0x166d2a=[],_0x287b52=[],_0x4239c2=document['createElement']('canvas');_0x4239c2['width']=_0x37594d*_0x5f0d7b,_0x4239c2['height']=_0x3c7bf0*_0x5f0d7b,_0x3c07ee[_0x358d14(0x1fb)]({'canvas':_0x4239c2,'visible':!![],'name':_0x358d14(0x1e4)}),_0x166d2a[_0x358d14(0x1fb)]([]),_0x287b52[_0x358d14(0x1fb)]([]);let _0x25aba6={'layers':_0x3c07ee,'activeLayer':0x0,'layerHistories':_0x166d2a,'layerRedoStacks':_0x287b52};return{'frames':[_0x25aba6],'activeFrame':0x0,'width':_0x37594d,'height':_0x3c7bf0,'name':_0x29861f||'画像'+(projects[_0x358d14(0x17d)]+0x1)};}function editProjectName(_0x43a180,_0x2195a0){const _0x4bfc35=_0x57eb,_0x49855c=document[_0x4bfc35(0x1fc)]('input');_0x49855c[_0x4bfc35(0x1ef)]=_0x4bfc35(0x1ed),_0x49855c[_0x4bfc35(0x185)]=projects[_0x43a180][_0x4bfc35(0x1ba)]||'画像'+(_0x43a180+0x1),_0x49855c[_0x4bfc35(0x1bd)]=_0x4bfc35(0x1b1),_0x49855c[_0x4bfc35(0x1de)][_0x4bfc35(0x17f)]=_0x4bfc35(0x1a4),_0x49855c[_0x4bfc35(0x1e1)]=()=>{const _0x30b28e=_0x4bfc35;projects[_0x43a180][_0x30b28e(0x1ba)]=_0x49855c[_0x30b28e(0x185)][_0x30b28e(0x17b)]()||'画像'+(_0x43a180+0x1),updateProjectUI();},_0x49855c[_0x4bfc35(0x178)]=_0x181b9e=>{const _0x4d90ee=_0x4bfc35;if(_0x181b9e[_0x4d90ee(0x211)]===_0x4d90ee(0x1eb))_0x49855c[_0x4d90ee(0x1b9)]();},_0x2195a0[_0x4bfc35(0x213)](_0x49855c),_0x49855c[_0x4bfc35(0x195)](),_0x49855c[_0x4bfc35(0x1b3)]();}function _0x57eb(_0x1aec05,_0x444bf6){_0x1aec05=_0x1aec05-0x178;const _0x23842f=_0x3d9f();let _0x274b5d=_0x23842f[_0x1aec05];return _0x274b5d;}function addProject(){showNewProjectDialog((_0x4a9f46,_0x561441,_0x54c346)=>{const _0x4f593d=_0x57eb;if(!Number[_0x4f593d(0x209)](_0x4a9f46)||_0x4a9f46<0x1)_0x4a9f46=0x10;if(!Number[_0x4f593d(0x209)](_0x561441)||_0x561441<0x1)_0x561441=0x10;projects[_0x4f593d(0x1fb)](createProject(_0x4a9f46,_0x561441,_0x54c346)),activeProject=projects[_0x4f593d(0x17d)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();if(typeof setExportInputsFromProject===_0x4f593d(0x1f2))setExportInputsFromProject();if(typeof requestAutoSave===_0x4f593d(0x1f2))requestAutoSave();});}function removeProjectAt(_0x2fd8cf){const _0x36605d=_0x57eb;if(projects[_0x36605d(0x17d)]<=0x1)return;const _0x55424a=projects[_0x2fd8cf]&&projects[_0x2fd8cf][_0x36605d(0x1ba)]?projects[_0x2fd8cf][_0x36605d(0x1ba)]:'画像'+(_0x2fd8cf+0x1);if(!confirm('「'+_0x55424a+_0x36605d(0x1c4)))return;projects['splice'](_0x2fd8cf,0x1);if(activeProject>=projects[_0x36605d(0x17d)])activeProject=projects['length']-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();if(typeof setExportInputsFromProject===_0x36605d(0x1f2))setExportInputsFromProject();if(typeof requestAutoSave===_0x36605d(0x1f2))requestAutoSave();}function getCurrentProject(){return projects[activeProject];}function addFrame(){const _0x40257d=_0x57eb,_0x41374d=getCurrentProject(),_0xd4029f=_0x41374d[_0x40257d(0x212)][_0x41374d[_0x40257d(0x1fd)]],_0x403d1e=_0x9891d5=>{const _0x437e93=_0x40257d,_0x215b0b=_0x9891d5&&_0x9891d5[_0x437e93(0x193)]?_0x9891d5['canvas']:_0x9891d5;if(!_0x215b0b)return console['warn'](_0x437e93(0x1be),_0x9891d5),null;const _0x61a4f3=document[_0x437e93(0x1fc)](_0x437e93(0x193));_0x61a4f3[_0x437e93(0x17f)]=_0x215b0b[_0x437e93(0x17f)]||_0x41374d['width']*cellSize,_0x61a4f3['height']=_0x215b0b[_0x437e93(0x20e)]||_0x41374d[_0x437e93(0x20e)]*cellSize;const _0x15eac4=_0x61a4f3[_0x437e93(0x1f7)]('2d');try{_0x15eac4['drawImage'](_0x215b0b,0x0,0x0);}catch(_0x5d2537){console[_0x437e93(0x192)](_0x437e93(0x1a7),_0x5d2537);}return{'canvas':_0x61a4f3,'visible':_0x9891d5&&typeof _0x9891d5[_0x437e93(0x210)]!=='undefined'?_0x9891d5[_0x437e93(0x210)]:!![],'name':_0x9891d5&&_0x9891d5[_0x437e93(0x1ba)]?_0x9891d5[_0x437e93(0x1ba)]:undefined};},_0x1160bb=_0xd4029f[_0x40257d(0x1d4)][_0x40257d(0x18f)](_0x403d1e),_0x2de8cc=_0x1160bb[_0x40257d(0x18f)](()=>[]),_0x14bf9a=_0x1160bb[_0x40257d(0x18f)](()=>[]),_0x5667ca={'layers':_0x1160bb,'activeLayer':0x0,'layerHistories':_0x2de8cc,'layerRedoStacks':_0x14bf9a};_0x41374d[_0x40257d(0x212)][_0x40257d(0x1e7)](_0x41374d[_0x40257d(0x1fd)]+0x1,0x0,_0x5667ca),_0x41374d[_0x40257d(0x1fd)]++,updateFrameUI(),updateLayerUI(),redrawAll();}const cloneLayer=_0x1b289e=>{const _0x5bf680=_0x57eb,_0x67e646=_0x1b289e&&_0x1b289e[_0x5bf680(0x193)]?_0x1b289e[_0x5bf680(0x193)]:_0x1b289e;if(!_0x67e646)return console[_0x5bf680(0x192)](_0x5bf680(0x1be),_0x1b289e),null;const _0x2acf2b=document[_0x5bf680(0x1fc)](_0x5bf680(0x193));_0x2acf2b['width']=_0x67e646[_0x5bf680(0x17f)],_0x2acf2b[_0x5bf680(0x20e)]=_0x67e646[_0x5bf680(0x20e)];const _0x436f2c=_0x2acf2b[_0x5bf680(0x1f7)]('2d');try{_0x436f2c[_0x5bf680(0x18a)](_0x67e646,0x0,0x0);}catch(_0x331580){console['warn'](_0x5bf680(0x1a7),_0x331580);}return{'canvas':_0x2acf2b,'visible':_0x1b289e&&typeof _0x1b289e[_0x5bf680(0x210)]!==_0x5bf680(0x17c)?_0x1b289e[_0x5bf680(0x210)]:!![],'name':_0x1b289e&&_0x1b289e[_0x5bf680(0x1ba)]?_0x1b289e[_0x5bf680(0x1ba)]:undefined};};function removeFrameAt(_0x1ea055){const _0x2bd94e=_0x57eb;let _0x136126=getCurrentProject();if(_0x136126[_0x2bd94e(0x212)][_0x2bd94e(0x17d)]<=0x1)return;_0x136126[_0x2bd94e(0x212)]['splice'](_0x1ea055,0x1);if(_0x136126[_0x2bd94e(0x1fd)]>=_0x136126[_0x2bd94e(0x212)][_0x2bd94e(0x17d)])_0x136126[_0x2bd94e(0x1fd)]=_0x136126[_0x2bd94e(0x212)][_0x2bd94e(0x17d)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0x1997cb=_0x57eb,_0x257638=getCurrentProject();if(!_0x257638||!_0x257638[_0x1997cb(0x212)]||typeof _0x257638[_0x1997cb(0x1fd)]!=='number'||!_0x257638[_0x1997cb(0x212)][_0x257638['activeFrame']])return null;return _0x257638[_0x1997cb(0x212)][_0x257638[_0x1997cb(0x1fd)]];}function swapLayer(_0x1a3f25,_0xaf2972){const _0xa9b7f3=_0x57eb;let _0x28a975=getCurrentFrame();[_0x28a975[_0xa9b7f3(0x1d4)][_0x1a3f25],_0x28a975['layers'][_0xaf2972]]=[_0x28a975[_0xa9b7f3(0x1d4)][_0xaf2972],_0x28a975[_0xa9b7f3(0x1d4)][_0x1a3f25]],[_0x28a975[_0xa9b7f3(0x1d7)][_0x1a3f25],_0x28a975['layerHistories'][_0xaf2972]]=[_0x28a975[_0xa9b7f3(0x1d7)][_0xaf2972],_0x28a975[_0xa9b7f3(0x1d7)][_0x1a3f25]],[_0x28a975[_0xa9b7f3(0x1ca)][_0x1a3f25],_0x28a975['layerRedoStacks'][_0xaf2972]]=[_0x28a975[_0xa9b7f3(0x1ca)][_0xaf2972],_0x28a975[_0xa9b7f3(0x1ca)][_0x1a3f25]];if(_0x28a975[_0xa9b7f3(0x20c)]===_0x1a3f25)_0x28a975[_0xa9b7f3(0x20c)]=_0xaf2972;else{if(_0x28a975[_0xa9b7f3(0x20c)]===_0xaf2972)_0x28a975[_0xa9b7f3(0x20c)]=_0x1a3f25;}updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0xa9b7f3(0x1f2))requestAutoSave();}function removeLayerAt(_0x245d03){const _0x2912ef=_0x57eb;let _0x8d0a2d=getCurrentFrame();if(_0x8d0a2d['layers'][_0x2912ef(0x17d)]<=0x1)return;_0x8d0a2d[_0x2912ef(0x1d4)][_0x2912ef(0x1e7)](_0x245d03,0x1),_0x8d0a2d['layerHistories'][_0x2912ef(0x1e7)](_0x245d03,0x1),_0x8d0a2d[_0x2912ef(0x1ca)]['splice'](_0x245d03,0x1);if(_0x8d0a2d[_0x2912ef(0x20c)]>=_0x8d0a2d['layers'][_0x2912ef(0x17d)])_0x8d0a2d[_0x2912ef(0x20c)]=_0x8d0a2d['layers']['length']-0x1;updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x2912ef(0x1f2))requestAutoSave();}function addLayer(){const _0x212997=_0x57eb;let _0x48f652=getCurrentProject(),_0x4c5a28=getCurrentFrame(),_0x2fca2a=document[_0x212997(0x1fc)](_0x212997(0x193));_0x2fca2a[_0x212997(0x17f)]=_0x48f652['width']*cellSize,_0x2fca2a[_0x212997(0x20e)]=_0x48f652[_0x212997(0x20e)]*cellSize;const _0x24689b=_0x212997(0x1c1)+(_0x4c5a28['layers'][_0x212997(0x17d)]+0x1);_0x4c5a28[_0x212997(0x1d4)]['push']({'canvas':_0x2fca2a,'visible':!![],'name':_0x24689b}),_0x4c5a28['layerHistories']['push']([]),_0x4c5a28[_0x212997(0x1ca)][_0x212997(0x1fb)]([]),_0x4c5a28['activeLayer']=_0x4c5a28[_0x212997(0x1d4)][_0x212997(0x17d)]-0x1;if(typeof requestAutoSave==='function')requestAutoSave();saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0x423525=_0x57eb;let _0x56ad25=getCurrentFrame();if(_0x56ad25['layers'][_0x423525(0x17d)]<=0x1)return;_0x56ad25[_0x423525(0x1d4)]['splice'](_0x56ad25[_0x423525(0x20c)],0x1),_0x56ad25['layerHistories'][_0x423525(0x1e7)](_0x56ad25[_0x423525(0x20c)],0x1),_0x56ad25[_0x423525(0x1ca)][_0x423525(0x1e7)](_0x56ad25[_0x423525(0x20c)],0x1),_0x56ad25[_0x423525(0x20c)]=Math['max'](0x0,_0x56ad25[_0x423525(0x20c)]-0x1),updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x423525(0x1f2))requestAutoSave();}function duplicateLayerAt(_0x188e0d){const _0x49e75a=_0x57eb,_0x3cc811=getCurrentProject(),_0x56ab40=getCurrentFrame();if(!_0x3cc811||!_0x56ab40||typeof _0x188e0d!==_0x49e75a(0x216)||!_0x56ab40[_0x49e75a(0x1d4)][_0x188e0d])return;const _0x58582d=_0x56ab40['layers'][_0x188e0d],_0x442455=_0x58582d&&_0x58582d[_0x49e75a(0x193)]?_0x58582d[_0x49e75a(0x193)]:_0x58582d;if(!_0x442455)return;const _0x340c1d=document['createElement']('canvas');_0x340c1d[_0x49e75a(0x17f)]=_0x3cc811[_0x49e75a(0x17f)]*cellSize,_0x340c1d[_0x49e75a(0x20e)]=_0x3cc811[_0x49e75a(0x20e)]*cellSize;const _0xca25e2=_0x340c1d[_0x49e75a(0x1f7)]('2d');_0xca25e2[_0x49e75a(0x1dc)](0x0,0x0,_0x340c1d['width'],_0x340c1d[_0x49e75a(0x20e)]);try{_0xca25e2['drawImage'](_0x442455,0x0,0x0);}catch(_0x327b10){console[_0x49e75a(0x192)]('duplicateLayerAt\x20draw\x20error',_0x327b10);}const _0x1a1a53=_0x188e0d+0x1,_0x99246b=_0x58582d&&_0x58582d[_0x49e75a(0x1ba)]?_0x58582d[_0x49e75a(0x1ba)]:_0x49e75a(0x1c1)+(_0x188e0d+0x1);_0x56ab40['layers'][_0x49e75a(0x1e7)](_0x1a1a53,0x0,{'canvas':_0x340c1d,'visible':!![],'name':_0x99246b+_0x49e75a(0x1e0)});if(Array['isArray'](_0x56ab40[_0x49e75a(0x1d7)]))_0x56ab40[_0x49e75a(0x1d7)]['splice'](_0x1a1a53,0x0,[]);if(Array[_0x49e75a(0x1f3)](_0x56ab40[_0x49e75a(0x1ca)]))_0x56ab40[_0x49e75a(0x1ca)][_0x49e75a(0x1e7)](_0x1a1a53,0x0,[]);_0x56ab40['activeLayer']=_0x1a1a53,saveHistory(),updateLayerUI(),redrawAll();if(typeof requestAutoSave===_0x49e75a(0x1f2))requestAutoSave();}function selectLayer(_0x540bbf){const _0xdce316=_0x57eb;getCurrentFrame()[_0xdce316(0x20c)]=parseInt(_0x540bbf),updateLayerUI();}function copyLayer(){const _0x38f6c0=_0x57eb,_0x2495a5=getCurrentFrame();if(!_0x2495a5)return;const _0x3a1a5d=_0x2495a5[_0x38f6c0(0x20c)];if(typeof _0x3a1a5d!==_0x38f6c0(0x216)||!_0x2495a5[_0x38f6c0(0x1d4)][_0x3a1a5d])return;const _0x12e243=_0x2495a5[_0x38f6c0(0x1d4)][_0x3a1a5d],_0x20a434=_0x12e243&&_0x12e243[_0x38f6c0(0x193)]?_0x12e243[_0x38f6c0(0x193)]:_0x12e243;if(!_0x20a434||typeof _0x20a434['toDataURL']!==_0x38f6c0(0x1f2))return;copiedLayerDataUrl=_0x20a434[_0x38f6c0(0x1bc)]();try{copiedLayerName=_0x12e243&&_0x12e243[_0x38f6c0(0x1ba)]?_0x12e243[_0x38f6c0(0x1ba)]:null;}catch(_0x34aa4f){copiedLayerName=null;}const _0x1d9c13=document[_0x38f6c0(0x202)](_0x38f6c0(0x1cf));if(_0x1d9c13)_0x1d9c13['disabled']=![];}function pasteLayer(){const _0xdc6929=_0x57eb;if(!copiedLayerDataUrl)return;const _0x4199ce=getCurrentProject(),_0x4dd829=getCurrentFrame();if(!_0x4199ce||!_0x4dd829)return;const _0x57a916=document['createElement'](_0xdc6929(0x193));_0x57a916[_0xdc6929(0x17f)]=_0x4199ce[_0xdc6929(0x17f)]*cellSize,_0x57a916[_0xdc6929(0x20e)]=_0x4199ce[_0xdc6929(0x20e)]*cellSize;const _0x4f34ea=_0x57a916[_0xdc6929(0x1f7)]('2d'),_0x5ec268=new Image();_0x5ec268[_0xdc6929(0x201)]=()=>{const _0x10636a=_0xdc6929;_0x4f34ea[_0x10636a(0x1dc)](0x0,0x0,_0x57a916[_0x10636a(0x17f)],_0x57a916[_0x10636a(0x20e)]),_0x4f34ea[_0x10636a(0x18a)](_0x5ec268,0x0,0x0);const _0x42138e=copiedLayerName||_0x10636a(0x1c1)+(_0x4dd829[_0x10636a(0x1d4)][_0x10636a(0x17d)]+0x1);_0x4dd829['layers'][_0x10636a(0x1fb)]({'canvas':_0x57a916,'visible':!![],'name':_0x42138e}),_0x4dd829['layerHistories'][_0x10636a(0x1fb)]([]),_0x4dd829['layerRedoStacks'][_0x10636a(0x1fb)]([]),_0x4dd829[_0x10636a(0x20c)]=_0x4dd829[_0x10636a(0x1d4)]['length']-0x1,saveHistory(),updateLayerUI(),redrawAll();},_0x5ec268['src']=copiedLayerDataUrl;}async function exportLayersAsGif(){const _0xe5d81e=_0x57eb,_0x423c8a=document[_0xe5d81e(0x202)](_0xe5d81e(0x1e9));if(_0x423c8a)_0x423c8a[_0xe5d81e(0x1b4)]='処理中...';const _0x3e9974=getCurrentProject();if(!_0x3e9974){if(_0x423c8a)_0x423c8a[_0xe5d81e(0x1b4)]='';return;}const _0x36a8b3=_0x3e9974[_0xe5d81e(0x212)],_0x3ceeda=_0x3e9974[_0xe5d81e(0x17f)]*cellSize,_0x2aafef=_0x3e9974[_0xe5d81e(0x20e)]*cellSize;let _0x4e2c9d=0x0;_0x36a8b3['forEach'](_0x443e9f=>{const _0x49c4c3=_0xe5d81e;_0x4e2c9d=Math['max'](_0x4e2c9d,_0x443e9f[_0x49c4c3(0x1d4)][_0x49c4c3(0x17d)]);});for(let _0x41eafd=0x0;_0x41eafd<_0x4e2c9d;_0x41eafd++){const _0x3d6066=await Promise[_0xe5d81e(0x1ad)](_0x36a8b3[_0xe5d81e(0x18f)](_0x259074=>{return new Promise(_0x371af8=>{const _0x4a7d9b=_0x57eb,_0x290967=document[_0x4a7d9b(0x1fc)](_0x4a7d9b(0x193));_0x290967[_0x4a7d9b(0x17f)]=_0x3ceeda,_0x290967[_0x4a7d9b(0x20e)]=_0x2aafef;const _0x4c5da9=_0x290967['getContext']('2d'),_0x385076=_0x259074['layers'][_0x41eafd]&&_0x259074['layers'][_0x41eafd]['canvas']?_0x259074[_0x4a7d9b(0x1d4)][_0x41eafd]['canvas']:_0x259074[_0x4a7d9b(0x1d4)][_0x41eafd];if(_0x385076)_0x4c5da9['drawImage'](_0x385076,0x0,0x0);const _0x5330b5=new Image();_0x5330b5['onload']=()=>_0x371af8(_0x5330b5),_0x5330b5[_0x4a7d9b(0x1d5)]=_0x290967[_0x4a7d9b(0x1bc)]('image/png');});})),_0x171bf5=_0x3d6066['some'](_0x1e0d49=>{const _0x5b1fc3=_0xe5d81e,_0x336fa3=document[_0x5b1fc3(0x1fc)]('canvas');_0x336fa3['width']=_0x3ceeda,_0x336fa3[_0x5b1fc3(0x20e)]=_0x2aafef;const _0x454558=_0x336fa3[_0x5b1fc3(0x1f7)]('2d');_0x454558[_0x5b1fc3(0x18a)](_0x1e0d49,0x0,0x0);const _0x3f9b43=_0x454558[_0x5b1fc3(0x1a1)](0x0,0x0,_0x3ceeda,_0x2aafef)[_0x5b1fc3(0x1c5)];for(let _0x257deb=0x3;_0x257deb<_0x3f9b43['length'];_0x257deb+=0x4)if(_0x3f9b43[_0x257deb]!==0x0)return!![];return![];});if(!_0x171bf5)continue;const _0x220221=(_0x3e9974[_0xe5d81e(0x1ba)]||_0xe5d81e(0x1a0))[_0xe5d81e(0x1cd)](/[\\/:*?"<>|]/g,'_')+('-layer'+(_0x41eafd+0x1)+_0xe5d81e(0x217)),_0x3ccdcf={'type':_0xe5d81e(0x1d3),'version':0x1,'project':{'width':_0x3e9974[_0xe5d81e(0x17f)],'height':_0x3e9974['height'],'name':_0x3e9974[_0xe5d81e(0x1ba)]||'','animationDelay':animationDelay,'frames':_0x3e9974[_0xe5d81e(0x212)][_0xe5d81e(0x18f)](_0xa28c27=>({'layers':_0xa28c27[_0xe5d81e(0x1d4)][_0xe5d81e(0x18f)](_0x17f181=>_0x17f181&&_0x17f181[_0xe5d81e(0x1ba)]?_0x17f181[_0xe5d81e(0x1ba)]:'')})),'frames':_0x3e9974['frames']['map'](_0x5bd0a6=>({'layers':_0x5bd0a6[_0xe5d81e(0x1d4)][_0xe5d81e(0x18f)](_0x3df950=>_0x3df950&&_0x3df950[_0xe5d81e(0x1ba)]?_0x3df950[_0xe5d81e(0x1ba)]:'')}))}};convertToGIF(_0x3d6066,animationDelay,_0x220221,0xa,_0x3ccdcf),await new Promise(_0x1c5682=>setTimeout(_0x1c5682,0x78));}if(_0x423c8a)_0x423c8a[_0xe5d81e(0x1b4)]='';}async function exportLayersAsApng(){const _0x1b42cb=_0x57eb,_0x1da1b8=document['getElementById']('layerExportStatus');if(_0x1da1b8)_0x1da1b8[_0x1b42cb(0x1b4)]=_0x1b42cb(0x179);const _0x12cc5b=getCurrentProject();if(!_0x12cc5b){if(_0x1da1b8)_0x1da1b8[_0x1b42cb(0x1b4)]='';return;}const _0x31b1c5=_0x12cc5b[_0x1b42cb(0x212)],_0x5409ad=_0x12cc5b[_0x1b42cb(0x17f)]*cellSize,_0x246beb=_0x12cc5b['height']*cellSize;let _0x6a3918=0x0;_0x31b1c5[_0x1b42cb(0x1bf)](_0x1d3957=>{const _0xdc3c7b=_0x1b42cb;_0x6a3918=Math[_0xdc3c7b(0x1ae)](_0x6a3918,_0x1d3957[_0xdc3c7b(0x1d4)][_0xdc3c7b(0x17d)]);});for(let _0x1f8945=0x0;_0x1f8945<_0x6a3918;_0x1f8945++){const _0x255f55=await Promise[_0x1b42cb(0x1ad)](_0x31b1c5[_0x1b42cb(0x18f)](_0x454cb7=>{return new Promise(_0x7f2dbc=>{const _0x134bb0=_0x57eb,_0x138924=document[_0x134bb0(0x1fc)](_0x134bb0(0x193));_0x138924[_0x134bb0(0x17f)]=_0x5409ad,_0x138924['height']=_0x246beb;const _0x522f8f=_0x138924[_0x134bb0(0x1f7)]('2d'),_0x4b9632=_0x454cb7[_0x134bb0(0x1d4)][_0x1f8945]&&_0x454cb7[_0x134bb0(0x1d4)][_0x1f8945]['canvas']?_0x454cb7[_0x134bb0(0x1d4)][_0x1f8945][_0x134bb0(0x193)]:_0x454cb7[_0x134bb0(0x1d4)][_0x1f8945];if(_0x4b9632)_0x522f8f['drawImage'](_0x4b9632,0x0,0x0);const _0x47abc1=new Image();_0x47abc1['onload']=()=>_0x7f2dbc(_0x47abc1),_0x47abc1[_0x134bb0(0x1d5)]=_0x138924[_0x134bb0(0x1bc)]('image/png');});})),_0x582195=_0x255f55['some'](_0x5e3610=>{const _0x235c6c=_0x1b42cb,_0x337a4f=document[_0x235c6c(0x1fc)](_0x235c6c(0x193));_0x337a4f[_0x235c6c(0x17f)]=_0x5409ad,_0x337a4f[_0x235c6c(0x20e)]=_0x246beb;const _0x450502=_0x337a4f[_0x235c6c(0x1f7)]('2d');_0x450502[_0x235c6c(0x18a)](_0x5e3610,0x0,0x0);const _0x32d865=_0x450502[_0x235c6c(0x1a1)](0x0,0x0,_0x5409ad,_0x246beb)['data'];for(let _0x3990be=0x3;_0x3990be<_0x32d865[_0x235c6c(0x17d)];_0x3990be+=0x4)if(_0x32d865[_0x3990be]!==0x0)return!![];return![];});if(!_0x582195)continue;const _0x158dfb=(_0x12cc5b[_0x1b42cb(0x1ba)]||'nezumi-animation')[_0x1b42cb(0x1cd)](/[\\/:*?"<>|]/g,'_')+(_0x1b42cb(0x1f4)+(_0x1f8945+0x1)+_0x1b42cb(0x1a6)),_0x1e1ee1={'type':_0x1b42cb(0x1d3),'version':0x1,'project':{'width':_0x12cc5b[_0x1b42cb(0x17f)],'height':_0x12cc5b[_0x1b42cb(0x20e)],'name':_0x12cc5b[_0x1b42cb(0x1ba)]||'','animationDelay':animationDelay,'frames':_0x12cc5b[_0x1b42cb(0x212)][_0x1b42cb(0x18f)](_0x2a3f98=>({'layers':_0x2a3f98[_0x1b42cb(0x1d4)][_0x1b42cb(0x18f)](_0x33e03a=>_0x33e03a&&_0x33e03a[_0x1b42cb(0x1ba)]?_0x33e03a[_0x1b42cb(0x1ba)]:'')}))}};convertToAPNG(_0x255f55,_0x5409ad,_0x246beb,animationDelay,_0x158dfb,0x0,_0x1e1ee1),await new Promise(_0x20cb7c=>setTimeout(_0x20cb7c,0x78));}if(_0x1da1b8)_0x1da1b8[_0x1b42cb(0x1b4)]='';}async function exportFramesLayersZip(){const _0x31df09=_0x57eb,_0x5623e5=document[_0x31df09(0x202)](_0x31df09(0x1e9));if(_0x5623e5)_0x5623e5['textContent']=_0x31df09(0x17a);const _0xe0ee12=getCurrentProject();if(!_0xe0ee12){if(_0x5623e5)_0x5623e5[_0x31df09(0x1b4)]='';return;}const _0x2de8a0=_0xe0ee12[_0x31df09(0x212)],_0x37514f=_0xe0ee12[_0x31df09(0x17f)]*cellSize,_0x4b5339=_0xe0ee12['height']*cellSize,_0x317eb7=new JSZip();for(let _0x178814=0x0;_0x178814<_0x2de8a0[_0x31df09(0x17d)];_0x178814++){const _0x41861c=_0x2de8a0[_0x178814],_0x1de927=_0x317eb7[_0x31df09(0x1b6)](_0x31df09(0x1f0)+(_0x178814+0x1));for(let _0x96c122=0x0;_0x96c122<_0x41861c['layers'][_0x31df09(0x17d)];_0x96c122++){const _0x5d5fe2=document[_0x31df09(0x1fc)](_0x31df09(0x193));_0x5d5fe2[_0x31df09(0x17f)]=_0x37514f,_0x5d5fe2[_0x31df09(0x20e)]=_0x4b5339;const _0x431663=_0x5d5fe2[_0x31df09(0x1f7)]('2d');_0x431663[_0x31df09(0x1dc)](0x0,0x0,_0x37514f,_0x4b5339);const _0x10ed4c=_0x41861c['layers'][_0x96c122];if(_0x10ed4c){const _0x5e8fcc=_0x10ed4c[_0x31df09(0x193)]?_0x10ed4c[_0x31df09(0x193)]:_0x10ed4c;if(_0x5e8fcc)_0x431663[_0x31df09(0x18a)](_0x5e8fcc,0x0,0x0);}const _0x362d90=_0x5d5fe2[_0x31df09(0x1bc)]('image/png'),_0x3214d3=_0x362d90[_0x31df09(0x1d2)](',')[0x1],_0x3c9419=atob(_0x3214d3),_0x15c529=new Uint8Array(_0x3c9419[_0x31df09(0x17d)]);for(let _0x31c554=0x0;_0x31c554<_0x3c9419[_0x31df09(0x17d)];_0x31c554++)_0x15c529[_0x31c554]=_0x3c9419[_0x31df09(0x1cc)](_0x31c554);_0x1de927[_0x31df09(0x1cb)](_0x31df09(0x1a9)+(_0x96c122+0x1)+_0x31df09(0x189),_0x15c529);}}const _0x88875a=await _0x317eb7['generateAsync']({'type':_0x31df09(0x1c8)}),_0x4c53a2=(_0xe0ee12[_0x31df09(0x1ba)]||_0x31df09(0x1d3))['replace'](/[\\/:*?"<>|]/g,'_'),_0x1c00e2=document['createElement']('a');_0x1c00e2[_0x31df09(0x207)]=URL[_0x31df09(0x21b)](_0x88875a),_0x1c00e2[_0x31df09(0x1e5)]=_0x4c53a2+_0x31df09(0x1d8),document['body']['appendChild'](_0x1c00e2),_0x1c00e2[_0x31df09(0x20d)](),setTimeout(()=>{const _0x557fd3=_0x31df09;URL[_0x557fd3(0x1ff)](_0x1c00e2['href']),document[_0x557fd3(0x1af)][_0x557fd3(0x17e)](_0x1c00e2);if(_0x5623e5)_0x5623e5[_0x557fd3(0x1b4)]='';},0x4b0);}function saveProjectFile(){const _0x591dda=_0x57eb,_0x33cfb2=typeof getSavePayload==='function'?getSavePayload():{'projects':projects[_0x591dda(0x18f)](_0x44288c=>({'width':_0x44288c[_0x591dda(0x17f)],'height':_0x44288c['height'],'name':_0x44288c['name']||'','activeFrame':_0x44288c['activeFrame'],'frames':_0x44288c[_0x591dda(0x212)][_0x591dda(0x18f)](_0x4bb4d6=>({'activeLayer':_0x4bb4d6[_0x591dda(0x20c)],'layers':_0x4bb4d6['layers'][_0x591dda(0x18f)](_0x4ab815=>_0x4ab815&&_0x4ab815[_0x591dda(0x193)]?_0x4ab815['canvas']['toDataURL']():_0x4ab815&&_0x4ab815['toDataURL']?_0x4ab815['toDataURL']():null)}))})),'activeProject':activeProject},_0x16c078=new Blob([JSON['stringify'](_0x33cfb2)],{'type':_0x591dda(0x1f9)}),_0x38c746=document[_0x591dda(0x1fc)]('a');_0x38c746[_0x591dda(0x1e5)]='nezumi-sketch.msketch',_0x38c746[_0x591dda(0x207)]=URL['createObjectURL'](_0x16c078),_0x38c746[_0x591dda(0x20d)]();}function getSavePayload(){const _0x23fbc2=_0x57eb;return{'projects':projects[_0x23fbc2(0x18f)](_0x1af35d=>({'width':_0x1af35d[_0x23fbc2(0x17f)],'height':_0x1af35d[_0x23fbc2(0x20e)],'name':_0x1af35d[_0x23fbc2(0x1ba)]||'','activeFrame':_0x1af35d[_0x23fbc2(0x1fd)],'frames':_0x1af35d[_0x23fbc2(0x212)][_0x23fbc2(0x18f)](_0x27f479=>({'activeLayer':_0x27f479[_0x23fbc2(0x20c)],'layers':_0x27f479[_0x23fbc2(0x1d4)][_0x23fbc2(0x18f)](_0x2251bd=>{const _0x193660=_0x23fbc2,_0x4def2e=_0x2251bd&&_0x2251bd['canvas']?_0x2251bd['canvas']['toDataURL']():_0x2251bd&&_0x2251bd[_0x193660(0x1bc)]?_0x2251bd['toDataURL']():null;return{'data':_0x4def2e,'name':_0x2251bd&&_0x2251bd[_0x193660(0x1ba)]?_0x2251bd[_0x193660(0x1ba)]:''};})}))})),'activeProject':activeProject,'animationDelay':animationDelay};}let _lastSavedAt=0x0;function setAutosaveStatus(_0xbda1d7,_0x4d8caa){const _0x54ef6f=_0x57eb,_0xcab205=document['getElementById'](_0x54ef6f(0x1e6)),_0x5979b5=document['getElementById'](_0x54ef6f(0x198)),_0x217c18=document[_0x54ef6f(0x202)]('autosaveText');if(!_0xcab205||!_0x5979b5||!_0x217c18)return;_0xcab205[_0x54ef6f(0x1bd)]=_0x54ef6f(0x1ea)+_0xbda1d7;let _0x4261e4=_0x54ef6f(0x1f8);switch(_0xbda1d7){case _0x54ef6f(0x214):_0x4261e4=_0x54ef6f(0x1b8),_0x217c18[_0x54ef6f(0x1b4)]=_0x4d8caa||_0x54ef6f(0x1aa);break;case'scheduled':_0x4261e4=_0x54ef6f(0x1c6),_0x217c18[_0x54ef6f(0x1b4)]=_0x4d8caa||'保存予定';break;case _0x54ef6f(0x19f):_0x4261e4=_0x54ef6f(0x1f1),_0x217c18[_0x54ef6f(0x1b4)]=_0x4d8caa||_0x54ef6f(0x1c0);break;case'failed':_0x4261e4=_0x54ef6f(0x20f),_0x217c18['textContent']=_0x4d8caa||_0x54ef6f(0x21c);break;default:_0x4261e4='check_circle';const _0x1d77e9=_lastSavedAt?new Date(_lastSavedAt)['toLocaleTimeString']():_0x54ef6f(0x18e);_0x217c18[_0x54ef6f(0x1b4)]=_0x4d8caa||_0x54ef6f(0x21a)+_0x1d77e9;}_0x5979b5['textContent']=_0x4261e4;}function _0x3d9f(){const _0x4f5cc4=['offsetCells','manualSaveBtn','value','catch','startsWith','stringify','.png','drawImage','保存に失敗したチュー:','floor','137697OWuKLR','保存済み','map','293160JmSKal','flushQuickSaveToLocalStorage:\x20saved\x20quick\x20snapshot','warn','canvas','3229405SBsyoj','focus','requestAutoSave:\x20timer\x20fired','nudgeActiveLayer:\x20対象レイヤーのキャンバスが見つかりません','autosaveIcon','parse','80FfZkPx','image','3151212hOiGxv','auto-save\x20(interval)\x20failed','setItem','dirty','nezumi-animation','getImageData','4HRNyXq','then','80px','info','.apng','cloneLayer\x20draw\x20error','hidden','layer-','保存中…','target','projects','all','max','body','IndexedDBからプロジェクトを読み込んだチュー！','project-name-edit','startCell','select','textContent','failed','folder','log','autorenew','blur','name','1319769MXyEdp','toDataURL','className','複製できないレイヤーがありますチュー','forEach','変更あり','レイヤー','(((.+)+)+)+$','ファイルの読み込みに失敗しました。','」を削除しますか？','data','schedule','nezumi-sketch-save','blob','apply','layerRedoStacks','file','charCodeAt','replace','files','pasteLayerBtn','object','flushQuickSaveToLocalStorage\x20failed','split','nezumi-export','layers','src','requestAutoSave','layerHistories','-frames-layers.zip','IndexedDBからの読み込みに失敗したチュー…','pen','requestAutoSave:\x20scheduling\x20save\x20in\x20','clearRect','nezumi-sketch-save-quick','style','animSpeedValue','\x20(複製)','onblur','idle','activeProject','レイヤー1','download','autosaveIndicator','splice','ファイルにプロジェクトメタデータが見つかりませんでした。読み込みできません。','layerExportStatus','autosave-status\x20','Enter','animationDelay','text','now','type','frame-','edit','function','isArray','-layer','auto-save:\x20saved','114381krIQWV','getContext','check_circle','application/json','search','push','createElement','activeFrame','loadProjectFromIDB:\x20データ確認','revokeObjectURL','string','onload','getElementById','getItem','active','スタンドアロン形式のプロジェクトを読み込みました:\x20','beforeunload','href','animSpeedRange','isFinite','addEventListener','手動保存に失敗しました。コンソールを確認してください。','activeLayer','click','height','error','visible','key','frames','replaceWith','saving','debug','number','.gif','disabled','272ELVLVx','最終保存:\x20','createObjectURL','保存失敗','visibilitychange','toString','onkeydown','処理中...','ZIP作成中...','trim','undefined','length','removeChild','width','onerror','299795Algzuj','loadProjectFromIDB:\x20localStorage\x20のクイック保存を復元します'];_0x3d9f=function(){return _0x4f5cc4;};return _0x3d9f();}async function saveProjectToIDB(){const _0xa587c3=_0x57eb,_0x28e7b2=getSavePayload();try{setAutosaveStatus(_0xa587c3(0x214)),await idbSet(_0xa587c3(0x1c7),_0x28e7b2),_lastSavedAt=Date[_0xa587c3(0x1ee)](),setAutosaveStatus(_0xa587c3(0x1e2)),console[_0xa587c3(0x1b7)]('プロジェクトをIndexedDBに保存したチュー！');}catch(_0xed47e1){setAutosaveStatus(_0xa587c3(0x1b5)),console[_0xa587c3(0x20f)](_0xa587c3(0x18b),_0xed47e1);throw _0xed47e1;}}async function manualSave(){const _0x28362b=_0x57eb,_0x1218c7=document[_0x28362b(0x202)](_0x28362b(0x184));if(_0x1218c7)_0x1218c7[_0x28362b(0x218)]=!![];try{await saveProjectToIDB();}catch(_0x53cb91){alert(_0x28362b(0x20b));}finally{if(_0x1218c7)_0x1218c7['disabled']=![];}}function flushQuickSaveToLocalStorage(){const _0x570af3=_0x57eb;try{const _0x68a0d0=getSavePayload();localStorage[_0x570af3(0x19e)](_0x570af3(0x1dd),JSON[_0x570af3(0x188)](_0x68a0d0)),console[_0x570af3(0x215)](_0x570af3(0x191));}catch(_0x5b1393){console[_0x570af3(0x20f)](_0x570af3(0x1d1),_0x5b1393);}}window[_0x171766(0x20a)](_0x171766(0x21d),()=>{const _0x557764=_0x171766;if(document[_0x557764(0x1a8)]&&autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x557764(0x1f2))saveProjectToIDB();}}),window[_0x171766(0x20a)](_0x171766(0x206),()=>{if(autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB==='function')saveProjectToIDB();}});let autosaveDirty=![],autosaveTimer=null;const AUTOSAVE_DELAY=0x1388,AUTOSAVE_INTERVAL=0xea60;function requestAutoSave(){const _0x4ae34c=_0x171766;autosaveDirty=!![];if(autosaveTimer)clearTimeout(autosaveTimer);console[_0x4ae34c(0x215)](_0x4ae34c(0x1db)+AUTOSAVE_DELAY+'ms');if(typeof setAutosaveStatus===_0x4ae34c(0x1f2))setAutosaveStatus('scheduled');autosaveTimer=setTimeout(async()=>{const _0x1b0af8=_0x4ae34c;console[_0x1b0af8(0x215)](_0x1b0af8(0x196));if(!autosaveDirty)return;try{if(typeof setAutosaveStatus===_0x1b0af8(0x1f2))setAutosaveStatus(_0x1b0af8(0x214));await saveProjectToIDB(),autosaveDirty=![],console[_0x1b0af8(0x1b7)](_0x1b0af8(0x1f5));}catch(_0x2722ef){console[_0x1b0af8(0x20f)]('auto-save\x20failed',_0x2722ef);if(typeof setAutosaveStatus===_0x1b0af8(0x1f2))setAutosaveStatus(_0x1b0af8(0x1b5));}},AUTOSAVE_DELAY);}function startAutoSaveInterval(){const _0x37f6d4=_0x171766;console[_0x37f6d4(0x215)]('startAutoSaveInterval:\x20starting\x20interval\x20'+AUTOSAVE_INTERVAL+'ms'),setInterval(async()=>{const _0x231b81=_0x37f6d4;if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x231b81(0x1b7)]('auto-save\x20(interval):\x20saved');}catch(_0x2890bb){console['error'](_0x231b81(0x19d),_0x2890bb);}},AUTOSAVE_INTERVAL);}window[_0x171766(0x1d6)]=requestAutoSave,window['startAutoSaveInterval']=startAutoSaveInterval;function loadProjectFile(_0x3347a9){const _0xe3dad0=_0x171766,_0x572feb=_0x3347a9[_0xe3dad0(0x1ab)][_0xe3dad0(0x1ce)][0x0];if(!_0x572feb)return;if(_0x572feb['type']&&_0x572feb[_0xe3dad0(0x1ef)][_0xe3dad0(0x187)](_0xe3dad0(0x19b))){loadStandaloneFromFile(_0x572feb)[_0xe3dad0(0x1a3)](_0x2690ac=>{const _0x34da40=_0xe3dad0;alert(_0x34da40(0x205)+(_0x2690ac[_0x34da40(0x1ba)]||'画像'));})[_0xe3dad0(0x186)](_0x229378=>{const _0x24f9c8=_0xe3dad0;console[_0x24f9c8(0x192)](_0x229378),alert(_0x24f9c8(0x1e8));});return;}const _0x4d2d2e=new FileReader();try{showLoading('ファイルを読み込み中...');}catch(_0x4c8c3b){}_0x4d2d2e['onload']=function(_0x38b768){const _0x3c7219=_0xe3dad0;try{const _0x584412=JSON['parse'](_0x38b768['target']['result']);projects=_0x584412[_0x3c7219(0x1ac)][_0x3c7219(0x18f)]((_0x34461f,_0x321cef)=>{const _0x56f208=_0x3c7219;let _0x4765f3=createProject(_0x34461f[_0x56f208(0x17f)],_0x34461f[_0x56f208(0x20e)],_0x34461f[_0x56f208(0x1ba)]||'画像'+(_0x321cef+0x1));return _0x4765f3[_0x56f208(0x212)]=_0x34461f[_0x56f208(0x212)][_0x56f208(0x18f)](_0x2073eb=>{const _0x12410c=_0x56f208;let _0x25cc46={'layers':[],'activeLayer':_0x2073eb['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x399d24=0x0;_0x399d24<_0x2073eb[_0x12410c(0x1d4)][_0x12410c(0x17d)];_0x399d24++){const _0x53acf9=_0x2073eb[_0x12410c(0x1d4)][_0x399d24];let _0xff738e=null,_0x1f01c4='';if(typeof _0x53acf9===_0x12410c(0x200))_0xff738e=_0x53acf9;else _0x53acf9&&typeof _0x53acf9===_0x12410c(0x1d0)&&(_0xff738e=_0x53acf9['data']||_0x53acf9['src']||null,_0x1f01c4=_0x53acf9['name']||'');let _0x3b2269=new Image();_0x3b2269[_0x12410c(0x1d5)]=_0xff738e;let _0x83e39f=document[_0x12410c(0x1fc)](_0x12410c(0x193));_0x83e39f[_0x12410c(0x17f)]=_0x34461f[_0x12410c(0x17f)]*cellSize,_0x83e39f[_0x12410c(0x20e)]=_0x34461f[_0x12410c(0x20e)]*cellSize,_0x3b2269[_0x12410c(0x201)]=()=>{const _0x7d1022=_0x12410c;let _0x28a52d=_0x83e39f[_0x7d1022(0x1f7)]('2d');_0x28a52d['clearRect'](0x0,0x0,_0x83e39f['width'],_0x83e39f['height']),_0x28a52d[_0x7d1022(0x18a)](_0x3b2269,0x0,0x0);try{redrawAll();}catch(_0x5f1333){}},_0x25cc46[_0x12410c(0x1d4)]['push']({'canvas':_0x83e39f,'visible':!![],'name':_0x1f01c4}),_0x25cc46[_0x12410c(0x1d7)][_0x12410c(0x1fb)]([]),_0x25cc46[_0x12410c(0x1ca)][_0x12410c(0x1fb)]([]);}return _0x25cc46;}),_0x4765f3['activeFrame']=_0x34461f[_0x56f208(0x1fd)],_0x4765f3[_0x56f208(0x1ba)]=_0x34461f[_0x56f208(0x1ba)]||'画像'+(_0x321cef+0x1),_0x4765f3;}),activeProject=_0x584412['activeProject']||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();if(typeof setExportInputsFromProject===_0x3c7219(0x1f2))setExportInputsFromProject();if(Number[_0x3c7219(0x209)](_0x584412[_0x3c7219(0x1ec)])){try{if(typeof setAnimationDelay===_0x3c7219(0x1f2))setAnimationDelay(_0x584412[_0x3c7219(0x1ec)]);}catch(_0x5a5a80){}const _0xb94d0a=document[_0x3c7219(0x202)](_0x3c7219(0x208)),_0x10dfe9=document[_0x3c7219(0x202)](_0x3c7219(0x1df));if(_0xb94d0a)_0xb94d0a[_0x3c7219(0x185)]=_0x584412[_0x3c7219(0x1ec)];if(_0x10dfe9)_0x10dfe9[_0x3c7219(0x185)]=_0x584412[_0x3c7219(0x1ec)];}try{_lastSavedAt=Date[_0x3c7219(0x1ee)]();if(typeof setAutosaveStatus==='function')setAutosaveStatus(_0x3c7219(0x1e2));}catch(_0x32f594){}}catch(_0x4764b0){alert(_0x3c7219(0x1c3));}finally{try{hideLoading();}catch(_0x2f5764){}}},_0x4d2d2e[_0xe3dad0(0x180)]=function(){try{hideLoading();}catch(_0x5e0159){}},_0x4d2d2e['readAsText'](_0x572feb);}async function loadProjectFromIDB(){const _0x34fdf0=_0x171766;try{let _0x44f44d=await idbGet(_0x34fdf0(0x1c7));if(!_0x44f44d){console[_0x34fdf0(0x1a5)]('loadProjectFromIDB:\x20DB\x20に保存が見つかりませんでした。localStorage\x20のクイック保存を確認します。');try{const _0x2af7d2=localStorage[_0x34fdf0(0x203)]('nezumi-sketch-save-quick');if(_0x2af7d2){const _0x33d7f2=JSON[_0x34fdf0(0x199)](_0x2af7d2);_0x33d7f2&&_0x33d7f2['projects']&&(console[_0x34fdf0(0x1a5)](_0x34fdf0(0x182)),_0x44f44d=_0x33d7f2);}}catch(_0x3d2dc8){console[_0x34fdf0(0x192)]('loadProjectFromIDB:\x20localStorage\x20quick\x20load\x20failed',_0x3d2dc8);}if(!_0x44f44d){if(typeof requestAutoSave===_0x34fdf0(0x1f2))requestAutoSave();return;}}console[_0x34fdf0(0x1b7)](_0x34fdf0(0x1fe),{'projects':Array[_0x34fdf0(0x1f3)](_0x44f44d[_0x34fdf0(0x1ac)])?_0x44f44d[_0x34fdf0(0x1ac)][_0x34fdf0(0x17d)]:0x0,'activeProject':_0x44f44d[_0x34fdf0(0x1e3)]}),projects=_0x44f44d[_0x34fdf0(0x1ac)][_0x34fdf0(0x18f)]((_0x5c7dce,_0x136be5)=>{const _0x3f1b83=_0x34fdf0;let _0x38d6c7=createProject(_0x5c7dce[_0x3f1b83(0x17f)],_0x5c7dce['height'],_0x5c7dce[_0x3f1b83(0x1ba)]||'画像'+(_0x136be5+0x1));return _0x38d6c7[_0x3f1b83(0x212)]=_0x5c7dce[_0x3f1b83(0x212)]['map'](_0x2addcc=>{const _0x40a4c6=_0x3f1b83;let _0x35db3e={'layers':[],'activeLayer':_0x2addcc[_0x40a4c6(0x20c)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x472c99=0x0;_0x472c99<_0x2addcc[_0x40a4c6(0x1d4)][_0x40a4c6(0x17d)];_0x472c99++){const _0x3dfad0=_0x2addcc['layers'][_0x472c99];let _0x4d8094=null,_0x225d9d='';if(typeof _0x3dfad0===_0x40a4c6(0x200))_0x4d8094=_0x3dfad0;else _0x3dfad0&&typeof _0x3dfad0===_0x40a4c6(0x1d0)&&(_0x4d8094=_0x3dfad0[_0x40a4c6(0x1c5)]||_0x3dfad0[_0x40a4c6(0x1d5)]||null,_0x225d9d=_0x3dfad0[_0x40a4c6(0x1ba)]||'');let _0x56f4d2=new Image();_0x56f4d2[_0x40a4c6(0x1d5)]=_0x4d8094;let _0x1cf6fc=document[_0x40a4c6(0x1fc)]('canvas');_0x1cf6fc[_0x40a4c6(0x17f)]=_0x5c7dce[_0x40a4c6(0x17f)]*cellSize,_0x1cf6fc[_0x40a4c6(0x20e)]=_0x5c7dce[_0x40a4c6(0x20e)]*cellSize,_0x56f4d2['onload']=()=>{const _0x25759c=_0x40a4c6;let _0x104e4=_0x1cf6fc['getContext']('2d');_0x104e4[_0x25759c(0x1dc)](0x0,0x0,_0x1cf6fc[_0x25759c(0x17f)],_0x1cf6fc[_0x25759c(0x20e)]),_0x104e4[_0x25759c(0x18a)](_0x56f4d2,0x0,0x0);try{redrawAll();}catch(_0x5b25a0){}},_0x35db3e[_0x40a4c6(0x1d4)][_0x40a4c6(0x1fb)]({'canvas':_0x1cf6fc,'visible':!![],'name':_0x225d9d}),_0x35db3e['layerHistories'][_0x40a4c6(0x1fb)]([]),_0x35db3e[_0x40a4c6(0x1ca)]['push']([]);}return _0x35db3e;}),_0x38d6c7[_0x3f1b83(0x1fd)]=_0x5c7dce[_0x3f1b83(0x1fd)],_0x38d6c7[_0x3f1b83(0x1ba)]=_0x5c7dce[_0x3f1b83(0x1ba)]||'画像'+(_0x136be5+0x1),_0x38d6c7;}),activeProject=_0x44f44d[_0x34fdf0(0x1e3)]||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{if(typeof updateUndoRedoButtons===_0x34fdf0(0x1f2))updateUndoRedoButtons();}catch(_0x5bf326){}setTool(_0x34fdf0(0x1da));if(typeof setExportInputsFromProject===_0x34fdf0(0x1f2))setExportInputsFromProject();if(Number['isFinite'](_0x44f44d['animationDelay'])){try{if(typeof setAnimationDelay===_0x34fdf0(0x1f2))setAnimationDelay(_0x44f44d[_0x34fdf0(0x1ec)]);}catch(_0x5e5093){}const _0x410112=document[_0x34fdf0(0x202)](_0x34fdf0(0x208)),_0x3dcda5=document[_0x34fdf0(0x202)](_0x34fdf0(0x1df));if(_0x410112)_0x410112[_0x34fdf0(0x185)]=_0x44f44d['animationDelay'];if(_0x3dcda5)_0x3dcda5[_0x34fdf0(0x185)]=_0x44f44d['animationDelay'];}try{_lastSavedAt=Date[_0x34fdf0(0x1ee)]();if(typeof setAutosaveStatus===_0x34fdf0(0x1f2))setAutosaveStatus(_0x34fdf0(0x1e2));}catch(_0x497c47){}console[_0x34fdf0(0x1b7)](_0x34fdf0(0x1b0));}catch(_0x226050){alert(_0x34fdf0(0x1d9)),console[_0x34fdf0(0x20f)](_0x226050);}}function shiftLayerCanvas(_0x388b3b,_0x540950,_0x178f52){const _0x16a564=_0x171766;if(!_0x388b3b)return;const _0x584a56=_0x388b3b[_0x16a564(0x17f)],_0x3d20b7=_0x388b3b['height'],_0x18e24e=document['createElement']('canvas');_0x18e24e['width']=_0x584a56,_0x18e24e[_0x16a564(0x20e)]=_0x3d20b7;const _0x543743=_0x18e24e['getContext']('2d');_0x543743[_0x16a564(0x1dc)](0x0,0x0,_0x584a56,_0x3d20b7),_0x543743[_0x16a564(0x18a)](_0x388b3b,0x0,0x0);const _0x5b4e80=_0x388b3b[_0x16a564(0x1f7)]('2d');_0x5b4e80['clearRect'](0x0,0x0,_0x584a56,_0x3d20b7),_0x5b4e80[_0x16a564(0x18a)](_0x18e24e,_0x540950,_0x178f52);}function nudgeActiveLayer(_0x10ea0f,_0x513705){const _0x19c464=_0x171766,_0x4072cf=getCurrentProject();if(!_0x4072cf)return;const _0x392bf6=getCurrentFrame();if(!_0x392bf6)return;const _0x3d95f1=_0x392bf6[_0x19c464(0x20c)];if(_0x3d95f1==null)return;const _0x2e23d7=(_0x10ea0f||0x0)*cellSize,_0x4c85fc=(_0x513705||0x0)*cellSize;if(_0x2e23d7===0x0&&_0x4c85fc===0x0)return;saveHistory();const _0x16dd4f=_0x392bf6[_0x19c464(0x1d4)][_0x3d95f1],_0x46a1da=_0x16dd4f&&_0x16dd4f['canvas']?_0x16dd4f[_0x19c464(0x193)]:_0x16dd4f;_0x46a1da?(shiftLayerCanvas(_0x46a1da,_0x2e23d7,_0x4c85fc),redrawAll()):console['warn'](_0x19c464(0x197),_0x16dd4f);}function startLayerMove(_0x51ea95){const _0x4e8b61=_0x171766;layerMoveState[_0x4e8b61(0x204)]=!![];const _0x2d8f27=getCanvasCoords(_0x51ea95);layerMoveState[_0x4e8b61(0x1b2)]={'x':Math['floor'](_0x2d8f27['x']/cellSize),'y':Math[_0x4e8b61(0x18c)](_0x2d8f27['y']/cellSize)},layerMoveState[_0x4e8b61(0x183)]={'x':0x0,'y':0x0};}function endLayerMove(_0xd417f7){const _0x4ab2c9=_0x171766;if(!layerMoveState['active'])return;const _0xced531=layerMoveState[_0x4ab2c9(0x183)]['x']*cellSize,_0x3bb939=layerMoveState['offsetCells']['y']*cellSize;if(_0xced531!==0x0||_0x3bb939!==0x0){saveHistory();const _0x3bd1da=getCurrentFrame();if(_0x3bd1da&&typeof _0x3bd1da[_0x4ab2c9(0x20c)]===_0x4ab2c9(0x216)){const _0xa26219=_0x3bd1da['layers'][_0x3bd1da['activeLayer']],_0x1e79e8=_0xa26219&&_0xa26219[_0x4ab2c9(0x193)]?_0xa26219['canvas']:_0xa26219;if(_0x1e79e8)shiftLayerCanvas(_0x1e79e8,_0xced531,_0x3bb939);}}layerMoveState[_0x4ab2c9(0x204)]=![],layerMoveState['startCell']=null,layerMoveState[_0x4ab2c9(0x183)]={'x':0x0,'y':0x0},redrawAll();}