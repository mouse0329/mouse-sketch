const _0x2f2ee5=_0x250a;(function(_0xb03530,_0x109208){const _0x5be35a=_0x250a,_0x307407=_0xb03530();while(!![]){try{const _0x4f9e81=parseInt(_0x5be35a(0xe1))/0x1+parseInt(_0x5be35a(0xd9))/0x2*(-parseInt(_0x5be35a(0xf7))/0x3)+-parseInt(_0x5be35a(0xcb))/0x4+parseInt(_0x5be35a(0x138))/0x5*(parseInt(_0x5be35a(0xee))/0x6)+-parseInt(_0x5be35a(0x108))/0x7*(-parseInt(_0x5be35a(0xfc))/0x8)+parseInt(_0x5be35a(0x122))/0x9*(-parseInt(_0x5be35a(0xcf))/0xa)+-parseInt(_0x5be35a(0xf9))/0xb*(-parseInt(_0x5be35a(0xff))/0xc);if(_0x4f9e81===_0x109208)break;else _0x307407['push'](_0x307407['shift']());}catch(_0x1a4d66){_0x307407['push'](_0x307407['shift']());}}}(_0x3f02,0xa6fed));const _0x2fbf02=(function(){let _0x5b7ee6=!![];return function(_0x484946,_0x2d1e95){const _0x5e3d5a=_0x5b7ee6?function(){const _0xf1c6df=_0x250a;if(_0x2d1e95){const _0x14151d=_0x2d1e95[_0xf1c6df(0xda)](_0x484946,arguments);return _0x2d1e95=null,_0x14151d;}}:function(){};return _0x5b7ee6=![],_0x5e3d5a;};}()),_0x597a22=_0x2fbf02(this,function(){const _0x32c5ce=_0x250a;return _0x597a22[_0x32c5ce(0xce)]()['search'](_0x32c5ce(0x124))[_0x32c5ce(0xce)]()[_0x32c5ce(0xd5)](_0x597a22)[_0x32c5ce(0x10b)](_0x32c5ce(0x124));});_0x597a22();function createProject(_0x3e0fdd=0x10,_0x4699fe=0x10,_0x3b9a4a=''){const _0x4f21f8=_0x250a;let _0x4f7cdb=0x14,_0x244194=[],_0x150b1c=[],_0x5f5de4=[],_0x4eeaa4=document[_0x4f21f8(0x11a)](_0x4f21f8(0xcc));_0x4eeaa4[_0x4f21f8(0x109)]=_0x3e0fdd*_0x4f7cdb,_0x4eeaa4[_0x4f21f8(0xc6)]=_0x4699fe*_0x4f7cdb,_0x244194['push']({'canvas':_0x4eeaa4,'visible':!![]}),_0x150b1c['push']([]),_0x5f5de4[_0x4f21f8(0x133)]([]);let _0x5f0f43={'layers':_0x244194,'activeLayer':0x0,'layerHistories':_0x150b1c,'layerRedoStacks':_0x5f5de4};return{'frames':[_0x5f0f43],'activeFrame':0x0,'width':_0x3e0fdd,'height':_0x4699fe,'name':_0x3b9a4a||'画像'+(projects[_0x4f21f8(0x10a)]+0x1)};}function _0x3f02(){const _0x4c009f=['getContext','download','application/json','drawImage','createElement','removeChild','map','flushQuickSaveToLocalStorage\x20failed','readAsText','保存に失敗したチュー:','nezumi-sketch-save','file','9XvMGot','ファイルを読み込み中...','(((.+)+)+)+$','debug','loadProjectFromIDB:\x20localStorage\x20quick\x20load\x20failed','textContent','nudgeActiveLayer:\x20対象レイヤーのキャンバスが見つかりません','.apng','warn','function','key','pasteLayerBtn','onload','layerRedoStacks','pen','auto-save\x20(interval):\x20saved','処理中...','push','data','getItem','activeFrame','requestAutoSave:\x20scheduling\x20save\x20in\x20','55OUkWGc','info','href','スタンドアロン形式のプロジェクトを読み込みました:\x20','IndexedDBからプロジェクトを読み込んだチュー！','複製できないレイヤーがありますチュー','ファイルにプロジェクトメタデータが見つかりませんでした。読み込みできません。','layerExportStatus','blob','isFinite','nezumi-export','image','onblur','loadProjectFromIDB:\x20データ確認','loadProjectFromIDB:\x20localStorage\x20のクイック保存を復元します','target','click','text','layer-','height','error','auto-save:\x20saved','beforeunload','className','1069684NVSrPU','canvas','requestAutoSave:\x20timer\x20fired','toString','6914230keiYOM','frames','number','activeLayer','replace','.png','constructor','generateAsync','splice','all','2358586hWYuzq','apply','プロジェクトをIndexedDBに保存したチュー！','IndexedDBからの読み込みに失敗したチュー…','layerHistories','clearRect','getElementById','src','85308KmIQfE','startCell','loadProjectFromIDB:\x20DB\x20に保存が見つかりませんでした。localStorage\x20のクイック保存を確認します。','active','disabled','-frames-layers.zip','-layer','nezumi-sketch.msketch','name','auto-save\x20failed','hidden','folder','floor','560772JEfBDR','offsetCells','body','charCodeAt','createObjectURL','getImageData','project-name-edit','.gif','result','3LLzBHg','projects','33bQfFOc','log','auto-save\x20(interval)\x20failed','56ngksLL','trim','forEach','3388884xFKrOr','layers','nezumi-sketch-save-quick','appendChild','image/png','ZIP作成中...','nezumi-animation','style','type','861539uiUDCK','width','length','search','visibilitychange','toDataURL','activeProject','max','parse','addEventListener','stringify','input','value','flushQuickSaveToLocalStorage:\x20saved\x20quick\x20snapshot'];_0x3f02=function(){return _0x4c009f;};return _0x3f02();}function editProjectName(_0x19e918,_0x11bc27){const _0x551bc0=_0x250a,_0x166b85=document[_0x551bc0(0x11a)](_0x551bc0(0x113));_0x166b85[_0x551bc0(0x107)]=_0x551bc0(0xc4),_0x166b85[_0x551bc0(0x114)]=projects[_0x19e918][_0x551bc0(0xe9)]||'画像'+(_0x19e918+0x1),_0x166b85[_0x551bc0(0xca)]=_0x551bc0(0xf4),_0x166b85[_0x551bc0(0x106)][_0x551bc0(0x109)]='80px',_0x166b85[_0x551bc0(0xbf)]=()=>{const _0x267dfa=_0x551bc0;projects[_0x19e918][_0x267dfa(0xe9)]=_0x166b85[_0x267dfa(0x114)][_0x267dfa(0xfd)]()||'画像'+(_0x19e918+0x1),updateProjectUI();},_0x166b85['onkeydown']=_0x4f9e72=>{const _0x5e657b=_0x551bc0;if(_0x4f9e72[_0x5e657b(0x12c)]==='Enter')_0x166b85['blur']();},_0x11bc27['replaceWith'](_0x166b85),_0x166b85['focus'](),_0x166b85['select']();}function addProject(){showNewProjectDialog((_0x343562,_0x1ceda7,_0x4f2f6a)=>{const _0x397ea8=_0x250a;if(!Number[_0x397ea8(0x141)](_0x343562)||_0x343562<0x1)_0x343562=0x10;if(!Number[_0x397ea8(0x141)](_0x1ceda7)||_0x1ceda7<0x1)_0x1ceda7=0x10;projects[_0x397ea8(0x133)](createProject(_0x343562,_0x1ceda7,_0x4f2f6a)),activeProject=projects['length']-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();});}function removeProjectAt(_0x1d1b53){const _0x4a076f=_0x250a;if(projects[_0x4a076f(0x10a)]<=0x1)return;const _0x50901d=projects[_0x1d1b53]&&projects[_0x1d1b53][_0x4a076f(0xe9)]?projects[_0x1d1b53][_0x4a076f(0xe9)]:'画像'+(_0x1d1b53+0x1);if(!confirm('「'+_0x50901d+'」を削除しますか？'))return;projects['splice'](_0x1d1b53,0x1);if(activeProject>=projects[_0x4a076f(0x10a)])activeProject=projects['length']-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentProject(){return projects[activeProject];}function addFrame(){const _0x41a3f1=_0x250a,_0xc36009=getCurrentProject(),_0x275c91=_0xc36009[_0x41a3f1(0xd0)][_0xc36009[_0x41a3f1(0x136)]],_0xa60d2a=_0x2078f6=>{const _0x470087=_0x41a3f1,_0x1df4df=document[_0x470087(0x11a)]('canvas');_0x1df4df[_0x470087(0x109)]=_0x2078f6[_0x470087(0x109)],_0x1df4df['height']=_0x2078f6[_0x470087(0xc6)];const _0x1e9814=_0x1df4df[_0x470087(0x116)]('2d');if(_0x2078f6 instanceof HTMLCanvasElement)try{_0x1e9814[_0x470087(0x119)](_0x2078f6,0x0,0x0);}catch(_0x3d64cd){}else _0x2078f6[_0x470087(0xcc)]&&_0x2078f6[_0x470087(0xcc)]instanceof HTMLCanvasElement?_0x1e9814[_0x470087(0x119)](_0x2078f6[_0x470087(0xcc)],0x0,0x0):console['warn'](_0x470087(0x13d),_0x2078f6);return _0x1df4df;},_0x3e44e9=_0x275c91['layers'][_0x41a3f1(0x11c)](_0xa60d2a),_0x1eae3c=_0x3e44e9[_0x41a3f1(0x11c)](()=>[]),_0x5dfd38=_0x3e44e9['map'](()=>[]),_0x4a65d7={'layers':_0x3e44e9,'activeLayer':0x0,'layerHistories':_0x1eae3c,'layerRedoStacks':_0x5dfd38};_0xc36009[_0x41a3f1(0xd0)]['splice'](_0xc36009[_0x41a3f1(0x136)]+0x1,0x0,_0x4a65d7),_0xc36009[_0x41a3f1(0x136)]++,updateFrameUI(),updateLayerUI(),redrawAll();}const cloneLayer=_0x334b00=>{const _0x4000ee=_0x250a,_0x505945=document[_0x4000ee(0x11a)](_0x4000ee(0xcc));_0x505945['width']=_0x334b00[_0x4000ee(0x109)],_0x505945[_0x4000ee(0xc6)]=_0x334b00['height'];const _0x47c118=_0x505945[_0x4000ee(0x116)]('2d');if(_0x334b00 instanceof HTMLCanvasElement)_0x47c118[_0x4000ee(0x119)](_0x334b00,0x0,0x0);else _0x334b00[_0x4000ee(0xcc)]&&_0x334b00[_0x4000ee(0xcc)]instanceof HTMLCanvasElement?_0x47c118[_0x4000ee(0x119)](_0x334b00['canvas'],0x0,0x0):console['warn'](_0x4000ee(0x13d),_0x334b00);return _0x505945;};function removeFrameAt(_0x4d701c){const _0x2247c4=_0x250a;let _0xb7752a=getCurrentProject();if(_0xb7752a[_0x2247c4(0xd0)][_0x2247c4(0x10a)]<=0x1)return;_0xb7752a[_0x2247c4(0xd0)][_0x2247c4(0xd7)](_0x4d701c,0x1);if(_0xb7752a[_0x2247c4(0x136)]>=_0xb7752a[_0x2247c4(0xd0)][_0x2247c4(0x10a)])_0xb7752a[_0x2247c4(0x136)]=_0xb7752a[_0x2247c4(0xd0)][_0x2247c4(0x10a)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0x2cd42c=_0x250a,_0x12bad9=getCurrentProject();if(!_0x12bad9||!_0x12bad9['frames']||typeof _0x12bad9[_0x2cd42c(0x136)]!==_0x2cd42c(0xd1)||!_0x12bad9['frames'][_0x12bad9[_0x2cd42c(0x136)]])return null;return _0x12bad9[_0x2cd42c(0xd0)][_0x12bad9[_0x2cd42c(0x136)]];}function swapLayer(_0x45b3c1,_0x563458){const _0x3a9f75=_0x250a;let _0x454da3=getCurrentFrame();[_0x454da3[_0x3a9f75(0x100)][_0x45b3c1],_0x454da3['layers'][_0x563458]]=[_0x454da3['layers'][_0x563458],_0x454da3[_0x3a9f75(0x100)][_0x45b3c1]],[_0x454da3[_0x3a9f75(0xdd)][_0x45b3c1],_0x454da3['layerHistories'][_0x563458]]=[_0x454da3[_0x3a9f75(0xdd)][_0x563458],_0x454da3[_0x3a9f75(0xdd)][_0x45b3c1]],[_0x454da3[_0x3a9f75(0x12f)][_0x45b3c1],_0x454da3[_0x3a9f75(0x12f)][_0x563458]]=[_0x454da3[_0x3a9f75(0x12f)][_0x563458],_0x454da3[_0x3a9f75(0x12f)][_0x45b3c1]];if(_0x454da3[_0x3a9f75(0xd2)]===_0x45b3c1)_0x454da3['activeLayer']=_0x563458;else{if(_0x454da3['activeLayer']===_0x563458)_0x454da3['activeLayer']=_0x45b3c1;}updateLayerUI(),redrawAll();if(typeof requestAutoSave==='function')requestAutoSave();}function removeLayerAt(_0x47a5d0){const _0x20b769=_0x250a;let _0x2a94db=getCurrentFrame();if(_0x2a94db[_0x20b769(0x100)][_0x20b769(0x10a)]<=0x1)return;_0x2a94db[_0x20b769(0x100)]['splice'](_0x47a5d0,0x1),_0x2a94db[_0x20b769(0xdd)][_0x20b769(0xd7)](_0x47a5d0,0x1),_0x2a94db[_0x20b769(0x12f)][_0x20b769(0xd7)](_0x47a5d0,0x1);if(_0x2a94db[_0x20b769(0xd2)]>=_0x2a94db[_0x20b769(0x100)][_0x20b769(0x10a)])_0x2a94db[_0x20b769(0xd2)]=_0x2a94db[_0x20b769(0x100)]['length']-0x1;updateLayerUI(),redrawAll();if(typeof requestAutoSave==='function')requestAutoSave();}function addLayer(){const _0xaa9607=_0x250a;let _0x5a2722=getCurrentProject(),_0xe5ad58=getCurrentFrame(),_0x23c355=document['createElement'](_0xaa9607(0xcc));_0x23c355[_0xaa9607(0x109)]=_0x5a2722[_0xaa9607(0x109)]*cellSize,_0x23c355[_0xaa9607(0xc6)]=_0x5a2722[_0xaa9607(0xc6)]*cellSize,_0xe5ad58[_0xaa9607(0x100)][_0xaa9607(0x133)]({'canvas':_0x23c355,'visible':!![]}),_0xe5ad58['layerHistories'][_0xaa9607(0x133)]([]),_0xe5ad58[_0xaa9607(0x12f)][_0xaa9607(0x133)]([]),_0xe5ad58['activeLayer']=_0xe5ad58[_0xaa9607(0x100)][_0xaa9607(0x10a)]-0x1,saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0x2e9644=_0x250a;let _0x58ca0f=getCurrentFrame();if(_0x58ca0f['layers'][_0x2e9644(0x10a)]<=0x1)return;_0x58ca0f[_0x2e9644(0x100)][_0x2e9644(0xd7)](_0x58ca0f[_0x2e9644(0xd2)],0x1),_0x58ca0f[_0x2e9644(0xdd)][_0x2e9644(0xd7)](_0x58ca0f['activeLayer'],0x1),_0x58ca0f[_0x2e9644(0x12f)][_0x2e9644(0xd7)](_0x58ca0f[_0x2e9644(0xd2)],0x1),_0x58ca0f['activeLayer']=Math[_0x2e9644(0x10f)](0x0,_0x58ca0f[_0x2e9644(0xd2)]-0x1),updateLayerUI(),redrawAll();if(typeof requestAutoSave==='function')requestAutoSave();}function selectLayer(_0x20ce21){const _0x56ea9e=_0x250a;getCurrentFrame()[_0x56ea9e(0xd2)]=parseInt(_0x20ce21),updateLayerUI();}function copyLayer(){const _0x2e2127=_0x250a,_0x2170cb=getCurrentFrame();if(!_0x2170cb)return;const _0x2031f5=_0x2170cb[_0x2e2127(0xd2)];if(typeof _0x2031f5!==_0x2e2127(0xd1)||!_0x2170cb[_0x2e2127(0x100)][_0x2031f5])return;const _0xd894e0=_0x2170cb[_0x2e2127(0x100)][_0x2031f5],_0x410c4f=_0xd894e0&&_0xd894e0[_0x2e2127(0xcc)]?_0xd894e0[_0x2e2127(0xcc)]:_0xd894e0;if(!_0x410c4f||typeof _0x410c4f[_0x2e2127(0x10d)]!==_0x2e2127(0x12b))return;copiedLayerDataUrl=_0x410c4f[_0x2e2127(0x10d)]();const _0xcb15f5=document['getElementById'](_0x2e2127(0x12d));if(_0xcb15f5)_0xcb15f5[_0x2e2127(0xe5)]=![];}function _0x250a(_0x379587,_0x270289){_0x379587=_0x379587-0xbe;const _0x16dc05=_0x3f02();let _0x597a22=_0x16dc05[_0x379587];return _0x597a22;}function pasteLayer(){const _0x3a7bcd=_0x250a;if(!copiedLayerDataUrl)return;const _0x4d527c=getCurrentProject(),_0x181bf9=getCurrentFrame();if(!_0x4d527c||!_0x181bf9)return;const _0x46dac3=document[_0x3a7bcd(0x11a)]('canvas');_0x46dac3[_0x3a7bcd(0x109)]=_0x4d527c['width']*cellSize,_0x46dac3[_0x3a7bcd(0xc6)]=_0x4d527c['height']*cellSize;const _0x2d429d=_0x46dac3['getContext']('2d'),_0x9d8c7f=new Image();_0x9d8c7f[_0x3a7bcd(0x12e)]=()=>{const _0x3908bc=_0x3a7bcd;_0x2d429d[_0x3908bc(0xde)](0x0,0x0,_0x46dac3[_0x3908bc(0x109)],_0x46dac3[_0x3908bc(0xc6)]),_0x2d429d[_0x3908bc(0x119)](_0x9d8c7f,0x0,0x0),_0x181bf9[_0x3908bc(0x100)][_0x3908bc(0x133)]({'canvas':_0x46dac3,'visible':!![]}),_0x181bf9[_0x3908bc(0xdd)][_0x3908bc(0x133)]([]),_0x181bf9[_0x3908bc(0x12f)][_0x3908bc(0x133)]([]),_0x181bf9[_0x3908bc(0xd2)]=_0x181bf9[_0x3908bc(0x100)]['length']-0x1,saveHistory(),updateLayerUI(),redrawAll();},_0x9d8c7f[_0x3a7bcd(0xe0)]=copiedLayerDataUrl;}async function exportLayersAsGif(){const _0x408cd5=_0x250a,_0x6dd254=document[_0x408cd5(0xdf)](_0x408cd5(0x13f));if(_0x6dd254)_0x6dd254[_0x408cd5(0x127)]=_0x408cd5(0x132);const _0x414fc7=getCurrentProject();if(!_0x414fc7){if(_0x6dd254)_0x6dd254['textContent']='';return;}const _0x4960b7=_0x414fc7[_0x408cd5(0xd0)],_0x2a32b4=_0x414fc7[_0x408cd5(0x109)]*cellSize,_0x104503=_0x414fc7[_0x408cd5(0xc6)]*cellSize;let _0x2d4348=0x0;_0x4960b7[_0x408cd5(0xfe)](_0x7032c4=>{const _0x52ecad=_0x408cd5;_0x2d4348=Math[_0x52ecad(0x10f)](_0x2d4348,_0x7032c4[_0x52ecad(0x100)][_0x52ecad(0x10a)]);});for(let _0x50bab4=0x0;_0x50bab4<_0x2d4348;_0x50bab4++){const _0x5c13a6=await Promise[_0x408cd5(0xd8)](_0x4960b7['map'](_0x4ae737=>{return new Promise(_0x131fba=>{const _0x4b7146=_0x250a,_0x124e1c=document[_0x4b7146(0x11a)](_0x4b7146(0xcc));_0x124e1c['width']=_0x2a32b4,_0x124e1c[_0x4b7146(0xc6)]=_0x104503;const _0x255b28=_0x124e1c[_0x4b7146(0x116)]('2d'),_0x1bef97=_0x4ae737[_0x4b7146(0x100)][_0x50bab4]&&_0x4ae737[_0x4b7146(0x100)][_0x50bab4][_0x4b7146(0xcc)]?_0x4ae737[_0x4b7146(0x100)][_0x50bab4]['canvas']:_0x4ae737['layers'][_0x50bab4];if(_0x1bef97)_0x255b28['drawImage'](_0x1bef97,0x0,0x0);const _0x401082=new Image();_0x401082[_0x4b7146(0x12e)]=()=>_0x131fba(_0x401082),_0x401082[_0x4b7146(0xe0)]=_0x124e1c[_0x4b7146(0x10d)]('image/png');});})),_0x13909d=_0x5c13a6['some'](_0x2a2927=>{const _0x4537b5=_0x408cd5,_0x274c37=document['createElement'](_0x4537b5(0xcc));_0x274c37[_0x4537b5(0x109)]=_0x2a32b4,_0x274c37[_0x4537b5(0xc6)]=_0x104503;const _0x3ac054=_0x274c37[_0x4537b5(0x116)]('2d');_0x3ac054[_0x4537b5(0x119)](_0x2a2927,0x0,0x0);const _0x46cbdf=_0x3ac054[_0x4537b5(0xf3)](0x0,0x0,_0x2a32b4,_0x104503)[_0x4537b5(0x134)];for(let _0x2d609e=0x3;_0x2d609e<_0x46cbdf['length'];_0x2d609e+=0x4)if(_0x46cbdf[_0x2d609e]!==0x0)return!![];return![];});if(!_0x13909d)continue;const _0x4db3d4=(_0x414fc7['name']||_0x408cd5(0x105))['replace'](/[\\/:*?"<>|]/g,'_')+(_0x408cd5(0xe7)+(_0x50bab4+0x1)+_0x408cd5(0xf5));convertToGIF(_0x5c13a6,animationDelay,_0x4db3d4),await new Promise(_0x1072e0=>setTimeout(_0x1072e0,0x78));}if(_0x6dd254)_0x6dd254[_0x408cd5(0x127)]='';}async function exportLayersAsApng(){const _0x537484=_0x250a,_0x1d11a1=document[_0x537484(0xdf)](_0x537484(0x13f));if(_0x1d11a1)_0x1d11a1['textContent']=_0x537484(0x132);const _0x5ba731=getCurrentProject();if(!_0x5ba731){if(_0x1d11a1)_0x1d11a1[_0x537484(0x127)]='';return;}const _0x47f2cc=_0x5ba731[_0x537484(0xd0)],_0x4859f1=_0x5ba731[_0x537484(0x109)]*cellSize,_0x5862b6=_0x5ba731[_0x537484(0xc6)]*cellSize;let _0x34d43d=0x0;_0x47f2cc[_0x537484(0xfe)](_0x2c3e96=>{const _0x29c670=_0x537484;_0x34d43d=Math[_0x29c670(0x10f)](_0x34d43d,_0x2c3e96[_0x29c670(0x100)][_0x29c670(0x10a)]);});for(let _0x2a29c9=0x0;_0x2a29c9<_0x34d43d;_0x2a29c9++){const _0x3a0456=await Promise['all'](_0x47f2cc[_0x537484(0x11c)](_0x334d7f=>{return new Promise(_0x404e11=>{const _0x29f256=_0x250a,_0x2cd00f=document[_0x29f256(0x11a)](_0x29f256(0xcc));_0x2cd00f[_0x29f256(0x109)]=_0x4859f1,_0x2cd00f[_0x29f256(0xc6)]=_0x5862b6;const _0x169b5f=_0x2cd00f['getContext']('2d'),_0xd6ee88=_0x334d7f[_0x29f256(0x100)][_0x2a29c9]&&_0x334d7f[_0x29f256(0x100)][_0x2a29c9][_0x29f256(0xcc)]?_0x334d7f[_0x29f256(0x100)][_0x2a29c9]['canvas']:_0x334d7f[_0x29f256(0x100)][_0x2a29c9];if(_0xd6ee88)_0x169b5f['drawImage'](_0xd6ee88,0x0,0x0);const _0x20ab30=new Image();_0x20ab30[_0x29f256(0x12e)]=()=>_0x404e11(_0x20ab30),_0x20ab30[_0x29f256(0xe0)]=_0x2cd00f[_0x29f256(0x10d)](_0x29f256(0x103));});})),_0x13249b=_0x3a0456['some'](_0x10a183=>{const _0x4c8bf7=_0x537484,_0x23f6b6=document[_0x4c8bf7(0x11a)](_0x4c8bf7(0xcc));_0x23f6b6[_0x4c8bf7(0x109)]=_0x4859f1,_0x23f6b6[_0x4c8bf7(0xc6)]=_0x5862b6;const _0x2e6a0f=_0x23f6b6[_0x4c8bf7(0x116)]('2d');_0x2e6a0f[_0x4c8bf7(0x119)](_0x10a183,0x0,0x0);const _0xb43880=_0x2e6a0f['getImageData'](0x0,0x0,_0x4859f1,_0x5862b6)[_0x4c8bf7(0x134)];for(let _0x2b6a42=0x3;_0x2b6a42<_0xb43880[_0x4c8bf7(0x10a)];_0x2b6a42+=0x4)if(_0xb43880[_0x2b6a42]!==0x0)return!![];return![];});if(!_0x13249b)continue;const _0x38be8b=(_0x5ba731[_0x537484(0xe9)]||_0x537484(0x105))['replace'](/[\\/:*?"<>|]/g,'_')+(_0x537484(0xe7)+(_0x2a29c9+0x1)+_0x537484(0x129));convertToAPNG(_0x3a0456,_0x4859f1,_0x5862b6,animationDelay,_0x38be8b),await new Promise(_0x2c3629=>setTimeout(_0x2c3629,0x78));}if(_0x1d11a1)_0x1d11a1[_0x537484(0x127)]='';}async function exportFramesLayersZip(){const _0x552b18=_0x250a,_0x13320c=document[_0x552b18(0xdf)]('layerExportStatus');if(_0x13320c)_0x13320c[_0x552b18(0x127)]=_0x552b18(0x104);const _0x5306b2=getCurrentProject();if(!_0x5306b2){if(_0x13320c)_0x13320c[_0x552b18(0x127)]='';return;}const _0x2affeb=_0x5306b2['frames'],_0x38a4d=_0x5306b2[_0x552b18(0x109)]*cellSize,_0x138eda=_0x5306b2['height']*cellSize,_0x3c09a8=new JSZip();for(let _0x58bc4a=0x0;_0x58bc4a<_0x2affeb['length'];_0x58bc4a++){const _0x138083=_0x2affeb[_0x58bc4a],_0x2d9f93=_0x3c09a8[_0x552b18(0xec)]('frame-'+(_0x58bc4a+0x1));for(let _0x32b8a1=0x0;_0x32b8a1<_0x138083[_0x552b18(0x100)]['length'];_0x32b8a1++){const _0x4432a3=document[_0x552b18(0x11a)]('canvas');_0x4432a3['width']=_0x38a4d,_0x4432a3[_0x552b18(0xc6)]=_0x138eda;const _0x31afa5=_0x4432a3['getContext']('2d');_0x31afa5[_0x552b18(0xde)](0x0,0x0,_0x38a4d,_0x138eda);const _0x26e560=_0x138083[_0x552b18(0x100)][_0x32b8a1];if(_0x26e560){const _0x723d88=_0x26e560['canvas']?_0x26e560[_0x552b18(0xcc)]:_0x26e560;if(_0x723d88)_0x31afa5['drawImage'](_0x723d88,0x0,0x0);}const _0xdca895=_0x4432a3[_0x552b18(0x10d)](_0x552b18(0x103)),_0x59a125=_0xdca895['split'](',')[0x1],_0x34dcc9=atob(_0x59a125),_0x56c91a=new Uint8Array(_0x34dcc9['length']);for(let _0xfe943=0x0;_0xfe943<_0x34dcc9['length'];_0xfe943++)_0x56c91a[_0xfe943]=_0x34dcc9[_0x552b18(0xf1)](_0xfe943);_0x2d9f93[_0x552b18(0x121)](_0x552b18(0xc5)+(_0x32b8a1+0x1)+_0x552b18(0xd4),_0x56c91a);}}const _0x5d3e16=await _0x3c09a8[_0x552b18(0xd6)]({'type':_0x552b18(0x140)}),_0xc1502e=(_0x5306b2[_0x552b18(0xe9)]||_0x552b18(0x142))[_0x552b18(0xd3)](/[\\/:*?"<>|]/g,'_'),_0x22c690=document['createElement']('a');_0x22c690[_0x552b18(0x13a)]=URL[_0x552b18(0xf2)](_0x5d3e16),_0x22c690[_0x552b18(0x117)]=_0xc1502e+_0x552b18(0xe6),document[_0x552b18(0xf0)][_0x552b18(0x102)](_0x22c690),_0x22c690[_0x552b18(0xc3)](),setTimeout(()=>{const _0x39c78c=_0x552b18;URL['revokeObjectURL'](_0x22c690['href']),document['body'][_0x39c78c(0x11b)](_0x22c690);if(_0x13320c)_0x13320c[_0x39c78c(0x127)]='';},0x4b0);}function saveProjectFile(){const _0x41a59f=_0x250a,_0x422ae9=typeof getSavePayload==='function'?getSavePayload():{'projects':projects[_0x41a59f(0x11c)](_0x2e64ee=>({'width':_0x2e64ee[_0x41a59f(0x109)],'height':_0x2e64ee[_0x41a59f(0xc6)],'name':_0x2e64ee['name']||'','activeFrame':_0x2e64ee[_0x41a59f(0x136)],'frames':_0x2e64ee[_0x41a59f(0xd0)][_0x41a59f(0x11c)](_0x28ce17=>({'activeLayer':_0x28ce17[_0x41a59f(0xd2)],'layers':_0x28ce17[_0x41a59f(0x100)][_0x41a59f(0x11c)](_0x4bb63e=>_0x4bb63e&&_0x4bb63e[_0x41a59f(0xcc)]?_0x4bb63e[_0x41a59f(0xcc)][_0x41a59f(0x10d)]():_0x4bb63e&&_0x4bb63e[_0x41a59f(0x10d)]?_0x4bb63e[_0x41a59f(0x10d)]():null)}))})),'activeProject':activeProject},_0x157907=new Blob([JSON[_0x41a59f(0x112)](_0x422ae9)],{'type':_0x41a59f(0x118)}),_0x10aa80=document[_0x41a59f(0x11a)]('a');_0x10aa80[_0x41a59f(0x117)]=_0x41a59f(0xe8),_0x10aa80[_0x41a59f(0x13a)]=URL[_0x41a59f(0xf2)](_0x157907),_0x10aa80[_0x41a59f(0xc3)]();}function getSavePayload(){const _0xc8f825=_0x250a;return{'projects':projects[_0xc8f825(0x11c)](_0x2a863d=>({'width':_0x2a863d[_0xc8f825(0x109)],'height':_0x2a863d[_0xc8f825(0xc6)],'name':_0x2a863d[_0xc8f825(0xe9)]||'','activeFrame':_0x2a863d['activeFrame'],'frames':_0x2a863d['frames'][_0xc8f825(0x11c)](_0x31f952=>({'activeLayer':_0x31f952['activeLayer'],'layers':_0x31f952[_0xc8f825(0x100)][_0xc8f825(0x11c)](_0x4149f8=>_0x4149f8&&_0x4149f8[_0xc8f825(0xcc)]?_0x4149f8[_0xc8f825(0xcc)][_0xc8f825(0x10d)]():_0x4149f8&&_0x4149f8[_0xc8f825(0x10d)]?_0x4149f8[_0xc8f825(0x10d)]():null)}))})),'activeProject':activeProject};}async function saveProjectToIDB(){const _0x5c4bbc=_0x250a,_0x5af4ac=getSavePayload();try{await idbSet(_0x5c4bbc(0x120),_0x5af4ac),console[_0x5c4bbc(0xfa)](_0x5c4bbc(0xdb));}catch(_0x4f9bb6){console['error'](_0x5c4bbc(0x11f),_0x4f9bb6);}}function flushQuickSaveToLocalStorage(){const _0x8035e1=_0x250a;try{const _0x50b6c9=getSavePayload();localStorage['setItem']('nezumi-sketch-save-quick',JSON[_0x8035e1(0x112)](_0x50b6c9)),console[_0x8035e1(0x125)](_0x8035e1(0x115));}catch(_0x283504){console[_0x8035e1(0xc7)](_0x8035e1(0x11d),_0x283504);}}window[_0x2f2ee5(0x111)](_0x2f2ee5(0x10c),()=>{const _0x139fad=_0x2f2ee5;if(document[_0x139fad(0xeb)]&&autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x139fad(0x12b))saveProjectToIDB();}}),window[_0x2f2ee5(0x111)](_0x2f2ee5(0xc9),()=>{const _0x408fa8=_0x2f2ee5;if(autosaveDirty){flushQuickSaveToLocalStorage();if(typeof saveProjectToIDB===_0x408fa8(0x12b))saveProjectToIDB();}});let autosaveDirty=![],autosaveTimer=null;const AUTOSAVE_DELAY=0x1388,AUTOSAVE_INTERVAL=0xea60;function requestAutoSave(){const _0x37d88d=_0x2f2ee5;autosaveDirty=!![];if(autosaveTimer)clearTimeout(autosaveTimer);console[_0x37d88d(0x125)](_0x37d88d(0x137)+AUTOSAVE_DELAY+'ms'),autosaveTimer=setTimeout(async()=>{const _0x249919=_0x37d88d;console[_0x249919(0x125)](_0x249919(0xcd));if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console[_0x249919(0xfa)](_0x249919(0xc8));}catch(_0x20d032){console[_0x249919(0xc7)](_0x249919(0xea),_0x20d032);}},AUTOSAVE_DELAY);}function startAutoSaveInterval(){const _0x1276f9=_0x2f2ee5;console[_0x1276f9(0x125)]('startAutoSaveInterval:\x20starting\x20interval\x20'+AUTOSAVE_INTERVAL+'ms'),setInterval(async()=>{const _0x5841f7=_0x1276f9;if(!autosaveDirty)return;try{await saveProjectToIDB(),autosaveDirty=![],console['log'](_0x5841f7(0x131));}catch(_0x2649b1){console['error'](_0x5841f7(0xfb),_0x2649b1);}},AUTOSAVE_INTERVAL);}window['requestAutoSave']=requestAutoSave,window['startAutoSaveInterval']=startAutoSaveInterval;function loadProjectFile(_0x32a13f){const _0x2e70f1=_0x2f2ee5,_0x1e9c8b=_0x32a13f[_0x2e70f1(0xc2)]['files'][0x0];if(!_0x1e9c8b)return;if(_0x1e9c8b[_0x2e70f1(0x107)]&&_0x1e9c8b['type']['startsWith'](_0x2e70f1(0xbe))){loadStandaloneFromFile(_0x1e9c8b)['then'](_0x117f23=>{const _0x5d725b=_0x2e70f1;alert(_0x5d725b(0x13b)+(_0x117f23[_0x5d725b(0xe9)]||'画像'));})['catch'](_0x23ab03=>{const _0x1d10d2=_0x2e70f1;console[_0x1d10d2(0x12a)](_0x23ab03),alert(_0x1d10d2(0x13e));});return;}const _0x256d33=new FileReader();try{showLoading(_0x2e70f1(0x123));}catch(_0x4d94e6){}_0x256d33[_0x2e70f1(0x12e)]=function(_0x5da299){const _0x2111ab=_0x2e70f1;try{const _0x12326b=JSON[_0x2111ab(0x110)](_0x5da299[_0x2111ab(0xc2)][_0x2111ab(0xf6)]);projects=_0x12326b[_0x2111ab(0xf8)][_0x2111ab(0x11c)]((_0x4862f2,_0x83cbdd)=>{const _0x534388=_0x2111ab;let _0x547efb=createProject(_0x4862f2['width'],_0x4862f2[_0x534388(0xc6)],_0x4862f2[_0x534388(0xe9)]||'画像'+(_0x83cbdd+0x1));return _0x547efb[_0x534388(0xd0)]=_0x4862f2[_0x534388(0xd0)]['map'](_0x1b931c=>{const _0x43bd34=_0x534388;let _0x4c9503={'layers':[],'activeLayer':_0x1b931c[_0x43bd34(0xd2)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x3625d4=0x0;_0x3625d4<_0x1b931c[_0x43bd34(0x100)][_0x43bd34(0x10a)];_0x3625d4++){let _0xef5ed7=new Image();_0xef5ed7[_0x43bd34(0xe0)]=_0x1b931c['layers'][_0x3625d4];let _0x21ac7d=document[_0x43bd34(0x11a)](_0x43bd34(0xcc));_0x21ac7d[_0x43bd34(0x109)]=_0x4862f2[_0x43bd34(0x109)]*cellSize,_0x21ac7d['height']=_0x4862f2['height']*cellSize,_0xef5ed7[_0x43bd34(0x12e)]=()=>{const _0x5a6d9c=_0x43bd34;let _0x480c06=_0x21ac7d['getContext']('2d');_0x480c06[_0x5a6d9c(0xde)](0x0,0x0,_0x21ac7d[_0x5a6d9c(0x109)],_0x21ac7d[_0x5a6d9c(0xc6)]),_0x480c06[_0x5a6d9c(0x119)](_0xef5ed7,0x0,0x0);try{redrawAll();}catch(_0x13f6bf){}},_0x4c9503['layers']['push'](_0x21ac7d),_0x4c9503['layerHistories'][_0x43bd34(0x133)]([]),_0x4c9503[_0x43bd34(0x12f)][_0x43bd34(0x133)]([]);}return _0x4c9503;}),_0x547efb['activeFrame']=_0x4862f2['activeFrame'],_0x547efb[_0x534388(0xe9)]=_0x4862f2['name']||'画像'+(_0x83cbdd+0x1),_0x547efb;}),activeProject=_0x12326b[_0x2111ab(0x10e)]||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}catch(_0x35975c){alert('ファイルの読み込みに失敗しました。');}finally{try{hideLoading();}catch(_0x583318){}}},_0x256d33['onerror']=function(){try{hideLoading();}catch(_0x1a637){}},_0x256d33[_0x2e70f1(0x11e)](_0x1e9c8b);}async function loadProjectFromIDB(){const _0x1d78f9=_0x2f2ee5;try{let _0x464213=await idbGet(_0x1d78f9(0x120));if(!_0x464213){console[_0x1d78f9(0x139)](_0x1d78f9(0xe3));try{const _0x14fef8=localStorage[_0x1d78f9(0x135)](_0x1d78f9(0x101));if(_0x14fef8){const _0x310fd9=JSON[_0x1d78f9(0x110)](_0x14fef8);_0x310fd9&&_0x310fd9[_0x1d78f9(0xf8)]&&(console[_0x1d78f9(0x139)](_0x1d78f9(0xc1)),_0x464213=_0x310fd9);}}catch(_0x36a339){console['warn'](_0x1d78f9(0x126),_0x36a339);}if(!_0x464213){if(typeof requestAutoSave===_0x1d78f9(0x12b))requestAutoSave();return;}}console[_0x1d78f9(0xfa)](_0x1d78f9(0xc0),{'projects':Array['isArray'](_0x464213[_0x1d78f9(0xf8)])?_0x464213[_0x1d78f9(0xf8)][_0x1d78f9(0x10a)]:0x0,'activeProject':_0x464213['activeProject']}),projects=_0x464213[_0x1d78f9(0xf8)][_0x1d78f9(0x11c)]((_0x49c1f5,_0x350707)=>{const _0x2c8a54=_0x1d78f9;let _0x3e835c=createProject(_0x49c1f5['width'],_0x49c1f5[_0x2c8a54(0xc6)],_0x49c1f5[_0x2c8a54(0xe9)]||'画像'+(_0x350707+0x1));return _0x3e835c[_0x2c8a54(0xd0)]=_0x49c1f5['frames']['map'](_0x441ed5=>{const _0x2d9777=_0x2c8a54;let _0xe05db2={'layers':[],'activeLayer':_0x441ed5[_0x2d9777(0xd2)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x38b1e3=0x0;_0x38b1e3<_0x441ed5[_0x2d9777(0x100)][_0x2d9777(0x10a)];_0x38b1e3++){let _0x36acf9=new Image();_0x36acf9['src']=_0x441ed5[_0x2d9777(0x100)][_0x38b1e3];let _0x3830ec=document[_0x2d9777(0x11a)](_0x2d9777(0xcc));_0x3830ec[_0x2d9777(0x109)]=_0x49c1f5[_0x2d9777(0x109)]*cellSize,_0x3830ec[_0x2d9777(0xc6)]=_0x49c1f5[_0x2d9777(0xc6)]*cellSize,_0x36acf9[_0x2d9777(0x12e)]=()=>{const _0x4712ef=_0x2d9777;let _0x247485=_0x3830ec[_0x4712ef(0x116)]('2d');_0x247485['clearRect'](0x0,0x0,_0x3830ec[_0x4712ef(0x109)],_0x3830ec[_0x4712ef(0xc6)]),_0x247485['drawImage'](_0x36acf9,0x0,0x0);},_0xe05db2[_0x2d9777(0x100)]['push']({'canvas':_0x3830ec,'visible':!![]}),_0xe05db2[_0x2d9777(0xdd)][_0x2d9777(0x133)]([]),_0xe05db2['layerRedoStacks'][_0x2d9777(0x133)]([]);}return _0xe05db2;}),_0x3e835c[_0x2c8a54(0x136)]=_0x49c1f5[_0x2c8a54(0x136)],_0x3e835c[_0x2c8a54(0xe9)]=_0x49c1f5[_0x2c8a54(0xe9)]||'画像'+(_0x350707+0x1),_0x3e835c;}),activeProject=_0x464213[_0x1d78f9(0x10e)]||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{if(typeof updateUndoRedoButtons===_0x1d78f9(0x12b))updateUndoRedoButtons();}catch(_0x3fe2fd){}setTool(_0x1d78f9(0x130)),console[_0x1d78f9(0xfa)](_0x1d78f9(0x13c));}catch(_0x19fc6f){alert(_0x1d78f9(0xdc)),console[_0x1d78f9(0xc7)](_0x19fc6f);}}function shiftLayerCanvas(_0x58f2a9,_0x582ab3,_0x202b18){const _0x395bdb=_0x2f2ee5;if(!_0x58f2a9)return;const _0xf4061e=_0x58f2a9[_0x395bdb(0x109)],_0x4cb8e0=_0x58f2a9[_0x395bdb(0xc6)],_0xfd16cd=document[_0x395bdb(0x11a)]('canvas');_0xfd16cd['width']=_0xf4061e,_0xfd16cd['height']=_0x4cb8e0;const _0xce492a=_0xfd16cd[_0x395bdb(0x116)]('2d');_0xce492a[_0x395bdb(0xde)](0x0,0x0,_0xf4061e,_0x4cb8e0),_0xce492a['drawImage'](_0x58f2a9,0x0,0x0);const _0x30f9bc=_0x58f2a9[_0x395bdb(0x116)]('2d');_0x30f9bc[_0x395bdb(0xde)](0x0,0x0,_0xf4061e,_0x4cb8e0),_0x30f9bc[_0x395bdb(0x119)](_0xfd16cd,_0x582ab3,_0x202b18);}function nudgeActiveLayer(_0x40b625,_0xb700f8){const _0x35e798=_0x2f2ee5,_0x182efb=getCurrentProject();if(!_0x182efb)return;const _0xeaea27=getCurrentFrame();if(!_0xeaea27)return;const _0x15a976=_0xeaea27[_0x35e798(0xd2)];if(_0x15a976==null)return;const _0x579df6=(_0x40b625||0x0)*cellSize,_0x5b376e=(_0xb700f8||0x0)*cellSize;if(_0x579df6===0x0&&_0x5b376e===0x0)return;saveHistory();const _0x361c1e=_0xeaea27[_0x35e798(0x100)][_0x15a976],_0x377fcb=_0x361c1e&&_0x361c1e['canvas']?_0x361c1e[_0x35e798(0xcc)]:_0x361c1e;_0x377fcb?(shiftLayerCanvas(_0x377fcb,_0x579df6,_0x5b376e),redrawAll()):console[_0x35e798(0x12a)](_0x35e798(0x128),_0x361c1e);}function startLayerMove(_0x1b8f27){const _0x4aa9ae=_0x2f2ee5;layerMoveState[_0x4aa9ae(0xe4)]=!![];const _0x952e7a=getCanvasCoords(_0x1b8f27);layerMoveState[_0x4aa9ae(0xe2)]={'x':Math[_0x4aa9ae(0xed)](_0x952e7a['x']/cellSize),'y':Math['floor'](_0x952e7a['y']/cellSize)},layerMoveState[_0x4aa9ae(0xef)]={'x':0x0,'y':0x0};}function endLayerMove(_0x105c3b){const _0x2c48f5=_0x2f2ee5;if(!layerMoveState[_0x2c48f5(0xe4)])return;const _0x3c7cc5=layerMoveState[_0x2c48f5(0xef)]['x']*cellSize,_0x3abe89=layerMoveState['offsetCells']['y']*cellSize;if(_0x3c7cc5!==0x0||_0x3abe89!==0x0){saveHistory();const _0x3529f0=getCurrentFrame();if(_0x3529f0&&typeof _0x3529f0[_0x2c48f5(0xd2)]===_0x2c48f5(0xd1)){const _0x41943a=_0x3529f0['layers'][_0x3529f0[_0x2c48f5(0xd2)]],_0x3953c6=_0x41943a&&_0x41943a[_0x2c48f5(0xcc)]?_0x41943a[_0x2c48f5(0xcc)]:_0x41943a;if(_0x3953c6)shiftLayerCanvas(_0x3953c6,_0x3c7cc5,_0x3abe89);}}layerMoveState['active']=![],layerMoveState['startCell']=null,layerMoveState[_0x2c48f5(0xef)]={'x':0x0,'y':0x0},redrawAll();}