const a0_0x45dd2d=a0_0x4a77;(function(_0x11a91c,_0x2957e4){const _0x251aa0=a0_0x4a77,_0x50a3a0=_0x11a91c();while(!![]){try{const _0x26fd40=-parseInt(_0x251aa0(0x242))/0x1+-parseInt(_0x251aa0(0x1c4))/0x2*(-parseInt(_0x251aa0(0x1dc))/0x3)+parseInt(_0x251aa0(0x23a))/0x4+-parseInt(_0x251aa0(0x258))/0x5+-parseInt(_0x251aa0(0x21a))/0x6+-parseInt(_0x251aa0(0x1bb))/0x7*(-parseInt(_0x251aa0(0x240))/0x8)+-parseInt(_0x251aa0(0x163))/0x9*(parseInt(_0x251aa0(0x261))/0xa);if(_0x26fd40===_0x2957e4)break;else _0x50a3a0['push'](_0x50a3a0['shift']());}catch(_0x3e1060){_0x50a3a0['push'](_0x50a3a0['shift']());}}}(a0_0x97ee,0x24304));const a0_0x36bc5d=(function(){let _0x2ea32=!![];return function(_0x3a0dca,_0x3aa60d){const _0x281aa5=_0x2ea32?function(){const _0x595fe0=a0_0x4a77;if(_0x3aa60d){const _0x5a39d6=_0x3aa60d[_0x595fe0(0x254)](_0x3a0dca,arguments);return _0x3aa60d=null,_0x5a39d6;}}:function(){};return _0x2ea32=![],_0x281aa5;};}()),a0_0x36731b=a0_0x36bc5d(this,function(){const _0x1672a1=a0_0x4a77;return a0_0x36731b[_0x1672a1(0x25e)]()[_0x1672a1(0x1b8)](_0x1672a1(0x181))[_0x1672a1(0x25e)]()['constructor'](a0_0x36731b)[_0x1672a1(0x1b8)](_0x1672a1(0x181));});a0_0x36731b();let canvas=document[a0_0x45dd2d(0x17e)]('canvas'),ctx=canvas[a0_0x45dd2d(0x237)]('2d');const wrapper=document[a0_0x45dd2d(0x17e)](a0_0x45dd2d(0x1e3));let cellSize=0x14,currentColor=a0_0x45dd2d(0x275),currentTool=a0_0x45dd2d(0x148),penSize=0x1,penMode=a0_0x45dd2d(0x209),layers=[],activeLayer=0x0,layerHistories=[],layerRedoStacks=[],currentWidth=0x10,currentHeight=0x10,projects=[],activeProject=0x0,isDrawing=![];function createProject(_0x1cc761=0x10,_0x4fecdc=0x10,_0x3d5f9e=''){const _0x4fb83f=a0_0x45dd2d;let _0x5a2484=0x14,_0x4847f8=[],_0x461d6c=[],_0x200adb=[],_0x46f4df=document['createElement'](_0x4fb83f(0x1e6));_0x46f4df[_0x4fb83f(0x17a)]=_0x1cc761*_0x5a2484,_0x46f4df[_0x4fb83f(0x189)]=_0x4fecdc*_0x5a2484,_0x4847f8[_0x4fb83f(0x159)](_0x46f4df),_0x461d6c[_0x4fb83f(0x159)]([]),_0x200adb[_0x4fb83f(0x159)]([]);let _0x4f59bd={'layers':_0x4847f8,'activeLayer':0x0,'layerHistories':_0x461d6c,'layerRedoStacks':_0x200adb};return{'frames':[_0x4f59bd],'activeFrame':0x0,'width':_0x1cc761,'height':_0x4fecdc,'name':_0x3d5f9e||'画像'+(projects['length']+0x1)};}function updateProjectUI(){const _0x56d0c7=a0_0x45dd2d,_0x46ab90=document['getElementById'](_0x56d0c7(0x156));_0x46ab90[_0x56d0c7(0x239)]='';for(let _0x140636=0x0;_0x140636<projects[_0x56d0c7(0x1af)];_0x140636++){const _0xdc94de=document[_0x56d0c7(0x234)]('div');_0xdc94de[_0x56d0c7(0x18e)]=_0x56d0c7(0x165)+(_0x140636===activeProject?_0x56d0c7(0x212):''),_0xdc94de[_0x56d0c7(0x259)]=()=>{activeProject=_0x140636,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();};const _0x1d0592=document['createElement'](_0x56d0c7(0x262));_0x1d0592[_0x56d0c7(0x18e)]='project-name',_0x1d0592[_0x56d0c7(0x22f)]=projects[_0x140636][_0x56d0c7(0x160)]||'画像'+(_0x140636+0x1),_0x1d0592[_0x56d0c7(0x24c)]=_0x56d0c7(0x19a),_0x1d0592[_0x56d0c7(0x259)]=_0x1e8638=>{_0x1e8638['stopPropagation'](),editProjectName(_0x140636,_0x1d0592);},_0xdc94de[_0x56d0c7(0x245)](_0x1d0592);const _0x42e9f3=document[_0x56d0c7(0x234)](_0x56d0c7(0x1a3));_0x42e9f3[_0x56d0c7(0x22f)]='削除',_0x42e9f3[_0x56d0c7(0x18e)]=_0x56d0c7(0x151),_0x42e9f3[_0x56d0c7(0x1ef)]=projects[_0x56d0c7(0x1af)]===0x1,_0x42e9f3[_0x56d0c7(0x259)]=_0x1ad63a=>{const _0x57817a=_0x56d0c7;_0x1ad63a[_0x57817a(0x1bf)](),removeProjectAt(_0x140636);},_0xdc94de[_0x56d0c7(0x245)](_0x42e9f3),_0x46ab90[_0x56d0c7(0x245)](_0xdc94de);}document[_0x56d0c7(0x17e)](_0x56d0c7(0x135))[_0x56d0c7(0x22f)]='('+projects[_0x56d0c7(0x1af)]+'枚)';}function editProjectName(_0xb0faaf,_0x19af90){const _0x63e98f=a0_0x45dd2d,_0xa1effa=document[_0x63e98f(0x234)](_0x63e98f(0x267));_0xa1effa[_0x63e98f(0x235)]=_0x63e98f(0x23c),_0xa1effa['value']=projects[_0xb0faaf][_0x63e98f(0x160)]||'画像'+(_0xb0faaf+0x1),_0xa1effa['className']='project-name-edit',_0xa1effa[_0x63e98f(0x27b)][_0x63e98f(0x17a)]=_0x63e98f(0x1dd),_0xa1effa['onblur']=()=>{const _0xfd36cc=_0x63e98f;projects[_0xb0faaf][_0xfd36cc(0x160)]=_0xa1effa[_0xfd36cc(0x1c7)][_0xfd36cc(0x1f6)]()||'画像'+(_0xb0faaf+0x1),updateProjectUI();},_0xa1effa['onkeydown']=_0x160aea=>{const _0x39e823=_0x63e98f;if(_0x160aea[_0x39e823(0x19c)]==='Enter')_0xa1effa[_0x39e823(0x197)]();},_0x19af90['replaceWith'](_0xa1effa),_0xa1effa[_0x63e98f(0x1c9)](),_0xa1effa[_0x63e98f(0x241)]();}function showNewProjectDialog(_0x1f6015){const _0x1a1414=a0_0x45dd2d;let _0x1c4640=document[_0x1a1414(0x17e)](_0x1a1414(0x211));if(_0x1c4640)_0x1c4640[_0x1a1414(0x1d1)]();const _0x502180=document[_0x1a1414(0x234)](_0x1a1414(0x249));_0x502180['id']='new-project-dialog',_0x502180[_0x1a1414(0x27b)][_0x1a1414(0x274)]=_0x1a1414(0x14e),_0x502180['style'][_0x1a1414(0x1f3)]='0',_0x502180[_0x1a1414(0x27b)][_0x1a1414(0x147)]='0',_0x502180['style'][_0x1a1414(0x17a)]=_0x1a1414(0x193),_0x502180['style']['height']=_0x1a1414(0x1c8),_0x502180[_0x1a1414(0x27b)]['background']=_0x1a1414(0x20d),_0x502180[_0x1a1414(0x27b)]['display']=_0x1a1414(0x16f),_0x502180[_0x1a1414(0x27b)]['alignItems']=_0x1a1414(0x1d8),_0x502180[_0x1a1414(0x27b)][_0x1a1414(0x1f9)]=_0x1a1414(0x1d8),_0x502180[_0x1a1414(0x27b)]['zIndex']=_0x1a1414(0x1e2),_0x502180[_0x1a1414(0x239)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:#fff;\x20border-radius:10px;\x20box-shadow:0\x202px\x2016px\x20#0003;\x20padding:28px\x2032px;\x20min-width:240px;\x20text-align:center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x22>新しい画像のサイズ</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:12px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>名前:\x20<input\x20id=\x22newProjName\x22\x20type=\x22text\x22\x20maxlength=\x2232\x22\x20value=\x22画像'+(projects['length']+0x1)+'\x22\x20style=\x22width:120px;\x22></label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:12px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>幅:\x20<input\x20id=\x22newProjW\x22\x20type=\x22number\x22\x20min=\x221\x22\x20max=\x22256\x22\x20value=\x2216\x22\x20style=\x22width:60px;\x22></label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22margin-left:12px;\x22>高さ:\x20<input\x20id=\x22newProjH\x22\x20type=\x22number\x22\x20min=\x221\x22\x20max=\x22256\x22\x20value=\x2216\x22\x20style=\x22width:60px;\x22></label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22newProjOkBtn\x22>作成</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22newProjCancelBtn\x22\x20style=\x22margin-left:12px;\x22>キャンセル</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20',document[_0x1a1414(0x142)][_0x1a1414(0x245)](_0x502180),_0x502180['querySelector'](_0x1a1414(0x244))[_0x1a1414(0x259)]=()=>{const _0x95199b=_0x1a1414,_0x366bd6=parseInt(_0x502180[_0x95199b(0x169)]('#newProjW')[_0x95199b(0x1c7)],0xa),_0x3a31f6=parseInt(_0x502180['querySelector'](_0x95199b(0x1f0))[_0x95199b(0x1c7)],0xa),_0xbca396=_0x502180[_0x95199b(0x169)](_0x95199b(0x1e5))[_0x95199b(0x1c7)][_0x95199b(0x1f6)]();_0x502180[_0x95199b(0x1d1)]();if(_0x1f6015)_0x1f6015(_0x366bd6,_0x3a31f6,_0xbca396);},_0x502180['querySelector'](_0x1a1414(0x25d))[_0x1a1414(0x259)]=()=>{const _0x1b14ee=_0x1a1414;_0x502180[_0x1b14ee(0x1d1)]();};}function addProject(){showNewProjectDialog((_0xd1d244,_0x144d04,_0x3322bf)=>{const _0x22b9af=a0_0x4a77;if(!Number[_0x22b9af(0x278)](_0xd1d244)||_0xd1d244<0x1)_0xd1d244=0x10;if(!Number[_0x22b9af(0x278)](_0x144d04)||_0x144d04<0x1)_0x144d04=0x10;projects[_0x22b9af(0x159)](createProject(_0xd1d244,_0x144d04,_0x3322bf)),activeProject=projects[_0x22b9af(0x1af)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();});}function removeProjectAt(_0xca379f){const _0xb9d6c7=a0_0x45dd2d;if(projects[_0xb9d6c7(0x1af)]<=0x1)return;projects[_0xb9d6c7(0x13a)](_0xca379f,0x1);if(activeProject>=projects[_0xb9d6c7(0x1af)])activeProject=projects['length']-0x1;updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentProject(){return projects[activeProject];}function updateFrameUI(){const _0x2a9fbf=a0_0x45dd2d,_0x461ba6=document['getElementById'](_0x2a9fbf(0x1ec)),_0x532fb2=getCurrentProject();_0x461ba6[_0x2a9fbf(0x239)]='';for(let _0x4f2a87=0x0;_0x4f2a87<_0x532fb2[_0x2a9fbf(0x1cb)][_0x2a9fbf(0x1af)];_0x4f2a87++){const _0x15d775=document[_0x2a9fbf(0x234)]('div');_0x15d775[_0x2a9fbf(0x18e)]=_0x2a9fbf(0x15e)+(_0x4f2a87===_0x532fb2[_0x2a9fbf(0x13c)]?_0x2a9fbf(0x212):''),_0x15d775['onclick']=()=>{_0x532fb2['activeFrame']=_0x4f2a87,updateFrameUI(),updateLayerUI(),redrawAll();};const _0x20ec56=document['createElement'](_0x2a9fbf(0x1e6));_0x20ec56[_0x2a9fbf(0x18e)]=_0x2a9fbf(0x22b),_0x20ec56[_0x2a9fbf(0x17a)]=0x20,_0x20ec56[_0x2a9fbf(0x189)]=0x20;let _0x39dada=_0x20ec56[_0x2a9fbf(0x237)]('2d');_0x39dada[_0x2a9fbf(0x140)](0x0,0x0,0x20,0x20);for(let _0x377c79=0x0;_0x377c79<_0x532fb2['frames'][_0x4f2a87][_0x2a9fbf(0x1f7)][_0x2a9fbf(0x1af)];_0x377c79++){_0x39dada['drawImage'](_0x532fb2[_0x2a9fbf(0x1cb)][_0x4f2a87][_0x2a9fbf(0x1f7)][_0x377c79],0x0,0x0,_0x20ec56[_0x2a9fbf(0x17a)],_0x20ec56[_0x2a9fbf(0x189)]);}_0x15d775[_0x2a9fbf(0x245)](_0x20ec56);const _0x5b3b07=document['createElement'](_0x2a9fbf(0x262));_0x5b3b07[_0x2a9fbf(0x22f)]='F'+(_0x4f2a87+0x1),_0x15d775[_0x2a9fbf(0x245)](_0x5b3b07);const _0x2c71e7=document[_0x2a9fbf(0x234)](_0x2a9fbf(0x1a3));_0x2c71e7[_0x2a9fbf(0x22f)]='削除',_0x2c71e7['className']=_0x2a9fbf(0x173),_0x2c71e7[_0x2a9fbf(0x1ef)]=_0x532fb2[_0x2a9fbf(0x1cb)][_0x2a9fbf(0x1af)]===0x1,_0x2c71e7['onclick']=_0x442ba4=>{const _0x4c57=_0x2a9fbf;_0x442ba4[_0x4c57(0x1bf)](),removeFrameAt(_0x4f2a87);},_0x15d775[_0x2a9fbf(0x245)](_0x2c71e7),_0x461ba6[_0x2a9fbf(0x245)](_0x15d775);}document[_0x2a9fbf(0x17e)]('frameCount')[_0x2a9fbf(0x22f)]='('+_0x532fb2[_0x2a9fbf(0x1cb)][_0x2a9fbf(0x1af)]+_0x2a9fbf(0x1e4);}function addFrame(){const _0x56c922=a0_0x45dd2d;let _0x466f23=getCurrentProject(),_0x1cfdb9=_0x466f23[_0x56c922(0x1cb)][_0x466f23[_0x56c922(0x13c)]],_0x49b203=_0x1cfdb9[_0x56c922(0x1f7)][_0x56c922(0x177)](_0x376a3=>{const _0xaaf659=_0x56c922;let _0x15e8e8=document[_0xaaf659(0x234)](_0xaaf659(0x1e6));return _0x15e8e8[_0xaaf659(0x17a)]=_0x376a3[_0xaaf659(0x17a)],_0x15e8e8[_0xaaf659(0x189)]=_0x376a3[_0xaaf659(0x189)],_0x15e8e8['getContext']('2d')[_0xaaf659(0x190)](_0x376a3,0x0,0x0),_0x15e8e8;}),_0x2c6b58=_0x49b203['map'](()=>[]),_0x4ca5d5=_0x49b203['map'](()=>[]),_0x33ac08={'layers':_0x49b203,'activeLayer':0x0,'layerHistories':_0x2c6b58,'layerRedoStacks':_0x4ca5d5};_0x466f23[_0x56c922(0x1cb)][_0x56c922(0x13a)](_0x466f23[_0x56c922(0x13c)]+0x1,0x0,_0x33ac08),_0x466f23[_0x56c922(0x13c)]++,updateFrameUI(),updateLayerUI(),redrawAll();}function removeFrameAt(_0x4cc895){const _0x1308a2=a0_0x45dd2d;let _0x4e7df3=getCurrentProject();if(_0x4e7df3['frames'][_0x1308a2(0x1af)]<=0x1)return;_0x4e7df3[_0x1308a2(0x1cb)][_0x1308a2(0x13a)](_0x4cc895,0x1);if(_0x4e7df3[_0x1308a2(0x13c)]>=_0x4e7df3[_0x1308a2(0x1cb)][_0x1308a2(0x1af)])_0x4e7df3[_0x1308a2(0x13c)]=_0x4e7df3[_0x1308a2(0x1cb)][_0x1308a2(0x1af)]-0x1;updateFrameUI(),updateLayerUI(),redrawAll();}function getCurrentFrame(){const _0x22f0d3=a0_0x45dd2d;return getCurrentProject()['frames'][getCurrentProject()[_0x22f0d3(0x13c)]];}function updateLayerUI(){const _0x17d5e5=a0_0x45dd2d;let {layers:_0x5b2a63,activeLayer:_0x3736f}=getCurrentFrame();document['getElementById'](_0x17d5e5(0x15b))[_0x17d5e5(0x22f)]='('+_0x5b2a63[_0x17d5e5(0x1af)]+'枚)';const _0x5d521b=document[_0x17d5e5(0x17e)](_0x17d5e5(0x20c));_0x5d521b['innerHTML']='';for(let _0x431fad=_0x5b2a63[_0x17d5e5(0x1af)]-0x1;_0x431fad>=0x0;_0x431fad--){const _0x5b3ae3=document['createElement']('div');_0x5b3ae3['className']=_0x17d5e5(0x21c)+(_0x431fad===_0x3736f?_0x17d5e5(0x212):''),_0x5b3ae3[_0x17d5e5(0x259)]=_0xd8dac=>{const _0x434a5b=_0x17d5e5;if(_0xd8dac[_0x434a5b(0x22d)][_0x434a5b(0x18a)][_0x434a5b(0x220)](_0x434a5b(0x137)))return;getCurrentFrame()['activeLayer']=_0x431fad,updateLayerUI(),redrawAll();};const _0x5ca1f2=document[_0x17d5e5(0x234)](_0x17d5e5(0x1e6));_0x5ca1f2[_0x17d5e5(0x18e)]=_0x17d5e5(0x136),_0x5ca1f2['width']=0x20,_0x5ca1f2[_0x17d5e5(0x189)]=0x20;let _0x55e1f3=_0x5ca1f2[_0x17d5e5(0x237)]('2d');_0x55e1f3[_0x17d5e5(0x140)](0x0,0x0,0x20,0x20),_0x55e1f3['drawImage'](_0x5b2a63[_0x431fad],0x0,0x0,_0x5ca1f2['width'],_0x5ca1f2[_0x17d5e5(0x189)]),_0x5b3ae3['appendChild'](_0x5ca1f2);const _0x53f2bb=document[_0x17d5e5(0x234)](_0x17d5e5(0x262));_0x53f2bb[_0x17d5e5(0x22f)]=_0x17d5e5(0x16c)+(_0x431fad+0x1),_0x5b3ae3[_0x17d5e5(0x245)](_0x53f2bb);const _0x122e46=document[_0x17d5e5(0x234)](_0x17d5e5(0x1a3));_0x122e46[_0x17d5e5(0x22f)]='↑',_0x122e46[_0x17d5e5(0x18e)]=_0x17d5e5(0x137),_0x122e46[_0x17d5e5(0x24c)]='上に移動',_0x122e46[_0x17d5e5(0x1ef)]=_0x431fad===_0x5b2a63[_0x17d5e5(0x1af)]-0x1,_0x122e46['onclick']=_0x512ba6=>{const _0x22456f=_0x17d5e5;_0x512ba6[_0x22456f(0x1bf)](),_0x431fad<_0x5b2a63[_0x22456f(0x1af)]-0x1&&swapLayer(_0x431fad,_0x431fad+0x1);},_0x5b3ae3[_0x17d5e5(0x245)](_0x122e46);const _0x30f3e6=document[_0x17d5e5(0x234)](_0x17d5e5(0x1a3));_0x30f3e6[_0x17d5e5(0x22f)]='↓',_0x30f3e6[_0x17d5e5(0x18e)]='layer-btn',_0x30f3e6['title']=_0x17d5e5(0x174),_0x30f3e6[_0x17d5e5(0x1ef)]=_0x431fad===0x0,_0x30f3e6[_0x17d5e5(0x259)]=_0xb1a53b=>{const _0x1d9fe3=_0x17d5e5;_0xb1a53b[_0x1d9fe3(0x1bf)](),_0x431fad>0x0&&swapLayer(_0x431fad,_0x431fad-0x1);},_0x5b3ae3[_0x17d5e5(0x245)](_0x30f3e6);const _0x2edf18=document[_0x17d5e5(0x234)](_0x17d5e5(0x1a3));_0x2edf18[_0x17d5e5(0x22f)]='削除',_0x2edf18['className']=_0x17d5e5(0x137),_0x2edf18[_0x17d5e5(0x24c)]=_0x17d5e5(0x232),_0x2edf18['disabled']=_0x5b2a63[_0x17d5e5(0x1af)]===0x1,_0x2edf18[_0x17d5e5(0x259)]=_0x340e8c=>{_0x340e8c['stopPropagation'](),removeLayerAt(_0x431fad);},_0x5b3ae3[_0x17d5e5(0x245)](_0x2edf18),_0x5d521b[_0x17d5e5(0x245)](_0x5b3ae3);}}function swapLayer(_0x3bac4e,_0x25dc85){const _0x1a2ca0=a0_0x45dd2d;let _0x251400=getCurrentFrame();[_0x251400[_0x1a2ca0(0x1f7)][_0x3bac4e],_0x251400[_0x1a2ca0(0x1f7)][_0x25dc85]]=[_0x251400[_0x1a2ca0(0x1f7)][_0x25dc85],_0x251400[_0x1a2ca0(0x1f7)][_0x3bac4e]],[_0x251400[_0x1a2ca0(0x260)][_0x3bac4e],_0x251400[_0x1a2ca0(0x260)][_0x25dc85]]=[_0x251400[_0x1a2ca0(0x260)][_0x25dc85],_0x251400['layerHistories'][_0x3bac4e]],[_0x251400['layerRedoStacks'][_0x3bac4e],_0x251400[_0x1a2ca0(0x224)][_0x25dc85]]=[_0x251400[_0x1a2ca0(0x224)][_0x25dc85],_0x251400[_0x1a2ca0(0x224)][_0x3bac4e]];if(_0x251400[_0x1a2ca0(0x15f)]===_0x3bac4e)_0x251400['activeLayer']=_0x25dc85;else{if(_0x251400[_0x1a2ca0(0x15f)]===_0x25dc85)_0x251400['activeLayer']=_0x3bac4e;}updateLayerUI(),redrawAll();}function removeLayerAt(_0x541925){const _0xa91dd6=a0_0x45dd2d;let _0x4e2b04=getCurrentFrame();if(_0x4e2b04[_0xa91dd6(0x1f7)]['length']<=0x1)return;_0x4e2b04[_0xa91dd6(0x1f7)]['splice'](_0x541925,0x1),_0x4e2b04[_0xa91dd6(0x260)]['splice'](_0x541925,0x1),_0x4e2b04['layerRedoStacks'][_0xa91dd6(0x13a)](_0x541925,0x1);if(_0x4e2b04[_0xa91dd6(0x15f)]>=_0x4e2b04['layers']['length'])_0x4e2b04['activeLayer']=_0x4e2b04[_0xa91dd6(0x1f7)][_0xa91dd6(0x1af)]-0x1;updateLayerUI(),redrawAll();}function addLayer(){const _0x101172=a0_0x45dd2d;let _0x29aaf4=getCurrentProject(),_0xe09513=getCurrentFrame(),_0x34a91d=document[_0x101172(0x234)](_0x101172(0x1e6));_0x34a91d[_0x101172(0x17a)]=_0x29aaf4[_0x101172(0x17a)]*cellSize,_0x34a91d[_0x101172(0x189)]=_0x29aaf4[_0x101172(0x189)]*cellSize,_0xe09513['layers'][_0x101172(0x159)](_0x34a91d),_0xe09513[_0x101172(0x260)]['push']([]),_0xe09513['layerRedoStacks'][_0x101172(0x159)]([]),_0xe09513[_0x101172(0x15f)]=_0xe09513[_0x101172(0x1f7)][_0x101172(0x1af)]-0x1,saveHistory(),updateLayerUI(),redrawAll();}function removeLayer(){const _0xa9ef2b=a0_0x45dd2d;let _0x34c3bb=getCurrentFrame();if(_0x34c3bb[_0xa9ef2b(0x1f7)][_0xa9ef2b(0x1af)]<=0x1)return;_0x34c3bb[_0xa9ef2b(0x1f7)]['splice'](_0x34c3bb[_0xa9ef2b(0x15f)],0x1),_0x34c3bb[_0xa9ef2b(0x260)][_0xa9ef2b(0x13a)](_0x34c3bb[_0xa9ef2b(0x15f)],0x1),_0x34c3bb[_0xa9ef2b(0x224)][_0xa9ef2b(0x13a)](_0x34c3bb[_0xa9ef2b(0x15f)],0x1),_0x34c3bb[_0xa9ef2b(0x15f)]=Math['max'](0x0,_0x34c3bb[_0xa9ef2b(0x15f)]-0x1),updateLayerUI(),redrawAll();}function selectLayer(_0x36d327){const _0x219875=a0_0x45dd2d;getCurrentFrame()[_0x219875(0x15f)]=parseInt(_0x36d327),updateLayerUI();}let PALETTE_COLORS=['transparent',a0_0x45dd2d(0x1e8),'#444444','#888888',a0_0x45dd2d(0x266),a0_0x45dd2d(0x26b),a0_0x45dd2d(0x275),a0_0x45dd2d(0x205),a0_0x45dd2d(0x1b4),a0_0x45dd2d(0x246),a0_0x45dd2d(0x229),a0_0x45dd2d(0x26e),a0_0x45dd2d(0x206),'#800000',a0_0x45dd2d(0x26d),a0_0x45dd2d(0x1d4),'#008080',a0_0x45dd2d(0x168),'#800080',a0_0x45dd2d(0x194),a0_0x45dd2d(0x1f4)],currentAlpha=0x1;function setTool(_0x5d5bc0){const _0x8a54f7=a0_0x45dd2d;currentTool=_0x5d5bc0,document['querySelectorAll'](_0x8a54f7(0x1fd))[_0x8a54f7(0x1ca)](_0x5a1afd=>{const _0x6c1003=_0x8a54f7;_0x5a1afd['classList'][_0x6c1003(0x1b9)](_0x6c1003(0x1bc),_0x5a1afd[_0x6c1003(0x21f)]['tool']===_0x5d5bc0);}),document['querySelectorAll'](_0x8a54f7(0x1c0))[_0x8a54f7(0x1ca)](_0x48d158=>{const _0x4b8241=_0x8a54f7;_0x48d158[_0x4b8241(0x18a)]['toggle'](_0x4b8241(0x1bc),_0x48d158[_0x4b8241(0x21f)][_0x4b8241(0x161)]===_0x5d5bc0);}),_0x5d5bc0==='pan'?canvas['style'][_0x8a54f7(0x187)]=_0x8a54f7(0x20f):canvas[_0x8a54f7(0x27b)][_0x8a54f7(0x187)]=_0x8a54f7(0x1ae);}function setPenSize(_0x168f17){const _0x18102a=a0_0x45dd2d;penSize=parseInt(_0x168f17)||0x1;let _0x21aaac=document[_0x18102a(0x17e)]('penSize');if(_0x21aaac)_0x21aaac[_0x18102a(0x1c7)]=penSize;let _0x56e82d=document['getElementById'](_0x18102a(0x1cf));if(_0x56e82d)_0x56e82d[_0x18102a(0x1c7)]=penSize;}function setPenMode(_0x207e23){const _0x123631=a0_0x45dd2d;penMode=_0x207e23;let _0x20855=document['getElementById']('penMode');if(_0x20855)_0x20855[_0x123631(0x1c7)]=penMode;let _0x2dc87a=document['getElementById'](_0x123631(0x26a));if(_0x2dc87a)_0x2dc87a['value']=penMode;}function hexToRgba(_0x1cb306,_0x3ead48=0x1){const _0x5dc0a4=a0_0x45dd2d;if(_0x1cb306==='transparent'||_0x1cb306===_0x5dc0a4(0x227))return[0x0,0x0,0x0,0x0];_0x1cb306=_0x1cb306['replace']('#','');if(_0x1cb306['length']===0x3)_0x1cb306=_0x1cb306['split']('')['map'](_0x10a095=>_0x10a095+_0x10a095)['join']('');let _0x4ddb0d=parseInt(_0x1cb306,0x10);return[_0x4ddb0d>>0x10&0xff,_0x4ddb0d>>0x8&0xff,_0x4ddb0d&0xff,Math[_0x5dc0a4(0x149)](0xff*_0x3ead48)];}function fillAt(_0x364d1f,_0x4be84d){const _0x1eb877=a0_0x45dd2d;let _0x366964=getCurrentProject(),_0x212303=getCurrentFrame(),_0x29056b=_0x212303['layers'][_0x212303[_0x1eb877(0x15f)]]['getContext']('2d'),_0x1fa211=_0x29056b[_0x1eb877(0x1f1)](0x0,0x0,_0x366964[_0x1eb877(0x17a)]*cellSize,_0x366964[_0x1eb877(0x189)]*cellSize),_0x13eddd=_0x364d1f*cellSize,_0x860785=_0x4be84d*cellSize,_0x79daa3=getPixel(_0x1fa211,_0x13eddd,_0x860785),_0x882420=currentColor===_0x1eb877(0x1d9)||currentColor===_0x1eb877(0x227)||currentAlpha===0x0?[0x0,0x0,0x0,0x0]:hexToRgba(currentColor,currentAlpha);if(colorsMatch(_0x79daa3,_0x882420))return;let _0x55dffa=[[_0x364d1f,_0x4be84d]],_0x5a45c7=new Set();while(_0x55dffa[_0x1eb877(0x1af)]){let [_0x147604,_0x3443bd]=_0x55dffa[_0x1eb877(0x18f)]();if(_0x147604<0x0||_0x3443bd<0x0||_0x147604>=_0x366964[_0x1eb877(0x17a)]||_0x3443bd>=_0x366964[_0x1eb877(0x189)])continue;let _0x16c72f=_0x147604+','+_0x3443bd;if(_0x5a45c7[_0x1eb877(0x13b)](_0x16c72f))continue;_0x5a45c7[_0x1eb877(0x1eb)](_0x16c72f);let _0x32e7e9=_0x147604*cellSize,_0x3ecaa7=_0x3443bd*cellSize,_0x2799e6=getPixel(_0x1fa211,_0x32e7e9,_0x3ecaa7);if(!colorsMatch(_0x2799e6,_0x79daa3))continue;for(let _0x109352=0x0;_0x109352<cellSize;_0x109352++){for(let _0x4222ff=0x0;_0x4222ff<cellSize;_0x4222ff++){setPixel(_0x1fa211,_0x32e7e9+_0x4222ff,_0x3ecaa7+_0x109352,_0x882420);}}_0x55dffa[_0x1eb877(0x159)]([_0x147604+0x1,_0x3443bd]),_0x55dffa['push']([_0x147604-0x1,_0x3443bd]),_0x55dffa['push']([_0x147604,_0x3443bd+0x1]),_0x55dffa[_0x1eb877(0x159)]([_0x147604,_0x3443bd-0x1]);}_0x29056b['putImageData'](_0x1fa211,0x0,0x0),redrawAll();}function getPixel(_0x4ef703,_0x457335,_0x48ef73){const _0x25d31f=a0_0x45dd2d;let _0x3f1c6e=(_0x48ef73*_0x4ef703['width']+_0x457335)*0x4;return[_0x4ef703[_0x25d31f(0x201)][_0x3f1c6e],_0x4ef703['data'][_0x3f1c6e+0x1],_0x4ef703[_0x25d31f(0x201)][_0x3f1c6e+0x2],_0x4ef703['data'][_0x3f1c6e+0x3]];}function setPixel(_0xbe3bbf,_0x181971,_0x5de63d,_0x37cf33){const _0x32cdf3=a0_0x45dd2d;let _0x709837=(_0x5de63d*_0xbe3bbf[_0x32cdf3(0x17a)]+_0x181971)*0x4;_0xbe3bbf[_0x32cdf3(0x201)][_0x709837]=_0x37cf33[0x0],_0xbe3bbf[_0x32cdf3(0x201)][_0x709837+0x1]=_0x37cf33[0x1],_0xbe3bbf['data'][_0x709837+0x2]=_0x37cf33[0x2],_0xbe3bbf['data'][_0x709837+0x3]=_0x37cf33[0x3];}function colorsMatch(_0x4fc78f,_0x1bc21e){return _0x4fc78f[0x0]===_0x1bc21e[0x0]&&_0x4fc78f[0x1]===_0x1bc21e[0x1]&&_0x4fc78f[0x2]===_0x1bc21e[0x2]&&_0x4fc78f[0x3]===_0x1bc21e[0x3];}function handleMouseDown(_0x422453){const _0x179e97=a0_0x45dd2d;isDrawing=!![];const _0x2371ea=getCanvasCoords(_0x422453),_0xadf663=Math[_0x179e97(0x157)](_0x2371ea['x']/cellSize),_0x17c986=Math['floor'](_0x2371ea['y']/cellSize);currentTool==='fill'?(fillAt(_0xadf663,_0x17c986),saveHistory(),isDrawing=![]):drawDotXY(_0xadf663,_0x17c986);}function handleMouseMove(_0x2ceb8b){const _0x2fc585=a0_0x45dd2d;if(!isDrawing)return;const _0x53370b=getCanvasCoords(_0x2ceb8b),_0x2e96c7=Math[_0x2fc585(0x157)](_0x53370b['x']/cellSize),_0x39aba7=Math['floor'](_0x53370b['y']/cellSize);drawDotXY(_0x2e96c7,_0x39aba7);}function handleMouseUp(_0x35cbfd){isDrawing&&saveHistory(),isDrawing=![];}let lastTouch=null,isPinching=![],pinchStartDistance=0x0,pinchStartMid=null,pinchStartScale=0x1,pinchStartPosX=0x0,pinchStartPosY=0x0,pinchRect=null;function getTouchPos(_0x5d15ec){const _0x56f3a3=a0_0x45dd2d,_0x3ab9b8=canvas[_0x56f3a3(0x210)]();let _0x515ac6=_0x5d15ec[_0x56f3a3(0x1a1)]&&_0x5d15ec[_0x56f3a3(0x1a1)][0x0]?_0x5d15ec[_0x56f3a3(0x1a1)][0x0]:_0x5d15ec[_0x56f3a3(0x264)][0x0];const _0x4754c3=canvas[_0x56f3a3(0x17a)]/_0x3ab9b8[_0x56f3a3(0x17a)],_0x3ca180=canvas[_0x56f3a3(0x189)]/_0x3ab9b8[_0x56f3a3(0x189)],_0x502960=_0x515ac6[_0x56f3a3(0x21d)],_0x1a0367=_0x515ac6[_0x56f3a3(0x231)],_0x1a15ac=(_0x502960-_0x3ab9b8['left'])*_0x4754c3,_0x2700aa=(_0x1a0367-_0x3ab9b8[_0x56f3a3(0x147)])*_0x3ca180;return{'x':Math[_0x56f3a3(0x157)](_0x1a15ac/cellSize),'y':Math[_0x56f3a3(0x157)](_0x2700aa/cellSize)};}function a0_0x97ee(){const _0x504a54=['nezumi-animation.apng','isArray','.tool-btn','nezumi-sketch-db','zoomSlider','nezumi_about_visited','data','>1</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x222\x22','onmousedown','insertBefore','#ffa500','#ff00ff','byteLength','vp8','square','configure','この色をパレットから削除','layerList','rgba(0,0,0,0.3)','palette-color','grab','getBoundingClientRect','new-project-dialog','\x20active','number','arc','ontouchend','jpg','alphaValue','eraser','releasePointerCapture','1328382kcxksO','keydown','layer-item','clientX','parentNode','dataset','contains','colorPicker','replace','/about?terms=true','layerRedoStacks','onchange','log','#00000000','restore','#00ffff','nezumi-animation','frame-thumb','application/json','target','max','textContent','保存エラー','clientY','このレイヤーを削除','nezumi-sketch-save','createElement','type','nezumi-drawing','getContext','get','innerHTML','588728fJOivW','palette-alphaValue','text','lib/gif.worker.js','penMode','パレットに色を追加','72IpayZz','select','39099umwaLf','このブラウザはWebCodecsによるWEBPアニメーションに対応していません。','#newProjOkBtn','appendChild','#00ff00','pathname','onmouseleave','div','pointermove','render','title','beginPath','oninput','innerWidth','Shift','unshift','pointerType','>4</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22margin-left:8px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22palette-penMode\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22square\x22','apply','palette-add-btn','UPNG','video/webm','66995SiSyks','onclick','then','touchAction','circle','#newProjCancelBtn','toString','objectStore','layerHistories','20YYeGlS','span','ontouchstart','changedTouches','closePath','#cccccc','input','読込エラー','setPointerCapture','palette-penMode','#ffffff','beforeunload','#808000','#0000ff','touchmove','onmouseup','palette-del-btn','nezumi-sketch.msketch','stroke','position','#ff0000','zoomValue','open','isFinite','flush','pointerId','style','touch','nezumi-palette','nezumi-projects','projectCount','layer-thumb','layer-btn','lineTo','\x22\x20style=\x22vertical-align:\x20middle;\x20width:70px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22palette-alphaValue\x22>','splice','has','activeFrame','/index.html','pointerdown','download','clearRect','getItem','body','crossOrigin','revokeObjectURL','background','globalAlpha','top','pen','round','transaction','result','anonymous','boolean','fixed','preventDefault','fill','project-btn','createObjectStore','\x22\x20data-tool=\x22fill\x22\x20onclick=\x22setTool(\x27fill\x27)\x22><span\x20class=\x22material-icons\x22\x20style=\x22vertical-align:\x20middle;\x22>format_color_fill</span>塗りつぶし</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22margin-left:8px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20太さ:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22palette-penSize\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x221\x22','プロジェクトをIndexedDBに保存したチュー！','querySelectorAll','projectList','floor','\x20selected','push','min','layerCount','stringify','translate(','frame-item','activeLayer','name','tool','>丸ペン</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22margin-left:8px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20透明度:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22range\x22\x20id=\x22palette-alphaSlider\x22\x20min=\x220\x22\x20max=\x22100\x22\x20value=\x22','926658wYGTDq','buffer','project-item','touchcancel','oncomplete','#000080','querySelector','block','keyup','レイヤー','selected','WebCodecs','flex','IndexedDBからの読み込みに失敗したチュー…','strokeStyle','IndexedDBからプロジェクトを読み込んだチュー！','frame-btn','下に移動','save','.palette-color','map','jpeg','menu-toggle-btn','width','hypot','ontouchcancel','click','getElementById','\x22\x20data-tool=\x22pen\x22\x20onclick=\x22setTool(\x27pen\x27)\x22><span\x20class=\x22material-icons\x22\x20style=\x22vertical-align:\x20middle;\x22>edit</span>ペン</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tool-btn','all','(((.+)+)+)+$','createObjectURL','onupgradeneeded','error','.toggle-btn','destination-out','cursor','px)\x20scale(','height','classList','main-container','src','.section.collapsible\x20.toggle-btn','className','pop','drawImage','GIFに変換できる画像がありません。','onload','100vw','#c0c0c0','onmousemove','.section.collapsible\x20.section-content','blur','firstChild','setItem','クリックで名前を編集','保存に失敗したチュー:','key','DOMContentLoaded','\x22\x20data-tool=\x22eraser\x22\x20onclick=\x22setTool(\x27eraser\x27)\x22><span\x20class=\x22material-icons\x22\x20style=\x22vertical-align:\x20middle;\x22>delete</span>消しゴム</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tool-btn','href','image/apng','touches','sidebar-open','button','#ccc','>四角ペン</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22circle\x22','encode','sidebar','removeEventListener','addFrame','removeChild','menu-toggle-btn-close','abs','filter','crosshair','length','shift','close','onerror','#palette-alphaValue','#ffff00','onsuccess','touchend','transform','search','toggle','alphaSlider','206885ndYIXE','active','color-palette','toDataURL','stopPropagation','#palette-toolbar\x20.tool-btn','put','display','projects','85948xnDewK','moveTo','resize','value','100vh','focus','forEach','frames','ファイルの読み込みに失敗しました。','#palette-penSize','readwrite','palette-penSize','undefined','remove','addEventListener','.section-content','#008000','palette-toolbar','globalCompositeOperation','hidden','center','transparent','none','px,\x20','15cnhazn','80px','keyval','palette-alphaSlider','.webm','rgba(','3000','canvas-container','コマ)','#newProjName','canvas','overflow','#000000','image/','pan','add','frameList','GIF','image/png','disabled','#newProjH','getImageData','pointerup','left','#ff69b4','parse','trim','layers','ontouchmove','justifyContent','#palette-penMode'];a0_0x97ee=function(){return _0x504a54;};return a0_0x97ee();}function handleTouchStart(_0xe30726){const _0x1cc0b3=a0_0x45dd2d;if(_0xe30726[_0x1cc0b3(0x1a1)][_0x1cc0b3(0x1af)]===0x2){_0xe30726[_0x1cc0b3(0x14f)](),isPinching=!![],isDrawing=![];const _0x25498d=_0xe30726[_0x1cc0b3(0x1a1)][0x0],_0x426834=_0xe30726['touches'][0x1];pinchStartDistance=Math[_0x1cc0b3(0x17b)](_0x426834[_0x1cc0b3(0x21d)]-_0x25498d[_0x1cc0b3(0x21d)],_0x426834['clientY']-_0x25498d['clientY']),pinchStartMid={'clientX':(_0x25498d['clientX']+_0x426834['clientX'])/0x2,'clientY':(_0x25498d[_0x1cc0b3(0x231)]+_0x426834['clientY'])/0x2},pinchStartScale=scale,pinchStartPosX=posX,pinchStartPosY=posY,pinchRect=canvas[_0x1cc0b3(0x210)]();}else{if(_0xe30726[_0x1cc0b3(0x1a1)][_0x1cc0b3(0x1af)]===0x1){_0xe30726[_0x1cc0b3(0x14f)]();if(isPinching)return;isDrawing=!![];let _0x207395=getTouchPos(_0xe30726);lastTouch=_0x207395,currentTool==='fill'?(fillAt(_0x207395['x'],_0x207395['y']),saveHistory(),isDrawing=![]):drawDotTouch(_0x207395['x'],_0x207395['y']);}}}function handleTouchMove(_0x530b9d){const _0x323bf5=a0_0x45dd2d;if(isPinching||_0x530b9d[_0x323bf5(0x1a1)]&&_0x530b9d['touches'][_0x323bf5(0x1af)]===0x2){_0x530b9d['preventDefault']();const _0x8491eb=_0x530b9d[_0x323bf5(0x1a1)][0x0],_0x1a3a90=_0x530b9d[_0x323bf5(0x1a1)][0x1],_0x2b3bbf=Math['hypot'](_0x1a3a90[_0x323bf5(0x21d)]-_0x8491eb[_0x323bf5(0x21d)],_0x1a3a90['clientY']-_0x8491eb[_0x323bf5(0x231)]),_0x1d408a={'clientX':(_0x8491eb[_0x323bf5(0x21d)]+_0x1a3a90[_0x323bf5(0x21d)])/0x2,'clientY':(_0x8491eb['clientY']+_0x1a3a90[_0x323bf5(0x231)])/0x2};if(!pinchStartDistance)pinchStartDistance=_0x2b3bbf||0x1;const _0x453ff0=_0x2b3bbf/pinchStartDistance||0x1;let _0x9b8a8e=pinchStartScale*_0x453ff0;_0x9b8a8e=Math['min'](Math[_0x323bf5(0x22e)](_0x9b8a8e,0.2),0x5);const _0x262d5a=pinchRect||canvas['getBoundingClientRect'](),_0x359be0=(pinchStartMid[_0x323bf5(0x21d)]-_0x262d5a[_0x323bf5(0x1f3)]-pinchStartPosX)/pinchStartScale,_0x473d53=(pinchStartMid[_0x323bf5(0x231)]-_0x262d5a[_0x323bf5(0x147)]-pinchStartPosY)/pinchStartScale;posX=_0x1d408a[_0x323bf5(0x21d)]-_0x262d5a[_0x323bf5(0x1f3)]-_0x359be0*_0x9b8a8e,posY=_0x1d408a['clientY']-_0x262d5a[_0x323bf5(0x147)]-_0x473d53*_0x9b8a8e,scale=_0x9b8a8e,updateTransform();return;}if(!isDrawing)return;if(_0x530b9d[_0x323bf5(0x1a1)]&&_0x530b9d[_0x323bf5(0x1a1)][_0x323bf5(0x1af)]>0x1)return;_0x530b9d[_0x323bf5(0x14f)]();let _0x2a758d=getTouchPos(_0x530b9d);if(lastTouch){let _0x23dec6=_0x2a758d['x']-lastTouch['x'],_0x123711=_0x2a758d['y']-lastTouch['y'],_0x4f743f=Math[_0x323bf5(0x22e)](Math[_0x323bf5(0x1ac)](_0x23dec6),Math[_0x323bf5(0x1ac)](_0x123711));for(let _0x150737=0x1;_0x150737<=_0x4f743f;_0x150737++){let _0xdddab4=Math[_0x323bf5(0x149)](lastTouch['x']+_0x23dec6*_0x150737/_0x4f743f),_0x177aa8=Math[_0x323bf5(0x149)](lastTouch['y']+_0x123711*_0x150737/_0x4f743f);drawDotTouch(_0xdddab4,_0x177aa8);}}else drawDotTouch(_0x2a758d['x'],_0x2a758d['y']);lastTouch=_0x2a758d;}function handleTouchEnd(_0xa2a89a){const _0x482e24=a0_0x45dd2d;isPinching&&_0xa2a89a[_0x482e24(0x1a1)]&&_0xa2a89a[_0x482e24(0x1a1)]['length']<0x2&&(isPinching=![],pinchStartDistance=0x0,pinchStartMid=null,pinchRect=null);isDrawing&&(!_0xa2a89a[_0x482e24(0x1a1)]||_0xa2a89a[_0x482e24(0x1a1)][_0x482e24(0x1af)]===0x0)&&saveHistory();if(_0xa2a89a['touches']&&_0xa2a89a[_0x482e24(0x1a1)][_0x482e24(0x1af)]===0x1){let _0x402b1a=_0xa2a89a[_0x482e24(0x1a1)][0x0];lastTouch=getTouchPos({'touches':[_0x402b1a]}),isDrawing=!![];}else isDrawing=![],lastTouch=null;}function drawDotXY(_0x43e38a,_0x1f6c99){const _0x8a0553=a0_0x45dd2d;let _0x432a3d=getCurrentProject(),_0x10b717=getCurrentFrame();if(!_0x10b717||!_0x432a3d)return;if(typeof _0x43e38a!==_0x8a0553(0x213)||typeof _0x1f6c99!==_0x8a0553(0x213)||_0x43e38a<0x0||_0x1f6c99<0x0||!Number['isFinite'](_0x432a3d['width'])||!Number[_0x8a0553(0x278)](_0x432a3d[_0x8a0553(0x189)])||_0x43e38a>=_0x432a3d[_0x8a0553(0x17a)]||_0x1f6c99>=_0x432a3d['height']||!Array['isArray'](_0x10b717[_0x8a0553(0x1f7)])||typeof _0x10b717[_0x8a0553(0x15f)]!==_0x8a0553(0x213)||!_0x10b717[_0x8a0553(0x1f7)][_0x10b717[_0x8a0553(0x15f)]])return;let _0x1ddc48=_0x10b717[_0x8a0553(0x1f7)][_0x10b717[_0x8a0553(0x15f)]]['getContext']('2d');if(!_0x1ddc48)return;if(currentTool===_0x8a0553(0x218)||currentColor===_0x8a0553(0x1d9)||currentColor===_0x8a0553(0x227)||currentAlpha===0x0)drawPenShape(_0x1ddc48,_0x43e38a,_0x1f6c99,'#00000000',!![]);else{let _0x2029c4=hexToRgba(currentColor,currentAlpha);_0x1ddc48[_0x8a0553(0x175)](),_0x1ddc48[_0x8a0553(0x146)]=_0x2029c4[0x3]/0xff,drawPenShape(_0x1ddc48,_0x43e38a,_0x1f6c99,'rgba('+_0x2029c4[0x0]+','+_0x2029c4[0x1]+','+_0x2029c4[0x2]+','+_0x2029c4[0x3]/0xff+')',![]),_0x1ddc48[_0x8a0553(0x228)]();}redrawAll();}function drawPenShape(_0x3fca86,_0x4e9009,_0x441f30,_0x586ea7,_0x2cc369){const _0x2b3f11=a0_0x45dd2d,_0x57dc8a=_0x4e9009*cellSize,_0x142b14=_0x441f30*cellSize,_0x3f9e31=penSize*cellSize;_0x2cc369?(_0x3fca86[_0x2b3f11(0x175)](),_0x3fca86[_0x2b3f11(0x1d6)]=_0x2b3f11(0x186),penMode===_0x2b3f11(0x25c)?(_0x3fca86[_0x2b3f11(0x24d)](),_0x3fca86[_0x2b3f11(0x214)](_0x57dc8a+cellSize/0x2,_0x142b14+cellSize/0x2,_0x3f9e31/0x2,0x0,Math['PI']*0x2),_0x3fca86[_0x2b3f11(0x150)]()):_0x3fca86[_0x2b3f11(0x140)](_0x57dc8a-Math[_0x2b3f11(0x157)]((penSize-0x1)/0x2)*cellSize,_0x142b14-Math['floor']((penSize-0x1)/0x2)*cellSize,_0x3f9e31,_0x3f9e31),_0x3fca86['restore']()):(_0x3fca86[_0x2b3f11(0x175)](),_0x3fca86['fillStyle']=_0x586ea7,penMode==='circle'?(_0x3fca86['beginPath'](),_0x3fca86[_0x2b3f11(0x214)](_0x57dc8a+cellSize/0x2,_0x142b14+cellSize/0x2,_0x3f9e31/0x2,0x0,Math['PI']*0x2),_0x3fca86['fill']()):_0x3fca86['fillRect'](_0x57dc8a-Math['floor']((penSize-0x1)/0x2)*cellSize,_0x142b14-Math[_0x2b3f11(0x157)]((penSize-0x1)/0x2)*cellSize,_0x3f9e31,_0x3f9e31),_0x3fca86[_0x2b3f11(0x228)]());}function drawDotTouch(_0x435ce6,_0x35841a){const _0x3eaa8e=a0_0x45dd2d;let _0x29a8c9=getCurrentProject(),_0x200a75=getCurrentFrame();if(_0x435ce6<0x0||_0x35841a<0x0||_0x435ce6>=_0x29a8c9[_0x3eaa8e(0x17a)]||_0x35841a>=_0x29a8c9[_0x3eaa8e(0x189)])return;let _0x29161f=_0x200a75[_0x3eaa8e(0x1f7)][_0x200a75[_0x3eaa8e(0x15f)]][_0x3eaa8e(0x237)]('2d');if(currentTool===_0x3eaa8e(0x218)||currentColor===_0x3eaa8e(0x1d9)||currentColor===_0x3eaa8e(0x227)||currentAlpha===0x0)drawPenShape(_0x29161f,_0x435ce6,_0x35841a,_0x3eaa8e(0x227),!![]);else{let _0x27cf14=hexToRgba(currentColor,currentAlpha);_0x29161f[_0x3eaa8e(0x175)](),_0x29161f['globalAlpha']=_0x27cf14[0x3]/0xff,drawPenShape(_0x29161f,_0x435ce6,_0x35841a,_0x3eaa8e(0x1e1)+_0x27cf14[0x0]+','+_0x27cf14[0x1]+','+_0x27cf14[0x2]+','+_0x27cf14[0x3]/0xff+')',![]),_0x29161f[_0x3eaa8e(0x228)]();}redrawAll();}window[a0_0x45dd2d(0x192)]=()=>{const _0x4ee252=a0_0x45dd2d;projects=[createProject()],activeProject=0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),initCanvas(),setTool(_0x4ee252(0x148)),loadPaletteFromDB()['then'](()=>createPalette()),document[_0x4ee252(0x17e)]('penSize')['value']=penSize,document[_0x4ee252(0x17e)](_0x4ee252(0x23e))['value']=penMode,canvas[_0x4ee252(0x195)]=handleMouseMove,canvas[_0x4ee252(0x270)]=handleMouseUp,canvas[_0x4ee252(0x248)]=handleMouseUp,canvas[_0x4ee252(0x263)]=handleTouchStart,canvas[_0x4ee252(0x1f8)]=handleTouchMove,canvas[_0x4ee252(0x215)]=handleTouchEnd,canvas[_0x4ee252(0x17c)]=handleTouchEnd,canvas[_0x4ee252(0x1d2)]('touchstart',handleTouchStart,{'passive':![]}),canvas[_0x4ee252(0x1d2)](_0x4ee252(0x26f),handleTouchMove,{'passive':![]}),canvas[_0x4ee252(0x1d2)](_0x4ee252(0x1b6),handleTouchEnd,{'passive':![]}),canvas[_0x4ee252(0x1d2)](_0x4ee252(0x166),handleTouchEnd,{'passive':![]}),idbGet(_0x4ee252(0x27e))&&loadProjectFromIDB();};function drawGrid(_0x21c438,_0x30abaf){const _0x2fc411=a0_0x45dd2d;ctx['save'](),ctx[_0x2fc411(0x171)]=_0x2fc411(0x1a4);for(let _0x37a97b=0x0;_0x37a97b<=_0x21c438;_0x37a97b++){ctx[_0x2fc411(0x24d)](),ctx[_0x2fc411(0x1c5)](_0x37a97b*cellSize,0x0),ctx[_0x2fc411(0x138)](_0x37a97b*cellSize,_0x30abaf*cellSize),ctx[_0x2fc411(0x273)]();}for(let _0x1d0495=0x0;_0x1d0495<=_0x30abaf;_0x1d0495++){ctx[_0x2fc411(0x24d)](),ctx[_0x2fc411(0x1c5)](0x0,_0x1d0495*cellSize),ctx['lineTo'](_0x21c438*cellSize,_0x1d0495*cellSize),ctx[_0x2fc411(0x273)]();}ctx[_0x2fc411(0x228)]();}function redrawAll(){const _0x2571e0=a0_0x45dd2d;let _0x2d1a55=getCurrentProject(),_0x19de63=getCurrentFrame();canvas['width']=_0x2d1a55['width']*cellSize,canvas['height']=_0x2d1a55['height']*cellSize,ctx[_0x2571e0(0x140)](0x0,0x0,canvas[_0x2571e0(0x17a)],canvas[_0x2571e0(0x189)]);for(let _0x306b7c=0x0;_0x306b7c<_0x19de63['layers'][_0x2571e0(0x1af)];_0x306b7c++){ctx[_0x2571e0(0x190)](_0x19de63[_0x2571e0(0x1f7)][_0x306b7c],0x0,0x0);}drawGrid(_0x2d1a55[_0x2571e0(0x17a)],_0x2d1a55[_0x2571e0(0x189)]),wrapper[_0x2571e0(0x27b)][_0x2571e0(0x17a)]=_0x2d1a55[_0x2571e0(0x17a)]*cellSize+'px',wrapper['style'][_0x2571e0(0x189)]=_0x2d1a55['height']*cellSize+'px';}function saveHistory(){const _0x459cc3=a0_0x45dd2d;let _0x3a2a6a=getCurrentFrame(),_0x5cf5cd=_0x3a2a6a[_0x459cc3(0x260)][_0x3a2a6a['activeLayer']];_0x5cf5cd['push'](_0x3a2a6a[_0x459cc3(0x1f7)][_0x3a2a6a[_0x459cc3(0x15f)]][_0x459cc3(0x1be)]());if(_0x5cf5cd[_0x459cc3(0x1af)]>0x32)_0x5cf5cd[_0x459cc3(0x1b0)]();_0x3a2a6a[_0x459cc3(0x224)][_0x3a2a6a['activeLayer']]=[];}function undo(){const _0x4ab5df=a0_0x45dd2d;let _0x2358b0=getCurrentFrame(),_0xf17472=_0x2358b0['layerHistories'][_0x2358b0['activeLayer']],_0x12e261=_0x2358b0['layerRedoStacks'][_0x2358b0[_0x4ab5df(0x15f)]];if(!_0xf17472||_0xf17472[_0x4ab5df(0x1af)]<0x2)return;_0x12e261[_0x4ab5df(0x159)](_0xf17472[_0x4ab5df(0x18f)]());let _0x37ab80=new Image();_0x37ab80[_0x4ab5df(0x192)]=()=>{const _0x409595=_0x4ab5df;let _0x18667f=_0x2358b0[_0x409595(0x1f7)][_0x2358b0[_0x409595(0x15f)]]['getContext']('2d');_0x18667f[_0x409595(0x140)](0x0,0x0,_0x2358b0[_0x409595(0x1f7)][_0x2358b0[_0x409595(0x15f)]][_0x409595(0x17a)],_0x2358b0[_0x409595(0x1f7)][_0x2358b0[_0x409595(0x15f)]]['height']),_0x18667f[_0x409595(0x190)](_0x37ab80,0x0,0x0),redrawAll();},_0x37ab80[_0x4ab5df(0x18c)]=_0xf17472[_0xf17472[_0x4ab5df(0x1af)]-0x1];}function redo(){const _0x201b84=a0_0x45dd2d;let _0x32109d=getCurrentFrame(),_0x2849c4=_0x32109d[_0x201b84(0x260)][_0x32109d['activeLayer']],_0x404084=_0x32109d[_0x201b84(0x224)][_0x32109d[_0x201b84(0x15f)]];if(!_0x404084||_0x404084[_0x201b84(0x1af)]===0x0)return;let _0x1aa73f=_0x404084[_0x201b84(0x18f)]();_0x2849c4['push'](_0x1aa73f);let _0x28ce38=new Image();_0x28ce38[_0x201b84(0x192)]=()=>{const _0x3fae58=_0x201b84;let _0x40d804=_0x32109d[_0x3fae58(0x1f7)][_0x32109d[_0x3fae58(0x15f)]][_0x3fae58(0x237)]('2d');_0x40d804['clearRect'](0x0,0x0,_0x32109d[_0x3fae58(0x1f7)][_0x32109d['activeLayer']]['width'],_0x32109d[_0x3fae58(0x1f7)][_0x32109d['activeLayer']][_0x3fae58(0x189)]),_0x40d804['drawImage'](_0x28ce38,0x0,0x0),redrawAll();},_0x28ce38['src']=_0x1aa73f;}function exportImage(_0x4f5151){const _0x151e68=a0_0x45dd2d;let _0x5c2292=getCurrentProject(),_0xbbcf0c=_0x5c2292[_0x151e68(0x1cb)],_0x25bbd4=_0x4f5151===_0x151e68(0x216)||_0x4f5151==='jpeg'?'image/jpeg':_0x151e68(0x1e9)+_0x4f5151,_0x5dc529=_0xbbcf0c[_0x151e68(0x1af)]>0x1,_0x51d1e9=(_0x5c2292[_0x151e68(0x160)]||_0x151e68(0x236))[_0x151e68(0x222)](/[\\/:*?"<>|]/g,'_');if(!_0x5dc529){let _0x540cb2=document[_0x151e68(0x234)](_0x151e68(0x1e6));_0x540cb2[_0x151e68(0x17a)]=_0x5c2292[_0x151e68(0x17a)]*cellSize,_0x540cb2[_0x151e68(0x189)]=_0x5c2292['height']*cellSize;let _0x4c6116=_0x540cb2[_0x151e68(0x237)]('2d'),_0x6157c2=getCurrentFrame();for(let _0x25b692=0x0;_0x25b692<_0x6157c2['layers'][_0x151e68(0x1af)];_0x25b692++){_0x4c6116[_0x151e68(0x190)](_0x6157c2['layers'][_0x25b692],0x0,0x0);}let _0x5dfd90=document[_0x151e68(0x234)]('a');_0x5dfd90[_0x151e68(0x13f)]=_0x51d1e9+'.'+_0x4f5151,_0x4f5151==='jpg'||_0x4f5151===_0x151e68(0x178)?_0x5dfd90[_0x151e68(0x19f)]=_0x540cb2[_0x151e68(0x1be)](_0x25bbd4,0.92):_0x5dfd90[_0x151e68(0x19f)]=_0x540cb2[_0x151e68(0x1be)](_0x25bbd4),_0x5dfd90[_0x151e68(0x17d)]();}else{if(_0x4f5151==='webp'&&typeof window[_0x151e68(0x16e)]!==_0x151e68(0x1d0))exportWebpAnimation(_0xbbcf0c,_0x5c2292[_0x151e68(0x17a)]*cellSize,_0x5c2292[_0x151e68(0x189)]*cellSize,_0x51d1e9);else for(let _0x14a2d1=0x0;_0x14a2d1<_0xbbcf0c[_0x151e68(0x1af)];_0x14a2d1++){let _0xfb3ea7=document[_0x151e68(0x234)](_0x151e68(0x1e6));_0xfb3ea7[_0x151e68(0x17a)]=_0x5c2292[_0x151e68(0x17a)]*cellSize,_0xfb3ea7[_0x151e68(0x189)]=_0x5c2292['height']*cellSize;let _0x46d806=_0xfb3ea7[_0x151e68(0x237)]('2d'),_0x578fcf=_0xbbcf0c[_0x14a2d1];for(let _0x3d4bb0=0x0;_0x3d4bb0<_0x578fcf[_0x151e68(0x1f7)][_0x151e68(0x1af)];_0x3d4bb0++){_0x46d806['drawImage'](_0x578fcf['layers'][_0x3d4bb0],0x0,0x0);}let _0x22a2e6=document['createElement']('a');_0x22a2e6[_0x151e68(0x13f)]=_0x51d1e9+'-f'+(_0x14a2d1+0x1)+'.'+_0x4f5151,_0x4f5151===_0x151e68(0x216)||_0x4f5151==='jpeg'?_0x22a2e6['href']=_0xfb3ea7[_0x151e68(0x1be)](_0x25bbd4,0.92):_0x22a2e6[_0x151e68(0x19f)]=_0xfb3ea7['toDataURL'](_0x25bbd4),setTimeout(()=>_0x22a2e6[_0x151e68(0x17d)](),_0x14a2d1*0x64);}}}async function exportWebpAnimation(_0x416082,_0x5cc865,_0x33dd36,_0x3c3388=a0_0x45dd2d(0x22a)){const _0x4e4057=a0_0x45dd2d;if(!window[_0x4e4057(0x16e)]||!window['VideoEncoder']){alert(_0x4e4057(0x243));return;}const _0x230ca3=[],_0x745ad5=new VideoEncoder({'output':_0x1c92af=>_0x230ca3[_0x4e4057(0x159)](_0x1c92af),'error':_0x5eb6a7=>console[_0x4e4057(0x184)](_0x5eb6a7)});_0x745ad5[_0x4e4057(0x20a)]({'codec':_0x4e4057(0x208),'width':_0x5cc865,'height':_0x33dd36,'framerate':0x5});for(let _0x8f7b0e=0x0;_0x8f7b0e<_0x416082['length'];_0x8f7b0e++){let _0x552629=document[_0x4e4057(0x234)](_0x4e4057(0x1e6));_0x552629[_0x4e4057(0x17a)]=_0x5cc865,_0x552629[_0x4e4057(0x189)]=_0x33dd36;let _0x344ae8=_0x552629[_0x4e4057(0x237)]('2d'),_0x359761=_0x416082[_0x8f7b0e];for(let _0x349397=0x0;_0x349397<_0x359761['layers'][_0x4e4057(0x1af)];_0x349397++){_0x344ae8[_0x4e4057(0x190)](_0x359761[_0x4e4057(0x1f7)][_0x349397],0x0,0x0);}let _0x671e7f=await createImageBitmap(_0x552629);_0x745ad5['encode'](_0x671e7f,{'keyFrame':!![],'duration':0xc8}),_0x671e7f['close']();}await _0x745ad5[_0x4e4057(0x279)](),_0x745ad5[_0x4e4057(0x1b1)]();const _0x456d84=new Blob(_0x230ca3[_0x4e4057(0x177)](_0x555467=>_0x555467[_0x4e4057(0x207)]?_0x555467:_0x555467[_0x4e4057(0x201)]),{'type':_0x4e4057(0x257)}),_0x2efb69=document[_0x4e4057(0x234)]('a');_0x2efb69['download']=_0x3c3388+_0x4e4057(0x1e0),_0x2efb69[_0x4e4057(0x19f)]=URL[_0x4e4057(0x182)](_0x456d84),_0x2efb69[_0x4e4057(0x17d)]();}function exportGif(){const _0x4c7c23=a0_0x45dd2d;let _0x1ebfe8=getCurrentProject(),_0x5e7ae2=_0x1ebfe8[_0x4c7c23(0x1cb)],_0x5d5ed9=_0x1ebfe8[_0x4c7c23(0x17a)]*cellSize,_0x21db71=_0x1ebfe8[_0x4c7c23(0x189)]*cellSize;const _0x2b5e00=_0x5e7ae2[_0x4c7c23(0x177)](_0xce9844=>{const _0x81d330=_0x4c7c23;let _0x191d76=document[_0x81d330(0x234)](_0x81d330(0x1e6));_0x191d76[_0x81d330(0x17a)]=_0x5d5ed9,_0x191d76[_0x81d330(0x189)]=_0x21db71;let _0x559bb9=_0x191d76[_0x81d330(0x237)]('2d');for(let _0x3aa069=0x0;_0x3aa069<_0xce9844['layers'][_0x81d330(0x1af)];_0x3aa069++){_0x559bb9[_0x81d330(0x190)](_0xce9844[_0x81d330(0x1f7)][_0x3aa069],0x0,0x0);}return _0x191d76[_0x81d330(0x1be)](_0x81d330(0x1ee));});Promise[_0x4c7c23(0x180)](_0x2b5e00['map'](_0x56195d=>{return new Promise(_0x2e3983=>{const _0x3fc69b=a0_0x4a77,_0x16c919=new Image();_0x16c919[_0x3fc69b(0x18c)]=_0x56195d,_0x16c919[_0x3fc69b(0x192)]=()=>_0x2e3983(_0x16c919);});}))[_0x4c7c23(0x25a)](_0x234863=>{const _0x46f8c7=_0x4c7c23,_0x3e862f=_0x234863[_0x46f8c7(0x1ad)](_0x394996=>_0x394996['width']>0x0&&_0x394996[_0x46f8c7(0x189)]>0x0);if(_0x3e862f['length']===0x0){alert(_0x46f8c7(0x191));return;}const _0xb6b424=(_0x1ebfe8[_0x46f8c7(0x160)]||_0x46f8c7(0x22a))[_0x46f8c7(0x222)](/[\\/:*?"<>|]/g,'_');convertToGIF(_0x3e862f,0x12c,_0xb6b424+'.gif');});}function exportApng(){const _0x4d1e7a=a0_0x45dd2d;let _0x115228=getCurrentProject(),_0x539f04=_0x115228['frames'],_0x35f47f=_0x115228[_0x4d1e7a(0x17a)]*cellSize,_0x303eff=_0x115228['height']*cellSize;const _0x45b16b=_0x539f04[_0x4d1e7a(0x177)](_0x20dc47=>{const _0x26c812=_0x4d1e7a;let _0x5655a7=document[_0x26c812(0x234)](_0x26c812(0x1e6));_0x5655a7[_0x26c812(0x17a)]=_0x35f47f,_0x5655a7[_0x26c812(0x189)]=_0x303eff;let _0x3bf89c=_0x5655a7['getContext']('2d');for(let _0x156604=0x0;_0x156604<_0x20dc47['layers'][_0x26c812(0x1af)];_0x156604++){_0x3bf89c['drawImage'](_0x20dc47[_0x26c812(0x1f7)][_0x156604],0x0,0x0);}let _0x422062=new Image();return _0x422062['src']=_0x5655a7[_0x26c812(0x1be)]('image/png'),_0x422062;}),_0x368a3a=(_0x115228[_0x4d1e7a(0x160)]||_0x4d1e7a(0x22a))[_0x4d1e7a(0x222)](/[\\/:*?"<>|]/g,'_');convertToAPNG(_0x45b16b,_0x35f47f,_0x303eff,0x12c,_0x368a3a+'.apng');}const dbName=a0_0x45dd2d(0x1fe),storeName=a0_0x45dd2d(0x1de);function openDB(){return new Promise((_0x36ee69,_0x554a79)=>{const _0x291652=a0_0x4a77,_0x4bc25e=indexedDB['open'](dbName,0x1);_0x4bc25e[_0x291652(0x183)]=()=>{const _0x1edb36=_0x291652;_0x4bc25e[_0x1edb36(0x14b)][_0x1edb36(0x152)](storeName);},_0x4bc25e[_0x291652(0x1b5)]=()=>_0x36ee69(_0x4bc25e[_0x291652(0x14b)]),_0x4bc25e[_0x291652(0x1b2)]=()=>_0x554a79(_0x4bc25e[_0x291652(0x184)]);});}async function idbSet(_0x4a56af,_0x1e24ce){const _0xe906f1=await openDB();return new Promise((_0x461439,_0x10bd65)=>{const _0x349645=a0_0x4a77,_0x494974=_0xe906f1[_0x349645(0x14a)](storeName,_0x349645(0x1ce));_0x494974['objectStore'](storeName)[_0x349645(0x1c1)](_0x1e24ce,_0x4a56af),_0x494974[_0x349645(0x167)]=()=>_0x461439(),_0x494974[_0x349645(0x1b2)]=()=>_0x10bd65(_0x494974[_0x349645(0x184)]);});}async function idbGet(_0x3f50f0){const _0x18b7f5=await openDB();return new Promise((_0x2c77c7,_0x2ac188)=>{const _0x127dbe=a0_0x4a77,_0x539602=_0x18b7f5[_0x127dbe(0x14a)](storeName,'readonly'),_0x16c212=_0x539602['objectStore'](storeName)[_0x127dbe(0x238)](_0x3f50f0);_0x16c212[_0x127dbe(0x1b5)]=()=>_0x2c77c7(_0x16c212[_0x127dbe(0x14b)]),_0x16c212['onerror']=()=>_0x2ac188(_0x16c212[_0x127dbe(0x184)]);});}async function idbDelete(_0x24a6fb){const _0x4f49bc=await openDB();return new Promise((_0x256ad0,_0x7a52cb)=>{const _0x30311b=a0_0x4a77,_0x19357f=_0x4f49bc['transaction'](storeName,_0x30311b(0x1ce));_0x19357f[_0x30311b(0x25f)](storeName)['delete'](_0x24a6fb),_0x19357f[_0x30311b(0x167)]=()=>_0x256ad0(),_0x19357f[_0x30311b(0x1b2)]=()=>_0x7a52cb(_0x19357f['error']);});}async function idbClear(){const _0x2da7e0=await openDB();return new Promise((_0x2c9ce3,_0x172179)=>{const _0xc053cf=a0_0x4a77,_0x89721e=_0x2da7e0[_0xc053cf(0x14a)](storeName,_0xc053cf(0x1ce));_0x89721e[_0xc053cf(0x25f)](storeName)['clear'](),_0x89721e[_0xc053cf(0x167)]=()=>_0x2c9ce3(),_0x89721e[_0xc053cf(0x1b2)]=()=>_0x172179(_0x89721e[_0xc053cf(0x184)]);});}function saveProjectFile(){const _0x115374=a0_0x45dd2d,_0x2d435c={'projects':projects[_0x115374(0x177)](_0x4713f2=>({'width':_0x4713f2[_0x115374(0x17a)],'height':_0x4713f2[_0x115374(0x189)],'name':_0x4713f2[_0x115374(0x160)]||'','activeFrame':_0x4713f2[_0x115374(0x13c)],'frames':_0x4713f2[_0x115374(0x1cb)][_0x115374(0x177)](_0x3209f0=>({'activeLayer':_0x3209f0[_0x115374(0x15f)],'layers':_0x3209f0['layers'][_0x115374(0x177)](_0xb6c46=>_0xb6c46['toDataURL']())}))})),'activeProject':activeProject},_0x5207ea=new Blob([JSON[_0x115374(0x15c)](_0x2d435c)],{'type':_0x115374(0x22c)}),_0x1ab7db=document[_0x115374(0x234)]('a');_0x1ab7db['download']=_0x115374(0x272),_0x1ab7db[_0x115374(0x19f)]=URL['createObjectURL'](_0x5207ea),_0x1ab7db[_0x115374(0x17d)]();}function saveProjectFile(){const _0x86798a=a0_0x45dd2d,_0x168a04={'projects':projects[_0x86798a(0x177)](_0x264779=>({'width':_0x264779['width'],'height':_0x264779[_0x86798a(0x189)],'name':_0x264779['name']||'','activeFrame':_0x264779['activeFrame'],'frames':_0x264779['frames'][_0x86798a(0x177)](_0x216124=>({'activeLayer':_0x216124[_0x86798a(0x15f)],'layers':_0x216124[_0x86798a(0x1f7)][_0x86798a(0x177)](_0x4376e2=>_0x4376e2[_0x86798a(0x1be)]())}))})),'activeProject':activeProject},_0x6232a1=new Blob([JSON[_0x86798a(0x15c)](_0x168a04)],{'type':'application/json'}),_0x4be6f6=document['createElement']('a');_0x4be6f6[_0x86798a(0x13f)]=_0x86798a(0x272),_0x4be6f6[_0x86798a(0x19f)]=URL[_0x86798a(0x182)](_0x6232a1),_0x4be6f6[_0x86798a(0x17d)]();}function a0_0x4a77(_0x5991eb,_0x3a8d56){_0x5991eb=_0x5991eb-0x135;const _0x2da950=a0_0x97ee();let _0x36731b=_0x2da950[_0x5991eb];return _0x36731b;}async function saveProjectToIDB(){const _0x5e6cda=a0_0x45dd2d,_0x17958f={'projects':projects[_0x5e6cda(0x177)](_0x137e3b=>({'width':_0x137e3b['width'],'height':_0x137e3b['height'],'name':_0x137e3b[_0x5e6cda(0x160)]||'','activeFrame':_0x137e3b[_0x5e6cda(0x13c)],'frames':_0x137e3b[_0x5e6cda(0x1cb)]['map'](_0x474c91=>({'activeLayer':_0x474c91['activeLayer'],'layers':_0x474c91[_0x5e6cda(0x1f7)]['map'](_0x545eb3=>_0x545eb3[_0x5e6cda(0x1be)]())}))})),'activeProject':activeProject};try{await idbSet(_0x5e6cda(0x233),_0x17958f),console[_0x5e6cda(0x226)](_0x5e6cda(0x154));}catch(_0x524cdd){console[_0x5e6cda(0x184)](_0x5e6cda(0x19b),_0x524cdd);}}setInterval(()=>{saveProjectToIDB();},0x2710),window['addEventListener'](a0_0x45dd2d(0x26c),_0xf43a9a=>{saveProjectToIDB();});function loadProjectFile(_0x3110ed){const _0x1504b8=a0_0x45dd2d,_0x249bd3=_0x3110ed[_0x1504b8(0x22d)]['files'][0x0];if(!_0x249bd3)return;const _0x23822a=new FileReader();_0x23822a[_0x1504b8(0x192)]=function(_0x2d9be8){const _0x8e1996=_0x1504b8;try{const _0x1136c8=JSON[_0x8e1996(0x1f5)](_0x2d9be8[_0x8e1996(0x22d)][_0x8e1996(0x14b)]);projects=_0x1136c8['projects'][_0x8e1996(0x177)]((_0x93f510,_0x18e504)=>{const _0x3ba147=_0x8e1996;let _0x5cbc2d=createProject(_0x93f510['width'],_0x93f510['height'],_0x93f510[_0x3ba147(0x160)]||'画像'+(_0x18e504+0x1));return _0x5cbc2d[_0x3ba147(0x1cb)]=_0x93f510[_0x3ba147(0x1cb)][_0x3ba147(0x177)](_0x517c23=>{const _0x1128f4=_0x3ba147;let _0x1450c7={'layers':[],'activeLayer':_0x517c23['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x3139e6=0x0;_0x3139e6<_0x517c23['layers'][_0x1128f4(0x1af)];_0x3139e6++){let _0x26aa7e=new Image();_0x26aa7e[_0x1128f4(0x18c)]=_0x517c23[_0x1128f4(0x1f7)][_0x3139e6];let _0x44e2ea=document[_0x1128f4(0x234)]('canvas');_0x44e2ea[_0x1128f4(0x17a)]=_0x93f510[_0x1128f4(0x17a)]*cellSize,_0x44e2ea[_0x1128f4(0x189)]=_0x93f510[_0x1128f4(0x189)]*cellSize,_0x26aa7e[_0x1128f4(0x192)]=()=>{const _0x35553d=_0x1128f4;let _0x6f481a=_0x44e2ea[_0x35553d(0x237)]('2d');_0x6f481a[_0x35553d(0x140)](0x0,0x0,_0x44e2ea[_0x35553d(0x17a)],_0x44e2ea[_0x35553d(0x189)]),_0x6f481a[_0x35553d(0x190)](_0x26aa7e,0x0,0x0);},_0x26aa7e['onload'](),_0x1450c7['layers'][_0x1128f4(0x159)](_0x44e2ea),_0x1450c7[_0x1128f4(0x260)][_0x1128f4(0x159)]([]),_0x1450c7[_0x1128f4(0x224)][_0x1128f4(0x159)]([]);}return _0x1450c7;}),_0x5cbc2d['activeFrame']=_0x93f510[_0x3ba147(0x13c)],_0x5cbc2d[_0x3ba147(0x160)]=_0x93f510['name']||'画像'+(_0x18e504+0x1),_0x5cbc2d;}),activeProject=_0x1136c8['activeProject']||0x0,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();}catch(_0xd77009){alert(_0x8e1996(0x1cc));}},_0x23822a['readAsText'](_0x249bd3);}async function loadProjectFromIDB(){const _0x41ed25=a0_0x45dd2d;try{const _0x2c7881=await idbGet(_0x41ed25(0x233));if(!_0x2c7881)return;projects=_0x2c7881[_0x41ed25(0x1c3)]['map']((_0x5c32a1,_0xc29e2f)=>{const _0x3e55c7=_0x41ed25;let _0x21e4f3=createProject(_0x5c32a1[_0x3e55c7(0x17a)],_0x5c32a1[_0x3e55c7(0x189)],_0x5c32a1[_0x3e55c7(0x160)]||'画像'+(_0xc29e2f+0x1));return _0x21e4f3['frames']=_0x5c32a1[_0x3e55c7(0x1cb)]['map'](_0x25019d=>{const _0x2d73de=_0x3e55c7;let _0x4f7ffe={'layers':[],'activeLayer':_0x25019d[_0x2d73de(0x15f)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x15c2a2=0x0;_0x15c2a2<_0x25019d[_0x2d73de(0x1f7)][_0x2d73de(0x1af)];_0x15c2a2++){let _0x5ddb50=new Image();_0x5ddb50[_0x2d73de(0x18c)]=_0x25019d[_0x2d73de(0x1f7)][_0x15c2a2];let _0x277949=document['createElement'](_0x2d73de(0x1e6));_0x277949[_0x2d73de(0x17a)]=_0x5c32a1['width']*cellSize,_0x277949[_0x2d73de(0x189)]=_0x5c32a1[_0x2d73de(0x189)]*cellSize,_0x5ddb50[_0x2d73de(0x192)]=()=>{const _0x323700=_0x2d73de;let _0x90b06a=_0x277949[_0x323700(0x237)]('2d');_0x90b06a[_0x323700(0x140)](0x0,0x0,_0x277949[_0x323700(0x17a)],_0x277949[_0x323700(0x189)]),_0x90b06a[_0x323700(0x190)](_0x5ddb50,0x0,0x0);},_0x4f7ffe[_0x2d73de(0x1f7)][_0x2d73de(0x159)](_0x277949),_0x4f7ffe['layerHistories'][_0x2d73de(0x159)]([]),_0x4f7ffe[_0x2d73de(0x224)][_0x2d73de(0x159)]([]);}return _0x4f7ffe;}),_0x21e4f3['activeFrame']=_0x5c32a1[_0x3e55c7(0x13c)],_0x21e4f3[_0x3e55c7(0x160)]=_0x5c32a1[_0x3e55c7(0x160)]||'画像'+(_0xc29e2f+0x1),_0x21e4f3;}),activeProject=_0x2c7881['activeProject']||0x0,await wait(0x64),updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll(),setTool(_0x41ed25(0x148)),console[_0x41ed25(0x226)](_0x41ed25(0x172));}catch(_0x4dba15){alert(_0x41ed25(0x170)),console['error'](_0x4dba15);}}function wait(_0x4f4ade){return new Promise(_0x47d0ae=>setTimeout(_0x47d0ae,_0x4f4ade));}function initCanvas(){const _0x5ee969=a0_0x45dd2d,_0x562fff=parseInt(0x10),_0x2eae4d=parseInt(0x10);let _0x21db14=getCurrentProject();_0x21db14[_0x5ee969(0x17a)]=_0x562fff,_0x21db14['height']=_0x2eae4d,canvas[_0x5ee969(0x17a)]=_0x562fff*cellSize,canvas[_0x5ee969(0x189)]=_0x2eae4d*cellSize,_0x21db14[_0x5ee969(0x1f7)]=[],_0x21db14[_0x5ee969(0x260)]=[],_0x21db14[_0x5ee969(0x224)]=[];let _0x12dd45=document[_0x5ee969(0x234)](_0x5ee969(0x1e6));_0x12dd45[_0x5ee969(0x17a)]=_0x562fff*cellSize,_0x12dd45[_0x5ee969(0x189)]=_0x2eae4d*cellSize,_0x21db14[_0x5ee969(0x1f7)][_0x5ee969(0x159)](_0x12dd45),_0x21db14[_0x5ee969(0x260)]['push']([]),_0x21db14[_0x5ee969(0x224)][_0x5ee969(0x159)]([]),_0x21db14[_0x5ee969(0x15f)]=0x0,saveHistory(),updateFrameUI(),updateLayerUI(),redrawAll(),canvas[_0x5ee969(0x203)]=null,canvas[_0x5ee969(0x195)]=null,canvas[_0x5ee969(0x270)]=null,canvas[_0x5ee969(0x248)]=null,canvas[_0x5ee969(0x263)]=null,canvas[_0x5ee969(0x1f8)]=null,canvas['ontouchend']=null,canvas['ontouchcancel']=null,canvas[_0x5ee969(0x1a8)]('touchstart',handleTouchStart),canvas[_0x5ee969(0x1a8)]('touchmove',handleTouchMove),canvas[_0x5ee969(0x1a8)](_0x5ee969(0x1b6),handleTouchEnd),canvas[_0x5ee969(0x1a8)](_0x5ee969(0x166),handleTouchEnd),canvas[_0x5ee969(0x203)]=handleMouseDown,canvas['onmousemove']=handleMouseMove,canvas[_0x5ee969(0x270)]=handleMouseUp,canvas['onmouseleave']=handleMouseUp,canvas[_0x5ee969(0x263)]=handleTouchStart,canvas[_0x5ee969(0x1f8)]=handleTouchMove,canvas[_0x5ee969(0x215)]=handleTouchEnd,canvas[_0x5ee969(0x17c)]=handleTouchEnd,canvas[_0x5ee969(0x1d2)]('touchstart',handleTouchStart,{'passive':![]}),canvas[_0x5ee969(0x1d2)](_0x5ee969(0x26f),handleTouchMove,{'passive':![]}),canvas[_0x5ee969(0x1d2)](_0x5ee969(0x1b6),handleTouchEnd,{'passive':![]}),canvas[_0x5ee969(0x1d2)](_0x5ee969(0x166),handleTouchEnd,{'passive':![]});}function createPalette(){const _0x2c5bf0=a0_0x45dd2d,_0x40fe72=document['getElementById'](_0x2c5bf0(0x1bd));if(!_0x40fe72)return;_0x40fe72[_0x2c5bf0(0x239)]='',PALETTE_COLORS['forEach']((_0x25a8ef,_0x53ebfb)=>{const _0x47ef2a=_0x2c5bf0,_0xd00141=document['createElement'](_0x47ef2a(0x1a3));_0xd00141['className']=_0x47ef2a(0x20e);_0x25a8ef===_0x47ef2a(0x1d9)||_0x25a8ef==='#00000000'?(_0xd00141[_0x47ef2a(0x27b)]['background']='repeating-conic-gradient(#eee\x200%\x2025%,\x20#fff\x200%\x2050%)\x2050%\x20/\x2016px\x2016px',_0xd00141[_0x47ef2a(0x24c)]='透明',_0xd00141[_0x47ef2a(0x239)]='<span\x20style=\x22font-size:13px;color:#888;\x22>透明</span>'):(_0xd00141['style'][_0x47ef2a(0x145)]=_0x25a8ef,_0xd00141['title']=_0x25a8ef);_0xd00141[_0x47ef2a(0x259)]=()=>{const _0x2ba4f1=_0x47ef2a;currentColor=_0x25a8ef,_0x25a8ef===_0x2ba4f1(0x1d9)||_0x25a8ef===_0x2ba4f1(0x227)?document[_0x2ba4f1(0x17e)](_0x2ba4f1(0x221))[_0x2ba4f1(0x1c7)]=_0x2ba4f1(0x1e8):document['getElementById'](_0x2ba4f1(0x221))[_0x2ba4f1(0x1c7)]=_0x25a8ef,document[_0x2ba4f1(0x155)](_0x2ba4f1(0x176))[_0x2ba4f1(0x1ca)](_0x5b3a69=>_0x5b3a69['classList']['remove'](_0x2ba4f1(0x16d))),_0xd00141['classList'][_0x2ba4f1(0x1eb)](_0x2ba4f1(0x16d));};if(_0x53ebfb!==0x0){const _0x3c33ab=document['createElement'](_0x47ef2a(0x262));_0x3c33ab[_0x47ef2a(0x22f)]='×',_0x3c33ab[_0x47ef2a(0x18e)]=_0x47ef2a(0x271),_0x3c33ab[_0x47ef2a(0x24c)]=_0x47ef2a(0x20b),_0x3c33ab[_0x47ef2a(0x259)]=_0x24adae=>{const _0x5396ca=_0x47ef2a;_0x24adae['stopPropagation'](),PALETTE_COLORS[_0x5396ca(0x1af)]>0x2&&(PALETTE_COLORS[_0x5396ca(0x13a)](_0x53ebfb,0x1),createPalette());},_0xd00141[_0x47ef2a(0x245)](_0x3c33ab);}_0x40fe72['appendChild'](_0xd00141);});const _0x61d16a=document[_0x2c5bf0(0x234)](_0x2c5bf0(0x1a3));_0x61d16a[_0x2c5bf0(0x18e)]=_0x2c5bf0(0x255),_0x61d16a['title']=_0x2c5bf0(0x23f),_0x61d16a[_0x2c5bf0(0x239)]='+',_0x61d16a[_0x2c5bf0(0x259)]=_0x1b5cbe=>{const _0x44bf8b=_0x2c5bf0;_0x1b5cbe[_0x44bf8b(0x1bf)]();const _0x489eb5=document['createElement'](_0x44bf8b(0x267));_0x489eb5[_0x44bf8b(0x235)]='color',_0x489eb5[_0x44bf8b(0x27b)][_0x44bf8b(0x1c2)]='none';let _0x314d4f=![];_0x489eb5['oninput']=_0x59d4b4=>{const _0x58e300=_0x44bf8b;if(!_0x314d4f){PALETTE_COLORS[_0x58e300(0x251)](_0x59d4b4[_0x58e300(0x22d)][_0x58e300(0x1c7)]);if(PALETTE_COLORS[_0x58e300(0x1af)]>0x18)PALETTE_COLORS=PALETTE_COLORS['slice'](0x0,0x18);savePaletteToDB(),createPalette(),_0x314d4f=!![],_0x489eb5[_0x58e300(0x1d1)]();}},_0x489eb5['addEventListener'](_0x44bf8b(0x197),()=>{if(!_0x314d4f)_0x489eb5['remove']();}),_0x489eb5[_0x44bf8b(0x1d2)](_0x44bf8b(0x17d),_0x5bdf5a=>_0x5bdf5a[_0x44bf8b(0x1bf)]()),document[_0x44bf8b(0x142)][_0x44bf8b(0x245)](_0x489eb5),_0x489eb5[_0x44bf8b(0x1c9)](),_0x489eb5[_0x44bf8b(0x17d)]();},_0x40fe72[_0x2c5bf0(0x204)](_0x61d16a,_0x40fe72[_0x2c5bf0(0x198)]);let _0x578e9d=document[_0x2c5bf0(0x17e)](_0x2c5bf0(0x1d5));!_0x578e9d&&(_0x578e9d=document[_0x2c5bf0(0x234)](_0x2c5bf0(0x249)),_0x578e9d['id']=_0x2c5bf0(0x1d5),_0x578e9d[_0x2c5bf0(0x18e)]=_0x2c5bf0(0x1d5),_0x40fe72[_0x2c5bf0(0x21e)]['appendChild'](_0x578e9d)),_0x578e9d[_0x2c5bf0(0x239)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22tool-btn'+(currentTool===_0x2c5bf0(0x148)?'\x20active':'')+_0x2c5bf0(0x17f)+(currentTool==='eraser'?_0x2c5bf0(0x212):'')+_0x2c5bf0(0x19e)+(currentTool==='fill'?_0x2c5bf0(0x212):'')+_0x2c5bf0(0x153)+(penSize==0x1?'\x20selected':'')+_0x2c5bf0(0x202)+(penSize==0x2?_0x2c5bf0(0x158):'')+'>2</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x223\x22'+(penSize==0x3?_0x2c5bf0(0x158):'')+'>3</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x224\x22'+(penSize==0x4?'\x20selected':'')+_0x2c5bf0(0x253)+(penMode==='square'?_0x2c5bf0(0x158):'')+_0x2c5bf0(0x1a5)+(penMode===_0x2c5bf0(0x25c)?_0x2c5bf0(0x158):'')+_0x2c5bf0(0x162)+Math['round'](currentAlpha*0x64)+_0x2c5bf0(0x139)+Math[_0x2c5bf0(0x149)](currentAlpha*0x64)+'%</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22undo()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22material-icons\x22\x20style=\x22vertical-align:\x20middle;\x22>undo</span>\x20戻す\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22redo()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22material-icons\x22\x20style=\x22vertical-align:\x20middle;\x22>redo</span>\x20戻すを戻す\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20',_0x578e9d[_0x2c5bf0(0x169)](_0x2c5bf0(0x1cd))[_0x2c5bf0(0x225)]=_0x298cf5=>setPenSize(_0x298cf5[_0x2c5bf0(0x22d)]['value']),_0x578e9d[_0x2c5bf0(0x169)](_0x2c5bf0(0x1fa))[_0x2c5bf0(0x225)]=_0x5789cf=>setPenMode(_0x5789cf[_0x2c5bf0(0x22d)][_0x2c5bf0(0x1c7)]),_0x578e9d[_0x2c5bf0(0x155)]('.tool-btn')[_0x2c5bf0(0x1ca)](_0x517d8f=>{const _0x356516=_0x2c5bf0;_0x517d8f[_0x356516(0x259)]=()=>setTool(_0x517d8f[_0x356516(0x21f)]['tool']);}),_0x578e9d[_0x2c5bf0(0x169)]('#palette-alphaSlider')['oninput']=_0x511c3e=>{const _0xb15b36=_0x2c5bf0;setAlpha(_0x511c3e[_0xb15b36(0x22d)][_0xb15b36(0x1c7)]),_0x578e9d[_0xb15b36(0x169)](_0xb15b36(0x1b3))[_0xb15b36(0x22f)]=_0x511c3e[_0xb15b36(0x22d)]['value']+'%';let _0x55c070=document[_0xb15b36(0x17e)](_0xb15b36(0x1ba)),_0x3f0cd5=document['getElementById'](_0xb15b36(0x217));if(_0x55c070)_0x55c070[_0xb15b36(0x1c7)]=_0x511c3e['target'][_0xb15b36(0x1c7)];if(_0x3f0cd5)_0x3f0cd5[_0xb15b36(0x22f)]=_0x511c3e[_0xb15b36(0x22d)][_0xb15b36(0x1c7)]+'%';};}function setAlpha(_0x5ad8aa){const _0x2618c7=a0_0x45dd2d;let _0x556618=Math[_0x2618c7(0x22e)](0x0,Math['min'](0x64,parseInt(_0x5ad8aa,0xa)||0x0));currentAlpha=_0x556618/0x64;let _0xcce330=document[_0x2618c7(0x17e)](_0x2618c7(0x1ba)),_0x2926b7=document[_0x2618c7(0x17e)](_0x2618c7(0x217));if(_0xcce330)_0xcce330[_0x2618c7(0x1c7)]=_0x556618;if(_0x2926b7)_0x2926b7[_0x2618c7(0x22f)]=_0x556618+'%';let _0x4e121e=document['getElementById'](_0x2618c7(0x1df)),_0x49617c=document[_0x2618c7(0x17e)]('palette-alphaValue');if(_0x4e121e)_0x4e121e[_0x2618c7(0x1c7)]=_0x556618;if(_0x49617c)_0x49617c[_0x2618c7(0x22f)]=_0x556618+'%';}async function savePaletteToDB(){const _0x1d359c=a0_0x45dd2d;try{await idbSet(_0x1d359c(0x27d),PALETTE_COLORS);}catch(_0x524273){console['error'](_0x1d359c(0x230),_0x524273);}}async function loadPaletteFromDB(){const _0x298fcc=a0_0x45dd2d;try{const _0x3486d8=await idbGet('nezumi-palette');Array[_0x298fcc(0x1fc)](_0x3486d8)&&_0x3486d8[_0x298fcc(0x1af)]&&(PALETTE_COLORS=_0x3486d8);}catch(_0x22ffb6){console[_0x298fcc(0x184)](_0x298fcc(0x268),_0x22ffb6);}}document[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x19d),()=>{const _0x28ee5f=a0_0x45dd2d,_0x191219=document[_0x28ee5f(0x17e)]('colorPicker');_0x191219&&(_0x191219[_0x28ee5f(0x24e)]=_0x4156a4=>{const _0x6d445c=_0x28ee5f;currentColor=_0x4156a4[_0x6d445c(0x22d)][_0x6d445c(0x1c7)],document[_0x6d445c(0x155)](_0x6d445c(0x176))[_0x6d445c(0x1ca)](_0xc6df67=>_0xc6df67[_0x6d445c(0x18a)][_0x6d445c(0x1d1)](_0x6d445c(0x16d)));});const _0x1bdf75=document[_0x28ee5f(0x17e)]('alphaSlider'),_0x182bc0=document[_0x28ee5f(0x17e)](_0x28ee5f(0x217));_0x1bdf75&&_0x182bc0&&(_0x1bdf75[_0x28ee5f(0x24e)]=_0x3cc55a=>{const _0x475b98=_0x28ee5f;setAlpha(_0x3cc55a[_0x475b98(0x22d)][_0x475b98(0x1c7)]),_0x182bc0[_0x475b98(0x22f)]=_0x3cc55a['target'][_0x475b98(0x1c7)]+'%';let _0x5f209f=document[_0x475b98(0x17e)](_0x475b98(0x1df)),_0x38a62d=document[_0x475b98(0x17e)](_0x475b98(0x23b));if(_0x5f209f)_0x5f209f[_0x475b98(0x1c7)]=_0x3cc55a[_0x475b98(0x22d)][_0x475b98(0x1c7)];if(_0x38a62d)_0x38a62d[_0x475b98(0x22f)]=_0x3cc55a[_0x475b98(0x22d)][_0x475b98(0x1c7)]+'%';});});async function convertToGIF(_0x22fe4c,_0x4dd018=0xc8,_0x4113df='nezumi-animation.gif'){const _0x1fdd76=a0_0x45dd2d,_0x2fe48d=new window[(_0x1fdd76(0x1ed))]({'workers':0x2,'quality':0xa,'workerScript':_0x1fdd76(0x23d)});_0x22fe4c[_0x1fdd76(0x1ca)](_0x18ed6a=>_0x2fe48d[_0x1fdd76(0x1a9)](_0x18ed6a,{'delay':_0x4dd018})),_0x2fe48d['on']('finished',_0x8b382c=>{const _0x137806=_0x1fdd76,_0x2108f7=URL['createObjectURL'](_0x8b382c),_0x359f6a=document[_0x137806(0x234)]('a');_0x359f6a[_0x137806(0x19f)]=_0x2108f7,_0x359f6a[_0x137806(0x13f)]=_0x4113df,document['body']['appendChild'](_0x359f6a),_0x359f6a[_0x137806(0x17d)](),setTimeout(()=>{const _0x490d2=_0x137806;document[_0x490d2(0x142)][_0x490d2(0x1aa)](_0x359f6a),URL[_0x490d2(0x144)](_0x2108f7);},0x3e8);}),_0x2fe48d[_0x1fdd76(0x24b)]();}function convertToAPNG(_0x853fb3,_0x5b9cc6,_0x479b72,_0x296f08=0xc8,_0x30ccc7=a0_0x45dd2d(0x1fb)){const _0x174d2a=a0_0x45dd2d,_0x5bc7e6=[],_0x1942f8=[],_0x10d456=document[_0x174d2a(0x234)](_0x174d2a(0x1e6));_0x10d456[_0x174d2a(0x17a)]=_0x5b9cc6,_0x10d456[_0x174d2a(0x189)]=_0x479b72;const _0x260d84=_0x10d456[_0x174d2a(0x237)]('2d');_0x853fb3[_0x174d2a(0x1ca)](_0x4dcf97=>{const _0x6b97ca=_0x174d2a;_0x260d84[_0x6b97ca(0x140)](0x0,0x0,_0x5b9cc6,_0x479b72),_0x260d84[_0x6b97ca(0x190)](_0x4dcf97,0x0,0x0,_0x5b9cc6,_0x479b72);const _0x2003a4=_0x260d84[_0x6b97ca(0x1f1)](0x0,0x0,_0x5b9cc6,_0x479b72)['data'][_0x6b97ca(0x164)];_0x5bc7e6[_0x6b97ca(0x159)](_0x2003a4),_0x1942f8[_0x6b97ca(0x159)](_0x296f08);});const _0x27d147=window[_0x174d2a(0x256)][_0x174d2a(0x1a6)](_0x5bc7e6,_0x5b9cc6,_0x479b72,0x0,_0x1942f8),_0xb93431=URL['createObjectURL'](new Blob([_0x27d147],{'type':_0x174d2a(0x1a0)})),_0x2048c7=document['createElement']('a');_0x2048c7[_0x174d2a(0x19f)]=_0xb93431,_0x2048c7[_0x174d2a(0x13f)]=_0x30ccc7,document[_0x174d2a(0x142)]['appendChild'](_0x2048c7),_0x2048c7['click'](),setTimeout(()=>{const _0x4181ff=_0x174d2a;document[_0x4181ff(0x142)][_0x4181ff(0x1aa)](_0x2048c7),URL[_0x4181ff(0x144)](_0xb93431);},0x3e8);}async function loadImages(_0x93d0ee){const _0x549f67=a0_0x45dd2d,_0x1ffcc8=await Promise[_0x549f67(0x180)](_0x93d0ee['map'](_0x6c3930=>{return new Promise(_0x5d5b11=>{const _0x1f5a8d=a0_0x4a77,_0x4be6d8=new Image();_0x4be6d8[_0x1f5a8d(0x143)]=_0x1f5a8d(0x14c),_0x4be6d8[_0x1f5a8d(0x18c)]=_0x6c3930,_0x4be6d8['onload']=()=>_0x5d5b11(_0x4be6d8);});}));return _0x1ffcc8;}function toggleSection(_0x3e4f64){const _0x42e887=a0_0x45dd2d,_0x332c78=document['getElementById'](_0x3e4f64),_0x15b950=_0x332c78[_0x42e887(0x169)](_0x42e887(0x1d3)),_0x4fc4f7=_0x332c78[_0x42e887(0x169)](_0x42e887(0x185));_0x15b950[_0x42e887(0x27b)][_0x42e887(0x1c2)]===_0x42e887(0x1da)?(_0x15b950[_0x42e887(0x27b)][_0x42e887(0x1c2)]='',_0x4fc4f7[_0x42e887(0x22f)]='▼'):(_0x15b950[_0x42e887(0x27b)][_0x42e887(0x1c2)]=_0x42e887(0x1da),_0x4fc4f7[_0x42e887(0x22f)]='▲');}document['addEventListener']('DOMContentLoaded',()=>{const _0x43791d=a0_0x45dd2d;document[_0x43791d(0x155)](_0x43791d(0x196))['forEach'](_0x2ad81b=>_0x2ad81b['style']['display']=''),document[_0x43791d(0x155)](_0x43791d(0x18d))[_0x43791d(0x1ca)](_0x4b94b3=>_0x4b94b3[_0x43791d(0x22f)]='▼');}),window[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x1c6),updateMenuBtnDisplay),document[a0_0x45dd2d(0x1d2)]('DOMContentLoaded',updateMenuBtnDisplay);function toggleSideMenu(_0x5833e7){const _0x49b740=a0_0x45dd2d,_0x5b3f9d=document[_0x49b740(0x17e)](_0x49b740(0x1a7)),_0x405c69=document[_0x49b740(0x17e)](_0x49b740(0x18b)),_0x2017b9=document[_0x49b740(0x17e)](_0x49b740(0x179)),_0x8bcf19=document[_0x49b740(0x17e)](_0x49b740(0x1ab)),_0x2a6e8c=_0x5b3f9d[_0x49b740(0x18a)][_0x49b740(0x220)](_0x49b740(0x277));let _0x40aeb5=typeof _0x5833e7===_0x49b740(0x14d)?_0x5833e7:!_0x2a6e8c;_0x40aeb5?(_0x5b3f9d[_0x49b740(0x18a)][_0x49b740(0x1eb)](_0x49b740(0x277)),_0x405c69[_0x49b740(0x18a)][_0x49b740(0x1eb)]('sidebar-open'),document[_0x49b740(0x142)][_0x49b740(0x27b)][_0x49b740(0x1e7)]=_0x49b740(0x1d7),document[_0x49b740(0x142)][_0x49b740(0x27b)]['touchAction']='none',window[_0x49b740(0x24f)]<=0x384&&(_0x8bcf19['style'][_0x49b740(0x1c2)]=_0x49b740(0x16a),_0x2017b9[_0x49b740(0x27b)][_0x49b740(0x1c2)]='none')):(_0x5b3f9d[_0x49b740(0x18a)][_0x49b740(0x1d1)](_0x49b740(0x277)),_0x405c69[_0x49b740(0x18a)][_0x49b740(0x1d1)](_0x49b740(0x1a2)),document[_0x49b740(0x142)][_0x49b740(0x27b)]['overflow']='',document[_0x49b740(0x142)][_0x49b740(0x27b)][_0x49b740(0x25b)]='',window[_0x49b740(0x24f)]<=0x384&&(_0x8bcf19[_0x49b740(0x27b)][_0x49b740(0x1c2)]=_0x49b740(0x1da),_0x2017b9[_0x49b740(0x27b)][_0x49b740(0x1c2)]=_0x49b740(0x16a)));}function updateMenuBtnDisplay(){const _0x58206c=a0_0x45dd2d,_0x1eaca6=document[_0x58206c(0x17e)](_0x58206c(0x1a7)),_0x5a4950=document[_0x58206c(0x17e)](_0x58206c(0x18b)),_0x207327=document[_0x58206c(0x17e)](_0x58206c(0x179)),_0x54d7b4=document['getElementById']('menu-toggle-btn-close');window['innerWidth']>0x384?(_0x1eaca6['classList'][_0x58206c(0x1d1)](_0x58206c(0x277)),_0x5a4950[_0x58206c(0x18a)]['remove']('sidebar-open'),_0x54d7b4[_0x58206c(0x27b)][_0x58206c(0x1c2)]=_0x58206c(0x1da),_0x207327[_0x58206c(0x27b)][_0x58206c(0x1c2)]=_0x58206c(0x1da),document[_0x58206c(0x142)][_0x58206c(0x27b)][_0x58206c(0x1e7)]='',document['body']['style'][_0x58206c(0x25b)]=''):_0x1eaca6['classList'][_0x58206c(0x220)](_0x58206c(0x277))?(_0x54d7b4[_0x58206c(0x27b)][_0x58206c(0x1c2)]='block',_0x207327[_0x58206c(0x27b)][_0x58206c(0x1c2)]='none'):(_0x54d7b4['style']['display']=_0x58206c(0x1da),_0x207327['style'][_0x58206c(0x1c2)]=_0x58206c(0x16a));}document[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x17d),function(_0x30ad74){const _0x228355=a0_0x45dd2d;if(window[_0x228355(0x24f)]>0x384)return;const _0x1336b5=document['getElementById'](_0x228355(0x1a7)),_0x23e84b=document['getElementById'](_0x228355(0x18b)),_0x13942c=document['getElementById']('menu-toggle-btn'),_0x129e1f=document[_0x228355(0x17e)]('menu-toggle-btn-close');!_0x1336b5[_0x228355(0x220)](_0x30ad74[_0x228355(0x22d)])&&_0x30ad74[_0x228355(0x22d)]!==_0x13942c&&_0x30ad74[_0x228355(0x22d)]!==_0x129e1f&&(_0x1336b5[_0x228355(0x18a)][_0x228355(0x1d1)](_0x228355(0x277)),_0x23e84b[_0x228355(0x18a)][_0x228355(0x1d1)]('sidebar-open'),_0x129e1f[_0x228355(0x27b)]['display']=_0x228355(0x1da),_0x13942c[_0x228355(0x27b)][_0x228355(0x1c2)]=_0x228355(0x16a),document[_0x228355(0x142)][_0x228355(0x27b)][_0x228355(0x1e7)]='',document[_0x228355(0x142)][_0x228355(0x27b)][_0x228355(0x25b)]='');}),(function(){const _0x5b0194=a0_0x45dd2d;try{(location['pathname']['match'](/index\.html$/)||location['pathname']==='/'||location[_0x5b0194(0x247)]===_0x5b0194(0x13d))&&(!localStorage[_0x5b0194(0x141)](_0x5b0194(0x200))&&(localStorage[_0x5b0194(0x199)](_0x5b0194(0x200),'1'),location[_0x5b0194(0x19f)]=_0x5b0194(0x223)));}catch(_0x3f4c76){}}());let scale=0x1,posX=0x0,posY=0x0,lastX=0x0,lastY=0x0,dragging=![],startX=0x0,startY=0x0,shiftPressed=![];document[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x21b),_0xc02e0b=>{const _0x1a9de8=a0_0x45dd2d;if(_0xc02e0b[_0x1a9de8(0x19c)]===_0x1a9de8(0x250))shiftPressed=!![];}),document[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x16b),_0x5e6d6e=>{const _0x110b97=a0_0x45dd2d;if(_0x5e6d6e['key']===_0x110b97(0x250))shiftPressed=![];}),canvas[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x13e),_0x34a984=>{const _0x56bdcf=a0_0x45dd2d;if(_0x34a984[_0x56bdcf(0x252)]==='touch')return;currentTool===_0x56bdcf(0x1ea)||shiftPressed?(dragging=!![],isDrawing=![],startX=_0x34a984[_0x56bdcf(0x21d)],startY=_0x34a984[_0x56bdcf(0x231)],lastX=posX,lastY=posY,canvas[_0x56bdcf(0x269)](_0x34a984[_0x56bdcf(0x27a)]),canvas[_0x56bdcf(0x27b)]['cursor']='grabbing'):(isDrawing=!![],handleMouseDown(_0x34a984),canvas[_0x56bdcf(0x269)](_0x34a984[_0x56bdcf(0x27a)]));}),canvas[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x24a),_0x48ab92=>{const _0x2c8855=a0_0x45dd2d;if(_0x48ab92[_0x2c8855(0x252)]===_0x2c8855(0x27c))return;if(dragging)posX=lastX+(_0x48ab92[_0x2c8855(0x21d)]-startX),posY=lastY+(_0x48ab92[_0x2c8855(0x231)]-startY),updateTransform();else isDrawing&&handleMouseMove(_0x48ab92);}),canvas[a0_0x45dd2d(0x1d2)](a0_0x45dd2d(0x1f2),_0x16034b=>{const _0x40dcb5=a0_0x45dd2d;if(_0x16034b[_0x40dcb5(0x252)]===_0x40dcb5(0x27c))return;dragging=![];isDrawing&&handleMouseUp(_0x16034b);isDrawing=![];try{canvas[_0x40dcb5(0x219)](_0x16034b[_0x40dcb5(0x27a)]);}catch(_0x18829b){}if(currentTool===_0x40dcb5(0x1ea))canvas[_0x40dcb5(0x27b)]['cursor']=_0x40dcb5(0x20f);else canvas[_0x40dcb5(0x27b)][_0x40dcb5(0x187)]='crosshair';}),wrapper['addEventListener']('wheel',_0x214a94=>{const _0x214a06=a0_0x45dd2d;_0x214a94[_0x214a06(0x14f)]();const _0x424328=canvas['getBoundingClientRect'](),_0x3862ce=_0x214a94[_0x214a06(0x21d)],_0x4c1efb=_0x214a94['clientY'],_0x44c1f4=(_0x3862ce-_0x424328[_0x214a06(0x1f3)]-posX)/scale,_0x33750d=(_0x4c1efb-_0x424328[_0x214a06(0x147)]-posY)/scale,_0x4a91b=_0x214a94['deltaY']>0x0?0.9:1.1;let _0x55b65a=scale*_0x4a91b;_0x55b65a=Math[_0x214a06(0x15a)](Math[_0x214a06(0x22e)](_0x55b65a,0.2),0x5),posX=_0x3862ce-_0x424328[_0x214a06(0x1f3)]-_0x44c1f4*_0x55b65a,posY=_0x4c1efb-_0x424328[_0x214a06(0x147)]-_0x33750d*_0x55b65a,scale=_0x55b65a,updateTransform();const _0xf7042b=document[_0x214a06(0x17e)](_0x214a06(0x1ff)),_0x4bb4b4=document['getElementById']('zoomValue');if(_0xf7042b)_0xf7042b[_0x214a06(0x1c7)]=Math[_0x214a06(0x149)](scale*0x64);if(_0x4bb4b4)_0x4bb4b4[_0x214a06(0x22f)]=Math[_0x214a06(0x149)](scale*0x64)+'%';},{'passive':![]});function updateTransform(){const _0x208af5=a0_0x45dd2d;canvas[_0x208af5(0x27b)][_0x208af5(0x1b7)]=_0x208af5(0x15d)+posX+_0x208af5(0x1db)+posY+_0x208af5(0x188)+scale+')';}function setZoomValue(_0x285596){const _0x1adfff=a0_0x45dd2d,_0x46b45=Math[_0x1adfff(0x22e)](0x14,Math[_0x1adfff(0x15a)](0x1f4,parseInt(_0x285596,0xa)||0x64)),_0x2f7855=_0x46b45/0x64;scale=_0x2f7855,updateTransform();const _0x4043b4=document[_0x1adfff(0x17e)](_0x1adfff(0x1ff)),_0x31e3ad=document[_0x1adfff(0x17e)](_0x1adfff(0x276));if(_0x4043b4)_0x4043b4[_0x1adfff(0x1c7)]=_0x46b45;if(_0x31e3ad)_0x31e3ad[_0x1adfff(0x22f)]=_0x46b45+'%';}function zoomIn(){const _0x228a11=a0_0x45dd2d,_0x25f4ae=document['getElementById'](_0x228a11(0x1ff));let _0x345e33=_0x25f4ae?parseInt(_0x25f4ae[_0x228a11(0x1c7)],0xa):Math['round'](scale*0x64);_0x345e33=Math[_0x228a11(0x15a)](0x1f4,_0x345e33+0xa),setZoomValue(_0x345e33);}function zoomOut(){const _0x19c079=a0_0x45dd2d,_0x3e639e=document['getElementById']('zoomSlider');let _0x356668=_0x3e639e?parseInt(_0x3e639e[_0x19c079(0x1c7)],0xa):Math['round'](scale*0x64);_0x356668=Math[_0x19c079(0x22e)](0x14,_0x356668-0xa),setZoomValue(_0x356668);}const zs=document[a0_0x45dd2d(0x17e)]('zoomSlider');if(zs)zs['oninput']=_0x40c01e=>setZoomValue(_0x40c01e[a0_0x45dd2d(0x22d)]['value']);const zv=document['getElementById'](a0_0x45dd2d(0x276));if(zv)zv[a0_0x45dd2d(0x22f)]=Math[a0_0x45dd2d(0x149)](scale*0x64)+'%';function getCanvasCoords(_0x1028ab){const _0x1b1875=a0_0x45dd2d,_0x9b5eee=canvas[_0x1b1875(0x210)](),_0x5a9356=canvas[_0x1b1875(0x17a)]/_0x9b5eee['width'],_0x2b4168=canvas[_0x1b1875(0x189)]/_0x9b5eee[_0x1b1875(0x189)],_0x1136ae=(_0x1028ab[_0x1b1875(0x21d)]-_0x9b5eee['left'])*_0x5a9356,_0x11b151=(_0x1028ab[_0x1b1875(0x231)]-_0x9b5eee['top'])*_0x2b4168;return{'x':_0x1136ae,'y':_0x11b151};}function handleDrawStart(_0x2a4d0a){const _0xe7a83c=a0_0x45dd2d,_0x3ad887=getCanvasCoords(_0x2a4d0a);ctx[_0xe7a83c(0x24d)](),ctx['moveTo'](_0x3ad887['x'],_0x3ad887['y']);}function handleDrawMove(_0x4803eb){const _0x481f98=a0_0x45dd2d,_0x1d7dcd=getCanvasCoords(_0x4803eb);ctx['lineTo'](_0x1d7dcd['x'],_0x1d7dcd['y']),ctx[_0x481f98(0x273)]();}function handleDrawEnd(_0x320c22){const _0x41768f=a0_0x45dd2d;ctx[_0x41768f(0x265)]();}