(function(_0x1f9b19,_0x4ba6fb){const _0x119a73=_0x30c8,_0x3f63ba=_0x1f9b19();while(!![]){try{const _0x2c7613=-parseInt(_0x119a73(0x129))/0x1+parseInt(_0x119a73(0x12c))/0x2*(-parseInt(_0x119a73(0x14e))/0x3)+parseInt(_0x119a73(0x13e))/0x4+-parseInt(_0x119a73(0x131))/0x5+parseInt(_0x119a73(0x147))/0x6+-parseInt(_0x119a73(0x14a))/0x7+parseInt(_0x119a73(0x137))/0x8;if(_0x2c7613===_0x4ba6fb)break;else _0x3f63ba['push'](_0x3f63ba['shift']());}catch(_0x1568cd){_0x3f63ba['push'](_0x3f63ba['shift']());}}}(_0x56ae,0x530e1));const _0xb7c2ea=(function(){let _0xff0eb8=!![];return function(_0x492693,_0x2efd38){const _0xb326ba=_0xff0eb8?function(){const _0x13be11=_0x30c8;if(_0x2efd38){const _0x1d1bd7=_0x2efd38[_0x13be11(0x156)](_0x492693,arguments);return _0x2efd38=null,_0x1d1bd7;}}:function(){};return _0xff0eb8=![],_0xb326ba;};}()),_0x424f30=_0xb7c2ea(this,function(){const _0x78b79c=_0x30c8;return _0x424f30['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x424f30)[_0x78b79c(0x122)](_0x78b79c(0x138));});_0x424f30();function saveHistory(){const _0x1619b4=_0x30c8;let _0x22f72d=getCurrentFrame();if(!_0x22f72d)return;if(!Array['isArray'](_0x22f72d[_0x1619b4(0x13c)]))_0x22f72d[_0x1619b4(0x13c)]=[];if(!Array[_0x1619b4(0x124)](_0x22f72d['layerRedoStacks']))_0x22f72d[_0x1619b4(0x127)]=[];const _0x4f341b=typeof _0x22f72d[_0x1619b4(0x148)]===_0x1619b4(0x128)?_0x22f72d[_0x1619b4(0x148)]:-0x1;if(_0x4f341b<0x0)return;if(!_0x22f72d[_0x1619b4(0x13c)][_0x4f341b])_0x22f72d[_0x1619b4(0x13c)][_0x4f341b]=[];if(!_0x22f72d[_0x1619b4(0x127)][_0x4f341b])_0x22f72d[_0x1619b4(0x127)][_0x4f341b]=[];const _0xcf5e6=_0x22f72d[_0x1619b4(0x11f)]&&_0x22f72d[_0x1619b4(0x11f)][_0x4f341b]?_0x22f72d[_0x1619b4(0x11f)][_0x4f341b]:null,_0x453778=_0xcf5e6&&_0xcf5e6[_0x1619b4(0x11d)]?_0xcf5e6['canvas']:_0xcf5e6;if(!_0x453778||typeof _0x453778[_0x1619b4(0x13f)]!=='function')return;try{_0x22f72d[_0x1619b4(0x13c)][_0x4f341b]['push'](_0x453778['toDataURL']());if(_0x22f72d[_0x1619b4(0x13c)][_0x4f341b][_0x1619b4(0x155)]>0x32)_0x22f72d[_0x1619b4(0x13c)][_0x4f341b][_0x1619b4(0x12d)]();_0x22f72d[_0x1619b4(0x127)][_0x4f341b]=[];try{if(typeof updateUndoRedoButtons===_0x1619b4(0x140))updateUndoRedoButtons();}catch(_0x43f79f){}if(typeof window[_0x1619b4(0x120)]==='function')window[_0x1619b4(0x120)]();}catch(_0x400601){console[_0x1619b4(0x141)](_0x1619b4(0x133),_0x400601);}}async function idbSet(_0x6a89b0,_0x2c2431){const _0x518adc=await openDB();return new Promise((_0x3fa5fc,_0x5eb2c9)=>{const _0x50ce22=_0x30c8,_0x4f5475=_0x518adc[_0x50ce22(0x121)](storeName,'readwrite');_0x4f5475[_0x50ce22(0x134)](storeName)[_0x50ce22(0x145)](_0x2c2431,_0x6a89b0),_0x4f5475[_0x50ce22(0x149)]=()=>_0x3fa5fc(),_0x4f5475[_0x50ce22(0x12a)]=()=>_0x5eb2c9(_0x4f5475[_0x50ce22(0x141)]);});}function _0x56ae(){const _0x111072=['readwrite','length','apply','getContext','canvas','forEach','layers','requestAutoSave','transaction','search','onsuccess','isArray','result','push','layerRedoStacks','number','423345ETSLJj','onerror','string','2Ffyaig','shift','clearRect','src','get','1182945OQMnYF','height','saveHistory\x20error','objectStore','nezumi-palette','frames','7481392TSovfS','(((.+)+)+)+$','undefined','保存エラー','onload','layerHistories','includes','1550968ksHCGk','toDataURL','function','error','readAsArrayBuffer','anonymous','readonly','put','map','643158CztkYi','activeLayer','oncomplete','2615508CrAidw','width','drawImage','メタデータが見つかりませんでした','169014FShQXd','name','project','読込エラー','clear','crossOrigin'];_0x56ae=function(){return _0x111072;};return _0x56ae();}async function idbGet(_0xd142a2){const _0x3f3e34=await openDB();return new Promise((_0x109a12,_0x497380)=>{const _0x4f2866=_0x30c8,_0x30a846=_0x3f3e34[_0x4f2866(0x121)](storeName,_0x4f2866(0x144)),_0x6a8731=_0x30a846[_0x4f2866(0x134)](storeName)[_0x4f2866(0x130)](_0xd142a2);_0x6a8731[_0x4f2866(0x123)]=()=>_0x109a12(_0x6a8731[_0x4f2866(0x125)]),_0x6a8731[_0x4f2866(0x12a)]=()=>_0x497380(_0x6a8731['error']);});}async function idbDelete(_0x3b3dc8){const _0x1c06f5=await openDB();return new Promise((_0x170ccf,_0x12a074)=>{const _0x38babe=_0x30c8,_0x3fa773=_0x1c06f5[_0x38babe(0x121)](storeName,_0x38babe(0x154));_0x3fa773[_0x38babe(0x134)](storeName)['delete'](_0x3b3dc8),_0x3fa773[_0x38babe(0x149)]=()=>_0x170ccf(),_0x3fa773[_0x38babe(0x12a)]=()=>_0x12a074(_0x3fa773[_0x38babe(0x141)]);});}async function idbClear(){const _0x5858a1=await openDB();return new Promise((_0x8d7531,_0x3e8551)=>{const _0x55f2ba=_0x30c8,_0x5cbd45=_0x5858a1['transaction'](storeName,_0x55f2ba(0x154));_0x5cbd45['objectStore'](storeName)[_0x55f2ba(0x152)](),_0x5cbd45[_0x55f2ba(0x149)]=()=>_0x8d7531(),_0x5cbd45['onerror']=()=>_0x3e8551(_0x5cbd45[_0x55f2ba(0x141)]);});}async function savePaletteToDB(){const _0x393a37=_0x30c8;try{await idbSet('nezumi-palette',PALETTE_COLORS);}catch(_0x1f5650){console['error'](_0x393a37(0x13a),_0x1f5650);}}async function loadPaletteFromDB(){const _0x52ac8e=_0x30c8;try{const _0x21bd2e=await idbGet(_0x52ac8e(0x135));if(Array['isArray'](_0x21bd2e)&&_0x21bd2e['length']){const _0x518d99=[];_0x21bd2e[_0x52ac8e(0x11e)](_0x27e34c=>{const _0x3d4bac=_0x52ac8e;if(typeof _0x27e34c===_0x3d4bac(0x12b)&&!_0x518d99[_0x3d4bac(0x13d)](_0x27e34c))_0x518d99[_0x3d4bac(0x126)](_0x27e34c);});for(const _0x426733 of typeof DEFAULT_PALETTE!==_0x52ac8e(0x139)?DEFAULT_PALETTE:[]){if(!_0x518d99['includes'](_0x426733))_0x518d99['push'](_0x426733);}PALETTE_COLORS=_0x518d99['slice'](0x0,0x18);}}catch(_0x36527e){console[_0x52ac8e(0x141)](_0x52ac8e(0x151),_0x36527e);}}function _0x30c8(_0x34adbf,_0x2cfa5e){_0x34adbf=_0x34adbf-0x11c;const _0x3de951=_0x56ae();let _0x424f30=_0x3de951[_0x34adbf];return _0x424f30;}async function loadImages(_0xb9adcc){const _0x4a91d0=_0x30c8,_0x3c3964=await Promise['all'](_0xb9adcc[_0x4a91d0(0x146)](_0x2d8bbe=>{return new Promise(_0x147a6d=>{const _0x51db07=_0x30c8,_0x2436fa=new Image();_0x2436fa[_0x51db07(0x153)]=_0x51db07(0x143),_0x2436fa[_0x51db07(0x12f)]=_0x2d8bbe,_0x2436fa[_0x51db07(0x13b)]=()=>_0x147a6d(_0x2436fa);});}));return _0x3c3964;}function loadStandaloneFromFile(_0x46e69a){return new Promise((_0x1020d0,_0x3105c6)=>{const _0x1b307f=_0x30c8;try{showLoading('画像ファイルを読み込み中...');}catch(_0x2c61a1){}const _0x2df805=new FileReader();_0x2df805[_0x1b307f(0x13b)]=_0x50a46c=>{const _0x16a73a=_0x1b307f,_0xcf782f=_0x50a46c['target'][_0x16a73a(0x125)],_0x15757a=extractMetadataFromArrayBuffer(_0xcf782f);if(!_0x15757a||!_0x15757a[_0x16a73a(0x150)]){try{hideLoading();}catch(_0x22e172){}_0x3105c6(new Error(_0x16a73a(0x14d)));return;}const _0x377c66=_0x15757a[_0x16a73a(0x150)];try{const _0x591857=createProject(_0x377c66[_0x16a73a(0x14b)],_0x377c66[_0x16a73a(0x132)],_0x377c66[_0x16a73a(0x14f)]||'画像');_0x591857[_0x16a73a(0x136)]=_0x377c66['frames'][_0x16a73a(0x146)](_0x571f29=>{const _0xcc1633=_0x16a73a;let _0x2b39a5={'layers':[],'activeLayer':_0x571f29['activeLayer'],'layerHistories':[],'layerRedoStacks':[]};for(let _0x2830a8=0x0;_0x2830a8<_0x571f29['layers'][_0xcc1633(0x155)];_0x2830a8++){let _0x2a4845=new Image();_0x2a4845[_0xcc1633(0x12f)]=_0x571f29[_0xcc1633(0x11f)][_0x2830a8];let _0x2a7cf7=document['createElement'](_0xcc1633(0x11d));_0x2a7cf7[_0xcc1633(0x14b)]=_0x377c66[_0xcc1633(0x14b)]*cellSize,_0x2a7cf7[_0xcc1633(0x132)]=_0x377c66[_0xcc1633(0x132)]*cellSize,_0x2a4845[_0xcc1633(0x13b)]=()=>{const _0x15f3a4=_0xcc1633;let _0x25da9a=_0x2a7cf7[_0x15f3a4(0x11c)]('2d');_0x25da9a[_0x15f3a4(0x12e)](0x0,0x0,_0x2a7cf7['width'],_0x2a7cf7[_0x15f3a4(0x132)]),_0x25da9a[_0x15f3a4(0x14c)](_0x2a4845,0x0,0x0);},_0x2b39a5[_0xcc1633(0x11f)][_0xcc1633(0x126)](_0x2a7cf7);}return _0x2b39a5;}),projects[_0x16a73a(0x126)](_0x591857),activeProject=projects[_0x16a73a(0x155)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0x54ea88){}_0x1020d0(_0x591857);}catch(_0x19a031){try{hideLoading();}catch(_0x30f8e8){}_0x3105c6(_0x19a031);}},_0x2df805[_0x1b307f(0x12a)]=_0x3d50c3=>{try{hideLoading();}catch(_0x33d6ab){};_0x3105c6(_0x3d50c3);},_0x2df805[_0x1b307f(0x142)](_0x46e69a);});}