function _0x258c(_0x20b041,_0x5df439){_0x20b041=_0x20b041-0xac;const _0x3fc732=_0x1ec9();let _0x2c6b2c=_0x3fc732[_0x20b041];return _0x2c6b2c;}(function(_0x3227c6,_0x3c67de){const _0x3c809a=_0x258c,_0xfe16c6=_0x3227c6();while(!![]){try{const _0x1a0ff3=-parseInt(_0x3c809a(0xc5))/0x1*(parseInt(_0x3c809a(0xac))/0x2)+parseInt(_0x3c809a(0xc0))/0x3+parseInt(_0x3c809a(0xda))/0x4*(-parseInt(_0x3c809a(0xb5))/0x5)+-parseInt(_0x3c809a(0xbe))/0x6*(-parseInt(_0x3c809a(0xe4))/0x7)+parseInt(_0x3c809a(0xd5))/0x8+-parseInt(_0x3c809a(0xbb))/0x9*(parseInt(_0x3c809a(0xb3))/0xa)+parseInt(_0x3c809a(0xcd))/0xb;if(_0x1a0ff3===_0x3c67de)break;else _0xfe16c6['push'](_0xfe16c6['shift']());}catch(_0x13af14){_0xfe16c6['push'](_0xfe16c6['shift']());}}}(_0x1ec9,0x2996d));const _0x12e943=(function(){let _0x404a29=!![];return function(_0xe903cc,_0x59c025){const _0x2553e4=_0x404a29?function(){const _0x20146d=_0x258c;if(_0x59c025){const _0x2996c8=_0x59c025[_0x20146d(0xe5)](_0xe903cc,arguments);return _0x59c025=null,_0x2996c8;}}:function(){};return _0x404a29=![],_0x2553e4;};}()),_0x2c6b2c=_0x12e943(this,function(){const _0x417787=_0x258c;return _0x2c6b2c[_0x417787(0xe2)]()[_0x417787(0xb0)](_0x417787(0xc1))['toString']()[_0x417787(0xd8)](_0x2c6b2c)[_0x417787(0xb0)](_0x417787(0xc1));});_0x2c6b2c();function saveHistory(){const _0x34c6ab=_0x258c;let _0x480d09=getCurrentFrame();if(!_0x480d09)return;if(!Array[_0x34c6ab(0xb6)](_0x480d09['layerHistories']))_0x480d09[_0x34c6ab(0xc3)]=[];if(!Array[_0x34c6ab(0xb6)](_0x480d09[_0x34c6ab(0xbf)]))_0x480d09[_0x34c6ab(0xbf)]=[];const _0x1a68eb=typeof _0x480d09[_0x34c6ab(0xcb)]==='number'?_0x480d09[_0x34c6ab(0xcb)]:-0x1;if(_0x1a68eb<0x0)return;if(!_0x480d09[_0x34c6ab(0xc3)][_0x1a68eb])_0x480d09[_0x34c6ab(0xc3)][_0x1a68eb]=[];if(!_0x480d09[_0x34c6ab(0xbf)][_0x1a68eb])_0x480d09[_0x34c6ab(0xbf)][_0x1a68eb]=[];const _0x44be29=_0x480d09['layers']&&_0x480d09[_0x34c6ab(0xb1)][_0x1a68eb]?_0x480d09[_0x34c6ab(0xb1)][_0x1a68eb]:null,_0x1cef19=_0x44be29&&_0x44be29[_0x34c6ab(0xce)]?_0x44be29[_0x34c6ab(0xce)]:_0x44be29;if(!_0x1cef19||typeof _0x1cef19[_0x34c6ab(0xd3)]!==_0x34c6ab(0xb7))return;try{_0x480d09[_0x34c6ab(0xc3)][_0x1a68eb][_0x34c6ab(0xe0)](_0x1cef19[_0x34c6ab(0xd3)]());if(_0x480d09[_0x34c6ab(0xc3)][_0x1a68eb][_0x34c6ab(0xdd)]>0x32)_0x480d09[_0x34c6ab(0xc3)][_0x1a68eb][_0x34c6ab(0xe6)]();_0x480d09[_0x34c6ab(0xbf)][_0x1a68eb]=[];try{if(typeof updateUndoRedoButtons===_0x34c6ab(0xb7))updateUndoRedoButtons();}catch(_0x259535){}if(typeof window[_0x34c6ab(0xdf)]===_0x34c6ab(0xb7))window[_0x34c6ab(0xdf)]();}catch(_0x4a95e){console[_0x34c6ab(0xb2)](_0x34c6ab(0xb8),_0x4a95e);}}function _0x1ec9(){const _0x53f728=['読込エラー','objectStore','164424dlQbyR','layerRedoStacks','686625anuwMx','(((.+)+)+)+$','map','layerHistories','画像ファイルを読み込み中...','3378KTZkLA','メタデータが見つかりませんでした','result','clearRect','src','readonly','activeLayer','保存エラー','2027399KrfvkG','canvas','onerror','drawImage','height','transaction','toDataURL','onload','1382736hJiiVK','anonymous','nezumi-palette','constructor','onsuccess','146616OKCcDb','includes','put','length','width','requestAutoSave','push','project','toString','readwrite','42osWLwH','apply','shift','128OIwyBR','frames','crossOrigin','string','search','layers','error','10AKbfhY','all','15nnoeaA','isArray','function','saveHistory\x20error','oncomplete','slice','2285523CLYYVk'];_0x1ec9=function(){return _0x53f728;};return _0x1ec9();}async function idbSet(_0x2ae519,_0x43f0f3){const _0x3741a4=await openDB();return new Promise((_0x2329ff,_0x35073d)=>{const _0xe77d0b=_0x258c,_0x4c6de5=_0x3741a4[_0xe77d0b(0xd2)](storeName,_0xe77d0b(0xe3));_0x4c6de5[_0xe77d0b(0xbd)](storeName)[_0xe77d0b(0xdc)](_0x43f0f3,_0x2ae519),_0x4c6de5[_0xe77d0b(0xb9)]=()=>_0x2329ff(),_0x4c6de5[_0xe77d0b(0xcf)]=()=>_0x35073d(_0x4c6de5[_0xe77d0b(0xb2)]);});}async function idbGet(_0x34868e){const _0x44cb88=await openDB();return new Promise((_0x2e9f3b,_0xc65002)=>{const _0x256cb4=_0x258c,_0x34b95c=_0x44cb88[_0x256cb4(0xd2)](storeName,_0x256cb4(0xca)),_0x367808=_0x34b95c[_0x256cb4(0xbd)](storeName)['get'](_0x34868e);_0x367808[_0x256cb4(0xd9)]=()=>_0x2e9f3b(_0x367808[_0x256cb4(0xc7)]),_0x367808[_0x256cb4(0xcf)]=()=>_0xc65002(_0x367808[_0x256cb4(0xb2)]);});}async function idbDelete(_0x2350c4){const _0x2e5c69=await openDB();return new Promise((_0x12a7bc,_0x220fe4)=>{const _0x1c28ed=_0x258c,_0x3d73bb=_0x2e5c69[_0x1c28ed(0xd2)](storeName,_0x1c28ed(0xe3));_0x3d73bb[_0x1c28ed(0xbd)](storeName)['delete'](_0x2350c4),_0x3d73bb[_0x1c28ed(0xb9)]=()=>_0x12a7bc(),_0x3d73bb['onerror']=()=>_0x220fe4(_0x3d73bb['error']);});}async function idbClear(){const _0x491540=await openDB();return new Promise((_0x4dab85,_0x467f64)=>{const _0x46790b=_0x258c,_0x37dc39=_0x491540[_0x46790b(0xd2)](storeName,_0x46790b(0xe3));_0x37dc39[_0x46790b(0xbd)](storeName)['clear'](),_0x37dc39[_0x46790b(0xb9)]=()=>_0x4dab85(),_0x37dc39[_0x46790b(0xcf)]=()=>_0x467f64(_0x37dc39[_0x46790b(0xb2)]);});}async function savePaletteToDB(){const _0x4f8259=_0x258c;try{await idbSet(_0x4f8259(0xd7),PALETTE_COLORS);}catch(_0x3a773e){console[_0x4f8259(0xb2)](_0x4f8259(0xcc),_0x3a773e);}}async function loadPaletteFromDB(){const _0x4d370e=_0x258c;try{const _0x58e4a0=await idbGet('nezumi-palette');if(Array[_0x4d370e(0xb6)](_0x58e4a0)&&_0x58e4a0[_0x4d370e(0xdd)]){const _0x57b248=[];_0x58e4a0['forEach'](_0x4960ae=>{const _0x26ac4f=_0x4d370e;if(typeof _0x4960ae===_0x26ac4f(0xaf)&&!_0x57b248[_0x26ac4f(0xdb)](_0x4960ae))_0x57b248[_0x26ac4f(0xe0)](_0x4960ae);});for(const _0x29af92 of typeof DEFAULT_PALETTE!=='undefined'?DEFAULT_PALETTE:[]){if(!_0x57b248['includes'](_0x29af92))_0x57b248[_0x4d370e(0xe0)](_0x29af92);}PALETTE_COLORS=_0x57b248[_0x4d370e(0xba)](0x0,0x18);}}catch(_0x1954d4){console['error'](_0x4d370e(0xbc),_0x1954d4);}}async function loadImages(_0x451f15){const _0x2a5bf0=_0x258c,_0xd6e539=await Promise[_0x2a5bf0(0xb4)](_0x451f15['map'](_0x4ae9d4=>{return new Promise(_0x2a3eb0=>{const _0x2b8888=_0x258c,_0x36a078=new Image();_0x36a078[_0x2b8888(0xae)]=_0x2b8888(0xd6),_0x36a078[_0x2b8888(0xc9)]=_0x4ae9d4,_0x36a078[_0x2b8888(0xd4)]=()=>_0x2a3eb0(_0x36a078);});}));return _0xd6e539;}function loadStandaloneFromFile(_0x3f4020){return new Promise((_0x327a95,_0x78ba16)=>{const _0x812bf0=_0x258c;try{showLoading(_0x812bf0(0xc4));}catch(_0x31628e){}const _0x54997d=new FileReader();_0x54997d['onload']=_0xf1ba43=>{const _0x58a41b=_0x812bf0,_0x264a0c=_0xf1ba43['target'][_0x58a41b(0xc7)],_0x6bf25b=extractMetadataFromArrayBuffer(_0x264a0c);if(!_0x6bf25b||!_0x6bf25b[_0x58a41b(0xe1)]){try{hideLoading();}catch(_0x6c40fc){}_0x78ba16(new Error(_0x58a41b(0xc6)));return;}const _0x15bc3e=_0x6bf25b[_0x58a41b(0xe1)];try{const _0x26f3b3=createProject(_0x15bc3e[_0x58a41b(0xde)],_0x15bc3e['height'],_0x15bc3e['name']||'画像');_0x26f3b3[_0x58a41b(0xad)]=_0x15bc3e[_0x58a41b(0xad)][_0x58a41b(0xc2)](_0x148404=>{const _0x2203b8=_0x58a41b;let _0xb91083={'layers':[],'activeLayer':_0x148404[_0x2203b8(0xcb)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x33fb5c=0x0;_0x33fb5c<_0x148404[_0x2203b8(0xb1)][_0x2203b8(0xdd)];_0x33fb5c++){let _0x1e7a15=new Image();_0x1e7a15['src']=_0x148404[_0x2203b8(0xb1)][_0x33fb5c];let _0x7a1716=document['createElement'](_0x2203b8(0xce));_0x7a1716[_0x2203b8(0xde)]=_0x15bc3e[_0x2203b8(0xde)]*cellSize,_0x7a1716['height']=_0x15bc3e[_0x2203b8(0xd1)]*cellSize,_0x1e7a15[_0x2203b8(0xd4)]=()=>{const _0x292f67=_0x2203b8;let _0xd64c3c=_0x7a1716['getContext']('2d');_0xd64c3c[_0x292f67(0xc8)](0x0,0x0,_0x7a1716[_0x292f67(0xde)],_0x7a1716[_0x292f67(0xd1)]),_0xd64c3c[_0x292f67(0xd0)](_0x1e7a15,0x0,0x0);},_0xb91083[_0x2203b8(0xb1)][_0x2203b8(0xe0)](_0x7a1716);}return _0xb91083;}),projects[_0x58a41b(0xe0)](_0x26f3b3),activeProject=projects[_0x58a41b(0xdd)]-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0xe21112){}_0x327a95(_0x26f3b3);}catch(_0x544de6){try{hideLoading();}catch(_0xc5929a){}_0x78ba16(_0x544de6);}},_0x54997d[_0x812bf0(0xcf)]=_0x255216=>{try{hideLoading();}catch(_0x425118){};_0x78ba16(_0x255216);},_0x54997d['readAsArrayBuffer'](_0x3f4020);});}