(function(_0x56766f,_0x5e1b19){const _0x195b9d=_0x55cf,_0x53bb7c=_0x56766f();while(!![]){try{const _0x559495=-parseInt(_0x195b9d(0xcc))/0x1+-parseInt(_0x195b9d(0xb5))/0x2+parseInt(_0x195b9d(0xeb))/0x3+parseInt(_0x195b9d(0xc1))/0x4+-parseInt(_0x195b9d(0xec))/0x5+-parseInt(_0x195b9d(0xcb))/0x6+parseInt(_0x195b9d(0xc5))/0x7*(parseInt(_0x195b9d(0xe7))/0x8);if(_0x559495===_0x5e1b19)break;else _0x53bb7c['push'](_0x53bb7c['shift']());}catch(_0x33dc33){_0x53bb7c['push'](_0x53bb7c['shift']());}}}(_0x3904,0x96cbf));const _0x51173f=(function(){let _0x422392=!![];return function(_0x5f7616,_0x4a077a){const _0x16585e=_0x422392?function(){const _0x1f4719=_0x55cf;if(_0x4a077a){const _0x14d0a9=_0x4a077a[_0x1f4719(0xb0)](_0x5f7616,arguments);return _0x4a077a=null,_0x14d0a9;}}:function(){};return _0x422392=![],_0x16585e;};}()),_0x377f93=_0x51173f(this,function(){const _0x5f38e8=_0x55cf;return _0x377f93[_0x5f38e8(0xea)]()['search'](_0x5f38e8(0xd4))[_0x5f38e8(0xea)]()[_0x5f38e8(0xe0)](_0x377f93)[_0x5f38e8(0xd6)](_0x5f38e8(0xd4));});_0x377f93();function saveHistory(){const _0x2c2ef3=_0x55cf;let _0x525f69=getCurrentFrame();if(!_0x525f69)return;if(!Array[_0x2c2ef3(0xb2)](_0x525f69[_0x2c2ef3(0xb8)]))_0x525f69['layerHistories']=[];if(!Array[_0x2c2ef3(0xb2)](_0x525f69[_0x2c2ef3(0xb9)]))_0x525f69['layerRedoStacks']=[];const _0x59533b=typeof _0x525f69[_0x2c2ef3(0xc6)]===_0x2c2ef3(0xc0)?_0x525f69[_0x2c2ef3(0xc6)]:-0x1;if(_0x59533b<0x0)return;if(!_0x525f69[_0x2c2ef3(0xb8)][_0x59533b])_0x525f69[_0x2c2ef3(0xb8)][_0x59533b]=[];if(!_0x525f69[_0x2c2ef3(0xb9)][_0x59533b])_0x525f69[_0x2c2ef3(0xb9)][_0x59533b]=[];const _0x59b47d=_0x525f69['layers']&&_0x525f69[_0x2c2ef3(0xc3)][_0x59533b]?_0x525f69[_0x2c2ef3(0xc3)][_0x59533b]:null,_0x17d50e=_0x59b47d&&_0x59b47d[_0x2c2ef3(0xb6)]?_0x59b47d[_0x2c2ef3(0xb6)]:_0x59b47d;if(!_0x17d50e||typeof _0x17d50e[_0x2c2ef3(0xd7)]!=='function')return;try{_0x525f69['layerHistories'][_0x59533b][_0x2c2ef3(0xc9)](_0x17d50e[_0x2c2ef3(0xd7)]());if(_0x525f69['layerHistories'][_0x59533b]['length']>0x32)_0x525f69[_0x2c2ef3(0xb8)][_0x59533b][_0x2c2ef3(0xda)]();_0x525f69[_0x2c2ef3(0xb9)][_0x59533b]=[];try{if(typeof updateUndoRedoButtons===_0x2c2ef3(0xd8))updateUndoRedoButtons();}catch(_0x2625b5){}if(typeof window['requestAutoSave']===_0x2c2ef3(0xd8))window['requestAutoSave']();}catch(_0x521d23){console[_0x2c2ef3(0xd0)](_0x2c2ef3(0xd5),_0x521d23);}}async function idbSet(_0x276ec7,_0x37a357){const _0x153408=await openDB();return new Promise((_0x69d031,_0x5c8b06)=>{const _0x432e20=_0x55cf,_0x1c9b6d=_0x153408[_0x432e20(0xdc)](storeName,_0x432e20(0xe6));_0x1c9b6d[_0x432e20(0xba)](storeName)[_0x432e20(0xd2)](_0x37a357,_0x276ec7),_0x1c9b6d['oncomplete']=()=>_0x69d031(),_0x1c9b6d['onerror']=()=>_0x5c8b06(_0x1c9b6d[_0x432e20(0xd0)]);});}async function idbGet(_0x58796b){const _0x245f45=await openDB();return new Promise((_0x234041,_0x503c88)=>{const _0x41031c=_0x55cf,_0xbe611=_0x245f45[_0x41031c(0xdc)](storeName,_0x41031c(0xdf)),_0x4d2c1b=_0xbe611[_0x41031c(0xba)](storeName)[_0x41031c(0xe3)](_0x58796b);_0x4d2c1b[_0x41031c(0xed)]=()=>_0x234041(_0x4d2c1b['result']),_0x4d2c1b['onerror']=()=>_0x503c88(_0x4d2c1b['error']);});}async function idbDelete(_0x4d90de){const _0x1eacb8=await openDB();return new Promise((_0x5b042a,_0x349a58)=>{const _0x344f14=_0x55cf,_0x183b37=_0x1eacb8['transaction'](storeName,_0x344f14(0xe6));_0x183b37[_0x344f14(0xba)](storeName)[_0x344f14(0xd1)](_0x4d90de),_0x183b37[_0x344f14(0xe8)]=()=>_0x5b042a(),_0x183b37[_0x344f14(0xc7)]=()=>_0x349a58(_0x183b37[_0x344f14(0xd0)]);});}async function idbClear(){const _0x2ecf04=await openDB();return new Promise((_0x1071d1,_0x6068f6)=>{const _0x591575=_0x55cf,_0x4d137f=_0x2ecf04[_0x591575(0xdc)](storeName,'readwrite');_0x4d137f['objectStore'](storeName)[_0x591575(0xde)](),_0x4d137f[_0x591575(0xe8)]=()=>_0x1071d1(),_0x4d137f[_0x591575(0xc7)]=()=>_0x6068f6(_0x4d137f['error']);});}async function savePaletteToDB(){const _0x222135=_0x55cf;try{await idbSet(_0x222135(0xb3),PALETTE_COLORS);}catch(_0x2e1da8){console['error'](_0x222135(0xbb),_0x2e1da8);}}function _0x55cf(_0x52725c,_0x63d6e){_0x52725c=_0x52725c-0xb0;const _0x2a28f1=_0x3904();let _0x377f93=_0x2a28f1[_0x52725c];return _0x377f93;}function _0x3904(){const _0x234d36=['target','error','delete','put','onload','(((.+)+)+)+$','saveHistory\x20error','search','toDataURL','function','name','shift','all','transaction','drawImage','clear','readonly','constructor','project','height','get','画像ファイルを読み込み中...','readAsArrayBuffer','readwrite','16GTKMFh','oncomplete','clearRect','toString','3677301uVODGj','5708370tPScHW','onsuccess','getContext','slice','apply','string','isArray','nezumi-palette','map','2226724bYapvJ','canvas','undefined','layerHistories','layerRedoStacks','objectStore','保存エラー','width','forEach','読込エラー','anonymous','number','457560Lsiixr','result','layers','includes','10102239qEvwuc','activeLayer','onerror','frames','push','メタデータが見つかりませんでした','5358444stqoyI','460738wxSvod','length','src'];_0x3904=function(){return _0x234d36;};return _0x3904();}async function loadPaletteFromDB(){const _0x46de1a=_0x55cf;try{const _0x3794e3=await idbGet('nezumi-palette');if(Array[_0x46de1a(0xb2)](_0x3794e3)&&_0x3794e3['length']){const _0x3da1c7=[];_0x3794e3[_0x46de1a(0xbd)](_0xfa0af6=>{const _0x1d3678=_0x46de1a;if(typeof _0xfa0af6===_0x1d3678(0xb1)&&!_0x3da1c7[_0x1d3678(0xc4)](_0xfa0af6))_0x3da1c7[_0x1d3678(0xc9)](_0xfa0af6);});for(const _0x1071c6 of typeof DEFAULT_PALETTE!==_0x46de1a(0xb7)?DEFAULT_PALETTE:[]){if(!_0x3da1c7['includes'](_0x1071c6))_0x3da1c7[_0x46de1a(0xc9)](_0x1071c6);}PALETTE_COLORS=_0x3da1c7[_0x46de1a(0xef)](0x0,0x18);}}catch(_0x24f9a){console[_0x46de1a(0xd0)](_0x46de1a(0xbe),_0x24f9a);}}async function loadImages(_0x11fdcb){const _0x11a6a6=_0x55cf,_0x511282=await Promise[_0x11a6a6(0xdb)](_0x11fdcb[_0x11a6a6(0xb4)](_0x3356fb=>{return new Promise(_0x1d7571=>{const _0x173d39=_0x55cf,_0x59a91b=new Image();_0x59a91b['crossOrigin']=_0x173d39(0xbf),_0x59a91b[_0x173d39(0xce)]=_0x3356fb,_0x59a91b[_0x173d39(0xd3)]=()=>_0x1d7571(_0x59a91b);});}));return _0x511282;}function loadStandaloneFromFile(_0x3c0f0a){return new Promise((_0x5bbe5a,_0x1a8aed)=>{const _0x4b7581=_0x55cf;try{showLoading(_0x4b7581(0xe4));}catch(_0x5d4a37){}const _0x5a693f=new FileReader();_0x5a693f[_0x4b7581(0xd3)]=_0x8a7543=>{const _0x157ed4=_0x4b7581,_0x12dc68=_0x8a7543[_0x157ed4(0xcf)][_0x157ed4(0xc2)],_0x352977=extractMetadataFromArrayBuffer(_0x12dc68);if(!_0x352977||!_0x352977[_0x157ed4(0xe1)]){try{hideLoading();}catch(_0x38426c){}_0x1a8aed(new Error(_0x157ed4(0xca)));return;}const _0x516756=_0x352977[_0x157ed4(0xe1)];try{const _0x21e292=createProject(_0x516756['width'],_0x516756['height'],_0x516756[_0x157ed4(0xd9)]||'画像');_0x21e292[_0x157ed4(0xc8)]=_0x516756[_0x157ed4(0xc8)][_0x157ed4(0xb4)](_0x4b028a=>{const _0x10c4cd=_0x157ed4;let _0x2ee634={'layers':[],'activeLayer':_0x4b028a[_0x10c4cd(0xc6)],'layerHistories':[],'layerRedoStacks':[]};for(let _0x566eb0=0x0;_0x566eb0<_0x4b028a[_0x10c4cd(0xc3)][_0x10c4cd(0xcd)];_0x566eb0++){let _0xbb0dc8=new Image();_0xbb0dc8[_0x10c4cd(0xce)]=_0x4b028a[_0x10c4cd(0xc3)][_0x566eb0];let _0x582bb2=document['createElement'](_0x10c4cd(0xb6));_0x582bb2[_0x10c4cd(0xbc)]=_0x516756[_0x10c4cd(0xbc)]*cellSize,_0x582bb2[_0x10c4cd(0xe2)]=_0x516756[_0x10c4cd(0xe2)]*cellSize,_0xbb0dc8[_0x10c4cd(0xd3)]=()=>{const _0x749c70=_0x10c4cd;let _0x371178=_0x582bb2[_0x749c70(0xee)]('2d');_0x371178[_0x749c70(0xe9)](0x0,0x0,_0x582bb2['width'],_0x582bb2[_0x749c70(0xe2)]),_0x371178[_0x749c70(0xdd)](_0xbb0dc8,0x0,0x0);try{redrawAll();}catch(_0x2c4b5c){}},_0x2ee634[_0x10c4cd(0xc3)][_0x10c4cd(0xc9)](_0x582bb2);}return _0x2ee634;}),projects[_0x157ed4(0xc9)](_0x21e292),activeProject=projects['length']-0x1,updateProjectUI(),updateFrameUI(),updateLayerUI(),redrawAll();try{hideLoading();}catch(_0x372993){}_0x5bbe5a(_0x21e292);}catch(_0x3110a7){try{hideLoading();}catch(_0x3baff7){}_0x1a8aed(_0x3110a7);}},_0x5a693f['onerror']=_0x3b15d3=>{try{hideLoading();}catch(_0x286e90){};_0x1a8aed(_0x3b15d3);},_0x5a693f[_0x4b7581(0xe5)](_0x3c0f0a);});}